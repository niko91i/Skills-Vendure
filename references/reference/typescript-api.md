# AssetNamingStrategy


## AssetNamingStrategy​


[​](#assetnamingstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[asset-naming-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/asset-naming-strategy/asset-naming-strategy.ts#L18)The AssetNamingStrategy determines how file names are generated based on the uploaded source file name,
as well as how to handle naming conflicts.

This is configured via the assetOptions.assetNamingStrategy property of
your VendureConfig.

```
interface AssetNamingStrategy extends InjectableStrategy {    generateSourceFileName(ctx: RequestContext, originalFileName: string, conflictFileName?: string): string;    generatePreviewFileName(ctx: RequestContext, sourceFileName: string, conflictFileName?: string): string;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### generateSourceFileName​


[​](#generatesourcefilename)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Given the original file name of the uploaded file, generate a file name to
be stored on the server. Operations like normalization and time-stamping can
be performed in this method.

The output will be checked for a naming conflict with an existing file. If a conflict
exists, this method will be invoked again with the second argument passed in and a new, unique
file name should then be generated. This process will repeat until a unique file name has
been returned.

### generatePreviewFileName​


[​](#generatepreviewfilename)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Given the source file name generated in the generateSourceFileName method, this method
should generate the file name of the preview image.

The same mechanism of checking for conflicts is used as described above.


---

# AssetOptions


## AssetOptions​


[​](#assetoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts#L675)The AssetOptions define how assets (images and other files) are named and stored, and how preview images are generated.

Note: If you are using the AssetServerPlugin, it is not necessary to configure these options.

```
interface AssetOptions {    assetNamingStrategy?: AssetNamingStrategy;    assetStorageStrategy?: AssetStorageStrategy;    assetPreviewStrategy?: AssetPreviewStrategy;    permittedFileTypes?: string[];    uploadMaxFileSize?: number;}
```

### assetNamingStrategy​


[​](#assetnamingstrategy)[AssetNamingStrategy](/reference/typescript-api/assets/asset-naming-strategy#assetnamingstrategy)[DefaultAssetNamingStrategy](/reference/typescript-api/assets/default-asset-naming-strategy#defaultassetnamingstrategy)Defines how asset files and preview images are named before being saved.

### assetStorageStrategy​


[​](#assetstoragestrategy)[AssetStorageStrategy](/reference/typescript-api/assets/asset-storage-strategy#assetstoragestrategy)Defines the strategy used for storing uploaded binary files.

### assetPreviewStrategy​


[​](#assetpreviewstrategy)[AssetPreviewStrategy](/reference/typescript-api/assets/asset-preview-strategy#assetpreviewstrategy)Defines the strategy used for creating preview images of uploaded assets.

### permittedFileTypes​


[​](#permittedfiletypes)An array of the permitted file types that may be uploaded as Assets. Each entry
should be in the form of a valid
unique file type specifier
i.e. either a file extension (".pdf") or a mime type ("image/*", "audio/mpeg" etc.).

[unique file type specifier](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file#Unique_file_type_specifiers)
### uploadMaxFileSize​


[​](#uploadmaxfilesize)The max file size in bytes for uploaded assets.


---

# AssetPreviewStrategy


## AssetPreviewStrategy​


[​](#assetpreviewstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[asset-preview-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/asset-preview-strategy/asset-preview-strategy.ts#L25)The AssetPreviewStrategy determines how preview images for assets are created. For image
assets, this would usually typically involve resizing to sensible dimensions. Other file types
could be previewed in a variety of ways, e.g.:

- waveform images generated for audio files
- preview images generated for pdf documents
- watermarks added to preview images

This is configured via the assetOptions.assetPreviewStrategy property of
your VendureConfig.

```
interface AssetPreviewStrategy extends InjectableStrategy {    generatePreviewImage(ctx: RequestContext, mimeType: string, data: Buffer): Promise<Buffer>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### generatePreviewImage​


[​](#generatepreviewimage)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)


---

# AssetStorageStrategy


## AssetStorageStrategy​


[​](#assetstoragestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[asset-storage-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/asset-storage-strategy/asset-storage-strategy.ts#L32)The AssetPersistenceStrategy determines how Asset files are physically stored
and retrieved.

This is configured via the assetOptions.assetStorageStrategy property of
your VendureConfig.

```
interface AssetStorageStrategy extends InjectableStrategy {    writeFileFromBuffer(fileName: string, data: Buffer): Promise<string>;    writeFileFromStream(fileName: string, data: Stream): Promise<string>;    readFileToBuffer(identifier: string): Promise<Buffer>;    readFileToStream(identifier: string): Promise<Stream>;    deleteFile(identifier: string): Promise<void>;    fileExists(fileName: string): Promise<boolean>;    toAbsoluteUrl?(request: Request, identifier: string): string;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### writeFileFromBuffer​


[​](#writefilefrombuffer)Writes a buffer to the store and returns a unique identifier for that
file such as a file path or a URL.

### writeFileFromStream​


[​](#writefilefromstream)Writes a readable stream to the store and returns a unique identifier for that
file such as a file path or a URL.

### readFileToBuffer​


[​](#readfiletobuffer)Reads a file based on an identifier which was generated by the writeFile
method, and returns the as a Buffer.

### readFileToStream​


[​](#readfiletostream)Reads a file based on an identifier which was generated by the writeFile
method, and returns the file as a Stream.

### deleteFile​


[​](#deletefile)Deletes a file from the storage.

### fileExists​


[​](#fileexists)Check whether a file with the given name already exists. Used to avoid
naming conflicts before saving the file.

### toAbsoluteUrl​


[​](#toabsoluteurl)Convert an identifier as generated by the writeFile... methods into an absolute
url (if it is not already in that form). If no conversion step is needed
(i.e. the identifier is already an absolute url) then this method
should not be implemented.


---

# DefaultAssetNamingStrategy


## DefaultAssetNamingStrategy​


[​](#defaultassetnamingstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-asset-naming-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/asset-naming-strategy/default-asset-naming-strategy.ts#L15)The default strategy normalizes the file names to remove unwanted characters and
in the case of conflicts, increments a counter suffix.

```
class DefaultAssetNamingStrategy implements AssetNamingStrategy {    generateSourceFileName(ctx: RequestContext, originalFileName: string, conflictFileName?: string) => string;    generatePreviewFileName(ctx: RequestContext, sourceFileName: string, conflictFileName?: string) => string;}
```

- Implements: AssetNamingStrategy

[AssetNamingStrategy](/reference/typescript-api/assets/asset-naming-strategy#assetnamingstrategy)
### generateSourceFileName​


[​](#generatesourcefilename)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### generatePreviewFileName​


[​](#generatepreviewfilename)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)


---

# AuthOptions


## AuthOptions​


[​](#authoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts#L360)The AuthOptions define how authentication and authorization is managed.

```
interface AuthOptions {    disableAuth?: boolean;    tokenMethod?: 'cookie' | 'bearer' | ReadonlyArray<'cookie' | 'bearer'>;    cookieOptions?: CookieOptions;    authTokenHeaderKey?: string;    sessionDuration?: string | number;    sessionCacheStrategy?: SessionCacheStrategy;    sessionCacheTTL?: string | number;    requireVerification?: boolean;    verificationTokenDuration?: string | number;    superadminCredentials?: SuperadminCredentials;    shopAuthenticationStrategy?: AuthenticationStrategy[];    adminAuthenticationStrategy?: AuthenticationStrategy[];    customPermissions?: PermissionDefinition[];    passwordHashingStrategy?: PasswordHashingStrategy;    passwordValidationStrategy?: PasswordValidationStrategy;    verificationTokenStrategy?: VerificationTokenStrategy;}
```

### disableAuth​


[​](#disableauth)Disable authentication & permissions checks.
NEVER set the to true in production. It exists
only to aid certain development tasks.

### tokenMethod​


[​](#tokenmethod)Sets the method by which the session token is delivered and read.

- 'cookie': Upon login, a 'Set-Cookie' header will be returned to the client, setting a
cookie containing the session token. A browser-based client (making requests with credentials)
should automatically send the session cookie with each request.
- 'bearer': Upon login, the token is returned in the response and should be then stored by the
client app. Each request should include the header Authorization: Bearer <token>.

Note that if the bearer method is used, Vendure will automatically expose the configured
authTokenHeaderKey in the server's CORS configuration (adding Access-Control-Expose-Headers: vendure-auth-token
by default).

From v1.2.0 it is possible to specify both methods as a tuple: ['cookie', 'bearer'].

### cookieOptions​


[​](#cookieoptions)[CookieOptions](/reference/typescript-api/auth/cookie-options#cookieoptions)Options related to the handling of cookies when using the 'cookie' tokenMethod.

### authTokenHeaderKey​


[​](#authtokenheaderkey)Sets the header property which will be used to send the auth token when using the 'bearer' method.

### sessionDuration​


[​](#sessionduration)Session duration, i.e. the time which must elapse from the last authenticated request
after which the user must re-authenticate.

If passed as a number should represent milliseconds and if passed as a string describes a time span per
zeit/ms.  Eg: 60, '2 days', '10h', '7d'

[zeit/ms](https://github.com/zeit/ms.js)
### sessionCacheStrategy​


[​](#sessioncachestrategy)[SessionCacheStrategy](/reference/typescript-api/auth/session-cache-strategy#sessioncachestrategy)[DefaultSessionCacheStrategy](/reference/typescript-api/auth/default-session-cache-strategy#defaultsessioncachestrategy)This strategy defines how sessions will be cached. By default, since v3.1.0, sessions are cached using
the underlying cache strategy defined in the SystemOptions.cacheStrategy.

[SystemOptions](/reference/typescript-api/configuration/system-options#systemoptions)
### sessionCacheTTL​


[​](#sessioncachettl)The "time to live" of a given item in the session cache. This determines the length of time that a cache entry
is kept before being considered "stale" and being replaced with fresh data taken from the database.

If passed as a number should represent seconds and if passed as a string describes a time span per
zeit/ms. Eg: 60, '2 days', '10h', '7d'

[zeit/ms](https://github.com/zeit/ms.js)
### requireVerification​


[​](#requireverification)Determines whether new User accounts require verification of their email address.

If set to "true", the customer will be required to verify their email address using a verification token
they receive in their email. See the registerCustomerAccount mutation for more details on the verification behavior.

### verificationTokenDuration​


[​](#verificationtokenduration)Sets the length of time that a verification token is valid for, after which the verification token must be refreshed.

If passed as a number should represent milliseconds and if passed as a string describes a time span per
zeit/ms.  Eg: 60, '2 days', '10h', '7d'

[zeit/ms](https://github.com/zeit/ms.js)
### superadminCredentials​


[​](#superadmincredentials)[SuperadminCredentials](/reference/typescript-api/auth/superadmin-credentials#superadmincredentials)Configures the credentials to be used to create a superadmin

### shopAuthenticationStrategy​


[​](#shopauthenticationstrategy)[AuthenticationStrategy](/reference/typescript-api/auth/authentication-strategy#authenticationstrategy)[NativeAuthenticationStrategy](/reference/typescript-api/auth/native-authentication-strategy#nativeauthenticationstrategy)Configures one or more AuthenticationStrategies which defines how authentication
is handled in the Shop API.

### adminAuthenticationStrategy​


[​](#adminauthenticationstrategy)[AuthenticationStrategy](/reference/typescript-api/auth/authentication-strategy#authenticationstrategy)[NativeAuthenticationStrategy](/reference/typescript-api/auth/native-authentication-strategy#nativeauthenticationstrategy)Configures one or more AuthenticationStrategy which defines how authentication
is handled in the Admin API.

### customPermissions​


[​](#custompermissions)[PermissionDefinition](/reference/typescript-api/auth/permission-definition#permissiondefinition)Allows custom Permissions to be defined, which can be used to restrict access to custom
GraphQL resolvers defined in plugins.

### passwordHashingStrategy​


[​](#passwordhashingstrategy)[PasswordHashingStrategy](/reference/typescript-api/auth/password-hashing-strategy#passwordhashingstrategy)[BcryptPasswordHashingStrategy](/reference/typescript-api/auth/bcrypt-password-hashing-strategy#bcryptpasswordhashingstrategy)Allows you to customize the way passwords are hashed when using the NativeAuthenticationStrategy.

[NativeAuthenticationStrategy](/reference/typescript-api/auth/native-authentication-strategy#nativeauthenticationstrategy)
### passwordValidationStrategy​


[​](#passwordvalidationstrategy)[PasswordValidationStrategy](/reference/typescript-api/auth/password-validation-strategy#passwordvalidationstrategy)[DefaultPasswordValidationStrategy](/reference/typescript-api/auth/default-password-validation-strategy#defaultpasswordvalidationstrategy)Allows you to set a custom policy for passwords when using the NativeAuthenticationStrategy.
By default, it uses the DefaultPasswordValidationStrategy, which will impose a minimum length
of four characters. To improve security for production, you are encouraged to specify a more strict
policy, which you can do like this:

[NativeAuthenticationStrategy](/reference/typescript-api/auth/native-authentication-strategy#nativeauthenticationstrategy)[DefaultPasswordValidationStrategy](/reference/typescript-api/auth/default-password-validation-strategy#defaultpasswordvalidationstrategy)Example

```
{  passwordValidationStrategy: new DefaultPasswordValidationStrategy({    // Minimum eight characters, at least one letter and one number    regexp: /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/,  }),}
```

### verificationTokenStrategy​


[​](#verificationtokenstrategy)[VerificationTokenStrategy](/reference/typescript-api/auth/verification-token-strategy#verificationtokenstrategy)[DefaultVerificationTokenStrategy](/reference/typescript-api/auth/default-verification-token-strategy#defaultverificationtokenstrategy)Allows you to customize the way verification tokens are generated.


---

# AuthenticationStrategy


## AuthenticationStrategy​


[​](#authenticationstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[authentication-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/auth/authentication-strategy.ts#L23)An AuthenticationStrategy defines how a User (which can be a Customer in the Shop API or
and Administrator in the Admin API) may be authenticated.

Real-world examples can be found in the Authentication guide.

[Authentication guide](/guides/core-concepts/auth/)This is configured via the authOptions.shopAuthenticationStrategy and authOptions.adminAuthenticationStrategy
properties of your VendureConfig.

```
interface AuthenticationStrategy<Data = unknown> extends InjectableStrategy {    readonly name: string;    defineInputType(): DocumentNode;    authenticate(ctx: RequestContext, data: Data): Promise<User | false | string>;    onLogOut?(ctx: RequestContext, user: User): Promise<void>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### name​


[​](#name)The name of the strategy, for example 'facebook', 'google', 'keycloak'.

### defineInputType​


[​](#defineinputtype)Defines the type of the GraphQL Input object expected by the authenticate
mutation. The final input object will be a map, with the key being the name
of the strategy. The shape of the input object should match the generic Data
type argument.

Example

For example, given the following:

```
defineInputType() {  return gql`     input MyAuthInput {       token: String!     }  `;}
```

assuming the strategy name is "my_auth", then the resulting call to authenticate
would look like:

```
authenticate(input: {  my_auth: {    token: "foo"  }}) {  # ...}

```

Note: if more than one graphql input type is being defined (as in a nested input type), then
the first input will be assumed to be the top-level input.

### authenticate​


[​](#authenticate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)Used to authenticate a user with the authentication provider. This method
will implement the provider-specific authentication logic, and should resolve to either a
User object on success, or false | string on failure.
A string return could be used to describe what error happened, otherwise false to an unknown error.

[User](/reference/typescript-api/entities/user#user)
### onLogOut​


[​](#onlogout)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)Called when a user logs out, and may perform any required tasks
related to the user logging out with the external provider.


---

# BcryptPasswordHashingStrategy


## BcryptPasswordHashingStrategy​


[​](#bcryptpasswordhashingstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[bcrypt-password-hashing-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/auth/bcrypt-password-hashing-strategy.ts#L12)A hashing strategy which uses bcrypt (https://en.wikipedia.org/wiki/Bcrypt) to hash plaintext password strings.

[https://en.wikipedia.org/wiki/Bcrypt](https://en.wikipedia.org/wiki/Bcrypt)
```
class BcryptPasswordHashingStrategy implements PasswordHashingStrategy {    hash(plaintext: string) => Promise<string>;    check(plaintext: string, hash: string) => Promise<boolean>;}
```

- Implements: PasswordHashingStrategy

[PasswordHashingStrategy](/reference/typescript-api/auth/password-hashing-strategy#passwordhashingstrategy)
### hash​


[​](#hash)
### check​


[​](#check)


---

# CookieOptions


## CookieOptions​


[​](#cookieoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts#L255)Options for the handling of the cookies used to track sessions (only applicable if
authOptions.tokenMethod is set to 'cookie'). These options are passed directly
to the Express cookie-session middleware.

[cookie-session middleware](https://github.com/expressjs/cookie-session)
```
interface CookieOptions {    name?: string | { shop: string; admin: string };    secret?: string;    path?: string;    domain?: string;    sameSite?: 'strict' | 'lax' | 'none' | boolean;    secure?: boolean;    secureProxy?: boolean;    httpOnly?: boolean;    signed?: boolean;    overwrite?: boolean;    maxAge?: number;    expires?: Date;}
```

### name​


[​](#name)The name of the cookies to set.
If set to a string, both cookies for the Admin API and Shop API will have the same name.
If set as an object, it makes it possible to give different names to the Admin API and the Shop API cookies

### secret​


[​](#secret)The secret used for signing the session cookies for authenticated users. Only applies
tokenMethod is set to 'cookie'.

In production applications, this should not be stored as a string in
source control for security reasons, but may be loaded from an external
file not under source control, or from an environment variable, for example.

### path​


[​](#path)a string indicating the path of the cookie.

### domain​


[​](#domain)a string indicating the domain of the cookie (no default).

### sameSite​


[​](#samesite)a boolean or string indicating whether the cookie is a "same site" cookie (false by default). This can be set to 'strict',
'lax', 'none', or true (which maps to 'strict').

### secure​


[​](#secure)a boolean indicating whether the cookie is only to be sent over HTTPS (false by default for HTTP, true by default for HTTPS).

### secureProxy​


[​](#secureproxy)a boolean indicating whether the cookie is only to be sent over HTTPS (use this if you handle SSL not in your node process).

### httpOnly​


[​](#httponly)a boolean indicating whether the cookie is only to be sent over HTTP(S), and not made available to client JavaScript (true by default).

### signed​


[​](#signed)a boolean indicating whether the cookie is to be signed (true by default). If this is true, another cookie of the same name with the .sig
suffix appended will also be sent, with a 27-byte url-safe base64 SHA1 value representing the hash of cookie-name=cookie-value against the
first Keygrip key. This signature key is used to detect tampering the next time a cookie is received.

### overwrite​


[​](#overwrite)a boolean indicating whether to overwrite previously set cookies of the same name (true by default). If this is true, all cookies set during
the same request with the same name (regardless of path or domain) are filtered out of the Set-Cookie header when setting this cookie.

### maxAge​


[​](#maxage)A number representing the milliseconds from Date.now() for expiry

### expires​


[​](#expires)a Date object indicating the cookie's expiration date (expires at the end of session by default).


---

# DefaultPasswordValidationStrategy


## DefaultPasswordValidationStrategy​


[​](#defaultpasswordvalidationstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-password-validation-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/auth/default-password-validation-strategy.ts#L18)The DefaultPasswordValidationStrategy allows you to specify a minimum length and/or
a regular expression to match passwords against. The default maxLength is 72.

TODO:
By default, the minLength will be set to 4. This is rather permissive and is only
this way in order to reduce the risk of backward-compatibility breaks. In the next major version
this default will be made more strict.

```
class DefaultPasswordValidationStrategy implements PasswordValidationStrategy {    constructor(options: { minLength?: number; maxLength?: number; regexp?: RegExp })    validate(ctx: RequestContext, password: string) => boolean | string;}
```

- Implements: PasswordValidationStrategy

[PasswordValidationStrategy](/reference/typescript-api/auth/password-validation-strategy#passwordvalidationstrategy)
### constructor​


[​](#constructor)
### validate​


[​](#validate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)


---

# DefaultSessionCacheStrategy


## DefaultSessionCacheStrategy​


[​](#defaultsessioncachestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-session-cache-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/session-cache/default-session-cache-strategy.ts#L17)The default SessionCacheStrategy delegates to the configured
CacheStrategy to store the session data. This should be suitable
for most use-cases, assuming you select a suitable CacheStrategy

[SessionCacheStrategy](/reference/typescript-api/auth/session-cache-strategy#sessioncachestrategy)[CacheStrategy](/reference/typescript-api/cache/cache-strategy#cachestrategy)[CacheStrategy](/reference/typescript-api/cache/cache-strategy#cachestrategy)
```
class DefaultSessionCacheStrategy implements SessionCacheStrategy {    protected cacheService: CacheService;    constructor(options?: {            ttl?: number;            cachePrefix?: string;        })    init(injector: Injector) => ;    set(session: CachedSession) => Promise<void>;    get(sessionToken: string) => Promise<CachedSession | undefined>;    delete(sessionToken: string) => void | Promise<void>;    clear() => Promise<void>;}
```

- Implements: SessionCacheStrategy

[SessionCacheStrategy](/reference/typescript-api/auth/session-cache-strategy#sessioncachestrategy)
### cacheService​


[​](#cacheservice)[CacheService](/reference/typescript-api/cache/cache-service#cacheservice)
### constructor​


[​](#constructor)
### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)
### set​


[​](#set)[CachedSession](/reference/typescript-api/auth/session-cache-strategy#cachedsession)
### get​


[​](#get)[CachedSession](/reference/typescript-api/auth/session-cache-strategy#cachedsession)
### delete​


[​](#delete)
### clear​


[​](#clear)


---

# DefaultVerificationTokenStrategy


## DefaultVerificationTokenStrategy​


[​](#defaultverificationtokenstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-verification-token-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/auth/default-verification-token-strategy.ts#L20)The default VerificationTokenStrategy which generates a token consisting of the
base64-encoded current time concatenated with a random id. The token is considered
valid if the current time is within the configured verificationTokenDuration of the
time encoded in the token.

```
class DefaultVerificationTokenStrategy implements VerificationTokenStrategy {    init(injector: Injector) => ;    generateVerificationToken(_ctx: RequestContext) => string;    verifyVerificationToken(_ctx: RequestContext, token: string) => boolean;}
```

- Implements: VerificationTokenStrategy

[VerificationTokenStrategy](/reference/typescript-api/auth/verification-token-strategy#verificationtokenstrategy)
### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)
### generateVerificationToken​


[​](#generateverificationtoken)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### verifyVerificationToken​


[​](#verifyverificationtoken)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)


---

# ExternalAuthenticationService


## ExternalAuthenticationService​


[​](#externalauthenticationservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[external-authentication.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/external-authentication/external-authentication.service.ts#L24)This is a helper service which exposes methods related to looking up and creating Users based on an
external AuthenticationStrategy.

[AuthenticationStrategy](/reference/typescript-api/auth/authentication-strategy#authenticationstrategy)
```
class ExternalAuthenticationService {    constructor(connection: TransactionalConnection, roleService: RoleService, historyService: HistoryService, customerService: CustomerService, administratorService: AdministratorService, channelService: ChannelService)    findCustomerUser(ctx: RequestContext, strategy: string, externalIdentifier: string, checkCurrentChannelOnly:  = true) => Promise<User | undefined>;    findAdministratorUser(ctx: RequestContext, strategy: string, externalIdentifier: string) => Promise<User | undefined>;    createCustomerAndUser(ctx: RequestContext, config: {            strategy: string;            externalIdentifier: string;            emailAddress: string;            firstName: string;            lastName: string;            verified?: boolean;        }) => Promise<User>;    createAdministratorAndUser(ctx: RequestContext, config: {            strategy: string;            externalIdentifier: string;            identifier: string;            emailAddress?: string;            firstName?: string;            lastName?: string;            roles: Role[];        }) => ;    findUser(ctx: RequestContext, strategy: string, externalIdentifier: string) => Promise<User | undefined>;    createUser(ctx: RequestContext, config: {            strategy: string;            externalIdentifier: string;        }) => Promise<User>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[RoleService](/reference/typescript-api/services/role-service#roleservice)[HistoryService](/reference/typescript-api/services/history-service#historyservice)[CustomerService](/reference/typescript-api/services/customer-service#customerservice)[AdministratorService](/reference/typescript-api/services/administrator-service#administratorservice)[ChannelService](/reference/typescript-api/services/channel-service#channelservice)
### findCustomerUser​


[​](#findcustomeruser)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)Looks up a User based on their identifier from an external authentication
provider, ensuring this User is associated with a Customer account.

By default, only customers in the currently-active Channel will be checked.
By passing false as the checkCurrentChannelOnly argument, all channels
will be checked.

### findAdministratorUser​


[​](#findadministratoruser)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)Looks up a User based on their identifier from an external authentication
provider, ensuring this User is associated with an Administrator account.

### createCustomerAndUser​


[​](#createcustomeranduser)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)If a customer has been successfully authenticated by an external authentication provider, yet cannot
be found using findCustomerUser, then we need to create a new User and
Customer record in Vendure for that user. This method encapsulates that logic as well as additional
housekeeping such as adding a record to the Customer's history.

### createAdministratorAndUser​


[​](#createadministratoranduser)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Role](/reference/typescript-api/entities/role#role)If an administrator has been successfully authenticated by an external authentication provider, yet cannot
be found using findAdministratorUser, then we need to create a new User and
Administrator record in Vendure for that user.

### findUser​


[​](#finduser)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)
### createUser​


[​](#createuser)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)Looks up a User based on their identifier from an external authentication
provider. Creates the user if does not exist. Unlike findCustomerUser and findAdministratorUser,
this method does not enforce that the User is associated with a Customer or
Administrator account.


---

# InMemorySessionCacheStrategy


## InMemorySessionCacheStrategy​


[​](#inmemorysessioncachestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[in-memory-session-cache-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/session-cache/in-memory-session-cache-strategy.ts#L16)Caches session in memory, using a LRU cache implementation. Not suitable for
multi-server setups since the cache will be local to each instance, reducing
its effectiveness. By default the cache has a size of 1000, meaning that after
1000 sessions have been cached, any new sessions will cause the least-recently-used
session to be evicted (removed) from the cache.

The cache size can be configured by passing a different number to the constructor
function.

```
class InMemorySessionCacheStrategy implements SessionCacheStrategy {    constructor(cacheSize?: number)    delete(sessionToken: string) => ;    get(sessionToken: string) => ;    set(session: CachedSession) => ;    clear() => ;}
```

- Implements: SessionCacheStrategy

[SessionCacheStrategy](/reference/typescript-api/auth/session-cache-strategy#sessioncachestrategy)
### constructor​


[​](#constructor)
### delete​


[​](#delete)
### get​


[​](#get)
### set​


[​](#set)[CachedSession](/reference/typescript-api/auth/session-cache-strategy#cachedsession)
### clear​


[​](#clear)


---

# NativeAuthenticationStrategy


## NativeAuthenticationStrategy​


[​](#nativeauthenticationstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[native-authentication-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/auth/native-authentication-strategy.ts#L28)This strategy implements a username/password credential-based authentication, with the credentials
being stored in the Vendure database. This is the default method of authentication, and it is advised
to keep it configured unless there is a specific reason not to.

```
class NativeAuthenticationStrategy implements AuthenticationStrategy<NativeAuthenticationData> {    readonly name = NATIVE_AUTH_STRATEGY_NAME;    init(injector: Injector) => ;    defineInputType() => DocumentNode;    authenticate(ctx: RequestContext, data: NativeAuthenticationData) => Promise<User | false>;    verifyUserPassword(ctx: RequestContext, userId: ID, password: string) => Promise<boolean>;}
```

- Implements: AuthenticationStrategy<NativeAuthenticationData>

[AuthenticationStrategy](/reference/typescript-api/auth/authentication-strategy#authenticationstrategy)
### name​


[​](#name)
### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)
### defineInputType​


[​](#defineinputtype)
### authenticate​


[​](#authenticate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)
### verifyUserPassword​


[​](#verifyuserpassword)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)


---

# NoopSessionCacheStrategy


## NoopSessionCacheStrategy​


[​](#noopsessioncachestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[noop-session-cache-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/session-cache/noop-session-cache-strategy.ts#L10)A cache that doesn't cache. The cache lookup will miss every time
so the session will always be taken from the database.

```
class NoopSessionCacheStrategy implements SessionCacheStrategy {    clear() => ;    delete(sessionToken: string) => ;    get(sessionToken: string) => ;    set(session: CachedSession) => ;}
```

- Implements: SessionCacheStrategy

[SessionCacheStrategy](/reference/typescript-api/auth/session-cache-strategy#sessioncachestrategy)
### clear​


[​](#clear)
### delete​


[​](#delete)
### get​


[​](#get)
### set​


[​](#set)[CachedSession](/reference/typescript-api/auth/session-cache-strategy#cachedsession)


---

# PasswordHashingStrategy


## PasswordHashingStrategy​


[​](#passwordhashingstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[password-hashing-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/auth/password-hashing-strategy.ts#L17)Defines how user passwords get hashed when using the NativeAuthenticationStrategy.

[NativeAuthenticationStrategy](/reference/typescript-api/auth/native-authentication-strategy#nativeauthenticationstrategy)This is configured via the authOptions.passwordHashingStrategy property of
your VendureConfig.

```
interface PasswordHashingStrategy extends InjectableStrategy {    hash(plaintext: string): Promise<string>;    check(plaintext: string, hash: string): Promise<boolean>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### hash​


[​](#hash)
### check​


[​](#check)


---

# PasswordValidationStrategy


## PasswordValidationStrategy​


[​](#passwordvalidationstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[password-validation-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/auth/password-validation-strategy.ts#L19)Defines validation to apply to new password (when creating an account or updating an existing account's
password when using the NativeAuthenticationStrategy.

[NativeAuthenticationStrategy](/reference/typescript-api/auth/native-authentication-strategy#nativeauthenticationstrategy)This is configured via the authOptions.passwordValidationStrategy property of
your VendureConfig.

```
interface PasswordValidationStrategy extends InjectableStrategy {    validate(ctx: RequestContext, password: string): Promise<boolean | string> | boolean | string;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### validate​


[​](#validate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Validates a password submitted during account registration or when a customer updates their password.
The method should resolve to true if the password is acceptable. If not, it should return false or
optionally a string which will be passed to the returned ErrorResult, which can e.g. advise on why
exactly the proposed password is not valid.


---

# PermissionDefinition


## PermissionDefinition​


[​](#permissiondefinition)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[permission-definition.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/permission-definition.ts#L86)Defines a new Permission with which to control access to GraphQL resolvers & REST controllers.
Used in conjunction with the Allow decorator (see example below).

[Allow](/reference/typescript-api/request/allow-decorator#allow)Note: To define CRUD permissions, use the CrudPermissionDefinition.

[CrudPermissionDefinition](/reference/typescript-api/auth/permission-definition#crudpermissiondefinition)Example

```
export const sync = new PermissionDefinition({  name: 'SyncInventory',  description: 'Allows syncing stock levels via Admin API'});
```

```
const config: VendureConfig = {  authOptions: {    customPermissions: [sync],  },}
```

```
@Resolver()export class ExternalSyncResolver {  @Allow(sync.Permission)  @Mutation()  syncStockLevels() {    // ...  }}
```

```
class PermissionDefinition {    constructor(config: PermissionDefinitionConfig)    Permission: Permission}
```

### constructor​


[​](#constructor)[PermissionDefinitionConfig](/reference/typescript-api/auth/permission-definition#permissiondefinitionconfig)
### Permission​


[​](#permission)[Permission](/reference/typescript-api/common/permission#permission)Returns the permission defined by this definition, for use in the
Allow decorator.

[Allow](/reference/typescript-api/request/allow-decorator#allow)
## CrudPermissionDefinition​


[​](#crudpermissiondefinition)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[permission-definition.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/permission-definition.ts#L146)Defines a set of CRUD Permissions for the given name, i.e. a name of 'Wishlist' will create
4 Permissions: 'CreateWishlist', 'ReadWishlist', 'UpdateWishlist' & 'DeleteWishlist'.

Example

```
export const wishlist = new CrudPermissionDefinition('Wishlist');
```

```
const config: VendureConfig = {  authOptions: {    customPermissions: [wishlist],  },}
```

```
@Resolver()export class WishlistResolver {  @Allow(wishlist.Create)  @Mutation()  createWishlist() {    // ...  }}
```

```
class CrudPermissionDefinition extends PermissionDefinition {    constructor(name: string, descriptionFn?: (operation: 'create' | 'read' | 'update' | 'delete') => string)    Create: Permission    Read: Permission    Update: Permission    Delete: Permission}
```

- Extends: PermissionDefinition

[PermissionDefinition](/reference/typescript-api/auth/permission-definition#permissiondefinition)
### constructor​


[​](#constructor-1)
### Create​


[​](#create)[Permission](/reference/typescript-api/common/permission#permission)Returns the 'Create' CRUD permission defined by this definition, for use in the
Allow decorator.

[Allow](/reference/typescript-api/request/allow-decorator#allow)
### Read​


[​](#read)[Permission](/reference/typescript-api/common/permission#permission)Returns the 'Read' CRUD permission defined by this definition, for use in the
Allow decorator.

[Allow](/reference/typescript-api/request/allow-decorator#allow)
### Update​


[​](#update)[Permission](/reference/typescript-api/common/permission#permission)Returns the 'Update' CRUD permission defined by this definition, for use in the
Allow decorator.

[Allow](/reference/typescript-api/request/allow-decorator#allow)
### Delete​


[​](#delete)[Permission](/reference/typescript-api/common/permission#permission)Returns the 'Delete' CRUD permission defined by this definition, for use in the
Allow decorator.

[Allow](/reference/typescript-api/request/allow-decorator#allow)
## RwPermissionDefinition​


[​](#rwpermissiondefinition)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[permission-definition.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/permission-definition.ts#L245)Defines a set of Read-Write Permissions for the given name, i.e. a name of 'DashboardSavedViews' will create
2 Permissions: 'ReadDashboardSavedViews' and 'WriteDashboardSavedViews'.

Example

```
export const dashboardSavedViews = new RwPermissionDefinition('DashboardSavedViews');
```

```
const config: VendureConfig = {  authOptions: {    customPermissions: [dashboardSavedViews],  },}
```

```
@Resolver()export class DashboardResolver {  @Allow(dashboardSavedViews.Read)  @Query()  getDashboardSavedViews() {    // ...  }  @Allow(dashboardSavedViews.Write)  @Mutation()  saveDashboardView() {    // ...  }}
```

```
class RwPermissionDefinition extends PermissionDefinition {    constructor(name: string, descriptionFn?: (operation: 'read' | 'write') => string)    Read: Permission    Write: Permission}
```

- Extends: PermissionDefinition

[PermissionDefinition](/reference/typescript-api/auth/permission-definition#permissiondefinition)
### constructor​


[​](#constructor-2)
### Read​


[​](#read-1)[Permission](/reference/typescript-api/common/permission#permission)Returns the 'Read' permission defined by this definition, for use in the
Allow decorator.

[Allow](/reference/typescript-api/request/allow-decorator#allow)
### Write​


[​](#write)[Permission](/reference/typescript-api/common/permission#permission)Returns the 'Write' permission defined by this definition, for use in the
Allow decorator.

[Allow](/reference/typescript-api/request/allow-decorator#allow)
## PermissionDefinitionConfig​


[​](#permissiondefinitionconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[permission-definition.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/permission-definition.ts#L10)Configures a PermissionDefinition

[PermissionDefinition](/reference/typescript-api/auth/permission-definition#permissiondefinition)
```
interface PermissionDefinitionConfig {    name: string;    description?: string;    assignable?: boolean;    internal?: boolean;}
```

### name​


[​](#name)The name of the permission. By convention this should be
UpperCamelCased.

### description​


[​](#description)A description of the permission.

### assignable​


[​](#assignable)Whether this permission can be assigned to a Role. In general this
should be left as the default true except in special cases.

### internal​


[​](#internal)Internal permissions are not exposed via the API and are reserved for
special use-cases such at the Owner or Public permissions.


---

# SessionCacheStrategy


## SessionCacheStrategy​


[​](#sessioncachestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[session-cache-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/session-cache/session-cache-strategy.ts#L164)This strategy defines how sessions get cached. Since most requests will need the Session
object for permissions data, it can become a bottleneck to go to the database and do a multi-join
SQL query each time. Therefore, we cache the session data only perform the SQL query once and upon
invalidation of the cache.

The Vendure default from v3.1+ is to use a the DefaultSessionCacheStrategy, which delegates
to the configured CacheStrategy to store the session data. This should be suitable
for most use-cases.

[DefaultSessionCacheStrategy](/reference/typescript-api/auth/default-session-cache-strategy#defaultsessioncachestrategy)[CacheStrategy](/reference/typescript-api/cache/cache-strategy#cachestrategy)If you are using v3.1 or later, you should not normally need to implement a custom SessionCacheStrategy,
since this is now handled by the DefaultSessionCacheStrategy.

[DefaultSessionCacheStrategy](/reference/typescript-api/auth/default-session-cache-strategy#defaultsessioncachestrategy)Prior to v3.1, the default was to use the InMemorySessionCacheStrategy, which is fast but suitable for
single-instance deployments.

[InMemorySessionCacheStrategy](/reference/typescript-api/auth/in-memory-session-cache-strategy#inmemorysessioncachestrategy)This is configured via the authOptions.sessionCacheStrategy property of
your VendureConfig.

Here's an example implementation using Redis. To use this, you need to add the
ioredis package as a dependency.

[ioredis package](https://www.npmjs.com/package/ioredis)Example

```
import { CachedSession, Logger, SessionCacheStrategy, VendurePlugin } from '@vendure/core';import { Redis, RedisOptions } from 'ioredis';export interface RedisSessionCachePluginOptions {  namespace?: string;  redisOptions?: RedisOptions;}const loggerCtx = 'RedisSessionCacheStrategy';const DEFAULT_NAMESPACE = 'vendure-session-cache';const DEFAULT_TTL = 86400;export class RedisSessionCacheStrategy implements SessionCacheStrategy {  private client: Redis;  constructor(private options: RedisSessionCachePluginOptions) {}  init() {    this.client = new Redis(this.options.redisOptions as RedisOptions);    this.client.on('error', err => Logger.error(err.message, loggerCtx, err.stack));  }  async destroy() {    await this.client.quit();  }  async get(sessionToken: string): Promise<CachedSession | undefined> {    try {      const retrieved = await this.client.get(this.namespace(sessionToken));      if (retrieved) {        try {          return JSON.parse(retrieved);        } catch (e: any) {          Logger.error(`Could not parse cached session data: ${e.message}`, loggerCtx);        }      }    } catch (e: any) {      Logger.error(`Could not get cached session: ${e.message}`, loggerCtx);    }  }  async set(session: CachedSession) {    try {      await this.client.set(this.namespace(session.token), JSON.stringify(session), 'EX', DEFAULT_TTL);    } catch (e: any) {      Logger.error(`Could not set cached session: ${e.message}`, loggerCtx);    }  }  async delete(sessionToken: string) {    try {      await this.client.del(this.namespace(sessionToken));    } catch (e: any) {      Logger.error(`Could not delete cached session: ${e.message}`, loggerCtx);    }  }  clear() {    // not implemented  }  private namespace(key: string) {    return `${this.options.namespace ?? DEFAULT_NAMESPACE}:${key}`;  }}@VendurePlugin({  configuration: config => {    config.authOptions.sessionCacheStrategy = new RedisSessionCacheStrategy(      RedisSessionCachePlugin.options,    );    return config;  },})export class RedisSessionCachePlugin {  static options: RedisSessionCachePluginOptions;  static init(options: RedisSessionCachePluginOptions) {    this.options = options;    return this;  }}
```

```
interface SessionCacheStrategy extends InjectableStrategy {    set(session: CachedSession): void | Promise<void>;    get(sessionToken: string): CachedSession | undefined | Promise<CachedSession | undefined>;    delete(sessionToken: string): void | Promise<void>;    clear(): void | Promise<void>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### set​


[​](#set)[CachedSession](/reference/typescript-api/auth/session-cache-strategy#cachedsession)Store the session in the cache. When caching a session, the data
should not be modified apart from performing any transforms needed to
get it into a state to be stored, e.g. JSON.stringify().

### get​


[​](#get)[CachedSession](/reference/typescript-api/auth/session-cache-strategy#cachedsession)[CachedSession](/reference/typescript-api/auth/session-cache-strategy#cachedsession)Retrieve the session from the cache

### delete​


[​](#delete)Delete a session from the cache

### clear​


[​](#clear)Clear the entire cache

## CachedSessionUser​


[​](#cachedsessionuser)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[session-cache-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/session-cache/session-cache-strategy.ts#L14)A simplified representation of the User associated with the
current Session.

```
type CachedSessionUser = {    id: ID;    identifier: string;    verified: boolean;    channelPermissions: UserChannelPermissions[];}
```

### id​


[​](#id)[ID](/reference/typescript-api/common/id#id)
### identifier​


[​](#identifier)
### verified​


[​](#verified)
### channelPermissions​


[​](#channelpermissions)
## CachedSession​


[​](#cachedsession)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[session-cache-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/session-cache/session-cache-strategy.ts#L29)A simplified representation of a Session which is easy to
store.

```
type CachedSession = {    cacheExpiry: number;    id: ID;    token: string;    expires: Date;    activeOrderId?: ID;    authenticationStrategy?: string;    user?: CachedSessionUser;    activeChannelId?: ID;}
```

### cacheExpiry​


[​](#cacheexpiry)The timestamp after which this cache entry is considered stale and
a fresh copy of the data will be set. Based on the sessionCacheTTL
option.

### id​


[​](#id-1)[ID](/reference/typescript-api/common/id#id)
### token​


[​](#token)
### expires​


[​](#expires)
### activeOrderId​


[​](#activeorderid)[ID](/reference/typescript-api/common/id#id)
### authenticationStrategy​


[​](#authenticationstrategy)
### user​


[​](#user)[CachedSessionUser](/reference/typescript-api/auth/session-cache-strategy#cachedsessionuser)
### activeChannelId​


[​](#activechannelid)[ID](/reference/typescript-api/common/id#id)


---

# SuperadminCredentials


## SuperadminCredentials​


[​](#superadmincredentials)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts#L851)These credentials will be used to create the Superadmin user & administrator
when Vendure first bootstraps.

```
interface SuperadminCredentials {    identifier: string;    password: string;}
```

### identifier​


[​](#identifier)The identifier to be used to create a superadmin account

### password​


[​](#password)The password to be used to create a superadmin account


---

# VerificationTokenStrategy


## VerificationTokenStrategy​


[​](#verificationtokenstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[verification-token-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/auth/verification-token-strategy.ts#L18)Defines a custom strategy for creating and validating verification tokens.

This is configured via the authOptions.verificationTokenStrategy property of
your VendureConfig.

```
interface VerificationTokenStrategy extends InjectableStrategy {    generateVerificationToken(ctx: RequestContext): Promise<string> | string;    verifyVerificationToken(ctx: RequestContext, token: string): Promise<boolean> | boolean;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### generateVerificationToken​


[​](#generateverificationtoken)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Generates a verification token.

### verifyVerificationToken​


[​](#verifyverificationtoken)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Checks the validity of a verification token.


---

# Cache


## Cache​


[​](#cache)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[cache.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/cache/cache.ts#L72)A convenience wrapper around the CacheService methods which provides a simple
API for caching and retrieving data.

[CacheService](/reference/typescript-api/cache/cache-service#cacheservice)The advantage of using the Cache class rather than directly calling the CacheService
methods is that it allows you to define a consistent way of generating cache keys and
to set default cache options, and takes care of setting the value in cache if it does not
already exist.

In most cases, using the Cache class will result in simpler and more readable code.

This class is normally created via the CacheService.createCache() method.

[CacheService](/reference/typescript-api/cache/cache-service#cacheservice)Example

```
const cache = cacheService.createCache({  getKey: id => `ProductVariantIds:${id}`,  options: {    ttl: 1000 * 60 * 60,    tags: ['products'],  },});// This will fetch the value from the cache if it exists, or// fetch it from the ProductService if not, and then cache// using the key 'ProductVariantIds.${id}'.const variantIds = await cache.get(id, async () => {  const variants await ProductService.getVariantsByProductId(ctx, id) ;  // The cached value must be serializable, so we just return the ids  return variants.map(v => v.id);});
```

```
class Cache {    constructor(config: CacheConfig, cacheService: CacheService)    get(id: string | number, getValueFn: () => T | Promise<T>) => Promise<T>;    delete(id: string | number | Array<string | number>) => Promise<void>;    invalidateTags(tags: string[]) => Promise<void>;}
```

### constructor​


[​](#constructor)[CacheConfig](/reference/typescript-api/cache/cache-config#cacheconfig)[CacheService](/reference/typescript-api/cache/cache-service#cacheservice)
### get​


[​](#get)Retrieves the value from the cache if it exists, otherwise calls the getValueFn function
to get the value, sets it in the cache and returns it.

### delete​


[​](#delete)Deletes one or more items from the cache.

### invalidateTags​


[​](#invalidatetags)Invalidates one or more tags in the cache.

---

# CacheConfig


## CacheConfig​


[​](#cacheconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[cache.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/cache/cache.ts#L14)Configuration for a new Cache instance.

[Cache](/reference/typescript-api/cache/#cache)
```
interface CacheConfig {    getKey: (id: string | number) => string;    options?: SetCacheKeyOptions;}
```

### getKey​


[​](#getkey)A function which generates a cache key from the given id.
This key will be used to store the value in the cache.

By convention, the key should be namespaced to avoid conflicts.

Example

```
getKey: id => `MyStrategy:getProductVariantIds:${id}`,
```

### options​


[​](#options)[SetCacheKeyOptions](/reference/typescript-api/cache/cache-strategy#setcachekeyoptions)Options available when setting the value in the cache.

---

# CacheService


## CacheService​


[​](#cacheservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[cache.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/cache/cache.service.ts#L21)The CacheService is used to cache data in order to optimize performance.

Internally it makes use of the configured CacheStrategy to persist
the cache into a key-value store.

[CacheStrategy](/reference/typescript-api/cache/cache-strategy#cachestrategy)
```
class CacheService {    protected cacheStrategy: CacheStrategy;    constructor(configService: ConfigService)    createCache(config: CacheConfig) => Cache;    get(key: string) => Promise<T | undefined>;    set(key: string, value: T, options?: SetCacheKeyOptions) => Promise<void>;    delete(key: string) => Promise<void>;    invalidateTags(tags: string[]) => Promise<void>;}
```

### cacheStrategy​


[​](#cachestrategy)[CacheStrategy](/reference/typescript-api/cache/cache-strategy#cachestrategy)
### constructor​


[​](#constructor)
### createCache​


[​](#createcache)[CacheConfig](/reference/typescript-api/cache/cache-config#cacheconfig)[Cache](/reference/typescript-api/cache/#cache)Creates a new Cache instance with the given configuration.

[Cache](/reference/typescript-api/cache/#cache)The Cache instance provides a convenience wrapper around the CacheService
methods.

### get​


[​](#get)Gets an item from the cache, or returns undefined if the key is not found, or the
item has expired.

### set​


[​](#set)[SetCacheKeyOptions](/reference/typescript-api/cache/cache-strategy#setcachekeyoptions)Sets a key-value pair in the cache. The value must be serializable, so cannot contain
things like functions, circular data structures, class instances etc.

Optionally a "time to live" (ttl) can be specified, which means that the key will
be considered stale after that many milliseconds.

### delete​


[​](#delete)Deletes an item from the cache.

### invalidateTags​


[​](#invalidatetags)Deletes all items from the cache which contain at least one matching tag.


---

# CacheStrategy


## CacheStrategy​


[​](#cachestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[cache-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/system/cache-strategy.ts#L53)The CacheStrategy defines how the underlying shared cache mechanism is implemented.

It is used by the CacheService to take care of storage and retrieval of items
from the cache.

[CacheService](/reference/typescript-api/cache/cache-service#cacheservice)If you are using the DefaultCachePlugin or the RedisCachePlugin, you will not need to
manually specify a CacheStrategy, as these plugins will automatically configure the
appropriate strategy.

This is configured via the systemOptions.cacheStrategy property of
your VendureConfig.

```
interface CacheStrategy extends InjectableStrategy {    get<T extends JsonCompatible<T>>(key: string): Promise<T | undefined>;    set<T extends JsonCompatible<T>>(key: string, value: T, options?: SetCacheKeyOptions): Promise<void>;    delete(key: string): Promise<void>;    invalidateTags(tags: string[]): Promise<void>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### get​


[​](#get)Gets an item from the cache, or returns undefined if the key is not found, or the
item has expired.

### set​


[​](#set)[SetCacheKeyOptions](/reference/typescript-api/cache/cache-strategy#setcachekeyoptions)Sets a key-value pair in the cache. The value must be serializable, so cannot contain
things like functions, circular data structures, class instances etc.

Optionally a "time to live" (ttl) can be specified, which means that the key will
be considered stale after that many milliseconds.

### delete​


[​](#delete)Deletes an item from the cache.

### invalidateTags​


[​](#invalidatetags)Deletes all items from the cache which contain at least one matching tag.

## SetCacheKeyOptions​


[​](#setcachekeyoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[cache-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/system/cache-strategy.ts#L13)Options available when setting the value in the cache.

```
interface SetCacheKeyOptions {    ttl?: number;    tags?: string[];}
```

### ttl​


[​](#ttl)The time-to-live for the cache key in milliseconds. This means
that after this time period, the key will be considered stale
and will no longer be returned from the cache. Omitting
this is equivalent to having an infinite ttl.

### tags​


[​](#tags)An array of tags which can be used to group cache keys together.
This can be useful for bulk deletion of related keys.


---

# DefaultCachePlugin


## DefaultCachePlugin​


[​](#defaultcacheplugin)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-cache-plugin.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/default-cache-plugin/default-cache-plugin.ts#L48)This plugin provides a simple SQL-based cache strategy SqlCacheStrategy which stores cached
items in the database.

[SqlCacheStrategy](/reference/typescript-api/cache/sql-cache-strategy#sqlcachestrategy)It is suitable for production use (including multi-instance setups). For increased performance
you can also consider using the RedisCachePlugin.

[RedisCachePlugin](/reference/typescript-api/cache/redis-cache-plugin#rediscacheplugin)
```
class DefaultCachePlugin {    static options: DefaultCachePluginInitOptions = {        cacheSize: 10_000,    };    init(options: DefaultCachePluginInitOptions) => ;}
```

### options​


[​](#options)[DefaultCachePluginInitOptions](/reference/typescript-api/cache/default-cache-plugin#defaultcacheplugininitoptions)
### init​


[​](#init)[DefaultCachePluginInitOptions](/reference/typescript-api/cache/default-cache-plugin#defaultcacheplugininitoptions)
## DefaultCachePluginInitOptions​


[​](#defaultcacheplugininitoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-cache-plugin.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/default-cache-plugin/default-cache-plugin.ts#L18)Configuration options for the DefaultCachePlugin.

[DefaultCachePlugin](/reference/typescript-api/cache/default-cache-plugin#defaultcacheplugin)
```
interface DefaultCachePluginInitOptions {    cacheSize?: number;    cacheTtlProvider?: CacheTtlProvider;}
```

### cacheSize​


[​](#cachesize)The maximum number of items to store in the cache. Once the cache reaches this size,
the least-recently-used items will be evicted to make room for new items.

### cacheTtlProvider​


[​](#cachettlprovider)Optionally provide a custom CacheTtlProvider to control the TTL of cache items.
This is useful for testing.


---

# RedisCachePlugin


## RedisCachePlugin​


[​](#rediscacheplugin)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[redis-cache-plugin.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/redis-cache-plugin/redis-cache-plugin.ts#L25)This plugin provides a Redis-based RedisCacheStrategy which stores cached items in a Redis instance.
This is a high-performance cache strategy which is suitable for production use, and is a drop-in
replacement for the DefaultCachePlugin.

[RedisCacheStrategy](/reference/typescript-api/cache/redis-cache-strategy#rediscachestrategy)[DefaultCachePlugin](/reference/typescript-api/cache/default-cache-plugin#defaultcacheplugin)Note: To use this plugin, you need to manually install the ioredis package:

```
npm install ioredis@^5.3.2
```

```
class RedisCachePlugin {    static options: RedisCachePluginInitOptions = {        maxItemSizeInBytes: 128_000,        redisOptions: {},        namespace: 'vendure-cache',    };    init(options: RedisCachePluginInitOptions) => ;}
```

### options​


[​](#options)[RedisCachePluginInitOptions](/reference/typescript-api/cache/redis-cache-plugin#rediscacheplugininitoptions)
### init​


[​](#init)[RedisCachePluginInitOptions](/reference/typescript-api/cache/redis-cache-plugin#rediscacheplugininitoptions)
## RedisCachePluginInitOptions​


[​](#rediscacheplugininitoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/redis-cache-plugin/types.ts#L9)Configuration options for the RedisCachePlugin.

[RedisCachePlugin](/reference/typescript-api/cache/redis-cache-plugin#rediscacheplugin)
```
interface RedisCachePluginInitOptions {    maxItemSizeInBytes?: number;    namespace?: string;    redisOptions?: import('ioredis').RedisOptions;}
```

### maxItemSizeInBytes​


[​](#maxitemsizeinbytes)The maximum size of a single cache item in bytes. If a cache item exceeds this size, it will not be stored
and an error will be logged.

### namespace​


[​](#namespace)The namespace to use for all keys stored in Redis. This can be useful if you are sharing a Redis instance
between multiple applications.

### redisOptions​


[​](#redisoptions)Options to pass to the ioredis Redis client.


---

# RedisCacheStrategy


## RedisCacheStrategy​


[​](#rediscachestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[redis-cache-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/redis-cache-plugin/redis-cache-strategy.ts#L23)A CacheStrategy which stores cached items in a Redis instance.
This is a high-performance cache strategy which is suitable for production use.

[CacheStrategy](/reference/typescript-api/cache/cache-strategy#cachestrategy)Note: To use this strategy, you need to manually install the ioredis package:

```
npm install ioredis@^5.3.2
```

```
class RedisCacheStrategy implements CacheStrategy {    constructor(options: RedisCachePluginInitOptions)    init() => ;    destroy() => ;    get(key: string) => Promise<T | undefined>;    set(key: string, value: T, options?: SetCacheKeyOptions) => Promise<void>;    delete(key: string) => Promise<void>;    invalidateTags(tags: string[]) => Promise<void>;}
```

- Implements: CacheStrategy

[CacheStrategy](/reference/typescript-api/cache/cache-strategy#cachestrategy)
### constructor​


[​](#constructor)[RedisCachePluginInitOptions](/reference/typescript-api/cache/redis-cache-plugin#rediscacheplugininitoptions)
### init​


[​](#init)
### destroy​


[​](#destroy)
### get​


[​](#get)
### set​


[​](#set)[SetCacheKeyOptions](/reference/typescript-api/cache/cache-strategy#setcachekeyoptions)
### delete​


[​](#delete)
### invalidateTags​


[​](#invalidatetags)


---

# RequestContextCacheService


## RequestContextCacheService​


[​](#requestcontextcacheservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[request-context-cache.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/cache/request-context-cache.service.ts#L15)This service is used to cache arbitrary data relative to an ongoing request.
It does this by using a WeakMap bound to the current RequestContext, so the cached
data is available for the duration of the request. Once the request completes, the
cached data will be automatically garbage-collected.

This is useful for caching data which is expensive to compute and which is needed
multiple times during the handling of a single request.

```
class RequestContextCacheService {    set(ctx: RequestContext, key: any, val: T) => void;    get(ctx: RequestContext, key: any) => T | undefined;    get(ctx: RequestContext, key: any, getDefault?: () => T) => T;    get(ctx: RequestContext, key: any, getDefault?: () => T) => T | Promise<T> | undefined;}
```

### set​


[​](#set)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Set a value in the RequestContext cache.

### get​


[​](#get)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Get a value from the RequestContext cache. If the value is not found, the getDefault
function will be called to get the value, which will then be cached and returned.

### get​


[​](#get-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### get​


[​](#get-2)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)


---

# SelfRefreshingCache


## SelfRefreshingCache​


[​](#selfrefreshingcache)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[self-refreshing-cache.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/self-refreshing-cache.ts#L10)A cache which automatically refreshes itself if the value is found to be stale.

```
interface SelfRefreshingCache<V, RefreshArgs extends any[] = []> {    value(...refreshArgs: RefreshArgs | [undefined] | []): Promise<V>;    memoize<Args extends any[], R>(        args: Args,        refreshArgs: RefreshArgs,        fn: (value: V, ...args: Args) => R,    ): Promise<R>;    refresh(...args: RefreshArgs): Promise<V>;}
```

### value​


[​](#value)The current value of the cache. If the value is stale, the data will be refreshed and then
the fresh value will be returned.

### memoize​


[​](#memoize)Allows a memoized function to be defined. For the given arguments, the fn function will
be invoked only once and its output cached and returned.
The results cache is cleared along with the rest of the cache according to the configured
ttl value.

### refresh​


[​](#refresh)Force a refresh of the value, e.g. when it is known that the value has changed such as after
an update operation to the source data in the database.

## SelfRefreshingCacheConfig​


[​](#selfrefreshingcacheconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[self-refreshing-cache.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/self-refreshing-cache.ts#L46)Configuration options for creating a SelfRefreshingCache.

[SelfRefreshingCache](/reference/typescript-api/cache/self-refreshing-cache#selfrefreshingcache)
```
interface SelfRefreshingCacheConfig<V, RefreshArgs extends any[]> {    name: string;    ttl: number;    refresh: {        fn: (...args: RefreshArgs) => Promise<V>;        /**         * Default arguments, passed to refresh function         */        defaultArgs: RefreshArgs;    };    getTimeFn?: () => number;}
```

### name​


[​](#name)The name of the cache, used for logging purposes.
e.g. 'MyService.cachedValue'.

### ttl​


[​](#ttl)The time-to-live (ttl) in milliseconds for the cache. After this time, the value will be considered stale
and will be refreshed the next time it is accessed.

### refresh​


[​](#refresh-1)The function which is used to refresh the value of the cache.
This function should return a Promise which resolves to the new value.

### getTimeFn​


[​](#gettimefn)Intended for unit testing the SelfRefreshingCache only.
By default uses () => new Date().getTime()

## createSelfRefreshingCache​


[​](#createselfrefreshingcache)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[self-refreshing-cache.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/self-refreshing-cache.ts#L114)Creates a SelfRefreshingCache object, which is used to cache a single frequently-accessed value. In this type
of cache, the function used to populate the value (refreshFn) is defined during the creation of the cache, and
it is immediately used to populate the initial value.

[SelfRefreshingCache](/reference/typescript-api/cache/self-refreshing-cache#selfrefreshingcache)From there, when the .value property is accessed, it will return a value from the cache, and if the
value has expired, it will automatically run the refreshFn to update the value and then return the
fresh value.

Example

```
import { createSelfRefreshingCache } from '@vendure/core';@Injectable()export class PublicChannelService {  private publicChannel: SelfRefreshingCache<Channel, [RequestContext]>;  async init() {    this.publicChannel = await createSelfRefreshingCache<Channel, [RequestContext]>({     name: 'PublicChannelService.publicChannel',     ttl: 1000 * 60 * 60, // 1 hour     refresh: {       fn: async (ctx: RequestContext) => {        return this.channelService.getPublicChannel(ctx);      },     defaultArgs: [RequestContext.empty()],    },  });}
```

```
function createSelfRefreshingCache<V, RefreshArgs extends any[]>(config: SelfRefreshingCacheConfig<V, RefreshArgs>, refreshArgs?: RefreshArgs): Promise<SelfRefreshingCache<V, RefreshArgs>>
```

Parameters

### config​


[​](#config)[SelfRefreshingCacheConfig](/reference/typescript-api/cache/self-refreshing-cache#selfrefreshingcacheconfig)
### refreshArgs​


[​](#refreshargs)

---

# SqlCacheStrategy


## SqlCacheStrategy​


[​](#sqlcachestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[sql-cache-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/default-cache-plugin/sql-cache-strategy.ts#L21)A CacheStrategy that stores cached items in the database. This
is the strategy used by the DefaultCachePlugin.

[CacheStrategy](/reference/typescript-api/cache/cache-strategy#cachestrategy)[DefaultCachePlugin](/reference/typescript-api/cache/default-cache-plugin#defaultcacheplugin)
```
class SqlCacheStrategy implements CacheStrategy {    protected cacheSize = 10_000;    protected ttlProvider: CacheTtlProvider;    constructor(config?: { cacheSize?: number; cacheTtlProvider?: CacheTtlProvider })    protected connection: TransactionalConnection;    protected configService: ConfigService;    init(injector: Injector) => ;    get(key: string) => Promise<T | undefined>;    set(key: string, value: T, options?: SetCacheKeyOptions) => ;    delete(key: string) => ;    invalidateTags(tags: string[]) => ;}
```

- Implements: CacheStrategy

[CacheStrategy](/reference/typescript-api/cache/cache-strategy#cachestrategy)
### cacheSize​


[​](#cachesize)
### ttlProvider​


[​](#ttlprovider)
### constructor​


[​](#constructor)
### connection​


[​](#connection)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)
### configService​


[​](#configservice)
### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)
### get​


[​](#get)
### set​


[​](#set)[SetCacheKeyOptions](/reference/typescript-api/cache/cache-strategy#setcachekeyoptions)
### delete​


[​](#delete)
### invalidateTags​


[​](#invalidatetags)


---

# AdminUiAppConfig


## AdminUiAppConfig​


[​](#adminuiappconfig)[@vendure/common](https://www.npmjs.com/package/@vendure/common)[shared-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/common/src/shared-types.ts#L355)Configures the path to a custom-build of the Admin UI app.

```
interface AdminUiAppConfig {    path: string;    route?: string;    compile?: () => Promise<void>;}
```

### path​


[​](#path)The path to the compiled admin UI app files. If not specified, an internal
default build is used. This path should contain the vendure-ui-config.json file,
index.html, the compiled js bundles etc.

### route​


[​](#route)Specifies the url route to the Admin UI app.

### compile​


[​](#compile)The function which will be invoked to start the app compilation process.

---

# AdminUiAppDevModeConfig


## AdminUiAppDevModeConfig​


[​](#adminuiappdevmodeconfig)[@vendure/common](https://www.npmjs.com/package/@vendure/common)[shared-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/common/src/shared-types.ts#L383)Information about the Admin UI app dev server.

```
interface AdminUiAppDevModeConfig {    sourcePath: string;    port: number;    route?: string;    compile: () => Promise<void>;}
```

### sourcePath​


[​](#sourcepath)The path to the uncompiled UI app source files. This path should contain the vendure-ui-config.json file.

### port​


[​](#port)The port on which the dev server is listening. Overrides the value set by AdminUiOptions.port.

### route​


[​](#route)Specifies the url route to the Admin UI app.

### compile​


[​](#compile)The function which will be invoked to start the app compilation process.

---

# AdminUiConfig


## AdminUiConfig​


[​](#adminuiconfig)[@vendure/common](https://www.npmjs.com/package/@vendure/common)[shared-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/common/src/shared-types.ts#L221)This interface describes JSON config file (vendure-ui-config.json) used by the Admin UI.
The values are loaded at run-time by the Admin UI app, and allow core configuration to be
managed without the need to re-build the application.

```
interface AdminUiConfig {    apiHost: string | 'auto';    apiPort: number | 'auto';    adminApiPath: string;    tokenMethod: 'cookie' | 'bearer';    authTokenHeaderKey: string;    channelTokenKey: string;    defaultLanguage: LanguageCode;    defaultLocale?: string;    availableLanguages: LanguageCode[];    availableLocales: string[];    loginUrl?: string;    brand?: string;    hideVendureBranding?: boolean;    hideVersion?: boolean;    loginImageUrl?: string;    cancellationReasons?: string[];}
```

### apiHost​


[​](#apihost)The hostname of the Vendure server which the admin UI will be making API calls
to. If set to "auto", the Admin UI app will determine the hostname from the
current location (i.e. window.location.hostname).

### apiPort​


[​](#apiport)The port of the Vendure server which the admin UI will be making API calls
to. If set to "auto", the Admin UI app will determine the port from the
current location (i.e. window.location.port).

### adminApiPath​


[​](#adminapipath)The path to the GraphQL Admin API.

### tokenMethod​


[​](#tokenmethod)Whether to use cookies or bearer tokens to track sessions.
Should match the setting of in the server's tokenMethod config
option.

### authTokenHeaderKey​


[​](#authtokenheaderkey)The header used when using the 'bearer' auth method. Should match the
setting of the server's authOptions.authTokenHeaderKey config option.

### channelTokenKey​


[​](#channeltokenkey)The name of the header which contains the channel token. Should match the
setting of the server's apiOptions.channelTokenKey config option.

### defaultLanguage​


[​](#defaultlanguage)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)The default language for the Admin UI. Must be one of the
items specified in the availableLanguages property.

### defaultLocale​


[​](#defaultlocale)The default locale for the Admin UI. The locale affects the formatting of
currencies & dates. Must be one of the items specified
in the availableLocales property.

If not set, the browser default locale will be used.

### availableLanguages​


[​](#availablelanguages)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)An array of languages for which translations exist for the Admin UI.

### availableLocales​


[​](#availablelocales)An array of locales to be used on Admin UI.

### loginUrl​


[​](#loginurl)If you are using an external AuthenticationStrategy for the Admin API, you can configure
a custom URL for the login page with this option. On logging out or redirecting an unauthenticated
user, the Admin UI app will redirect the user to this URL rather than the default username/password
screen.

[AuthenticationStrategy](/reference/typescript-api/auth/authentication-strategy#authenticationstrategy)
### brand​


[​](#brand)The custom brand name.

### hideVendureBranding​


[​](#hidevendurebranding)Option to hide vendure branding.

### hideVersion​


[​](#hideversion)Option to hide version.

### loginImageUrl​


[​](#loginimageurl)A url of a custom image to be used on the login screen, to override the images provided by Vendure's login image server.

### cancellationReasons​


[​](#cancellationreasons)Allows you to provide default reasons for a refund or cancellation. This will be used in the
refund/cancel dialog. The values can be literal strings (e.g. "Not in stock") or translation
tokens (see Adding Admin UI Translations).

[Adding Admin UI Translations](/guides/extending-the-admin-ui/adding-ui-translations/)


---

# AsyncQueue


## AsyncQueue​


[​](#asyncqueue)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[async-queue.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/async-queue.ts#L13)A queue class for limiting concurrent async tasks. This can be used e.g. to prevent
race conditions when working on a shared resource such as writing to a database.

```
class AsyncQueue {    constructor(label: string = 'default', concurrency: number = 1)    push(task: Task<T>) => Promise<T>;}
```

### constructor​


[​](#constructor)
### push​


[​](#push)Pushes a new task onto the queue, upon which the task will either execute immediately or
(if the number of running tasks is equal to the concurrency limit) enqueue the task to
be executed at the soonest opportunity.


---

# Bootstrap


## bootstrap​


[​](#bootstrap)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[bootstrap.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/bootstrap.ts#L160)Bootstraps the Vendure server. This is the entry point to the application.

Example

```
import { bootstrap } from '@vendure/core';import { config } from './vendure-config';bootstrap(config).catch(err => {  console.log(err);  process.exit(1);});
```

### Passing additional options​


[​](#passing-additional-options)Since v2.2.0, you can pass additional options to the NestJs application via the options parameter.
For example, to integrate with the Nest Devtools, you need to
pass the snapshot option:

[Nest Devtools](https://docs.nestjs.com/devtools/overview)
```
import { bootstrap } from '@vendure/core';import { config } from './vendure-config';bootstrap(config, {  nestApplicationOptions: {    snapshot: true,  }}).catch(err => {  console.log(err);  process.exit(1);});
```

### Ignoring compatibility errors for plugins​


[​](#ignoring-compatibility-errors-for-plugins)Since v3.1.0, you can ignore compatibility errors for specific plugins by passing the ignoreCompatibilityErrorsForPlugins option.

This should be used with caution, only if you are sure that the plugin will still work as expected with the current version of Vendure.

Example

```
import { bootstrap } from '@vendure/core';import { config } from './vendure-config';import { MyPlugin } from './plugins/my-plugin';bootstrap(config, {  // Let's say that `MyPlugin` is not yet compatible with the current version of Vendure  // but we know that it will still work as expected, and we are not able to publish  // a new version of the plugin right now.  ignoreCompatibilityErrorsForPlugins: [MyPlugin],});
```

```
function bootstrap(userConfig: Partial<VendureConfig>, options?: BootstrapOptions): Promise<INestApplication>
```

Parameters

### userConfig​


[​](#userconfig)[VendureConfig](/reference/typescript-api/configuration/vendure-config#vendureconfig)
### options​


[​](#options)[BootstrapOptions](/reference/typescript-api/common/bootstrap#bootstrapoptions)
## BootstrapOptions​


[​](#bootstrapoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[bootstrap.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/bootstrap.ts#L42)Additional options that can be used to configure the bootstrap process of the
Vendure server.

```
interface BootstrapOptions {    nestApplicationOptions?: NestApplicationOptions;    ignoreCompatibilityErrorsForPlugins?: Array<DynamicModule | Type<any>>;}
```

### nestApplicationOptions​


[​](#nestapplicationoptions)These options get passed directly to the NestFactory.create() method.

### ignoreCompatibilityErrorsForPlugins​


[​](#ignorecompatibilityerrorsforplugins)By default, if a plugin specifies a compatibility range which does not include the current
Vendure version, the bootstrap process will fail. This option allows you to ignore compatibility
errors for specific plugins.

This setting should be used with caution, only if you are sure that the plugin will still
work as expected with the current version of Vendure.

Example

```
import { bootstrap } from '@vendure/core';import { config } from './vendure-config';import { MyPlugin } from './plugins/my-plugin';bootstrap(config, { ignoreCompatibilityErrorsForPlugins: [MyPlugin],});
```


---

# CurrencyCode


## CurrencyCode​


[​](#currencycode)[@vendure/common](https://www.npmjs.com/package/@vendure/common)[generated-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/common/src/generated-types.ts#L1004)ISO 4217 currency code

```
enum CurrencyCode {    AED = 'AED'    AFN = 'AFN'    ALL = 'ALL'    AMD = 'AMD'    ANG = 'ANG'    AOA = 'AOA'    ARS = 'ARS'    AUD = 'AUD'    AWG = 'AWG'    AZN = 'AZN'    BAM = 'BAM'    BBD = 'BBD'    BDT = 'BDT'    BGN = 'BGN'    BHD = 'BHD'    BIF = 'BIF'    BMD = 'BMD'    BND = 'BND'    BOB = 'BOB'    BRL = 'BRL'    BSD = 'BSD'    BTN = 'BTN'    BWP = 'BWP'    BYN = 'BYN'    BZD = 'BZD'    CAD = 'CAD'    CDF = 'CDF'    CHF = 'CHF'    CLP = 'CLP'    CNY = 'CNY'    COP = 'COP'    CRC = 'CRC'    CUC = 'CUC'    CUP = 'CUP'    CVE = 'CVE'    CZK = 'CZK'    DJF = 'DJF'    DKK = 'DKK'    DOP = 'DOP'    DZD = 'DZD'    EGP = 'EGP'    ERN = 'ERN'    ETB = 'ETB'    EUR = 'EUR'    FJD = 'FJD'    FKP = 'FKP'    GBP = 'GBP'    GEL = 'GEL'    GHS = 'GHS'    GIP = 'GIP'    GMD = 'GMD'    GNF = 'GNF'    GTQ = 'GTQ'    GYD = 'GYD'    HKD = 'HKD'    HNL = 'HNL'    HRK = 'HRK'    HTG = 'HTG'    HUF = 'HUF'    IDR = 'IDR'    ILS = 'ILS'    INR = 'INR'    IQD = 'IQD'    IRR = 'IRR'    ISK = 'ISK'    JMD = 'JMD'    JOD = 'JOD'    JPY = 'JPY'    KES = 'KES'    KGS = 'KGS'    KHR = 'KHR'    KMF = 'KMF'    KPW = 'KPW'    KRW = 'KRW'    KWD = 'KWD'    KYD = 'KYD'    KZT = 'KZT'    LAK = 'LAK'    LBP = 'LBP'    LKR = 'LKR'    LRD = 'LRD'    LSL = 'LSL'    LYD = 'LYD'    MAD = 'MAD'    MDL = 'MDL'    MGA = 'MGA'    MKD = 'MKD'    MMK = 'MMK'    MNT = 'MNT'    MOP = 'MOP'    MRU = 'MRU'    MUR = 'MUR'    MVR = 'MVR'    MWK = 'MWK'    MXN = 'MXN'    MYR = 'MYR'    MZN = 'MZN'    NAD = 'NAD'    NGN = 'NGN'    NIO = 'NIO'    NOK = 'NOK'    NPR = 'NPR'    NZD = 'NZD'    OMR = 'OMR'    PAB = 'PAB'    PEN = 'PEN'    PGK = 'PGK'    PHP = 'PHP'    PKR = 'PKR'    PLN = 'PLN'    PYG = 'PYG'    QAR = 'QAR'    RON = 'RON'    RSD = 'RSD'    RUB = 'RUB'    RWF = 'RWF'    SAR = 'SAR'    SBD = 'SBD'    SCR = 'SCR'    SDG = 'SDG'    SEK = 'SEK'    SGD = 'SGD'    SHP = 'SHP'    SLL = 'SLL'    SOS = 'SOS'    SRD = 'SRD'    SSP = 'SSP'    STN = 'STN'    SVC = 'SVC'    SYP = 'SYP'    SZL = 'SZL'    THB = 'THB'    TJS = 'TJS'    TMT = 'TMT'    TND = 'TND'    TOP = 'TOP'    TRY = 'TRY'    TTD = 'TTD'    TWD = 'TWD'    TZS = 'TZS'    UAH = 'UAH'    UGX = 'UGX'    USD = 'USD'    UYU = 'UYU'    UZS = 'UZS'    VES = 'VES'    VND = 'VND'    VUV = 'VUV'    WST = 'WST'    XAF = 'XAF'    XCD = 'XCD'    XOF = 'XOF'    XPF = 'XPF'    YER = 'YER'    ZAR = 'ZAR'    ZMW = 'ZMW'    ZWL = 'ZWL'}
```


---

# EntityRelationPaths


## EntityRelationPaths​


[​](#entityrelationpaths)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[entity-relation-paths.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/types/entity-relation-paths.ts#L25)This type allows type-safe access to entity relations using strings with dot notation.
It works to 2 levels deep.

Example

```
type T1 = EntityRelationPaths<Product>;
```

In the above example, the type T1 will be a string union of all relations of the
Product entity:

- 'featuredAsset'
- 'variants'
- 'variants.options'
- 'variants.featuredAsset'
- etc.

```
type EntityRelationPaths<T extends VendureEntity> = | `customFields.${string}`    | PathsToStringProps1<T>    | Join<PathsToStringProps2<T>, '.'>    | TripleDotPath
```

---

# I18nService


## I18nService​


[​](#i18nservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[i18n.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/i18n/i18n.service.ts#L44)
```
class I18nService implements OnModuleInit {    addTranslationFile(langKey: string, filePath: string) => void;    addTranslation(langKey: string, resources: VendureTranslationResources | any) => void;}
```

- Implements: OnModuleInit

### addTranslationFile​


[​](#addtranslationfile)Add a I18n translation by json file

### addTranslation​


[​](#addtranslation)[VendureTranslationResources](/reference/typescript-api/common/i18n-service#venduretranslationresources)Add a I18n translation (key-value) resource

## VendureTranslationResources​


[​](#venduretranslationresources)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[i18n.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/i18n/i18n.service.ts#L24)I18n resources used for translations

```
interface VendureTranslationResources {    error: any;    errorResult: any;    message: any;}
```

### error​


[​](#error)
### errorResult​


[​](#errorresult)
### message​


[​](#message)


---

# ID


## ID​


[​](#id)[@vendure/common](https://www.npmjs.com/package/@vendure/common)[shared-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/common/src/shared-types.ts#L79)An entity ID. Depending on the configured EntityIdStrategy, it will be either
a string or a number;

[EntityIdStrategy](/reference/typescript-api/configuration/entity-id-strategy#entityidstrategy)
```
type ID = string | number
```


---

# InjectableStrategy


## InjectableStrategy​


[​](#injectablestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[injectable-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/types/injectable-strategy.ts#L10)This interface defines the setup and teardown hooks available to the
various strategies used to configure Vendure.

```
interface InjectableStrategy {    init?: (injector: Injector) => void | Promise<void>;    destroy?: () => void | Promise<void>;}
```

### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)Defines setup logic to be run during application bootstrap. Receives
the Injector as an argument, which allows application providers
to be used as part of the setup. This hook will be called on both the
main server and the worker processes.

[Injector](/reference/typescript-api/common/injector#injector)Example

```
async init(injector: Injector) {  const myService = injector.get(MyService);  await myService.doSomething();}
```

### destroy​


[​](#destroy)Defines teardown logic to be run before application shutdown.

---

# Injector


## Injector​


[​](#injector)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[injector.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/injector.ts#L15)The Injector wraps the underlying Nestjs ModuleRef, allowing injection of providers
known to the application's dependency injection container. This is intended to enable the injection
of services into objects which exist outside of the Nestjs module system, e.g. the various
Strategies which can be supplied in the VendureConfig.

```
class Injector {    constructor(moduleRef: ModuleRef)    get(typeOrToken: Type<T> | string | symbol) => R;    resolve(typeOrToken: Type<T> | string | symbol, contextId?: ContextId) => Promise<R>;}
```

### constructor​


[​](#constructor)
### get​


[​](#get)Retrieve an instance of the given type from the app's dependency injection container.
Wraps the Nestjs ModuleRef.get() method.

### resolve​


[​](#resolve)Retrieve an instance of the given scoped provider (transient or request-scoped) from the
app's dependency injection container.
Wraps the Nestjs ModuleRef.resolve() method.


---

# JobState


## JobState​


[​](#jobstate)[@vendure/common](https://www.npmjs.com/package/@vendure/common)[generated-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/common/src/generated-types.ts#L2256)The state of a Job in the JobQueue

```
enum JobState {    CANCELLED = 'CANCELLED'    COMPLETED = 'COMPLETED'    FAILED = 'FAILED'    PENDING = 'PENDING'    RETRYING = 'RETRYING'    RUNNING = 'RUNNING'}
```


---

# JsonCompatible


## JsonCompatible​


[​](#jsoncompatible)[@vendure/common](https://www.npmjs.com/package/@vendure/common)[shared-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/common/src/shared-types.ts#L52)A type representing JSON-compatible values.
From https://github.com/microsoft/TypeScript/issues/1897#issuecomment-580962081

[https://github.com/microsoft/TypeScript/issues/1897#issuecomment-580962081](https://github.com/microsoft/TypeScript/issues/1897#issuecomment-580962081)
```
type JsonCompatible<T> = {    [P in keyof T]: T[P] extends Json        ? T[P]        : Pick<T, P> extends Required<Pick<T, P>>          ? never          : JsonCompatible<T[P]>;}
```


---

# LanguageCode


## LanguageCode​


[​](#languagecode)[@vendure/common](https://www.npmjs.com/package/@vendure/common)[generated-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/common/src/generated-types.ts#L2274)Languages in the form of a ISO 639-1 language code with optional
region or script modifier (e.g. de_AT). The selection available is based
on the Unicode CLDR summary list
and includes the major spoken languages of the world and any widely-used variants.

[Unicode CLDR summary list](https://unicode-org.github.io/cldr-staging/charts/37/summary/root.html)
```
enum LanguageCode {    af = 'af'    ak = 'ak'    am = 'am'    ar = 'ar'    as = 'as'    az = 'az'    be = 'be'    bg = 'bg'    bm = 'bm'    bn = 'bn'    bo = 'bo'    br = 'br'    bs = 'bs'    ca = 'ca'    ce = 'ce'    co = 'co'    cs = 'cs'    cu = 'cu'    cy = 'cy'    da = 'da'    de = 'de'    de_AT = 'de_AT'    de_CH = 'de_CH'    dz = 'dz'    ee = 'ee'    el = 'el'    en = 'en'    en_AU = 'en_AU'    en_CA = 'en_CA'    en_GB = 'en_GB'    en_US = 'en_US'    eo = 'eo'    es = 'es'    es_ES = 'es_ES'    es_MX = 'es_MX'    et = 'et'    eu = 'eu'    fa = 'fa'    fa_AF = 'fa_AF'    ff = 'ff'    fi = 'fi'    fo = 'fo'    fr = 'fr'    fr_CA = 'fr_CA'    fr_CH = 'fr_CH'    fy = 'fy'    ga = 'ga'    gd = 'gd'    gl = 'gl'    gu = 'gu'    gv = 'gv'    ha = 'ha'    he = 'he'    hi = 'hi'    hr = 'hr'    ht = 'ht'    hu = 'hu'    hy = 'hy'    ia = 'ia'    id = 'id'    ig = 'ig'    ii = 'ii'    is = 'is'    it = 'it'    ja = 'ja'    jv = 'jv'    ka = 'ka'    ki = 'ki'    kk = 'kk'    kl = 'kl'    km = 'km'    kn = 'kn'    ko = 'ko'    ks = 'ks'    ku = 'ku'    kw = 'kw'    ky = 'ky'    la = 'la'    lb = 'lb'    lg = 'lg'    ln = 'ln'    lo = 'lo'    lt = 'lt'    lu = 'lu'    lv = 'lv'    mg = 'mg'    mi = 'mi'    mk = 'mk'    ml = 'ml'    mn = 'mn'    mr = 'mr'    ms = 'ms'    mt = 'mt'    my = 'my'    nb = 'nb'    nd = 'nd'    ne = 'ne'    nl = 'nl'    nl_BE = 'nl_BE'    nn = 'nn'    ny = 'ny'    om = 'om'    or = 'or'    os = 'os'    pa = 'pa'    pl = 'pl'    ps = 'ps'    pt = 'pt'    pt_BR = 'pt_BR'    pt_PT = 'pt_PT'    qu = 'qu'    rm = 'rm'    rn = 'rn'    ro = 'ro'    ro_MD = 'ro_MD'    ru = 'ru'    rw = 'rw'    sa = 'sa'    sd = 'sd'    se = 'se'    sg = 'sg'    si = 'si'    sk = 'sk'    sl = 'sl'    sm = 'sm'    sn = 'sn'    so = 'so'    sq = 'sq'    sr = 'sr'    st = 'st'    su = 'su'    sv = 'sv'    sw = 'sw'    sw_CD = 'sw_CD'    ta = 'ta'    te = 'te'    tg = 'tg'    th = 'th'    ti = 'ti'    tk = 'tk'    to = 'to'    tr = 'tr'    tt = 'tt'    ug = 'ug'    uk = 'uk'    ur = 'ur'    uz = 'uz'    vi = 'vi'    vo = 'vo'    wo = 'wo'    xh = 'xh'    yi = 'yi'    yo = 'yo'    zh = 'zh'    zh_Hans = 'zh_Hans'    zh_Hant = 'zh_Hant'    zu = 'zu'}
```


---

# Middleware


## Middleware​


[​](#middleware)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[common-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/types/common-types.ts#L212)Defines API middleware, set in the ApiOptions. Middleware can be either
Express middleware or NestJS middleware.

[ApiOptions](/reference/typescript-api/configuration/api-options#apioptions)[Express middleware](https://expressjs.com/en/guide/using-middleware.html)[NestJS middleware](https://docs.nestjs.com/middleware)
## Increasing the maximum request body size limit​


[​](#increasing-the-maximum-request-body-size-limit)Internally, Vendure relies on the body-parser middleware to parse incoming JSON data. By default, the maximum
body size is set to 100kb. Attempting to send a request with more than 100kb of JSON data will result in a
PayloadTooLargeError. To increase this limit, we can manually configure the body-parser middleware:

Example

```
import { VendureConfig } from '@vendure/core';import { json } from 'body-parser';export const config: VendureConfig = {  // ...  apiOptions: {    middleware: [{      handler: json({ limit: '10mb' }),      route: '*splat',      beforeListen: true,    }],  },};
```

```
interface Middleware {    handler: MiddlewareHandler;    route: string;    beforeListen?: boolean;}
```

### handler​


[​](#handler)The Express middleware function or NestJS NestMiddleware class.

### route​


[​](#route)The route to which this middleware will apply. Pattern based routes are supported as well.

The 'ab*cd' route path will match abcd, ab_cd, abecd, and so on. The characters ?, +, *, and () may be used in a route path,
and are subsets of their regular expression counterparts. The hyphen (-) and the dot (.) are interpreted literally.

### beforeListen​


[​](#beforelisten)When set to true, this will cause the middleware to be applied before the Vendure server (and underlying Express server) starts listening
for connections. In practical terms this means that the middleware will be at the very start of the middleware stack, before even the
body-parser middleware which is automatically applied by NestJS. This can be useful in certain cases such as when you need to access the
raw unparsed request for a specific route.


---

# PaginatedList


## PaginatedList​


[​](#paginatedlist)[@vendure/common](https://www.npmjs.com/package/@vendure/common)[shared-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/common/src/shared-types.ts#L67)A type describing the shape of a paginated list response. In Vendure, almost all list queries
(products, collections, orders, customers etc) return an object of this type.

```
type PaginatedList<T> = {    items: T[];    totalItems: number;}
```

### items​


[​](#items)
### totalItems​


[​](#totalitems)


---

# Permission


## Permission​


[​](#permission)[@vendure/common](https://www.npmjs.com/package/@vendure/common)[generated-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/common/src/generated-types.ts#L4491)Permissions for administrators and customers. Used to control access to
GraphQL resolvers via the Allow decorator.

[Allow](/reference/typescript-api/request/allow-decorator#allow)
## Understanding Permission.Owner​


[​](#understanding-permissionowner)Permission.Owner is a special permission which is used in some Vendure resolvers to indicate that that resolver should only
be accessible to the "owner" of that resource.

For example, the Shop API activeCustomer query resolver should only return the Customer object for the "owner" of that Customer, i.e.
based on the activeUserId of the current session. As a result, the resolver code looks like this:

Example

```
@Query()@Allow(Permission.Owner)async activeCustomer(@Ctx() ctx: RequestContext): Promise<Customer | undefined> {  const userId = ctx.activeUserId;  if (userId) {    return this.customerService.findOneByUserId(ctx, userId);  }}
```

Here we can see that the "ownership" must be enforced by custom logic inside the resolver. Since "ownership" cannot be defined generally
nor statically encoded at build-time, any resolvers using Permission.Owner must include logic to enforce that only the owner
of the resource has access. If not, then it is the equivalent of using Permission.Public.

```
enum Permission {    Authenticated = 'Authenticated'    CreateAdministrator = 'CreateAdministrator'    CreateAsset = 'CreateAsset'    CreateCatalog = 'CreateCatalog'    CreateChannel = 'CreateChannel'    CreateCollection = 'CreateCollection'    CreateCountry = 'CreateCountry'    CreateCustomer = 'CreateCustomer'    CreateCustomerGroup = 'CreateCustomerGroup'    CreateFacet = 'CreateFacet'    CreateOrder = 'CreateOrder'    CreatePaymentMethod = 'CreatePaymentMethod'    CreateProduct = 'CreateProduct'    CreatePromotion = 'CreatePromotion'    CreateSeller = 'CreateSeller'    CreateSettings = 'CreateSettings'    CreateShippingMethod = 'CreateShippingMethod'    CreateStockLocation = 'CreateStockLocation'    CreateSystem = 'CreateSystem'    CreateTag = 'CreateTag'    CreateTaxCategory = 'CreateTaxCategory'    CreateTaxRate = 'CreateTaxRate'    CreateZone = 'CreateZone'    DeleteAdministrator = 'DeleteAdministrator'    DeleteAsset = 'DeleteAsset'    DeleteCatalog = 'DeleteCatalog'    DeleteChannel = 'DeleteChannel'    DeleteCollection = 'DeleteCollection'    DeleteCountry = 'DeleteCountry'    DeleteCustomer = 'DeleteCustomer'    DeleteCustomerGroup = 'DeleteCustomerGroup'    DeleteFacet = 'DeleteFacet'    DeleteOrder = 'DeleteOrder'    DeletePaymentMethod = 'DeletePaymentMethod'    DeleteProduct = 'DeleteProduct'    DeletePromotion = 'DeletePromotion'    DeleteSeller = 'DeleteSeller'    DeleteSettings = 'DeleteSettings'    DeleteShippingMethod = 'DeleteShippingMethod'    DeleteStockLocation = 'DeleteStockLocation'    DeleteSystem = 'DeleteSystem'    DeleteTag = 'DeleteTag'    DeleteTaxCategory = 'DeleteTaxCategory'    DeleteTaxRate = 'DeleteTaxRate'    DeleteZone = 'DeleteZone'    Owner = 'Owner'    Public = 'Public'    ReadAdministrator = 'ReadAdministrator'    ReadAsset = 'ReadAsset'    ReadCatalog = 'ReadCatalog'    ReadChannel = 'ReadChannel'    ReadCollection = 'ReadCollection'    ReadCountry = 'ReadCountry'    ReadCustomer = 'ReadCustomer'    ReadCustomerGroup = 'ReadCustomerGroup'    ReadFacet = 'ReadFacet'    ReadOrder = 'ReadOrder'    ReadPaymentMethod = 'ReadPaymentMethod'    ReadProduct = 'ReadProduct'    ReadPromotion = 'ReadPromotion'    ReadSeller = 'ReadSeller'    ReadSettings = 'ReadSettings'    ReadShippingMethod = 'ReadShippingMethod'    ReadStockLocation = 'ReadStockLocation'    ReadSystem = 'ReadSystem'    ReadTag = 'ReadTag'    ReadTaxCategory = 'ReadTaxCategory'    ReadTaxRate = 'ReadTaxRate'    ReadZone = 'ReadZone'    SuperAdmin = 'SuperAdmin'    UpdateAdministrator = 'UpdateAdministrator'    UpdateAsset = 'UpdateAsset'    UpdateCatalog = 'UpdateCatalog'    UpdateChannel = 'UpdateChannel'    UpdateCollection = 'UpdateCollection'    UpdateCountry = 'UpdateCountry'    UpdateCustomer = 'UpdateCustomer'    UpdateCustomerGroup = 'UpdateCustomerGroup'    UpdateFacet = 'UpdateFacet'    UpdateGlobalSettings = 'UpdateGlobalSettings'    UpdateOrder = 'UpdateOrder'    UpdatePaymentMethod = 'UpdatePaymentMethod'    UpdateProduct = 'UpdateProduct'    UpdatePromotion = 'UpdatePromotion'    UpdateSeller = 'UpdateSeller'    UpdateSettings = 'UpdateSettings'    UpdateShippingMethod = 'UpdateShippingMethod'    UpdateStockLocation = 'UpdateStockLocation'    UpdateSystem = 'UpdateSystem'    UpdateTag = 'UpdateTag'    UpdateTaxCategory = 'UpdateTaxCategory'    UpdateTaxRate = 'UpdateTaxRate'    UpdateZone = 'UpdateZone'}
```

---

# PriceCalculationResult


## PriceCalculationResult​


[​](#pricecalculationresult)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[common-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/types/common-types.ts#L174)The result of the price calculation from the ProductVariantPriceCalculationStrategy or the
OrderItemPriceCalculationStrategy.

[ProductVariantPriceCalculationStrategy](/reference/typescript-api/products-stock/product-variant-price-calculation-strategy#productvariantpricecalculationstrategy)[OrderItemPriceCalculationStrategy](/reference/typescript-api/orders/order-item-price-calculation-strategy#orderitempricecalculationstrategy)
```
type PriceCalculationResult = {    price: number;    priceIncludesTax: boolean;}
```

### price​


[​](#price)
### priceIncludesTax​


[​](#priceincludestax)

---

# ProcessContext


## ProcessContext​


[​](#processcontext)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[process-context.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/process-context/process-context.ts#L31)The ProcessContext can be injected into your providers & modules in order to know whether it
is being executed in the context of the main Vendure server or the worker.

Example

```
import { Injectable, OnApplicationBootstrap } from '@nestjs/common';import { ProcessContext } from '@vendure/core';@Injectable()export class MyService implements OnApplicationBootstrap {  constructor(private processContext: ProcessContext) {}  onApplicationBootstrap() {    if (this.processContext.isServer) {      // code which will only execute when running in      // the server process    }  }}
```

```
class ProcessContext {    isServer: boolean    isWorker: boolean}
```

### isServer​


[​](#isserver)
### isWorker​


[​](#isworker)


---

# VENDURE_VERSION


## VENDURE_VERSION​


[​](#vendure_version)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[version.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/version.ts#L17)A constant which holds the current version of the Vendure core. You can use
this when your code needs to know the version of Vendure which is running.

Example

```
import { VENDURE_VERSION } from '@vendure/core';console.log('Vendure version:', VENDURE_VERSION);
```


---

# ConfigurableOperationDef


## ConfigurableOperationDef​


[​](#configurableoperationdef)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[configurable-operation.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/configurable-operation.ts#L335)A ConfigurableOperationDef is a special type of object used extensively by Vendure to define
code blocks which have arguments which are configurable at run-time by the administrator.

This is the mechanism used by:

- CollectionFilter
- PaymentMethodHandler
- PromotionAction
- PromotionCondition
- ShippingCalculator
- ShippingEligibilityChecker

[CollectionFilter](/reference/typescript-api/configuration/collection-filter#collectionfilter)[PaymentMethodHandler](/reference/typescript-api/payment/payment-method-handler#paymentmethodhandler)[PromotionAction](/reference/typescript-api/promotions/promotion-action#promotionaction)[PromotionCondition](/reference/typescript-api/promotions/promotion-condition#promotioncondition)[ShippingCalculator](/reference/typescript-api/shipping/shipping-calculator#shippingcalculator)[ShippingEligibilityChecker](/reference/typescript-api/shipping/shipping-eligibility-checker#shippingeligibilitychecker)Any class which extends ConfigurableOperationDef works in the same way: it takes a
config object as the constructor argument. That config object extends the ConfigurableOperationDefOptions
interface and typically adds some kind of business logic function to it.

[ConfigurableOperationDefOptions](/reference/typescript-api/configurable-operation-def/configurable-operation-def-options#configurableoperationdefoptions)For example, in the case of ShippingEligibilityChecker,
it adds the check() function to the config object which defines the logic for checking whether an Order is eligible
for a particular ShippingMethod.

## The args property​


[​](#the-args-property)The key feature of the ConfigurableOperationDef is the args property. This is where we define those
arguments that are exposed via the Admin UI as data input components. This allows their values to
be set at run-time by the Administrator. Those values can then be accessed in the business logic
of the operation.

The data type of the args can be one of ConfigArgType, and the configuration is further explained in
the docs of ConfigArgs.

[ConfigArgType](/reference/typescript-api/configurable-operation-def/config-arg-type#configargtype)[ConfigArgs](/reference/typescript-api/configurable-operation-def/config-args#configargs)
## Dependency Injection​


[​](#dependency-injection)If your business logic relies on injectable providers, such as the TransactionalConnection object, or any of the
internal Vendure services or those defined in a plugin, you can inject them by using the config object's
init() method, which exposes the Injector.

[Injector](/reference/typescript-api/common/injector#injector)Here's an example of a ShippingCalculator that injects a service which has been defined in a plugin:

Example

```
import { Injector, ShippingCalculator } from '@vendure/core';import { ShippingRatesService } from './shipping-rates.service';// We keep reference to our injected service by keeping it// in the top-level scope of the file.let shippingRatesService: ShippingRatesService;export const customShippingCalculator = new ShippingCalculator({  code: 'custom-shipping-calculator',  description: [],  args: {},  init(injector: Injector) {    // The init function is called during bootstrap, and allows    // us to inject any providers we need.    shippingRatesService = injector.get(ShippingRatesService);  },  calculate: async (order, args) => {    // We can now use the injected provider in the business logic.    const { price, priceWithTax } = await shippingRatesService.getRate({      destination: order.shippingAddress,      contents: order.lines,    });    return {      price,      priceWithTax,    };  },});
```

```
class ConfigurableOperationDef<T extends ConfigArgs = ConfigArgs> {    code: string    args: T    description: LocalizedStringArray    constructor(options: ConfigurableOperationDefOptions<T>)    init(injector: Injector) => ;    destroy() => ;    toGraphQlType(ctx: RequestContext) => ConfigurableOperationDefinition;    argsArrayToHash(args: ConfigArg[]) => ConfigArgValues<T>;}
```

### code​


[​](#code)
### args​


[​](#args)
### description​


[​](#description)[LocalizedStringArray](/reference/typescript-api/configurable-operation-def/localized-string-array#localizedstringarray)
### constructor​


[​](#constructor)[ConfigurableOperationDefOptions](/reference/typescript-api/configurable-operation-def/configurable-operation-def-options#configurableoperationdefoptions)
### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)
### destroy​


[​](#destroy)
### toGraphQlType​


[​](#tographqltype)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Convert a ConfigurableOperationDef into a ConfigurableOperationDefinition object, typically
so that it can be sent via the API.

### argsArrayToHash​


[​](#argsarraytohash)Coverts an array of ConfigArgs into a hash object:

from:
[{ name: 'foo', type: 'string', value: 'bar'}]

to:
{ foo: 'bar' }


---

# ConfigArgType


## ConfigArgType​


[​](#configargtype)[@vendure/common](https://www.npmjs.com/package/@vendure/common)[shared-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/common/src/shared-types.ts#L130)Certain entities (those which implement ConfigurableOperationDef) allow arbitrary
configuration arguments to be specified which can then be set in the admin-ui and used in
the business logic of the app. These are the valid data types of such arguments.
The data type influences:

[ConfigurableOperationDef](/reference/typescript-api/configurable-operation-def/#configurableoperationdef)- How the argument form field is rendered in the admin-ui
- The JavaScript type into which the value is coerced before being passed to the business logic.

```
type ConfigArgType = 'string' | 'int' | 'float' | 'boolean' | 'datetime' | 'ID'
```


---

# ConfigArgs


## ConfigArgs​


[​](#configargs)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[configurable-operation.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/configurable-operation.ts#L140)A object which defines the configurable arguments which may be passed to
functions in those classes which implement the ConfigurableOperationDef interface.

[ConfigurableOperationDef](/reference/typescript-api/configurable-operation-def/#configurableoperationdef)
## Data types​


[​](#data-types)Each argument has a data type, which must be one of ConfigArgType.

[ConfigArgType](/reference/typescript-api/configurable-operation-def/config-arg-type#configargtype)Example

```
{  apiKey: { type: 'string' },  maxRetries: { type: 'int' },  logErrors: { type: 'boolean' },}
```

## Lists​


[​](#lists)Setting the list property to true will make the argument into an array of the specified
data type. For example, if you want to store an array of strings:

Example

```
{  aliases: {    type: 'string',    list: true,  },}
```

In the Admin UI, this will be rendered as an orderable list of string inputs.

## UI Component​


[​](#ui-component)The ui field allows you to specify a specific input component to be used in the Admin UI.
When not set, a default input component is used appropriate to the data type.

Example

```
{  operator: {    type: 'string',    ui: {      component: 'select-form-input',      options: [        { value: 'startsWith' },        { value: 'endsWith' },        { value: 'contains' },        { value: 'doesNotContain' },      ],    },  },  secretKey: {    type: 'string',    ui: { component: 'password-form-input' },  },}
```

The available components as well as their configuration options can be found in the DefaultFormConfigHash docs.
Custom UI components may also be defined via an Admin UI extension using the registerFormInputComponent() function
which is exported from @vendure/admin-ui/core.

[DefaultFormConfigHash](/reference/typescript-api/configurable-operation-def/default-form-config-hash#defaultformconfighash)
```
type ConfigArgs = {    [name: string]: ConfigArgDef<ConfigArgType>;}
```

### [index]​


[​](#index)[ConfigArgType](/reference/typescript-api/configurable-operation-def/config-arg-type#configargtype)


---

# ConfigurableOperationDefOptions


## ConfigurableOperationDefOptions​


[​](#configurableoperationdefoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[configurable-operation.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/configurable-operation.ts#L230)Common configuration options used when creating a new instance of a
ConfigurableOperationDef (

[ConfigurableOperationDef](/reference/typescript-api/configurable-operation-def/#configurableoperationdef)
```
interface ConfigurableOperationDefOptions<T extends ConfigArgs> extends InjectableStrategy {    code: string;    args: T;    description: LocalizedStringArray;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### code​


[​](#code)A unique code used to identify this operation.

### args​


[​](#args)Optional provider-specific arguments which, when specified, are
editable in the admin-ui. For example, args could be used to store an API key
for a payment provider service.

Example

```
args: {  apiKey: { type: 'string' },}
```

See ConfigArgs for available configuration options.

[ConfigArgs](/reference/typescript-api/configurable-operation-def/config-args#configargs)
### description​


[​](#description)[LocalizedStringArray](/reference/typescript-api/configurable-operation-def/localized-string-array#localizedstringarray)A human-readable description for the operation method.


---

# DefaultFormComponentId


## DefaultFormComponentId​


[​](#defaultformcomponentid)[@vendure/common](https://www.npmjs.com/package/@vendure/common)[shared-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/common/src/shared-types.ts#L139)The ids of the default form input components that ship with the
Admin UI.

```
type DefaultFormComponentId = | 'boolean-form-input'    | 'currency-form-input'    | 'customer-group-form-input'    | 'date-form-input'    | 'facet-value-form-input'    | 'json-editor-form-input'    | 'html-editor-form-input'    | 'number-form-input'    | 'password-form-input'    | 'product-selector-form-input'    | 'relation-form-input'    | 'rich-text-form-input'    | 'select-form-input'    | 'text-form-input'    | 'textarea-form-input'    | 'product-multi-form-input'    | 'combination-mode-form-input'    | 'struct-form-input'
```


---

# DefaultFormConfigHash


## DefaultFormConfigHash​


[​](#defaultformconfighash)[@vendure/common](https://www.npmjs.com/package/@vendure/common)[shared-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/common/src/shared-types.ts#L165)Used to define the expected arguments for a given default form input component.

```
type DefaultFormConfigHash = {    'boolean-form-input': Record<string, never>;    'currency-form-input': Record<string, never>;    'customer-group-form-input': Record<string, never>;    'date-form-input': { min?: string; max?: string; yearRange?: number };    'facet-value-form-input': Record<string, never>;    'json-editor-form-input': { height?: string };    'html-editor-form-input': { height?: string };    'number-form-input': { min?: number; max?: number; step?: number; prefix?: string; suffix?: string };    'password-form-input': Record<string, never>;    'product-selector-form-input': Record<string, never>;    'relation-form-input': Record<string, never>;    'rich-text-form-input': Record<string, never>;    'select-form-input': {        options?: Array<{ value: string; label?: Array<Omit<LocalizedString, '__typename'>> }>;    };    'text-form-input': { prefix?: string; suffix?: string };    'textarea-form-input': {        spellcheck?: boolean;    };    'product-multi-form-input': {        selectionMode?: 'product' | 'variant';    };    'combination-mode-form-input': Record<string, never>;    'struct-form-input': Record<string, never>;}
```

### 'boolean-form-input'​


[​](#boolean-form-input)
### 'currency-form-input'​


[​](#currency-form-input)
### 'customer-group-form-input'​


[​](#customer-group-form-input)
### 'date-form-input'​


[​](#date-form-input)
### 'facet-value-form-input'​


[​](#facet-value-form-input)
### 'json-editor-form-input'​


[​](#json-editor-form-input)
### 'html-editor-form-input'​


[​](#html-editor-form-input)
### 'number-form-input'​


[​](#number-form-input)
### 'password-form-input'​


[​](#password-form-input)
### 'product-selector-form-input'​


[​](#product-selector-form-input)
### 'relation-form-input'​


[​](#relation-form-input)
### 'rich-text-form-input'​


[​](#rich-text-form-input)
### 'select-form-input'​


[​](#select-form-input)
### 'text-form-input'​


[​](#text-form-input)
### 'textarea-form-input'​


[​](#textarea-form-input)
### 'product-multi-form-input'​


[​](#product-multi-form-input)
### 'combination-mode-form-input'​


[​](#combination-mode-form-input)
### 'struct-form-input'​


[​](#struct-form-input)


---

# LocalizedStringArray


## LocalizedStringArray​


[​](#localizedstringarray)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[configurable-operation.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/configurable-operation.ts#L43)An array of string values in a given LanguageCode, used to define human-readable string values.
The ui property can be used in conjunction with the Vendure Admin UI to specify a custom form input
component.

[LanguageCode](/reference/typescript-api/common/language-code#languagecode)Example

```
const title: LocalizedStringArray = [  { languageCode: LanguageCode.en, value: 'English Title' },  { languageCode: LanguageCode.de, value: 'German Title' },  { languageCode: LanguageCode.zh, value: 'Chinese Title' },]
```

```
type LocalizedStringArray = Array<Omit<LocalizedString, '__typename'>>
```


---

# ApiOptions


## ApiOptions​


[​](#apioptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts#L76)The ApiOptions define how the Vendure GraphQL APIs are exposed, as well as allowing the API layer
to be extended with middleware.

```
interface ApiOptions {    hostname?: string;    port: number;    adminApiPath?: string;    shopApiPath?: string;    adminApiPlayground?: boolean | RenderPageOptions;    shopApiPlayground?: boolean | RenderPageOptions;    adminApiDebug?: boolean;    shopApiDebug?: boolean;    shopListQueryLimit?: number;    adminListQueryLimit?: number;    adminApiValidationRules?: Array<(context: ValidationContext) => any>;    shopApiValidationRules?: Array<(context: ValidationContext) => any>;    channelTokenKey?: string;    cors?: boolean | CorsOptions;    middleware?: Middleware[];    trustProxy?: TrustProxyOptions;    apolloServerPlugins?: ApolloServerPlugin[];    introspection?: boolean;}
```

### hostname​


[​](#hostname)Set the hostname of the server. If not set, the server will be available on localhost.

### port​


[​](#port)Which port the Vendure server should listen on.

### adminApiPath​


[​](#adminapipath)The path to the admin GraphQL API.

### shopApiPath​


[​](#shopapipath)The path to the shop GraphQL API.

### adminApiPlayground​


[​](#adminapiplayground)The playground config to the admin GraphQL API
ApolloServer playground.

[ApolloServer playground](https://www.apollographql.com/docs/apollo-server/api/apollo-server/#constructoroptions-apolloserver)
### shopApiPlayground​


[​](#shopapiplayground)The playground config to the shop GraphQL API
ApolloServer playground.

[ApolloServer playground](https://www.apollographql.com/docs/apollo-server/api/apollo-server/#constructoroptions-apolloserver)
### adminApiDebug​


[​](#adminapidebug)The debug config to the admin GraphQL API
ApolloServer playground.

[ApolloServer playground](https://www.apollographql.com/docs/apollo-server/api/apollo-server/#constructoroptions-apolloserver)
### shopApiDebug​


[​](#shopapidebug)The debug config to the shop GraphQL API
ApolloServer playground.

[ApolloServer playground](https://www.apollographql.com/docs/apollo-server/api/apollo-server/#constructoroptions-apolloserver)
### shopListQueryLimit​


[​](#shoplistquerylimit)The maximum number of items that may be returned by a query which returns a PaginatedList response. In other words,
this is the upper limit of the take input option.

### adminListQueryLimit​


[​](#adminlistquerylimit)The maximum number of items that may be returned by a query which returns a PaginatedList response. In other words,
this is the upper limit of the take input option.

### adminApiValidationRules​


[​](#adminapivalidationrules)Custom functions to use as additional validation rules when validating the schema for the admin GraphQL API
ApolloServer validation rules.

[ApolloServer validation rules](https://www.apollographql.com/docs/apollo-server/api/apollo-server/#validationrules)
### shopApiValidationRules​


[​](#shopapivalidationrules)Custom functions to use as additional validation rules when validating the schema for the shop GraphQL API
ApolloServer validation rules.

[ApolloServer validation rules](https://www.apollographql.com/docs/apollo-server/api/apollo-server/#validationrules)
### channelTokenKey​


[​](#channeltokenkey)The name of the property which contains the token of the
active channel. This property can be included either in
the request header or as a query string.

### cors​


[​](#cors)Set the CORS handling for the server. See the express CORS docs.

[express CORS docs](https://github.com/expressjs/cors#configuration-options)
### middleware​


[​](#middleware)[Middleware](/reference/typescript-api/common/middleware#middleware)Custom Express or NestJS middleware for the server. More information can be found in the Middleware docs.

[Middleware](/reference/typescript-api/common/middleware#middleware)
### trustProxy​


[​](#trustproxy)[TrustProxyOptions](/reference/typescript-api/configuration/trust-proxy-options#trustproxyoptions)Set the trust proxy configuration for the server. See the express proxy docs.

[express proxy docs](https://expressjs.com/en/guide/behind-proxies.html)
### apolloServerPlugins​


[​](#apolloserverplugins)Custom ApolloServerPlugins which
allow the extension of the Apollo Server, which is the underlying GraphQL server used by Vendure.

[ApolloServerPlugins](https://www.apollographql.com/docs/apollo-server/integrations/plugins/)Apollo plugins can be used e.g. to perform custom data transformations on incoming operations or outgoing
data.

### introspection​


[​](#introspection)Controls whether introspection of the GraphQL APIs is enabled. For production, it is recommended to disable
introspection, since exposing your entire schema can allow an attacker to trivially learn all operations
and much more easily find any potentially exploitable queries.

Note: when introspection is disabled, tooling which relies on it for things like autocompletion
will not work.

Example

```
{  introspection: process.env.NODE_ENV !== 'production'}
```


---

# CollectionFilter


## CollectionFilter​


[​](#collectionfilter)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[collection-filter.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/catalog/collection-filter.ts#L64)A CollectionFilter defines a rule which can be used to associate ProductVariants with a Collection.
The filtering is done by defining the apply() function, which receives a TypeORM
QueryBuilder object to which clauses may be added.

[QueryBuilder](https://typeorm.io/#/select-query-builder)Creating a CollectionFilter is considered an advanced Vendure topic. For more insight into how
they work, study the default collection filters

[default collection filters](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/catalog/default-collection-filters.ts)Here's a simple example of a custom CollectionFilter:

Example

```
import { CollectionFilter, LanguageCode } from '@vendure/core';export const skuCollectionFilter = new CollectionFilter({  args: {    // The `args` object defines the user-configurable arguments    // which will get passed to the filter's `apply()` function.    sku: {      type: 'string',      label: [{ languageCode: LanguageCode.en, value: 'SKU' }],      description: [        {          languageCode: LanguageCode.en,          value: 'Matches any product variants with SKUs containing this value',        },      ],    },  },  code: 'variant-sku-filter',  description: [{ languageCode: LanguageCode.en, value: 'Filter by matching SKU' }],  // This is the function that defines the logic of the filter.  apply: (qb, args) => {    const LIKE = qb.connection.options.type === 'postgres' ? 'ILIKE' : 'LIKE';    return qb.andWhere(`productVariant.sku ${LIKE} :sku`, { sku: `%${args.sku}%` });  },});
```

```
class CollectionFilter<T extends ConfigArgs = ConfigArgs> extends ConfigurableOperationDef<T> {    constructor(config: CollectionFilterConfig<T>)    apply(qb: SelectQueryBuilder<ProductVariant>, args: ConfigArg[]) => SelectQueryBuilder<ProductVariant>;}
```

- Extends: ConfigurableOperationDef<T>

[ConfigurableOperationDef](/reference/typescript-api/configurable-operation-def/#configurableoperationdef)
### constructor​


[​](#constructor)
### apply​


[​](#apply)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)


---

# DefaultConfig


## defaultConfig​


[​](#defaultconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/default-config.ts#L69)The default configuration settings which are used if not explicitly overridden in the bootstrap() call.


---

# DefaultSlugStrategy


## DefaultSlugStrategy​


[​](#defaultslugstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-slug-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/entity/default-slug-strategy.ts#L25)The default strategy for generating slugs. This strategy:

- Converts to lowercase
- Replaces spaces and special characters with hyphens
- Removes non-alphanumeric characters (except hyphens)
- Removes leading and trailing hyphens
- Collapses multiple hyphens into one

Example

```
const strategy = new DefaultSlugStrategy();strategy.generate(ctx, { value: "Hello World!" }); // "hello-world"strategy.generate(ctx, { value: "Café Français" }); // "cafe-francais"strategy.generate(ctx, { value: "100% Natural" }); // "100-natural"
```

```
class DefaultSlugStrategy implements SlugStrategy {    generate(ctx: RequestContext, params: SlugGenerateParams) => string;}
```

- Implements: SlugStrategy

[SlugStrategy](/reference/typescript-api/configuration/slug-strategy#slugstrategy)
### generate​


[​](#generate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)


---

# EntityDuplicator


## EntityDuplicator​


[​](#entityduplicator)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[entity-duplicator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/entity/entity-duplicator.ts#L158)An EntityDuplicator is used to define the logic for duplicating entities when the duplicateEntity mutation is called.
This allows you to add support for duplication of both core and custom entities.

Example

```
import { Collection, LanguageCode, Permission  EntityDuplicator, TransactionalConnection, CollectionService } from '@vendure/core';let collectionService: CollectionService;let connection: TransactionalConnection;// This is just an example - we already ship with a built-in duplicator for Collections.const customCollectionDuplicator = new EntityDuplicator({    code: 'custom-collection-duplicator',    description: [{ languageCode: LanguageCode.en, value: 'Custom collection duplicator' }],    args: {        throwError: {            type: 'boolean',            defaultValue: false,        },    },    forEntities: ['Collection'],    requiresPermission: [Permission.UpdateCollection],    init(injector) {        collectionService = injector.get(CollectionService);        connection = injector.get(TransactionalConnection);    },    duplicate: async input => {        const { ctx, id, args } = input;        const original = await connection.getEntityOrThrow(ctx, Collection, id, {            relations: {                assets: true,                featuredAsset: true,            },        });        const newCollection = await collectionService.create(ctx, {            isPrivate: original.isPrivate,            customFields: original.customFields,            assetIds: original.assets.map(a => a.id),            featuredAssetId: original.featuredAsset?.id,            parentId: original.parentId,            filters: original.filters.map(f => ({                code: f.code,                arguments: f.args,            })),            inheritFilters: original.inheritFilters,            translations: original.translations.map(t => ({                languageCode: t.languageCode,                name: `${t.name} (copy)`,                slug: `${t.slug}-copy`,                description: t.description,                customFields: t.customFields,            })),        });        if (args.throwError) {            // If an error is thrown at any point during the duplication process, the entire            // transaction will get automatically rolled back, and the mutation will return            // an ErrorResponse containing the error message.            throw new Error('Dummy error');        }        return newCollection;    },});
```

The duplicator then gets passed to your VendureConfig object:

```
import { VendureConfig, defaultEntityDuplicators } from '@vendure/core';import { customCollectionDuplicator } from './config/custom-collection-duplicator';export const config: VendureConfig = {   // ...   entityOptions: {     entityDuplicators: [         ...defaultEntityDuplicators,         customCollectionDuplicator,     ],   },};
```

```
class EntityDuplicator<T extends ConfigArgs = ConfigArgs> extends ConfigurableOperationDef<T> {    constructor(config: EntityDuplicatorConfig<T>)    duplicate(input: {        ctx: RequestContext;        entityName: string;        id: ID;        args: ConfigArg[];    }) => Promise<VendureEntity>;}
```

- Extends: ConfigurableOperationDef<T>

[ConfigurableOperationDef](/reference/typescript-api/configurable-operation-def/#configurableoperationdef)
### constructor​


[​](#constructor)[EntityDuplicatorConfig](/reference/typescript-api/configuration/entity-duplicator#entityduplicatorconfig)
### duplicate​


[​](#duplicate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)
## DuplicateEntityFn​


[​](#duplicateentityfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[entity-duplicator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/entity/entity-duplicator.ts#L21)A function which performs the duplication of an entity.

```
type DuplicateEntityFn<T extends ConfigArgs> = (input: {    ctx: RequestContext;    entityName: string;    id: ID;    args: ConfigArgValues<T>;}) => Promise<VendureEntity>
```

## EntityDuplicatorConfig​


[​](#entityduplicatorconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[entity-duplicator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/entity/entity-duplicator.ts#L36)Configuration for creating a new EntityDuplicator.

```
interface EntityDuplicatorConfig<T extends ConfigArgs> extends ConfigurableOperationDefOptions<T> {    requiresPermission: Array<Permission | string> | Permission | string;    forEntities: string[];    duplicate: DuplicateEntityFn<T>;}
```

- Extends: ConfigurableOperationDefOptions<T>

[ConfigurableOperationDefOptions](/reference/typescript-api/configurable-operation-def/configurable-operation-def-options#configurableoperationdefoptions)
### requiresPermission​


[​](#requirespermission)[Permission](/reference/typescript-api/common/permission#permission)[Permission](/reference/typescript-api/common/permission#permission)The permissions required in order to execute this duplicator. If an array is passed,
then the administrator must have at least one of the permissions in the array.

### forEntities​


[​](#forentities)The entities for which this duplicator is able to duplicate.

### duplicate​


[​](#duplicate-1)[DuplicateEntityFn](/reference/typescript-api/configuration/entity-duplicator#duplicateentityfn)The function which performs the duplication.

Example

```
duplicate: async input => {  const { ctx, id, args } = input;  // perform the duplication logic here  return newEntity;}
```


---

# EntityId Decorator


## EntityId​


[​](#entityid)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[entity-id.decorator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/entity-id.decorator.ts#L41)Decorates a property which points to another entity by ID. This custom decorator is needed
because we do not know the data type of the ID column until runtime, when we have access
to the configured EntityIdStrategy.

```
function EntityId(options?: IdColumnOptions): void
```

Parameters

### options​


[​](#options)


---

# EntityIdStrategy


## AutoIncrementIdStrategy​


[​](#autoincrementidstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[auto-increment-id-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/entity/auto-increment-id-strategy.ts#L11)An id strategy which uses auto-increment integers as primary keys
for all entities. This is the default strategy used by Vendure.

```
class AutoIncrementIdStrategy implements EntityIdStrategy<'increment'> {    readonly primaryKeyType = 'increment';    decodeId(id: string) => number;    encodeId(primaryKey: number) => string;}
```

- Implements: EntityIdStrategy<'increment'>

[EntityIdStrategy](/reference/typescript-api/configuration/entity-id-strategy#entityidstrategy)
### primaryKeyType​


[​](#primarykeytype)
### decodeId​


[​](#decodeid)
### encodeId​


[​](#encodeid)
## EntityIdStrategy​


[​](#entityidstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[entity-id-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/entity/entity-id-strategy.ts#L32)The EntityIdStrategy determines how entity IDs are generated and stored in the
database, as well as how they are transformed when being passed from the API to the
service layer and vice versa.

Vendure ships with two strategies: AutoIncrementIdStrategy and UuidIdStrategy,
but custom strategies can be used, e.g. to apply some custom encoding to the ID before exposing
it in the GraphQL API.

[AutoIncrementIdStrategy](/reference/typescript-api/configuration/entity-id-strategy#autoincrementidstrategy)[UuidIdStrategy](/reference/typescript-api/configuration/entity-id-strategy#uuididstrategy)This is configured via the entityOptions.entityIdStrategy property of
your VendureConfig.

Note: changing from an integer-based strategy to a uuid-based strategy
on an existing Vendure database will lead to problems with broken foreign-key
references. To change primary key types like this, you'll need to start with
a fresh database.

```
interface EntityIdStrategy<T extends 'increment' | 'uuid'> extends InjectableStrategy {    readonly primaryKeyType: T;    encodeId: (primaryKey: PrimaryKeyType<T>) => string;    decodeId: (id: string) => PrimaryKeyType<T>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### primaryKeyType​


[​](#primarykeytype-1)Defines how the primary key will be stored in the database - either
'increment' for auto-increment integer IDs, or 'uuid' for a unique
string ID.

### encodeId​


[​](#encodeid-1)Allows the raw ID from the database to be transformed in some way before exposing
it in the GraphQL API.

For example, you may need to use auto-increment integer IDs due to some business
constraint, but you may not want to expose this data publicly in your API. In this
case, you can use the encode/decode methods to obfuscate the ID with some kind of
encoding scheme, such as base64 (or something more sophisticated).

### decodeId​


[​](#decodeid-1)Reverses the transformation performed by the encodeId method in order to get
back to the raw ID value.

## UuidIdStrategy​


[​](#uuididstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[uuid-id-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/entity/uuid-id-strategy.ts#L25)An id strategy which uses string uuids as primary keys
for all entities. This strategy can be configured with the
entityIdStrategy property of the entityOptions property
of VendureConfig.

[VendureConfig](/reference/typescript-api/configuration/vendure-config#vendureconfig)Example

```
import { UuidIdStrategy, VendureConfig } from '@vendure/core';export const config: VendureConfig = {  entityOptions: {    entityIdStrategy: new UuidIdStrategy(),    // ...  }}
```

```
class UuidIdStrategy implements EntityIdStrategy<'uuid'> {    readonly primaryKeyType = 'uuid';    decodeId(id: string) => string;    encodeId(primaryKey: string) => string;}
```

- Implements: EntityIdStrategy<'uuid'>

[EntityIdStrategy](/reference/typescript-api/configuration/entity-id-strategy#entityidstrategy)
### primaryKeyType​


[​](#primarykeytype-2)
### decodeId​


[​](#decodeid-2)
### encodeId​


[​](#encodeid-2)

---

# EntityOptions


## EntityOptions​


[​](#entityoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts#L1036)Options relating to the internal handling of entities.

```
interface EntityOptions {    entityIdStrategy?: EntityIdStrategy<any>;    entityDuplicators?: Array<EntityDuplicator<any>>;    moneyStrategy?: MoneyStrategy;    channelCacheTtl?: number;    zoneCacheTtl?: number;    taxRateCacheTtl?: number;    metadataModifiers?: EntityMetadataModifier[];    slugStrategy?: SlugStrategy;}
```

### entityIdStrategy​


[​](#entityidstrategy)[EntityIdStrategy](/reference/typescript-api/configuration/entity-id-strategy#entityidstrategy)[AutoIncrementIdStrategy](/reference/typescript-api/configuration/entity-id-strategy#autoincrementidstrategy)Defines the strategy used for both storing the primary keys of entities
in the database, and the encoding & decoding of those ids when exposing
entities via the API. The default uses a simple auto-increment integer
strategy.

Note: changing from an integer-based strategy to a uuid-based strategy
on an existing Vendure database will lead to problems with broken foreign-key
references. To change primary key types like this, you'll need to start with
a fresh database.

### entityDuplicators​


[​](#entityduplicators)[EntityDuplicator](/reference/typescript-api/configuration/entity-duplicator#entityduplicator)An array of EntityDuplicator instances which are used to duplicate entities
when using the duplicateEntity mutation.

[EntityDuplicator](/reference/typescript-api/configuration/entity-duplicator#entityduplicator)
### moneyStrategy​


[​](#moneystrategy)[MoneyStrategy](/reference/typescript-api/money/money-strategy#moneystrategy)[DefaultMoneyStrategy](/reference/typescript-api/money/default-money-strategy#defaultmoneystrategy)Defines the strategy used to store and round monetary values.

### channelCacheTtl​


[​](#channelcachettl)Channels get cached in-memory as they are accessed very frequently. This
setting determines how long the cache lives (in ms) until it is considered stale and
refreshed. For multi-instance deployments (e.g. serverless, load-balanced), a
smaller value here will prevent data inconsistencies between instances.

### zoneCacheTtl​


[​](#zonecachettl)Zones get cached in-memory as they are accessed very frequently. This
setting determines how long the cache lives (in ms) until it is considered stale and
refreshed. For multi-instance deployments (e.g. serverless, load-balanced), a
smaller value here will prevent data inconsistencies between instances.

### taxRateCacheTtl​


[​](#taxratecachettl)TaxRates get cached in-memory as they are accessed very frequently. This
setting determines how long the cache lives (in ms) until it is considered stale and
refreshed. For multi-instance deployments (e.g. serverless, load-balanced), a
smaller value here will prevent data inconsistencies between instances.

### metadataModifiers​


[​](#metadatamodifiers)[EntityMetadataModifier](/reference/typescript-api/configuration/entity-options#entitymetadatamodifier)Allows the metadata of the built-in TypeORM entities to be manipulated. This allows you
to do things like altering data types, adding indices etc. This is an advanced feature
which should be used with some caution as it will result in DB schema changes. For examples
see EntityMetadataModifier.

[EntityMetadataModifier](/reference/typescript-api/configuration/entity-options#entitymetadatamodifier)
### slugStrategy​


[​](#slugstrategy)[SlugStrategy](/reference/typescript-api/configuration/slug-strategy#slugstrategy)[DefaultSlugStrategy](/reference/typescript-api/configuration/default-slug-strategy#defaultslugstrategy)Defines the strategy for generating slugs from input strings.
Slugs are URL-friendly versions of text commonly used for entity identifiers in URLs.

## EntityMetadataModifier​


[​](#entitymetadatamodifier)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[entity-metadata-modifier.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/entity-metadata/entity-metadata-modifier.ts#L56)A function which allows TypeORM entity metadata to be manipulated prior to the DB schema being generated
during bootstrap.

Certain DB schema modifications will result in auto-generated migrations which will lead to data loss. For instance,
changing the data type of a column will drop the column & data and then re-create it. To avoid loss of important data,
always check and modify your migration scripts as needed.

Example

```
import { Index } from 'typeorm';import { EntityMetadataModifier, ProductVariant } from '@vendure/core';// Adds a unique index to the ProductVariant.sku columnexport const addSkuUniqueIndex: EntityMetadataModifier = metadata => {  const instance = new ProductVariant();  Index({ unique: true })(instance, 'sku');};
```

Example

```
import { Column } from 'typeorm';import { EntityMetadataModifier, ProductTranslation } from '@vendure/core';// Use the "mediumtext" datatype for the Product's description rather than// the default "text" type.export const makeProductDescriptionMediumText: EntityMetadataModifier = metadata => {    const descriptionColumnIndex = metadata.columns.findIndex(        col => col.propertyName === 'description' && col.target === ProductTranslation,    );    if (-1 < descriptionColumnIndex) {        // First we need to remove the existing column definition        // from the metadata.        metadata.columns.splice(descriptionColumnIndex, 1);        // Then we add a new column definition with our custom        // data type "mediumtext"        // DANGER: this particular modification will generate a DB migration        // which will result in data loss of existing descriptions. Make sure        // to manually check & modify your migration scripts.        const instance = new ProductTranslation();        Column({ type: 'mediumtext' })(instance, 'description');    }};
```

```
type EntityMetadataModifier = (metadata: MetadataArgsStorage) => void | Promise<void>
```


---

# MergeConfig


## mergeConfig​


[​](#mergeconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[merge-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/merge-config.ts#L32)Performs a deep merge of two VendureConfig objects. Unlike Object.assign() the target object is
not mutated, instead the function returns a new object which is the result of deeply merging the
values of source into target.

Arrays do not get merged, they are treated as a single value that will be replaced. So if merging the
plugins array, you must explicitly concatenate the array.

Example

```
const result = mergeConfig(defaultConfig, {  assetOptions: {    uploadMaxFileSize: 5000,  },  plugins: [    ...defaultConfig.plugins,    MyPlugin,  ]};
```

```
function mergeConfig<T extends VendureConfig>(target: T, source: PartialVendureConfig, depth:  = 0): T
```

Parameters

### target​


[​](#target)
### source​


[​](#source)
### depth​


[​](#depth)

---

# ProductVariantPriceSelectionStrategy


## ProductVariantPriceSelectionStrategy​


[​](#productvariantpriceselectionstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-variant-price-selection-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/catalog/product-variant-price-selection-strategy.ts#L21)The strategy for selecting the price for a ProductVariant in a given Channel.

This is configured via the catalogOptions.productVariantPriceSelectionStrategy property of
your VendureConfig.

```
interface ProductVariantPriceSelectionStrategy extends InjectableStrategy {    selectPrice(        ctx: RequestContext,        prices: ProductVariantPrice[],    ): ProductVariantPrice | undefined | Promise<ProductVariantPrice | undefined>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### selectPrice​


[​](#selectprice)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)
## DefaultProductVariantPriceSelectionStrategy​


[​](#defaultproductvariantpriceselectionstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-product-variant-price-selection-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/catalog/default-product-variant-price-selection-strategy.ts#L17)The default strategy for selecting the price for a ProductVariant in a given Channel. It
first filters all available prices to those which are in the current Channel, and then
selects the first price which matches the current currency.

```
class DefaultProductVariantPriceSelectionStrategy implements ProductVariantPriceSelectionStrategy {    selectPrice(ctx: RequestContext, prices: ProductVariantPrice[]) => ;}
```

- Implements: ProductVariantPriceSelectionStrategy

[ProductVariantPriceSelectionStrategy](/reference/typescript-api/configuration/product-variant-price-selection-strategy#productvariantpriceselectionstrategy)
### selectPrice​


[​](#selectprice-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)

---

# ProductVariantPriceUpdateStrategy


## ProductVariantPriceUpdateStrategy​


[​](#productvariantpriceupdatestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-variant-price-update-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/catalog/product-variant-price-update-strategy.ts#L58)This strategy determines how updates to a ProductVariantPrice is handled in regard to
any other prices which may be associated with the same ProductVariant.

For instance, in a multichannel setup, if a price is updated for a ProductVariant in one
Channel, this strategy can be used to update the prices in other Channels.

Using custom logic, this can be made more sophisticated - for example, you could have a
one-way sync that only updates prices in child channels when the price in the default
channel is updated. You could also have a conditional sync which is dependent on the
permissions of the current administrator, or based on custom field flags on the ProductVariant
or Channel.

Another use-case might be to update the prices of a ProductVariant in other currencies
when a price is updated in one currency, based on the current exchange rate.

This is configured via the catalogOptions.productVariantPriceUpdateStrategy property of
your VendureConfig.

```
interface ProductVariantPriceUpdateStrategy extends InjectableStrategy {    onPriceCreated(        ctx: RequestContext,        createdPrice: ProductVariantPrice,        prices: ProductVariantPrice[],    ): UpdatedProductVariantPrice[] | Promise<UpdatedProductVariantPrice[]>;    onPriceUpdated(        ctx: RequestContext,        updatedPrice: ProductVariantPrice,        prices: ProductVariantPrice[],    ): UpdatedProductVariantPrice[] | Promise<UpdatedProductVariantPrice[]>;    onPriceDeleted(        ctx: RequestContext,        deletedPrice: ProductVariantPrice,        prices: ProductVariantPrice[],    ): UpdatedProductVariantPrice[] | Promise<UpdatedProductVariantPrice[]>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### onPriceCreated​


[​](#onpricecreated)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)This method is called when a ProductVariantPrice is created. It receives the created
ProductVariantPrice and the array of all prices associated with the ProductVariant.

It should return an array of UpdatedProductVariantPrice objects which will be used to update
the prices of the specific ProductVariantPrices.

### onPriceUpdated​


[​](#onpriceupdated)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)This method is called when a ProductVariantPrice is updated. It receives the updated
ProductVariantPrice and the array of all prices associated with the ProductVariant.

It should return an array of UpdatedProductVariantPrice objects which will be used to update
the prices of the specific ProductVariantPrices.

### onPriceDeleted​


[​](#onpricedeleted)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)This method is called when a ProductVariantPrice is deleted. It receives the deleted
ProductVariantPrice and the array of all prices associated with the ProductVariant.

It should return an array of UpdatedProductVariantPrice objects which will be used to update
the prices of the specific ProductVariantPrices.

## DefaultProductVariantPriceUpdateStrategyOptions​


[​](#defaultproductvariantpriceupdatestrategyoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-product-variant-price-update-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/catalog/default-product-variant-price-update-strategy.ts#L14)The options available to the DefaultProductVariantPriceUpdateStrategy.

[DefaultProductVariantPriceUpdateStrategy](/reference/typescript-api/configuration/product-variant-price-update-strategy#defaultproductvariantpriceupdatestrategy)
```
interface DefaultProductVariantPriceUpdateStrategyOptions {    syncPricesAcrossChannels: boolean;}
```

### syncPricesAcrossChannels​


[​](#syncpricesacrosschannels)When true, any price changes to a ProductVariant in one Channel will update any other
prices of the same currencyCode in other Channels. Note that if there are different
tax settings across the channels, these will not be taken into account. To handle this
case, a custom strategy should be implemented.

## DefaultProductVariantPriceUpdateStrategy​


[​](#defaultproductvariantpriceupdatestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-product-variant-price-update-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/catalog/default-product-variant-price-update-strategy.ts#L56)The default ProductVariantPriceUpdateStrategy which by default will not update any other
prices when a price is created, updated or deleted.

[ProductVariantPriceUpdateStrategy](/reference/typescript-api/configuration/product-variant-price-update-strategy#productvariantpriceupdatestrategy)If the syncPricesAcrossChannels option is set to true, then when a price is updated in one Channel,
the price of the same currencyCode in other Channels will be updated to match.  Note that if there are different
tax settings across the channels, these will not be taken into account. To handle this
case, a custom strategy should be implemented.

Example

```
import { DefaultProductVariantPriceUpdateStrategy, VendureConfig } from '@vendure/core';export const config: VendureConfig = {  // ...  catalogOptions: {    productVariantPriceUpdateStrategy: new DefaultProductVariantPriceUpdateStrategy({      syncPricesAcrossChannels: true,    }),  },  // ...};
```

```
class DefaultProductVariantPriceUpdateStrategy implements ProductVariantPriceUpdateStrategy {    constructor(options: DefaultProductVariantPriceUpdateStrategyOptions)    onPriceCreated(ctx: RequestContext, price: ProductVariantPrice) => ;    onPriceUpdated(ctx: RequestContext, updatedPrice: ProductVariantPrice, prices: ProductVariantPrice[]) => ;    onPriceDeleted(ctx: RequestContext, deletedPrice: ProductVariantPrice, prices: ProductVariantPrice[]) => ;}
```

- Implements: ProductVariantPriceUpdateStrategy

[ProductVariantPriceUpdateStrategy](/reference/typescript-api/configuration/product-variant-price-update-strategy#productvariantpriceupdatestrategy)
### constructor​


[​](#constructor)[DefaultProductVariantPriceUpdateStrategyOptions](/reference/typescript-api/configuration/product-variant-price-update-strategy#defaultproductvariantpriceupdatestrategyoptions)
### onPriceCreated​


[​](#onpricecreated-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)
### onPriceUpdated​


[​](#onpriceupdated-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)
### onPriceDeleted​


[​](#onpricedeleted-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)


---

# RuntimeVendureConfig


## RuntimeVendureConfig​


[​](#runtimevendureconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts#L1319)This interface represents the VendureConfig object available at run-time, i.e. the user-supplied
config values have been merged with the defaultConfig values.

[defaultConfig](/reference/typescript-api/configuration/default-config#defaultconfig)
```
interface RuntimeVendureConfig extends Required<VendureConfig> {    apiOptions: Required<ApiOptions>;    assetOptions: Required<AssetOptions>;    authOptions: Required<AuthOptions>;    catalogOptions: Required<CatalogOptions>;    customFields: Required<CustomFields>;    entityOptions: Required<Omit<EntityOptions, 'entityIdStrategy'>> & EntityOptions;    importExportOptions: Required<ImportExportOptions>;    jobQueueOptions: Required<JobQueueOptions>;    schedulerOptions: Required<SchedulerOptions>;    orderOptions: Required<OrderOptions>;    promotionOptions: Required<PromotionOptions>;    shippingOptions: Required<ShippingOptions>;    taxOptions: Required<TaxOptions>;    systemOptions: Required<SystemOptions>;}
```

- Extends: Required<VendureConfig>

[VendureConfig](/reference/typescript-api/configuration/vendure-config#vendureconfig)
### apiOptions​


[​](#apioptions)[ApiOptions](/reference/typescript-api/configuration/api-options#apioptions)
### assetOptions​


[​](#assetoptions)[AssetOptions](/reference/typescript-api/assets/asset-options#assetoptions)
### authOptions​


[​](#authoptions)[AuthOptions](/reference/typescript-api/auth/auth-options#authoptions)
### catalogOptions​


[​](#catalogoptions)[CatalogOptions](/reference/typescript-api/products-stock/catalog-options#catalogoptions)
### customFields​


[​](#customfields)[CustomFields](/reference/typescript-api/custom-fields/#customfields)
### entityOptions​


[​](#entityoptions)[EntityOptions](/reference/typescript-api/configuration/entity-options#entityoptions)[EntityOptions](/reference/typescript-api/configuration/entity-options#entityoptions)
### importExportOptions​


[​](#importexportoptions)[ImportExportOptions](/reference/typescript-api/import-export/import-export-options#importexportoptions)
### jobQueueOptions​


[​](#jobqueueoptions)[JobQueueOptions](/reference/typescript-api/job-queue/job-queue-options#jobqueueoptions)
### schedulerOptions​


[​](#scheduleroptions)[SchedulerOptions](/reference/typescript-api/scheduled-tasks/scheduler-options#scheduleroptions)
### orderOptions​


[​](#orderoptions)[OrderOptions](/reference/typescript-api/orders/order-options#orderoptions)
### promotionOptions​


[​](#promotionoptions)[PromotionOptions](/reference/typescript-api/promotions/promotion-options#promotionoptions)
### shippingOptions​


[​](#shippingoptions)[ShippingOptions](/reference/typescript-api/shipping/shipping-options#shippingoptions)
### taxOptions​


[​](#taxoptions)[TaxOptions](/reference/typescript-api/tax/tax-options#taxoptions)
### systemOptions​


[​](#systemoptions)[SystemOptions](/reference/typescript-api/configuration/system-options#systemoptions)


---

# SettingsStoreFields


## SettingsStoreFields​


[​](#settingsstorefields)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[settings-store-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/settings-store/settings-store-types.ts#L141)This is how SettingsStoreFields are defined in the VendureConfig object.

[VendureConfig](/reference/typescript-api/configuration/vendure-config#vendureconfig)
```
type SettingsStoreFields = {    [namespace: string]: SettingsStoreFieldConfig[];}
```

### [index]​


[​](#index)[SettingsStoreFieldConfig](/reference/typescript-api/settings-store/settings-store-field-config#settingsstorefieldconfig)


---

# SlugStrategy


## SlugStrategy​


[​](#slugstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[slug-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/entity/slug-strategy.ts#L44)Defines the strategy for generating slugs from input strings.
Slugs are URL-friendly versions of text that are commonly used for
entity identifiers in URLs.

Example

```
export class CustomSlugStrategy implements SlugStrategy {  generate(ctx: RequestContext, params: SlugGenerateParams): string {    return params.value      .toLowerCase()      .replace(/[^a-z0-9]+/g, '-')      .replace(/^-+|-+$/g, '');  }}
```

```
interface SlugStrategy extends InjectableStrategy {    generate(ctx: RequestContext, params: SlugGenerateParams): string | Promise<string>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### generate​


[​](#generate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Generates a slug from the input string.

---

# SystemOptions


## SystemOptions​


[​](#systemoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts#L1134)Options relating to system functions.

```
interface SystemOptions {    healthChecks?: HealthCheckStrategy[];    errorHandlers?: ErrorHandlerStrategy[];    cacheStrategy?: CacheStrategy;    instrumentationStrategy?: InstrumentationStrategy;}
```

### healthChecks​


[​](#healthchecks)[HealthCheckStrategy](/reference/typescript-api/health-check/health-check-strategy#healthcheckstrategy)[TypeORMHealthCheckStrategy](/reference/typescript-api/health-check/type-ormhealth-check-strategy#typeormhealthcheckstrategy)Defines an array of HealthCheckStrategy instances which are used by the /health endpoint to verify
that any critical systems which the Vendure server depends on are also healthy.

[HealthCheckStrategy](/reference/typescript-api/health-check/health-check-strategy#healthcheckstrategy)
### errorHandlers​


[​](#errorhandlers)[ErrorHandlerStrategy](/reference/typescript-api/errors/error-handler-strategy#errorhandlerstrategy)Defines an array of ErrorHandlerStrategy instances which are used to define logic to be executed
when an error occurs, either on the server or the worker.

[ErrorHandlerStrategy](/reference/typescript-api/errors/error-handler-strategy#errorhandlerstrategy)
### cacheStrategy​


[​](#cachestrategy)[CacheStrategy](/reference/typescript-api/cache/cache-strategy#cachestrategy)Defines the underlying method used to store cache key-value pairs which powers the
CacheService.

[CacheService](/reference/typescript-api/cache/cache-service#cacheservice)
### instrumentationStrategy​


[​](#instrumentationstrategy)[InstrumentationStrategy](/reference/typescript-api/telemetry/instrumentation-strategy#instrumentationstrategy)

---

# TrustProxyOptions


## TrustProxyOptions​


[​](#trustproxyoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts#L245)Configures Express trust proxy settings when running behind a reverse proxy (usually the case with most hosting services).
Setting trustProxy allows you to retrieve the original IP address from the X-Forwarded-For header.

See the express documentation for more details.

[express documentation](https://expressjs.com/en/guide/behind-proxies.html)
```
type TrustProxyOptions = boolean | number | string | string[] | ((ip: string) => boolean)
```

---

# VendureConfig


## VendureConfig​


[​](#vendureconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts#L1172)All possible configuration options are defined by the
VendureConfig interface.

[VendureConfig](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts)
```
interface VendureConfig {    apiOptions: ApiOptions;    assetOptions?: AssetOptions;    authOptions: AuthOptions;    catalogOptions?: CatalogOptions;    customFields?: CustomFields;    settingsStoreFields?: SettingsStoreFields;    dbConnectionOptions: DataSourceOptions;    defaultChannelToken?: string | null;    defaultLanguageCode?: LanguageCode;    entityIdStrategy?: EntityIdStrategy<any>;    entityOptions?: EntityOptions;    importExportOptions?: ImportExportOptions;    orderOptions?: OrderOptions;    paymentOptions: PaymentOptions;    plugins?: Array<DynamicModule | Type<any>>;    promotionOptions?: PromotionOptions;    shippingOptions?: ShippingOptions;    logger?: VendureLogger;    taxOptions?: TaxOptions;    jobQueueOptions?: JobQueueOptions;    schedulerOptions?: SchedulerOptions;    systemOptions?: SystemOptions;}
```

### apiOptions​


[​](#apioptions)[ApiOptions](/reference/typescript-api/configuration/api-options#apioptions)Configuration for the GraphQL APIs, including hostname, port, CORS settings,
middleware etc.

### assetOptions​


[​](#assetoptions)[AssetOptions](/reference/typescript-api/assets/asset-options#assetoptions)Configuration for the handling of Assets.

### authOptions​


[​](#authoptions)[AuthOptions](/reference/typescript-api/auth/auth-options#authoptions)Configuration for authorization.

### catalogOptions​


[​](#catalogoptions)[CatalogOptions](/reference/typescript-api/products-stock/catalog-options#catalogoptions)Configuration for Products and Collections.

### customFields​


[​](#customfields)[CustomFields](/reference/typescript-api/custom-fields/#customfields)Defines custom fields which can be used to extend the built-in entities.

### settingsStoreFields​


[​](#settingsstorefields)[SettingsStoreFields](/reference/typescript-api/configuration/settings-store-fields#settingsstorefields)Defines key-value fields that can be set and read via the getKeyValue/setKeyValue GraphQL APIs
and via the SettingsStoreService. These differ from custom fields in that they are not associated
with a specific entity, but can be scoped globally or to a specific user etc, and defining them does not
require any changes to the database schema.

[SettingsStoreService](/reference/typescript-api/services/settings-store-service#settingsstoreservice)
### dbConnectionOptions​


[​](#dbconnectionoptions)The connection options used by TypeORM to connect to the database.
See the TypeORM documentation for a
full description of all available options.

[TypeORM documentation](https://typeorm.io/#/connection-options)
### defaultChannelToken​


[​](#defaultchanneltoken)The token for the default channel. If not specified, a token
will be randomly generated.

### defaultLanguageCode​


[​](#defaultlanguagecode)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)The default languageCode of the app.

### entityIdStrategy​


[​](#entityidstrategy)[EntityIdStrategy](/reference/typescript-api/configuration/entity-id-strategy#entityidstrategy)[AutoIncrementIdStrategy](/reference/typescript-api/configuration/entity-id-strategy#autoincrementidstrategy)Defines the strategy used for both storing the primary keys of entities
in the database, and the encoding & decoding of those ids when exposing
entities via the API. The default uses a simple auto-increment integer
strategy.

### entityOptions​


[​](#entityoptions)[EntityOptions](/reference/typescript-api/configuration/entity-options#entityoptions)
### importExportOptions​


[​](#importexportoptions)[ImportExportOptions](/reference/typescript-api/import-export/import-export-options#importexportoptions)Configuration settings for data import and export.

### orderOptions​


[​](#orderoptions)[OrderOptions](/reference/typescript-api/orders/order-options#orderoptions)Configuration settings governing how orders are handled.

### paymentOptions​


[​](#paymentoptions)[PaymentOptions](/reference/typescript-api/payment/payment-options#paymentoptions)Configures available payment processing methods.

### plugins​


[​](#plugins)An array of plugins.

### promotionOptions​


[​](#promotionoptions)[PromotionOptions](/reference/typescript-api/promotions/promotion-options#promotionoptions)Configures the Conditions and Actions available when creating Promotions.

### shippingOptions​


[​](#shippingoptions)[ShippingOptions](/reference/typescript-api/shipping/shipping-options#shippingoptions)Configures the available checkers and calculators for ShippingMethods.

### logger​


[​](#logger)[VendureLogger](/reference/typescript-api/logger/vendure-logger#vendurelogger)[DefaultLogger](/reference/typescript-api/logger/default-logger#defaultlogger)Provide a logging service which implements the VendureLogger interface.
Note that the logging of SQL queries is controlled separately by the
dbConnectionOptions.logging property.

[VendureLogger](/reference/typescript-api/logger/vendure-logger#vendurelogger)
### taxOptions​


[​](#taxoptions)[TaxOptions](/reference/typescript-api/tax/tax-options#taxoptions)Configures how taxes are calculated on products.

### jobQueueOptions​


[​](#jobqueueoptions)[JobQueueOptions](/reference/typescript-api/job-queue/job-queue-options#jobqueueoptions)Configures how the job queue is persisted and processed.

### schedulerOptions​


[​](#scheduleroptions)[SchedulerOptions](/reference/typescript-api/scheduled-tasks/scheduler-options#scheduleroptions)Configures the scheduler mechanism and tasks.

### systemOptions​


[​](#systemoptions)[SystemOptions](/reference/typescript-api/configuration/system-options#systemoptions)Configures system options


---

# CustomFields


## CustomFields​


[​](#customfields)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[custom-field-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/custom-field/custom-field-types.ts#L273)Most entities can have additional fields added to them by defining an array of CustomFieldConfigobjects on against the corresponding key.

[CustomFieldConfig](/reference/typescript-api/custom-fields/custom-field-config#customfieldconfig)Example

```
bootstrap({    // ...    customFields: {        Product: [            { name: 'infoUrl', type: 'string' },            { name: 'downloadable', type: 'boolean', defaultValue: false },            { name: 'shortName', type: 'localeString' },        ],        User: [            { name: 'socialLoginToken', type: 'string', public: false },        ],    },})
```

```
type CustomFields = {    Address?: CustomFieldConfig[];    Administrator?: CustomFieldConfig[];    Asset?: CustomFieldConfig[];    Channel?: CustomFieldConfig[];    Collection?: CustomFieldConfig[];    Customer?: CustomFieldConfig[];    CustomerGroup?: CustomFieldConfig[];    Facet?: CustomFieldConfig[];    FacetValue?: CustomFieldConfig[];    Fulfillment?: CustomFieldConfig[];    GlobalSettings?: CustomFieldConfig[];    HistoryEntry?: CustomFieldConfig[];    Order?: CustomFieldConfig[];    OrderLine?: CustomFieldConfig[];    Payment?: CustomFieldConfig[];    PaymentMethod?: CustomFieldConfig[];    Product?: CustomFieldConfig[];    ProductOption?: CustomFieldConfig[];    ProductOptionGroup?: CustomFieldConfig[];    ProductVariant?: CustomFieldConfig[];    ProductVariantPrice?: CustomFieldConfig[];    Promotion?: CustomFieldConfig[];    Refund?: CustomFieldConfig[];    Region?: CustomFieldConfig[];    Seller?: CustomFieldConfig[];    Session?: CustomFieldConfig[];    ShippingLine?: CustomFieldConfig[];    ShippingMethod?: CustomFieldConfig[];    StockLevel?: CustomFieldConfig[];    StockLocation?: CustomFieldConfig[];    StockMovement?: CustomFieldConfig[];    TaxCategory?: CustomFieldConfig[];    TaxRate?: CustomFieldConfig[];    User?: CustomFieldConfig[];    Zone?: CustomFieldConfig[];} & { [entity: string]: CustomFieldConfig[] }
```

---

# CustomFieldConfig


## CustomFieldConfig​


[​](#customfieldconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[custom-field-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/custom-field/custom-field-types.ts#L237)An object used to configure a custom field.

```
type CustomFieldConfig = | StringCustomFieldConfig    | LocaleStringCustomFieldConfig    | TextCustomFieldConfig    | LocaleTextCustomFieldConfig    | IntCustomFieldConfig    | FloatCustomFieldConfig    | BooleanCustomFieldConfig    | DateTimeCustomFieldConfig    | RelationCustomFieldConfig    | StructCustomFieldConfig
```

---

# CustomFieldType


## CustomFieldType​


[​](#customfieldtype)[@vendure/common](https://www.npmjs.com/package/@vendure/common)[shared-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/common/src/shared-types.ts#L104)A data type for a custom field. The CustomFieldType determines the data types used in the generated
database columns and GraphQL fields as follows (key: m = MySQL, p = Postgres, s = SQLite):

Additionally, the CustomFieldType also dictates which configuration options
are available for that custom field.

[configuration options](/guides/developer-guide/custom-fields/#custom-field-config-properties)
```
type CustomFieldType = | 'string'    | 'localeString'    | 'int'    | 'float'    | 'boolean'    | 'datetime'    | 'relation'    | 'text'    | 'localeText'    | 'struct'
```

---

# StructCustomFieldConfig


## StructCustomFieldConfig​


[​](#structcustomfieldconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[custom-field-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/custom-field/custom-field-types.ts#L224)Configures a "struct" custom field.

```
type StructCustomFieldConfig = TypedCustomFieldConfig<    'struct',    Omit<GraphQLStructCustomFieldConfig, 'fields'>> & {    fields: StructFieldConfig[];}
```


---

# StructFieldConfig


## StructFieldConfig​


[​](#structfieldconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[custom-field-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/custom-field/custom-field-types.ts#L209)Configures an individual field of a "struct" custom field. The individual fields share
the same API as the top-level custom fields, with the exception that they do not support the
readonly, internal, nullable, unique and requiresPermission options.

Example

```
const customFields: CustomFields = {  Product: [    {      name: 'specifications',      type: 'struct',      fields: [        { name: 'processor', type: 'string' },        { name: 'ram', type: 'string' },        { name: 'screenSize', type: 'float' },      ],    },  ],};
```

```
type StructFieldConfig = | StringStructFieldConfig    | TextStructFieldConfig    | IntStructFieldConfig    | FloatStructFieldConfig    | BooleanStructFieldConfig    | DateTimeStructFieldConfig
```


---

# TypedCustomSingleFieldConfig


## TypedCustomSingleFieldConfig​


[​](#typedcustomsinglefieldconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[custom-field-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/custom-field/custom-field-types.ts#L84)Configures a custom field on an entity in the CustomFields config object.

[CustomFields](/reference/typescript-api/custom-fields/#customfields)
```
type TypedCustomSingleFieldConfig<T extends CustomFieldType, C extends CustomField> = BaseTypedCustomFieldConfig<T, C> & {    list?: false;    defaultValue?: DefaultValueType<T>;    validate?: (        value: DefaultValueType<T>,        injector: Injector,        ctx: RequestContext,    ) => string | LocalizedString[] | void | Promise<string | LocalizedString[] | void>;}
```


---

# CalculatedPropertySubscriber


## CalculatedPropertySubscriber​


[​](#calculatedpropertysubscriber)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[subscribers.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/subscribers.ts#L14)
```
class CalculatedPropertySubscriber implements EntitySubscriberInterface {    afterLoad(event: any) => ;    afterInsert(event: InsertEvent<any>) => Promise<any> | void;}
```

- Implements: EntitySubscriberInterface

### afterLoad​


[​](#afterload)
### afterInsert​


[​](#afterinsert)


---

# Calculated


## Calculated​


[​](#calculated)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[calculated-decorator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/calculated-decorator.ts#L43)Used to define calculated entity getters. The decorator simply attaches an array of "calculated"
property names to the entity's prototype. This array is then used by the CalculatedPropertySubscriberto transfer the getter function from the prototype to the entity instance.

[CalculatedPropertySubscriber](/reference/typescript-api/data-access/calculated-property-subscriber#calculatedpropertysubscriber)
```
function Calculated(queryInstruction?: CalculatedColumnQueryInstruction): MethodDecorator
```

Parameters

### queryInstruction​


[​](#queryinstruction)[CalculatedColumnQueryInstruction](/reference/typescript-api/data-access/calculated#calculatedcolumnqueryinstruction)
## CalculatedColumnQueryInstruction​


[​](#calculatedcolumnqueryinstruction)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[calculated-decorator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/calculated-decorator.ts#L17)Optional metadata used to tell the ListQueryBuilder & Relations decorator how to deal with
calculated columns when sorting, filtering and deriving required relations from GraphQL operations.

[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[Relations](/reference/typescript-api/request/relations-decorator#relations)
```
interface CalculatedColumnQueryInstruction {    relations?: string[];    query?: (qb: SelectQueryBuilder<any>) => void;    expression?: string;}
```

### relations​


[​](#relations)If the calculated property depends on one or more relations being present
on the entity (e.g. an Order entity calculating the totalQuantity by adding
up the quantities of each OrderLine), then those relations should be defined here.

### query​


[​](#query)
### expression​


[​](#expression)


---

# EntityHydrator


## EntityHydrator​


[​](#entityhydrator)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[entity-hydrator.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/entity-hydrator/entity-hydrator.service.ts#L77)This is a helper class which is used to "hydrate" entity instances, which means to populate them
with the specified relations. This is useful when writing plugin code which receives an entity,
and you need to ensure that one or more relations are present.

Example

```
import { Injectable } from '@nestjs/common';import { ID, RequestContext, EntityHydrator, ProductVariantService } from '@vendure/core';@Injectable()export class MyService {  constructor(     private entityHydrator: EntityHydrator,     private productVariantService: ProductVariantService,  ) {}  myMethod(ctx: RequestContext, variantId: ID) {    const product = await this.productVariantService      .getProductForVariant(ctx, variantId);    // at this stage, we don't know which of the Product relations    // will be joined at runtime.    await this.entityHydrator      .hydrate(ctx, product, { relations: ['facetValues.facet' ]});    // You can be sure now that the `facetValues` & `facetValues.facet` relations are populated  }}
```

In this above example, the product instance will now have the facetValues relation
available, and those FacetValues will have their facet relations joined too.

This hydrate method will also automatically take care or translating any
translatable entities (e.g. Product, Collection, Facet), and if the applyProductVariantPrices
options is used (see HydrateOptions), any related ProductVariant will have the correct
Channel-specific prices applied to them.

[HydrateOptions](/reference/typescript-api/data-access/hydrate-options#hydrateoptions)Custom field relations may also be hydrated:

Example

```
const customer = await this.customerService  .findOne(ctx, id);await this.entityHydrator  .hydrate(ctx, customer, { relations: ['customFields.avatar' ]});
```

```
class EntityHydrator {    constructor(connection: TransactionalConnection, productPriceApplicator: ProductPriceApplicator, translator: TranslatorService)    hydrate(ctx: RequestContext, target: Entity, options: HydrateOptions<Entity>) => Promise<Entity>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[ProductPriceApplicator](/reference/typescript-api/service-helpers/product-price-applicator#productpriceapplicator)[TranslatorService](/reference/typescript-api/service-helpers/translator-service#translatorservice)
### hydrate​


[​](#hydrate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[HydrateOptions](/reference/typescript-api/data-access/hydrate-options#hydrateoptions)Hydrates (joins) the specified relations to the target entity instance. This method
mutates the target entity.

Example

```
await this.entityHydrator.hydrate(ctx, product, {  relations: [    'variants.stockMovements'    'optionGroups.options',    'featuredAsset',  ],  applyProductVariantPrices: true,});
```


---

# GetEntityOrThrowOptions


## GetEntityOrThrowOptions​


[​](#getentityorthrowoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/connection/types.ts#L10)Options used by the TransactionalConnection getEntityOrThrow method.

[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)
```
interface GetEntityOrThrowOptions<T = any> extends FindOneOptions<T> {    channelId?: ID;    retries?: number;    retryDelay?: number;    includeSoftDeleted?: boolean;}
```

- Extends: FindOneOptions<T>

### channelId​


[​](#channelid)[ID](/reference/typescript-api/common/id#id)An optional channelId to limit results to entities assigned to the given Channel. Should
only be used when getting entities that implement the ChannelAware interface.

[ChannelAware](/reference/typescript-api/entities/interfaces#channelaware)
### retries​


[​](#retries)If set to a positive integer, it will retry getting the entity in case it is initially not
found.

### retryDelay​


[​](#retrydelay)Specifies the delay in ms to wait between retries.

### includeSoftDeleted​


[​](#includesoftdeleted)If set to true, soft-deleted entities will be returned. Otherwise they will
throw as if they did not exist.


---

# HydrateOptions


## HydrateOptions​


[​](#hydrateoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[entity-hydrator-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/entity-hydrator/entity-hydrator-types.ts#L12)Options used to control which relations of the entity get hydrated
when using the EntityHydrator helper.

[EntityHydrator](/reference/typescript-api/data-access/entity-hydrator#entityhydrator)
```
interface HydrateOptions<Entity extends VendureEntity> {    relations: Array<EntityRelationPaths<Entity>>;    applyProductVariantPrices?: boolean;}
```

### relations​


[​](#relations)[EntityRelationPaths](/reference/typescript-api/common/entity-relation-paths#entityrelationpaths)Defines the relations to hydrate, using strings with dot notation to indicate
nested joins. If the entity already has a particular relation available, that relation
will be skipped (no extra DB join will be added).

### applyProductVariantPrices​


[​](#applyproductvariantprices)If set to true, any ProductVariants will also have their price and priceWithTax fields
applied based on the current context. If prices are not required, this can be left false which
will be slightly more efficient.


---

# ListQueryBuilder


## ListQueryBuilder​


[​](#listquerybuilder)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[list-query-builder.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/list-query-builder/list-query-builder.ts#L207)This helper class is used when fetching entities the database from queries which return a PaginatedList type.
These queries all follow the same format:

[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)In the GraphQL definition, they return a type which implements the Node interface, and the query returns a
type which implements the PaginatedList interface:

```
type BlogPost implements Node {  id: ID!  published: DateTime!  title: String!  body: String!}type BlogPostList implements PaginatedList {  items: [BlogPost!]!  totalItems: Int!}# Generated at run-time by Vendureinput BlogPostListOptionsextend type Query {   blogPosts(options: BlogPostListOptions): BlogPostList!}

```

When Vendure bootstraps, it will find the BlogPostListOptions input and, because it is used in a query
returning a PaginatedList type, it knows that it should dynamically generate this input. This means
all primitive field of the BlogPost type (namely, "published", "title" and "body") will have filter and
sort inputs created for them, as well a skip and take fields for pagination.

Your resolver function will then look like this:

```
@Resolver()export class BlogPostResolver  constructor(private blogPostService: BlogPostService) {}  @Query()  async blogPosts(    @Ctx() ctx: RequestContext,    @Args() args: any,  ): Promise<PaginatedList<BlogPost>> {    return this.blogPostService.findAll(ctx, args.options || undefined);  }}
```

and the corresponding service will use the ListQueryBuilder:

```
@Injectable()export class BlogPostService {  constructor(private listQueryBuilder: ListQueryBuilder) {}  findAll(ctx: RequestContext, options?: ListQueryOptions<BlogPost>) {    return this.listQueryBuilder      .build(BlogPost, options)      .getManyAndCount()      .then(async ([items, totalItems]) => {        return { items, totalItems };      });  }}
```

```
class ListQueryBuilder implements OnApplicationBootstrap {    constructor(connection: TransactionalConnection, configService: ConfigService)    filterObjectHasProperty(filterObject: FP | NullOptionals<FP> | null | undefined, property: keyof FP) => boolean;    build(entity: Type<T>, options: ListQueryOptions<T> = {}, extendedOptions: ExtendedListQueryOptions<T> = {}) => SelectQueryBuilder<T>;}
```

- Implements: OnApplicationBootstrap

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)
### filterObjectHasProperty​


[​](#filterobjecthasproperty)Used to determine whether a list query filter object contains the
given property, either at the top level or nested inside a boolean
_and or _or expression.

This is useful when a custom property map is used to map a filter
field to a related entity, and we need to determine whether the
filter object contains that property, which then means we would need
to join that relation.

### build​


[​](#build)[ExtendedListQueryOptions](/reference/typescript-api/data-access/list-query-builder#extendedlistqueryoptions)
## ExtendedListQueryOptions​


[​](#extendedlistqueryoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[list-query-builder.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/list-query-builder/list-query-builder.ts#L48)Options which can be passed to the ListQueryBuilder's build() method.

```
type ExtendedListQueryOptions<T extends VendureEntity> = {    relations?: string[];    channelId?: ID;    where?: FindOptionsWhere<T>;    orderBy?: FindOneOptions<T>['order'];    entityAlias?: string;    ctx?: RequestContext;    customPropertyMap?: { [name: string]: string };    ignoreQueryLimits?: boolean;}
```

### relations​


[​](#relations)
### channelId​


[​](#channelid)[ID](/reference/typescript-api/common/id#id)
### where​


[​](#where)
### orderBy​


[​](#orderby)
### entityAlias​


[​](#entityalias)Allows you to specify the alias used for the entity T in the generated SQL query.
Defaults to the entity class name lower-cased, i.e. ProductVariant -> 'productvariant'.

### ctx​


[​](#ctx)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)When a RequestContext is passed, then the query will be
executed as part of any outer transaction.

### customPropertyMap​


[​](#custompropertymap)One of the main tasks of the ListQueryBuilder is to auto-generate filter and sort queries based on the
available columns of a given entity. However, it may also be sometimes desirable to allow filter/sort
on a property of a relation. In this case, the customPropertyMap can be used to define a property
of the options.sort or options.filter which does not correspond to a direct column of the current
entity, and then provide a mapping to the related property to be sorted/filtered.

Example: we want to allow sort/filter by and Order's customerLastName. The actual lastName property is
not a column in the Order table, it exists on the Customer entity, and Order has a relation to Customer via
Order.customer. Therefore, we can define a customPropertyMap like this:

Example

```
"""Manually extend the filter & sort inputs to include the newfield that we want to be able to use in building list queries."""input OrderFilterParameter {    customerLastName: StringOperators}input OrderSortParameter {    customerLastName: SortOrder}
```

Example

```
const qb = this.listQueryBuilder.build(Order, options, {  relations: ['customer'],  customPropertyMap: {    // Tell TypeORM how to map that custom    // sort/filter field to the property on a    // related entity.    customerLastName: 'customer.lastName',  },};
```

We can now use the customerLastName property to filter or sort
on the list query:

Example

```
query {  myOrderQuery(options: {    filter: {      customerLastName: { contains: "sm" }    }  }) {    # ...  }}

```

### ignoreQueryLimits​


[​](#ignorequerylimits)When set to true, the configured shopListQueryLimit and adminListQueryLimit values will be ignored,
allowing unlimited results to be returned. Use caution when exposing an unlimited list query to the public,
as it could become a vector for a denial of service attack if an attacker requests a very large list.


---

# TransactionalConnection


## TransactionalConnection​


[​](#transactionalconnection)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[transactional-connection.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/connection/transactional-connection.ts#L41)The TransactionalConnection is a wrapper around the TypeORM Connection object which works in conjunction
with the Transaction decorator to implement per-request transactions. All services which access the
database should use this class rather than the raw TypeORM connection, to ensure that db changes can be
easily wrapped in transactions when required.

[Transaction](/reference/typescript-api/request/transaction-decorator#transaction)The service layer does not need to know about the scope of a transaction, as this is covered at the
API by the use of the Transaction decorator.

```
class TransactionalConnection {    constructor(dataSource: DataSource, transactionWrapper: TransactionWrapper)    rawConnection: DataSource    getRepository(target: ObjectType<Entity> | EntitySchema<Entity> | string) => Repository<Entity>;    getRepository(ctx: RequestContext | undefined, target: ObjectType<Entity> | EntitySchema<Entity> | string, options?: {            replicationMode?: ReplicationMode;        }) => Repository<Entity>;    getRepository(ctxOrTarget: RequestContext | ObjectType<Entity> | EntitySchema<Entity> | string | undefined, maybeTarget?: ObjectType<Entity> | EntitySchema<Entity> | string, options?: {            replicationMode?: ReplicationMode;        }) => Repository<Entity>;    withTransaction(work: (ctx: RequestContext) => Promise<T>) => Promise<T>;    withTransaction(ctx: RequestContext, work: (ctx: RequestContext) => Promise<T>) => Promise<T>;    withTransaction(ctxOrWork: RequestContext | ((ctx: RequestContext) => Promise<T>), maybeWork?: (ctx: RequestContext) => Promise<T>) => Promise<T>;    startTransaction(ctx: RequestContext, isolationLevel?: TransactionIsolationLevel) => ;    commitOpenTransaction(ctx: RequestContext) => ;    rollBackTransaction(ctx: RequestContext) => ;    getEntityOrThrow(ctx: RequestContext, entityType: Type<T>, id: ID, options: GetEntityOrThrowOptions<T> = {}) => Promise<T>;    findOneInChannel(ctx: RequestContext, entity: Type<T>, id: ID, channelId: ID, options: FindOneOptions<T> = {}) => ;    findByIdsInChannel(ctx: RequestContext, entity: Type<T>, ids: ID[], channelId: ID, options: FindManyOptions<T>) => ;}
```

### constructor​


[​](#constructor)
### rawConnection​


[​](#rawconnection)The plain TypeORM Connection object. Should be used carefully as any operations
performed with this connection will not be performed within any outer
transactions.

### getRepository​


[​](#getrepository)Returns a TypeORM repository. Note that when no RequestContext is supplied, the repository will not
be aware of any existing transaction. Therefore, calling this method without supplying a RequestContext
is discouraged without a deliberate reason.

### getRepository​


[​](#getrepository-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Returns a TypeORM repository which is bound to any existing transactions. It is recommended to always pass
the RequestContext argument when possible, otherwise the queries will be executed outside of any
ongoing transactions which have been started by the Transaction decorator.

[Transaction](/reference/typescript-api/request/transaction-decorator#transaction)The options parameter allows specifying additional configurations, such as the replicationMode,
which determines whether the repository should interact with the master or replica database.

### getRepository​


[​](#getrepository-2)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Returns a TypeORM repository. Depending on the parameters passed, it will either be transaction-aware
or not. If RequestContext is provided, the repository is bound to any ongoing transactions. The
options parameter allows further customization, such as selecting the replication mode (e.g., 'master').

### withTransaction​


[​](#withtransaction)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Allows database operations to be wrapped in a transaction, ensuring that in the event of an error being
thrown at any point, the entire transaction will be rolled back and no changes will be saved.

In the context of API requests, you should instead use the Transaction decorator on your resolver or
controller method.

[Transaction](/reference/typescript-api/request/transaction-decorator#transaction)On the other hand, for code that does not run in the context of a GraphQL/REST request, this method
should be used to protect against non-atomic changes to the data which could leave your data in an
inconsistent state.

Such situations include function processed by the JobQueue or stand-alone scripts which make use
of Vendure internal services.

If there is already a RequestContext object available, you should pass it in as the first
argument in order to create transactional context as the copy. If not, omit the first argument and an empty
RequestContext object will be created, which is then used to propagate the transaction to
all inner method calls.

[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Example

```
private async transferCredit(outerCtx: RequestContext, fromId: ID, toId: ID, amount: number) {  await this.connection.withTransaction(outerCtx, async ctx => {    // Note you must not use `outerCtx` here, instead use `ctx`. Otherwise, this query    // will be executed outside of transaction    await this.giftCardService.updateCustomerCredit(ctx, fromId, -amount);    await this.connection.getRepository(ctx, GiftCard).update(fromId, { transferred: true })    // If some intermediate logic here throws an Error,    // then all DB transactions will be rolled back and neither Customer's    // credit balance will have changed.    await this.giftCardService.updateCustomerCredit(ctx, toId, amount);  })}
```

### withTransaction​


[​](#withtransaction-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### withTransaction​


[​](#withtransaction-2)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### startTransaction​


[​](#starttransaction)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[TransactionIsolationLevel](/reference/typescript-api/request/transaction-decorator#transactionisolationlevel)Manually start a transaction if one is not already in progress. This method should be used in
conjunction with the 'manual' mode of the Transaction decorator.

[Transaction](/reference/typescript-api/request/transaction-decorator#transaction)
### commitOpenTransaction​


[​](#commitopentransaction)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Manually commits any open transaction. Should be very rarely needed, since the Transaction decorator
and the internal TransactionInterceptor take care of this automatically. Use-cases include situations
in which the worker thread needs to access changes made in the current transaction, or when using the
Transaction decorator in manual mode.

[Transaction](/reference/typescript-api/request/transaction-decorator#transaction)
### rollBackTransaction​


[​](#rollbacktransaction)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Manually rolls back any open transaction. Should be very rarely needed, since the Transaction decorator
and the internal TransactionInterceptor take care of this automatically. Use-cases include when using the
Transaction decorator in manual mode.

[Transaction](/reference/typescript-api/request/transaction-decorator#transaction)
### getEntityOrThrow​


[​](#getentityorthrow)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[GetEntityOrThrowOptions](/reference/typescript-api/data-access/get-entity-or-throw-options#getentityorthrowoptions)Finds an entity of the given type by ID, or throws an EntityNotFoundError if none
is found.

### findOneInChannel​


[​](#findoneinchannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)Like the TypeOrm Repository.findOne() method, but limits the results to
the given Channel.

### findByIdsInChannel​


[​](#findbyidsinchannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)Like the TypeOrm Repository.findByIds() method, but limits the results to
the given Channel.


---

# DefaultSearchPlugin


## DefaultSearchPlugin​


[​](#defaultsearchplugin)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-search-plugin.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/default-search-plugin/default-search-plugin.ts#L70)The DefaultSearchPlugin provides a full-text Product search based on the full-text searching capabilities of the
underlying database.

The DefaultSearchPlugin is bundled with the @vendure/core package. If you are not using an alternative search
plugin, then make sure this one is used, otherwise you will not be able to search products via the
search query.

[search query](/reference/graphql-api/shop/queries#search)Note that the quality of the fulltext search capabilities varies depending on the underlying database being used. For example,
the MySQL & Postgres implementations will typically yield better results than the SQLite implementation.

Example

```
import { DefaultSearchPlugin, VendureConfig } from '@vendure/core';export const config: VendureConfig = {  // Add an instance of the plugin to the plugins array  plugins: [    DefaultSearchPlugin.init({      indexStockStatus: true,      bufferUpdates: true,    }),  ],};
```

```
class DefaultSearchPlugin implements OnApplicationBootstrap, OnApplicationShutdown {    static options: DefaultSearchPluginInitOptions = {};    init(options: DefaultSearchPluginInitOptions) => Type<DefaultSearchPlugin>;}
```

- Implements: OnApplicationBootstrap, OnApplicationShutdown

### options​


[​](#options)[DefaultSearchPluginInitOptions](/reference/typescript-api/default-search-plugin/default-search-plugin-init-options#defaultsearchplugininitoptions)
### init​


[​](#init)[DefaultSearchPluginInitOptions](/reference/typescript-api/default-search-plugin/default-search-plugin-init-options#defaultsearchplugininitoptions)[DefaultSearchPlugin](/reference/typescript-api/default-search-plugin/#defaultsearchplugin)

---

# DefaultSearchPluginInitOptions


## DefaultSearchPluginInitOptions​


[​](#defaultsearchplugininitoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/default-search-plugin/types.ts#L15)Options which configure the behaviour of the DefaultSearchPlugin

```
interface DefaultSearchPluginInitOptions {    indexStockStatus?: boolean;    bufferUpdates?: boolean;    searchStrategy?: SearchStrategy;}
```

### indexStockStatus​


[​](#indexstockstatus)If set to true, the stock status of a ProductVariant (inStock: Boolean) will
be exposed in the search query results. Enabling this option on an existing
Vendure installation will require a DB migration/synchronization.

### bufferUpdates​


[​](#bufferupdates)If set to true, updates to Products, ProductVariants and Collections will not immediately
trigger an update to the search index. Instead, all these changes will be buffered and will
only be run via a call to the runPendingSearchIndexUpdates mutation in the Admin API.

This is very useful for installations with a large number of ProductVariants and/or
Collections, as the buffering allows better control over when these expensive jobs are run,
and also performs optimizations to minimize the amount of work that needs to be performed by
the worker.

### searchStrategy​


[​](#searchstrategy)[SearchStrategy](/reference/typescript-api/default-search-plugin/search-strategy#searchstrategy)Set a custom search strategy that implements SearchStrategy or extends an existing search strategy
such as MysqlSearchStrategy, PostgresSearchStrategy or SqliteSearchStrategy.

[SearchStrategy](/reference/typescript-api/default-search-plugin/search-strategy#searchstrategy)[MysqlSearchStrategy](/reference/typescript-api/default-search-plugin/mysql-search-strategy#mysqlsearchstrategy)[PostgresSearchStrategy](/reference/typescript-api/default-search-plugin/postgres-search-strategy#postgressearchstrategy)[SqliteSearchStrategy](/reference/typescript-api/default-search-plugin/sqlite-search-strategy#sqlitesearchstrategy)Example

```
export class MySearchStrategy implements SearchStrategy {    private readonly minTermLength = 2;    private connection: TransactionalConnection;    private options: DefaultSearchPluginInitOptions;    async init(injector: Injector) {        this.connection = injector.get(TransactionalConnection);        this.options = injector.get(PLUGIN_INIT_OPTIONS);    }    async getFacetValueIds(        ctx: RequestContext,        input: SearchInput,        enabledOnly: boolean,    ): Promise<Map<ID, number>> {        // ...        return createFacetIdCountMap(facetValuesResult);    }    async getCollectionIds(        ctx: RequestContext,        input: SearchInput,        enabledOnly: boolean,    ): Promise<Map<ID, number>> {        // ...        return createCollectionIdCountMap(collectionsResult);    }    async getSearchResults(        ctx: RequestContext,        input: SearchInput,        enabledOnly: boolean,    ): Promise<SearchResult[]> {        const take = input.take || 25;        const skip = input.skip || 0;        const sort = input.sort;        const qb = this.connection            .getRepository(SearchIndexItem)            .createQueryBuilder('si')            .select(this.createMysqlSelect(!!input.groupByProduct));        // ...        return qb            .take(take)            .skip(skip)            .getRawMany()            .then(res => res.map(r => mapToSearchResult(r, ctx.channel.currencyCode)));    }    async getTotalCount(ctx: RequestContext, input: SearchInput, enabledOnly: boolean): Promise<number> {        const innerQb = this.applyTermAndFilters(            ctx,            this.connection                .getRepository(SearchIndexItem)                .createQueryBuilder('si')                .select(this.createMysqlSelect(!!input.groupByProduct)),            input,        );        if (enabledOnly) {            innerQb.andWhere('si.enabled = :enabled', { enabled: true });        }        const totalItemsQb = this.connection.rawConnection            .createQueryBuilder()            .select('COUNT(*) as total')            .from(`(${innerQb.getQuery()})`, 'inner')            .setParameters(innerQb.getParameters());        return totalItemsQb.getRawOne().then(res => res.total);    }}
```


---

# MysqlSearchStrategy


## MysqlSearchStrategy​


[​](#mysqlsearchstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[mysql-search-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/default-search-plugin/search-strategy/mysql-search-strategy.ts#L28)A weighted fulltext search for MySQL / MariaDB.

```
class MysqlSearchStrategy implements SearchStrategy {    init(injector: Injector) => ;    getFacetValueIds(ctx: RequestContext, input: SearchInput, enabledOnly: boolean) => Promise<Map<ID, number>>;    getCollectionIds(ctx: RequestContext, input: SearchInput, enabledOnly: boolean) => Promise<Map<ID, number>>;    getSearchResults(ctx: RequestContext, input: SearchInput, enabledOnly: boolean) => Promise<SearchResult[]>;    getTotalCount(ctx: RequestContext, input: SearchInput, enabledOnly: boolean) => Promise<number>;}
```

- Implements: SearchStrategy

[SearchStrategy](/reference/typescript-api/default-search-plugin/search-strategy#searchstrategy)
### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)
### getFacetValueIds​


[​](#getfacetvalueids)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### getCollectionIds​


[​](#getcollectionids)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### getSearchResults​


[​](#getsearchresults)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### getTotalCount​


[​](#gettotalcount)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)


---

# PostgresSearchStrategy


## PostgresSearchStrategy​


[​](#postgressearchstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[postgres-search-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/default-search-plugin/search-strategy/postgres-search-strategy.ts#L28)A weighted fulltext search for PostgeSQL.

```
class PostgresSearchStrategy implements SearchStrategy {    init(injector: Injector) => ;    getFacetValueIds(ctx: RequestContext, input: SearchInput, enabledOnly: boolean) => Promise<Map<ID, number>>;    getCollectionIds(ctx: RequestContext, input: SearchInput, enabledOnly: boolean) => Promise<Map<ID, number>>;    getSearchResults(ctx: RequestContext, input: SearchInput, enabledOnly: boolean) => Promise<SearchResult[]>;    getTotalCount(ctx: RequestContext, input: SearchInput, enabledOnly: boolean) => Promise<number>;}
```

- Implements: SearchStrategy

[SearchStrategy](/reference/typescript-api/default-search-plugin/search-strategy#searchstrategy)
### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)
### getFacetValueIds​


[​](#getfacetvalueids)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### getCollectionIds​


[​](#getcollectionids)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### getSearchResults​


[​](#getsearchresults)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### getTotalCount​


[​](#gettotalcount)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)


---

# SearchStrategy


## SearchStrategy​


[​](#searchstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[search-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/default-search-plugin/search-strategy/search-strategy.ts#L21)This interface defines the contract that any database-specific search implementations
should follow.

This is configured via the searchStrategy property of
the DefaultSearchPluginInitOptions.

[DefaultSearchPluginInitOptions](/reference/typescript-api/default-search-plugin/default-search-plugin-init-options#defaultsearchplugininitoptions)
```
interface SearchStrategy extends InjectableStrategy {    getSearchResults(ctx: RequestContext, input: SearchInput, enabledOnly: boolean): Promise<SearchResult[]>;    getTotalCount(ctx: RequestContext, input: SearchInput, enabledOnly: boolean): Promise<number>;    getFacetValueIds(ctx: RequestContext, input: SearchInput, enabledOnly: boolean): Promise<Map<ID, number>>;    getCollectionIds(ctx: RequestContext, input: SearchInput, enabledOnly: boolean): Promise<Map<ID, number>>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### getSearchResults​


[​](#getsearchresults)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### getTotalCount​


[​](#gettotalcount)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### getFacetValueIds​


[​](#getfacetvalueids)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### getCollectionIds​


[​](#getcollectionids)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)


---

# SqliteSearchStrategy


## SqliteSearchStrategy​


[​](#sqlitesearchstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[sqlite-search-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/default-search-plugin/search-strategy/sqlite-search-strategy.ts#L30)A rather naive search for SQLite / SQL.js. Rather than proper
full-text searching, it uses a weighted LIKE "%term%" operator instead.

```
class SqliteSearchStrategy implements SearchStrategy {    init(injector: Injector) => ;    getFacetValueIds(ctx: RequestContext, input: SearchInput, enabledOnly: boolean) => Promise<Map<ID, number>>;    getCollectionIds(ctx: RequestContext, input: SearchInput, enabledOnly: boolean) => Promise<Map<ID, number>>;    getSearchResults(ctx: RequestContext, input: SearchInput, enabledOnly: boolean) => Promise<SearchResult[]>;    getTotalCount(ctx: RequestContext, input: SearchInput, enabledOnly: boolean) => Promise<number>;}
```

- Implements: SearchStrategy

[SearchStrategy](/reference/typescript-api/default-search-plugin/search-strategy#searchstrategy)
### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)
### getFacetValueIds​


[​](#getfacetvalueids)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### getCollectionIds​


[​](#getcollectionids)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### getSearchResults​


[​](#getsearchresults)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### getTotalCount​


[​](#gettotalcount)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)


---

# Address


## Address​


[​](#address)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[address.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/address/address.entity.ts#L16)Represents a Customer's address.

[Customer](/reference/typescript-api/entities/customer#customer)
```
class Address extends VendureEntity implements HasCustomFields {    constructor(input?: DeepPartial<Address>)    @Index()    @ManyToOne(type => Customer, customer => customer.addresses)    customer: Customer;    @Column({ default: '' }) fullName: string;    @Column({ default: '' })    company: string;    @Column() streetLine1: string;    @Column({ default: '' })    streetLine2: string;    @Column({ default: '' }) city: string;    @Column({ default: '' })    province: string;    @Column({ default: '' }) postalCode: string;    @Index()    @ManyToOne(type => Country)    country: Country;    @Column({ default: '' })    phoneNumber: string;    @Column({ default: false })    defaultShippingAddress: boolean;    @Column({ default: false })    defaultBillingAddress: boolean;    @Column(type => CustomAddressFields)    customFields: CustomAddressFields;}
```

- Extends: VendureEntity
- Implements: HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: HasCustomFields

### constructor​


[​](#constructor)[Address](/reference/typescript-api/entities/address#address)
### customer​


[​](#customer)[Customer](/reference/typescript-api/entities/customer#customer)
### fullName​


[​](#fullname)
### company​


[​](#company)
### streetLine1​


[​](#streetline1)
### streetLine2​


[​](#streetline2)
### city​


[​](#city)
### province​


[​](#province)
### postalCode​


[​](#postalcode)
### country​


[​](#country)[Country](/reference/typescript-api/entities/country#country)
### phoneNumber​


[​](#phonenumber)
### defaultShippingAddress​


[​](#defaultshippingaddress)
### defaultBillingAddress​


[​](#defaultbillingaddress)
### customFields​


[​](#customfields)

---

# Administrator


## Administrator​


[​](#administrator)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[administrator.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/administrator/administrator.entity.ts#L18)An administrative user who has access to the Admin UI and Admin API. The
specific permissions of the Administrator are determined by the assigned
Roles.

[Role](/reference/typescript-api/entities/role#role)
```
class Administrator extends VendureEntity implements SoftDeletable, HasCustomFields {    constructor(input?: DeepPartial<Administrator>)    @Column({ type: Date, nullable: true })    deletedAt: Date | null;    @Column() firstName: string;    @Column() lastName: string;    @Column({ unique: true })    emailAddress: string;    @OneToOne(type => User)    @JoinColumn()    user: User;    @Column(type => CustomAdministratorFields)    customFields: CustomAdministratorFields;}
```

- Extends: VendureEntity
- Implements: SoftDeletable, HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: SoftDeletable, HasCustomFields

[SoftDeletable](/reference/typescript-api/entities/interfaces#softdeletable)
### constructor​


[​](#constructor)[Administrator](/reference/typescript-api/entities/administrator#administrator)
### deletedAt​


[​](#deletedat)
### firstName​


[​](#firstname)
### lastName​


[​](#lastname)
### emailAddress​


[​](#emailaddress)
### user​


[​](#user)[User](/reference/typescript-api/entities/user#user)
### customFields​


[​](#customfields)


---

# AnonymousSession


## AnonymousSession​


[​](#anonymoussession)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[anonymous-session.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/session/anonymous-session.entity.ts#L16)An anonymous session is created when a unauthenticated user interacts with restricted operations,
such as calling the activeOrder query in the Shop API. Anonymous sessions allow a guest Customer
to maintain an order without requiring authentication and a registered account beforehand.

```
class AnonymousSession extends Session {    constructor(input: DeepPartial<AnonymousSession>)}
```

- Extends: Session

[Session](/reference/typescript-api/entities/session#session)
### constructor​


[​](#constructor)[AnonymousSession](/reference/typescript-api/entities/anonymous-session#anonymoussession)


---

# Asset


## Asset​


[​](#asset)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[asset.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/asset/asset.entity.ts#L22)An Asset represents a file such as an image which can be associated with certain other entities
such as Products.

```
class Asset extends VendureEntity implements Taggable, ChannelAware, HasCustomFields {    constructor(input?: DeepPartial<Asset>)    @Column() name: string;    @Column('varchar') type: AssetType;    @Column() mimeType: string;    @Column({ default: 0 }) width: number;    @Column({ default: 0 }) height: number;    @Column() fileSize: number;    @Column() source: string;    @Column() preview: string;    @Column('simple-json', { nullable: true })    focalPoint?: { x: number; y: number };    @ManyToMany(type => Tag)    @JoinTable()    tags: Tag[];    @ManyToMany(type => Channel)    @JoinTable()    channels: Channel[];    @OneToMany(type => Collection, collection => collection.featuredAsset)    featuredInCollections?: Collection[];    @OneToMany(type => ProductVariant, productVariant => productVariant.featuredAsset)    featuredInVariants?: ProductVariant[];    @OneToMany(type => Product, product => product.featuredAsset)    featuredInProducts?: Product[];    @Column(type => CustomAssetFields)    customFields: CustomAssetFields;}
```

- Extends: VendureEntity
- Implements: Taggable, ChannelAware, HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: Taggable, ChannelAware, HasCustomFields

[Taggable](/reference/typescript-api/entities/interfaces#taggable)[ChannelAware](/reference/typescript-api/entities/interfaces#channelaware)
### constructor​


[​](#constructor)[Asset](/reference/typescript-api/entities/asset#asset)
### name​


[​](#name)
### type​


[​](#type)
### mimeType​


[​](#mimetype)
### width​


[​](#width)
### height​


[​](#height)
### fileSize​


[​](#filesize)
### source​


[​](#source)
### preview​


[​](#preview)
### focalPoint​


[​](#focalpoint)
### tags​


[​](#tags)[Tag](/reference/typescript-api/entities/tag#tag)
### channels​


[​](#channels)[Channel](/reference/typescript-api/entities/channel#channel)
### featuredInCollections​


[​](#featuredincollections)[Collection](/reference/typescript-api/entities/collection#collection)
### featuredInVariants​


[​](#featuredinvariants)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### featuredInProducts​


[​](#featuredinproducts)[Product](/reference/typescript-api/entities/product#product)
### customFields​


[​](#customfields)


---

# AuthenticatedSession


## AuthenticatedSession​


[​](#authenticatedsession)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[authenticated-session.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/session/authenticated-session.entity.ts#L14)An AuthenticatedSession is created upon successful authentication.

```
class AuthenticatedSession extends Session {    constructor(input: DeepPartial<AuthenticatedSession>)    @Index()    @ManyToOne(type => User, user => user.sessions)    user: User;    @Column()    authenticationStrategy: string;}
```

- Extends: Session

[Session](/reference/typescript-api/entities/session#session)
### constructor​


[​](#constructor)[AuthenticatedSession](/reference/typescript-api/entities/authenticated-session#authenticatedsession)
### user​


[​](#user)[User](/reference/typescript-api/entities/user#user)The User who has authenticated to create this session.

[User](/reference/typescript-api/entities/user#user)
### authenticationStrategy​


[​](#authenticationstrategy)The name of the AuthenticationStrategy used when authenticating
to create this session.

[AuthenticationStrategy](/reference/typescript-api/auth/authentication-strategy#authenticationstrategy)


---

# AuthenticationMethod


## AuthenticationMethod​


[​](#authenticationmethod)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[authentication-method.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/authentication-method/authentication-method.entity.ts#L14)An AuthenticationMethod represents the means by which a User is authenticated. There are two kinds:
NativeAuthenticationMethod and ExternalAuthenticationMethod.

[User](/reference/typescript-api/entities/user#user)[NativeAuthenticationMethod](/reference/typescript-api/entities/authentication-method#nativeauthenticationmethod)[ExternalAuthenticationMethod](/reference/typescript-api/entities/authentication-method#externalauthenticationmethod)
```
class AuthenticationMethod extends VendureEntity {    @Index()    @ManyToOne(type => User, user => user.authenticationMethods)    user: User;}
```

- Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)
### user​


[​](#user)[User](/reference/typescript-api/entities/user#user)
## ExternalAuthenticationMethod​


[​](#externalauthenticationmethod)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[external-authentication-method.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/authentication-method/external-authentication-method.entity.ts#L14)This method is used when an external authentication service is used to authenticate Vendure Users.
Examples of external auth include social logins or corporate identity servers.

```
class ExternalAuthenticationMethod extends AuthenticationMethod {    constructor(input: DeepPartial<ExternalAuthenticationMethod>)    @Column()    strategy: string;    @Column()    externalIdentifier: string;    @Column('simple-json')    metadata: any;}
```

- Extends: AuthenticationMethod

[AuthenticationMethod](/reference/typescript-api/entities/authentication-method#authenticationmethod)
### constructor​


[​](#constructor)[ExternalAuthenticationMethod](/reference/typescript-api/entities/authentication-method#externalauthenticationmethod)
### strategy​


[​](#strategy)
### externalIdentifier​


[​](#externalidentifier)
### metadata​


[​](#metadata)
## NativeAuthenticationMethod​


[​](#nativeauthenticationmethod)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[native-authentication-method.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/authentication-method/native-authentication-method.entity.ts#L14)This is the default, built-in authentication method which uses a identifier (typically username or email address)
and password combination to authenticate a User.

```
class NativeAuthenticationMethod extends AuthenticationMethod {    constructor(input?: DeepPartial<NativeAuthenticationMethod>)    @Column()    identifier: string;    @Column({ select: false }) passwordHash: string;    @Column({ type: 'varchar', nullable: true })    verificationToken: string | null;    @Column({ type: 'varchar', nullable: true })    passwordResetToken: string | null;    @Column({ type: 'varchar', nullable: true })    identifierChangeToken: string | null;    @Column({ type: 'varchar', nullable: true })    pendingIdentifier: string | null;}
```

- Extends: AuthenticationMethod

[AuthenticationMethod](/reference/typescript-api/entities/authentication-method#authenticationmethod)
### constructor​


[​](#constructor-1)[NativeAuthenticationMethod](/reference/typescript-api/entities/authentication-method#nativeauthenticationmethod)
### identifier​


[​](#identifier)
### passwordHash​


[​](#passwordhash)
### verificationToken​


[​](#verificationtoken)
### passwordResetToken​


[​](#passwordresettoken)
### identifierChangeToken​


[​](#identifierchangetoken)A token issued when a User requests to change their identifier (typically
an email address)

### pendingIdentifier​


[​](#pendingidentifier)When a request has been made to change the User's identifier, the new identifier
will be stored here until it has been verified, after which it will
replace the current value of the identifier field.


---

# Channel


## Channel​


[​](#channel)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[channel.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/channel/channel.entity.ts#L37)A Channel represents a distinct sales channel and configures defaults for that
channel.

- Set a channel-specific currency, language, tax and shipping defaults
- Assign only specific Products to the Channel (with Channel-specific prices)
- Create Administrator roles limited to the Channel
- Assign only specific StockLocations, Assets, Facets, Collections, Promotions, ShippingMethods & PaymentMethods to the Channel
- Have Orders and Customers associated with specific Channels.

In Vendure, Channels have a number of different uses, such as:

- Multi-region stores, where there is a distinct website for each territory with its own available inventory, pricing, tax and shipping rules.
- Creating distinct rules and inventory for different sales channels such as Amazon.
- Specialized stores offering a subset of the main inventory.
- Implementing multi-vendor marketplace applications.

```
class Channel extends VendureEntity {    constructor(input?: DeepPartial<Channel>)    @Column({ unique: true })    code: string;    @Column({ unique: true })    token: string;    @Column({ default: '', nullable: true })    description: string;    @Index()    @ManyToOne(type => Seller, seller => seller.channels)    seller?: Seller;    @EntityId({ nullable: true })    sellerId?: ID;    @Column('varchar') defaultLanguageCode: LanguageCode;    @Column({ type: 'simple-array', nullable: true })    availableLanguageCodes: LanguageCode[];    @Index()    @ManyToOne(type => Zone, zone => zone.defaultTaxZoneChannels)    defaultTaxZone: Zone;    @Index()    @ManyToOne(type => Zone, zone => zone.defaultShippingZoneChannels)    defaultShippingZone: Zone;    @Column('varchar')    defaultCurrencyCode: CurrencyCode;    @Column({ type: 'simple-array', nullable: true })    availableCurrencyCodes: CurrencyCode[];    @Column({ default: true })    trackInventory: boolean;    @Column({ default: 0 })    outOfStockThreshold: number;    @Column(type => CustomChannelFields)    customFields: CustomChannelFields;    @Column() pricesIncludeTax: boolean;    @ManyToMany(type => Product, product => product.channels, { onDelete: 'CASCADE' })    products: Product[];    @ManyToMany(type => ProductVariant, productVariant => productVariant.channels, { onDelete: 'CASCADE' })    productVariants: ProductVariant[];    @ManyToMany(type => FacetValue, facetValue => facetValue.channels, { onDelete: 'CASCADE' })    facetValues: FacetValue[];    @ManyToMany(type => Facet, facet => facet.channels, { onDelete: 'CASCADE' })    facets: Facet[];    @ManyToMany(type => Collection, collection => collection.channels, { onDelete: 'CASCADE' })    collections: Collection[];    @ManyToMany(type => Promotion, promotion => promotion.channels, { onDelete: 'CASCADE' })    promotions: Promotion[];    @ManyToMany(type => PaymentMethod, paymentMethod => paymentMethod.channels, { onDelete: 'CASCADE' })    paymentMethods: PaymentMethod[];    @ManyToMany(type => ShippingMethod, shippingMethod => shippingMethod.channels, { onDelete: 'CASCADE' })    shippingMethods: ShippingMethod[];    @ManyToMany(type => Customer, customer => customer.channels, { onDelete: 'CASCADE' })    customers: Customer[];    @ManyToMany(type => Role, role => role.channels, { onDelete: 'CASCADE' })    roles: Role[];    @ManyToMany(type => StockLocation, stockLocation => stockLocation.channels, { onDelete: 'CASCADE' })    stockLocations: StockLocation[];}
```

- Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)
### constructor​


[​](#constructor)[Channel](/reference/typescript-api/entities/channel#channel)
### code​


[​](#code)The name of the Channel. For example "US Webstore" or "German Webstore".

### token​


[​](#token)A unique token (string) used to identify the Channel in the vendure-token header of the
GraphQL API requests.

### description​


[​](#description)
### seller​


[​](#seller)[Seller](/reference/typescript-api/entities/seller#seller)
### sellerId​


[​](#sellerid)[ID](/reference/typescript-api/common/id#id)
### defaultLanguageCode​


[​](#defaultlanguagecode)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)
### availableLanguageCodes​


[​](#availablelanguagecodes)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)
### defaultTaxZone​


[​](#defaulttaxzone)[Zone](/reference/typescript-api/entities/zone#zone)
### defaultShippingZone​


[​](#defaultshippingzone)[Zone](/reference/typescript-api/entities/zone#zone)
### defaultCurrencyCode​


[​](#defaultcurrencycode)[CurrencyCode](/reference/typescript-api/common/currency-code#currencycode)
### availableCurrencyCodes​


[​](#availablecurrencycodes)[CurrencyCode](/reference/typescript-api/common/currency-code#currencycode)
### trackInventory​


[​](#trackinventory)Specifies the default value for inventory tracking for ProductVariants.
Can be overridden per ProductVariant, but this value determines the default
if not otherwise specified.

### outOfStockThreshold​


[​](#outofstockthreshold)Specifies the value of stockOnHand at which a given ProductVariant is considered
out of stock.

### customFields​


[​](#customfields)
### pricesIncludeTax​


[​](#pricesincludetax)
### products​


[​](#products)[Product](/reference/typescript-api/entities/product#product)
### productVariants​


[​](#productvariants)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### facetValues​


[​](#facetvalues)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
### facets​


[​](#facets)[Facet](/reference/typescript-api/entities/facet#facet)
### collections​


[​](#collections)[Collection](/reference/typescript-api/entities/collection#collection)
### promotions​


[​](#promotions)[Promotion](/reference/typescript-api/entities/promotion#promotion)
### paymentMethods​


[​](#paymentmethods)[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)
### shippingMethods​


[​](#shippingmethods)[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)
### customers​


[​](#customers)[Customer](/reference/typescript-api/entities/customer#customer)
### roles​


[​](#roles)[Role](/reference/typescript-api/entities/role#role)
### stockLocations​


[​](#stocklocations)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)


---

# Collection


## Collection​


[​](#collection)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[collection.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/collection/collection.entity.ts#L35)A Collection is a grouping of Products based on various configurable criteria.

[Product](/reference/typescript-api/entities/product#product)
```
class Collection extends VendureEntity implements Translatable, HasCustomFields, ChannelAware, Orderable {    constructor(input?: DeepPartial<Collection>)    @Column({ default: false })    isRoot: boolean;    @Column()    position: number;    @Column({ default: false })    isPrivate: boolean;    name: LocaleString;    description: LocaleString;    slug: LocaleString;    @OneToMany(type => CollectionTranslation, translation => translation.base, { eager: true })    translations: Array<Translation<Collection>>;    @Index()    @ManyToOne(type => Asset, asset => asset.featuredInCollections, { onDelete: 'SET NULL' })    featuredAsset: Asset;    @OneToMany(type => CollectionAsset, collectionAsset => collectionAsset.collection)    assets: CollectionAsset[];    @Column('simple-json') filters: ConfigurableOperation[];    @Column({ default: true }) inheritFilters: boolean;    @ManyToMany(type => ProductVariant, productVariant => productVariant.collections)    @JoinTable()    productVariants: ProductVariant[];    @Column(type => CustomCollectionFields)    customFields: CustomCollectionFields;    @TreeChildren()    children: Collection[];    @TreeParent()    parent: Collection;    @EntityId({ nullable: true })    parentId: ID;    @ManyToMany(type => Channel, channel => channel.collections)    @JoinTable()    channels: Channel[];}
```

- Extends: VendureEntity
- Implements: Translatable, HasCustomFields, ChannelAware, Orderable

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: Translatable, HasCustomFields, ChannelAware, Orderable

[Translatable](/reference/typescript-api/entities/interfaces#translatable)[ChannelAware](/reference/typescript-api/entities/interfaces#channelaware)[Orderable](/reference/typescript-api/entities/interfaces#orderable)
### constructor​


[​](#constructor)[Collection](/reference/typescript-api/entities/collection#collection)
### isRoot​


[​](#isroot)
### position​


[​](#position)
### isPrivate​


[​](#isprivate)
### name​


[​](#name)
### description​


[​](#description)
### slug​


[​](#slug)
### translations​


[​](#translations)[Collection](/reference/typescript-api/entities/collection#collection)
### featuredAsset​


[​](#featuredasset)[Asset](/reference/typescript-api/entities/asset#asset)
### assets​


[​](#assets)
### filters​


[​](#filters)
### inheritFilters​


[​](#inheritfilters)
### productVariants​


[​](#productvariants)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### customFields​


[​](#customfields)
### children​


[​](#children)[Collection](/reference/typescript-api/entities/collection#collection)
### parent​


[​](#parent)[Collection](/reference/typescript-api/entities/collection#collection)
### parentId​


[​](#parentid)[ID](/reference/typescript-api/common/id#id)
### channels​


[​](#channels)[Channel](/reference/typescript-api/entities/channel#channel)


---

# Country


## Country​


[​](#country)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[country.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/region/country.entity.ts#L14)A country to which is available when creating / updating an Address. Countries are
grouped together into Zones which are in turn used to determine applicable shipping
and taxes for an Order.

[Address](/reference/typescript-api/entities/address#address)[Zone](/reference/typescript-api/entities/zone#zone)[Order](/reference/typescript-api/entities/order#order)
```
class Country extends Region {    constructor(input?: DeepPartial<Country>)    readonly type: RegionType = 'country';}
```

- Extends: Region

[Region](/reference/typescript-api/entities/region#region)
### constructor​


[​](#constructor)[Country](/reference/typescript-api/entities/country#country)
### type​


[​](#type)


---

# CustomerGroup


## CustomerGroup​


[​](#customergroup)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[customer-group.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/customer-group/customer-group.entity.ts#L17)A grouping of Customers which enables features such as group-based promotions
or tax rules.

[Customer](/reference/typescript-api/entities/customer#customer)
```
class CustomerGroup extends VendureEntity implements HasCustomFields {    constructor(input?: DeepPartial<CustomerGroup>)    @Column() name: string;    @ManyToMany(type => Customer, customer => customer.groups)    customers: Customer[];    @Column(type => CustomCustomerGroupFields)    customFields: CustomCustomerGroupFields;    @OneToMany(type => TaxRate, taxRate => taxRate.zone)    taxRates: TaxRate[];}
```

- Extends: VendureEntity
- Implements: HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: HasCustomFields

### constructor​


[​](#constructor)[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)
### name​


[​](#name)
### customers​


[​](#customers)[Customer](/reference/typescript-api/entities/customer#customer)
### customFields​


[​](#customfields)
### taxRates​


[​](#taxrates)[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)


---

# CustomerHistoryEntry


## CustomerHistoryEntry​


[​](#customerhistoryentry)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[customer-history-entry.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/history-entry/customer-history-entry.entity.ts#L14)Represents an event in the history of a particular Customer.

[Customer](/reference/typescript-api/entities/customer#customer)
```
class CustomerHistoryEntry extends HistoryEntry {    constructor(input: DeepPartial<CustomerHistoryEntry>)    @Index()    @ManyToOne(type => Customer, { onDelete: 'CASCADE' })    customer: Customer;}
```

- Extends: HistoryEntry

[HistoryEntry](/reference/typescript-api/entities/history-entry#historyentry)
### constructor​


[​](#constructor)[CustomerHistoryEntry](/reference/typescript-api/entities/customer-history-entry#customerhistoryentry)
### customer​


[​](#customer)[Customer](/reference/typescript-api/entities/customer#customer)


---

# Customer


## Customer​


[​](#customer)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[customer.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/customer/customer.entity.ts#L22)This entity represents a customer of the store, typically an individual person. A Customer can be
a guest, in which case it has no associated User. Customers with registered account will
have an associated User entity.

[User](/reference/typescript-api/entities/user#user)
```
class Customer extends VendureEntity implements ChannelAware, HasCustomFields, SoftDeletable {    constructor(input?: DeepPartial<Customer>)    @Column({ type: Date, nullable: true })    deletedAt: Date | null;    @Column({ nullable: true })    title: string;    @Column() firstName: string;    @Column() lastName: string;    @Column({ nullable: true })    phoneNumber: string;    @Column()    emailAddress: string;    @ManyToMany(type => CustomerGroup, group => group.customers)    @JoinTable()    groups: CustomerGroup[];    @OneToMany(type => Address, address => address.customer)    addresses: Address[];    @OneToMany(type => Order, order => order.customer)    orders: Order[];    @OneToOne(type => User, { eager: true })    @JoinColumn()    user?: User;    @Column(type => CustomCustomerFields)    customFields: CustomCustomerFields;    @ManyToMany(type => Channel, channel => channel.customers)    @JoinTable()    channels: Channel[];}
```

- Extends: VendureEntity
- Implements: ChannelAware, HasCustomFields, SoftDeletable

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: ChannelAware, HasCustomFields, SoftDeletable

[ChannelAware](/reference/typescript-api/entities/interfaces#channelaware)[SoftDeletable](/reference/typescript-api/entities/interfaces#softdeletable)
### constructor​


[​](#constructor)[Customer](/reference/typescript-api/entities/customer#customer)
### deletedAt​


[​](#deletedat)
### title​


[​](#title)
### firstName​


[​](#firstname)
### lastName​


[​](#lastname)
### phoneNumber​


[​](#phonenumber)
### emailAddress​


[​](#emailaddress)
### groups​


[​](#groups)[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)
### addresses​


[​](#addresses)[Address](/reference/typescript-api/entities/address#address)
### orders​


[​](#orders)[Order](/reference/typescript-api/entities/order#order)
### user​


[​](#user)[User](/reference/typescript-api/entities/user#user)
### customFields​


[​](#customfields)
### channels​


[​](#channels)[Channel](/reference/typescript-api/entities/channel#channel)


---

# FacetValue


## FacetValue​


[​](#facetvalue)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[facet-value.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/facet-value/facet-value.entity.ts#L23)A particular value of a Facet.

[Facet](/reference/typescript-api/entities/facet#facet)
```
class FacetValue extends VendureEntity implements Translatable, HasCustomFields, ChannelAware {    constructor(input?: DeepPartial<FacetValue>)    name: LocaleString;    @Column() code: string;    @OneToMany(type => FacetValueTranslation, translation => translation.base, { eager: true })    translations: Array<Translation<FacetValue>>;    @Index()    @ManyToOne(type => Facet, group => group.values, { onDelete: 'CASCADE' })    facet: Facet;    @EntityId()    facetId: ID;    @Column(type => CustomFacetValueFields)    customFields: CustomFacetValueFields;    @ManyToMany(type => Channel, channel => channel.facetValues)    @JoinTable()    channels: Channel[];    @ManyToMany(() => Product, product => product.facetValues, { onDelete: 'CASCADE' })    products: Product[];    @ManyToMany(type => ProductVariant, productVariant => productVariant.facetValues)    productVariants: ProductVariant[];}
```

- Extends: VendureEntity
- Implements: Translatable, HasCustomFields, ChannelAware

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: Translatable, HasCustomFields, ChannelAware

[Translatable](/reference/typescript-api/entities/interfaces#translatable)[ChannelAware](/reference/typescript-api/entities/interfaces#channelaware)
### constructor​


[​](#constructor)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
### name​


[​](#name)
### code​


[​](#code)
### translations​


[​](#translations)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
### facet​


[​](#facet)[Facet](/reference/typescript-api/entities/facet#facet)
### facetId​


[​](#facetid)[ID](/reference/typescript-api/common/id#id)
### customFields​


[​](#customfields)
### channels​


[​](#channels)[Channel](/reference/typescript-api/entities/channel#channel)
### products​


[​](#products)[Product](/reference/typescript-api/entities/product#product)
### productVariants​


[​](#productvariants)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)


---

# Facet


## Facet​


[​](#facet)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[facet.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/facet/facet.entity.ts#L25)A Facet is a class of properties which can be applied to a Product or ProductVariant.
They are used to enable faceted search whereby products
can be filtered along a number of dimensions (facets).

[Product](/reference/typescript-api/entities/product#product)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[faceted search](https://en.wikipedia.org/wiki/Faceted_search)For example, there could be a Facet named "Brand" which has a number of FacetValues representing
the various brands of product, e.g. "Apple", "Samsung", "Dell", "HP" etc.

[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
```
class Facet extends VendureEntity implements Translatable, HasCustomFields, ChannelAware {    constructor(input?: DeepPartial<Facet>)    name: LocaleString;    @Column({ default: false })    isPrivate: boolean;    @Column({ unique: true })    code: string;    @OneToMany(type => FacetTranslation, translation => translation.base, { eager: true })    translations: Array<Translation<Facet>>;    @OneToMany(type => FacetValue, value => value.facet)    values: FacetValue[];    @Column(type => CustomFacetFields)    customFields: CustomFacetFields;    @ManyToMany(type => Channel, channel => channel.facets)    @JoinTable()    channels: Channel[];}
```

- Extends: VendureEntity
- Implements: Translatable, HasCustomFields, ChannelAware

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: Translatable, HasCustomFields, ChannelAware

[Translatable](/reference/typescript-api/entities/interfaces#translatable)[ChannelAware](/reference/typescript-api/entities/interfaces#channelaware)
### constructor​


[​](#constructor)[Facet](/reference/typescript-api/entities/facet#facet)
### name​


[​](#name)
### isPrivate​


[​](#isprivate)
### code​


[​](#code)
### translations​


[​](#translations)[Facet](/reference/typescript-api/entities/facet#facet)
### values​


[​](#values)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
### customFields​


[​](#customfields)
### channels​


[​](#channels)[Channel](/reference/typescript-api/entities/channel#channel)


---

# Fulfillment


## Fulfillment​


[​](#fulfillment)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[fulfillment.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/fulfillment/fulfillment.entity.ts#L18)This entity represents a fulfillment of an Order or part of it, i.e. which OrderLines have been
delivered to the Customer after successful payment.

[OrderLine](/reference/typescript-api/entities/order-line#orderline)
```
class Fulfillment extends VendureEntity implements HasCustomFields {    constructor(input?: DeepPartial<Fulfillment>)    @Column('varchar') state: FulfillmentState;    @Column({ default: '' })    trackingCode: string;    @Column()    method: string;    @Column()    handlerCode: string;    @OneToMany(type => FulfillmentLine, fulfillmentLine => fulfillmentLine.fulfillment)    lines: FulfillmentLine[];    @ManyToMany(type => Order, order => order.fulfillments)    orders: Order[];    @Column(type => CustomFulfillmentFields)    customFields: CustomFulfillmentFields;}
```

- Extends: VendureEntity
- Implements: HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: HasCustomFields

### constructor​


[​](#constructor)[Fulfillment](/reference/typescript-api/entities/fulfillment#fulfillment)
### state​


[​](#state)[FulfillmentState](/reference/typescript-api/fulfillment/fulfillment-state#fulfillmentstate)
### trackingCode​


[​](#trackingcode)
### method​


[​](#method)
### handlerCode​


[​](#handlercode)
### lines​


[​](#lines)[FulfillmentLine](/reference/typescript-api/entities/order-line-reference#fulfillmentline)
### orders​


[​](#orders)[Order](/reference/typescript-api/entities/order#order)
### customFields​


[​](#customfields)


---

# GlobalSettings


## GlobalSettings​


[​](#globalsettings)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[global-settings.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/global-settings/global-settings.entity.ts#L14)Stores global settings for the whole application

```
class GlobalSettings extends VendureEntity implements HasCustomFields {    constructor(input?: DeepPartial<GlobalSettings>)    @Column('simple-array')    availableLanguages: LanguageCode[];    @Column({ default: true })    trackInventory: boolean;    @Column({ default: 0 })    outOfStockThreshold: number;    @Column(type => CustomGlobalSettingsFields)    customFields: CustomGlobalSettingsFields;}
```

- Extends: VendureEntity
- Implements: HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: HasCustomFields

### constructor​


[​](#constructor)[GlobalSettings](/reference/typescript-api/entities/global-settings#globalsettings)
### availableLanguages​


[​](#availablelanguages)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)
### trackInventory​


[​](#trackinventory)Specifies the default value for inventory tracking for ProductVariants.
Can be overridden per ProductVariant, but this value determines the default
if not otherwise specified.

### outOfStockThreshold​


[​](#outofstockthreshold)Specifies the value of stockOnHand at which a given ProductVariant is considered
out of stock.

### customFields​


[​](#customfields)


---

# HistoryEntry


## HistoryEntry​


[​](#historyentry)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[history-entry.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/history-entry/history-entry.entity.ts#L16)An abstract entity representing an entry in the history of an Order (OrderHistoryEntry)
or a Customer (CustomerHistoryEntry).

[OrderHistoryEntry](/reference/typescript-api/entities/order-history-entry#orderhistoryentry)[CustomerHistoryEntry](/reference/typescript-api/entities/customer-history-entry#customerhistoryentry)
```
class HistoryEntry extends VendureEntity implements HasCustomFields {    @Index()    @ManyToOne(type => Administrator)    administrator?: Administrator;    @Column({ nullable: false, type: 'varchar' })    readonly type: HistoryEntryType;    @Column()    isPublic: boolean;    @Column('simple-json')    data: any;    @Column(type => CustomHistoryEntryFields)    customFields: CustomHistoryEntryFields;}
```

- Extends: VendureEntity
- Implements: HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: HasCustomFields

### administrator​


[​](#administrator)[Administrator](/reference/typescript-api/entities/administrator#administrator)
### type​


[​](#type)
### isPublic​


[​](#ispublic)
### data​


[​](#data)
### customFields​


[​](#customfields)


---

# Interfaces


## ChannelAware​


[​](#channelaware)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[common-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/types/common-types.ts#L17)Entities which can be assigned to Channels should implement this interface.

```
interface ChannelAware {    channels: Channel[];}
```

### channels​


[​](#channels)[Channel](/reference/typescript-api/entities/channel#channel)
## SoftDeletable​


[​](#softdeletable)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[common-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/types/common-types.ts#L28)Entities which can be soft deleted should implement this interface.

```
interface SoftDeletable {    deletedAt: Date | null;}
```

### deletedAt​


[​](#deletedat)
## Orderable​


[​](#orderable)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[common-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/types/common-types.ts#L39)Entities which can be ordered relative to their siblings in a list.

```
interface Orderable {    position: number;}
```

### position​


[​](#position)
## Taggable​


[​](#taggable)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[common-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/types/common-types.ts#L50)Entities which can have Tags applied to them.

```
interface Taggable {    tags: Tag[];}
```

### tags​


[​](#tags)[Tag](/reference/typescript-api/entities/tag#tag)
## Translatable​


[​](#translatable)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[locale-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/types/locale-types.ts#L29)Entities which have localizable string properties should implement this type.

```
interface Translatable {    translations: Array<Translation<VendureEntity>>;}
```

### translations​


[​](#translations)[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)


---

# OrderHistoryEntry


## OrderHistoryEntry​


[​](#orderhistoryentry)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-history-entry.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/history-entry/order-history-entry.entity.ts#L14)Represents an event in the history of a particular Order.

[Order](/reference/typescript-api/entities/order#order)
```
class OrderHistoryEntry extends HistoryEntry {    constructor(input: DeepPartial<OrderHistoryEntry>)    @Index()    @ManyToOne(type => Order, { onDelete: 'CASCADE' })    order: Order;}
```

- Extends: HistoryEntry

[HistoryEntry](/reference/typescript-api/entities/history-entry#historyentry)
### constructor​


[​](#constructor)[OrderHistoryEntry](/reference/typescript-api/entities/order-history-entry#orderhistoryentry)
### order​


[​](#order)[Order](/reference/typescript-api/entities/order#order)


---

# OrderLineReference


## FulfillmentLine​


[​](#fulfillmentline)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[fulfillment-line.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/order-line-reference/fulfillment-line.entity.ts#L16)This entity represents a line from an Order which has been fulfilled by a Fulfillment.

[Order](/reference/typescript-api/entities/order#order)[Fulfillment](/reference/typescript-api/entities/fulfillment#fulfillment)
```
class FulfillmentLine extends OrderLineReference {    constructor(input?: DeepPartial<FulfillmentLine>)    @Index()    @ManyToOne(type => Fulfillment, fulfillment => fulfillment.lines)    fulfillment: Fulfillment;    @EntityId()    fulfillmentId: ID;}
```

- Extends: OrderLineReference

[OrderLineReference](/reference/typescript-api/entities/order-line-reference#orderlinereference)
### constructor​


[​](#constructor)[FulfillmentLine](/reference/typescript-api/entities/order-line-reference#fulfillmentline)
### fulfillment​


[​](#fulfillment)[Fulfillment](/reference/typescript-api/entities/fulfillment#fulfillment)
### fulfillmentId​


[​](#fulfillmentid)[ID](/reference/typescript-api/common/id#id)
## OrderLineReference​


[​](#orderlinereference)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-line-reference.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/order-line-reference/order-line-reference.entity.ts#L15)This is an abstract base class for entities which reference an OrderLine.

[OrderLine](/reference/typescript-api/entities/order-line#orderline)
```
class OrderLineReference extends VendureEntity {    @Column()    quantity: number;    @Index()    @ManyToOne(type => OrderLine, line => line.linesReferences, { onDelete: 'CASCADE' })    orderLine: OrderLine;    @EntityId()    orderLineId: ID;}
```

- Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)
### quantity​


[​](#quantity)
### orderLine​


[​](#orderline)[OrderLine](/reference/typescript-api/entities/order-line#orderline)
### orderLineId​


[​](#orderlineid)[ID](/reference/typescript-api/common/id#id)
## OrderModificationLine​


[​](#ordermodificationline)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-modification-line.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/order-line-reference/order-modification-line.entity.ts#L16)This entity represents a line from an Order which has been modified by an OrderModification.

[Order](/reference/typescript-api/entities/order#order)[OrderModification](/reference/typescript-api/entities/order-modification#ordermodification)
```
class OrderModificationLine extends OrderLineReference {    constructor(input?: DeepPartial<OrderModificationLine>)    @Index()    @ManyToOne(type => OrderModification, modification => modification.lines)    modification: OrderModification;    @EntityId()    modificationId: ID;}
```

- Extends: OrderLineReference

[OrderLineReference](/reference/typescript-api/entities/order-line-reference#orderlinereference)
### constructor​


[​](#constructor-1)[OrderModificationLine](/reference/typescript-api/entities/order-line-reference#ordermodificationline)
### modification​


[​](#modification)[OrderModification](/reference/typescript-api/entities/order-modification#ordermodification)
### modificationId​


[​](#modificationid)[ID](/reference/typescript-api/common/id#id)
## RefundLine​


[​](#refundline)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[refund-line.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/order-line-reference/refund-line.entity.ts#L16)This entity represents a line from an Order which has been refunded by a Refund.

[Order](/reference/typescript-api/entities/order#order)[Refund](/reference/typescript-api/entities/refund#refund)
```
class RefundLine extends OrderLineReference {    constructor(input?: DeepPartial<RefundLine>)    @Index()    @ManyToOne(type => Refund, refund => refund.lines)    refund: Refund;    @EntityId()    refundId: ID;}
```

- Extends: OrderLineReference

[OrderLineReference](/reference/typescript-api/entities/order-line-reference#orderlinereference)
### constructor​


[​](#constructor-2)[RefundLine](/reference/typescript-api/entities/order-line-reference#refundline)
### refund​


[​](#refund)[Refund](/reference/typescript-api/entities/refund#refund)
### refundId​


[​](#refundid)[ID](/reference/typescript-api/common/id#id)

---

# OrderLine


## OrderLine​


[​](#orderline)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-line.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/order-line/order-line.entity.ts#L32)A single line on an Order which contains information about the ProductVariant and
quantity ordered, as well as the price and tax information.

[Order](/reference/typescript-api/entities/order#order)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
```
class OrderLine extends VendureEntity implements HasCustomFields {    constructor(input?: DeepPartial<OrderLine>)    @Index()    @ManyToOne(type => Channel, { nullable: true, onDelete: 'SET NULL' })    sellerChannel?: Channel;    @EntityId({ nullable: true })    sellerChannelId?: ID;    @Index()    @ManyToOne(type => ShippingLine, shippingLine => shippingLine.orderLines, {        nullable: true,        onDelete: 'SET NULL',    })    shippingLine?: ShippingLine;    @EntityId({ nullable: true })    shippingLineId?: ID;    @Index()    @ManyToOne(type => ProductVariant, productVariant => productVariant.lines, { onDelete: 'CASCADE' })    productVariant: ProductVariant;    @EntityId()    productVariantId: ID;    @Index()    @ManyToOne(type => TaxCategory)    taxCategory: TaxCategory;    @EntityId({ nullable: true })    taxCategoryId: ID;    @Index()    @ManyToOne(type => Asset, asset => asset.featuredInVariants, { onDelete: 'SET NULL' })    featuredAsset: Asset;    @Index()    @ManyToOne(type => Order, order => order.lines, { onDelete: 'CASCADE' })    order: Order;    @OneToMany(type => OrderLineReference, lineRef => lineRef.orderLine)    linesReferences: OrderLineReference[];    @OneToMany(type => Sale, sale => sale.orderLine)    sales: Sale[];    @Column()    quantity: number;    @Column({ default: 0 })    orderPlacedQuantity: number;    @Money({ nullable: true })    initialListPrice: number;    @Money()    listPrice: number;    @Column()    listPriceIncludesTax: boolean;    @Column('simple-json')    adjustments: Adjustment[];    @Column('simple-json')    taxLines: TaxLine[];    @OneToMany(type => Cancellation, cancellation => cancellation.orderLine)    cancellations: Cancellation[];    @OneToMany(type => Allocation, allocation => allocation.orderLine)    allocations: Allocation[];    @Column(type => CustomOrderLineFields)    customFields: CustomOrderLineFields;    unitPrice: number    unitPriceWithTax: number    unitPriceChangeSinceAdded: number    unitPriceWithTaxChangeSinceAdded: number    discountedUnitPrice: number    discountedUnitPriceWithTax: number    proratedUnitPrice: number    proratedUnitPriceWithTax: number    unitTax: number    proratedUnitTax: number    taxRate: number    linePrice: number    linePriceWithTax: number    discountedLinePrice: number    discountedLinePriceWithTax: number    discounts: Discount[]    lineTax: number    proratedLinePrice: number    proratedLinePriceWithTax: number    proratedLineTax: number    addAdjustment(adjustment: Adjustment) => ;    clearAdjustments(type?: AdjustmentType) => ;}
```

- Extends: VendureEntity
- Implements: HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: HasCustomFields

### constructor​


[​](#constructor)[OrderLine](/reference/typescript-api/entities/order-line#orderline)
### sellerChannel​


[​](#sellerchannel)[Channel](/reference/typescript-api/entities/channel#channel)The Channel of the Seller for a multivendor setup.

[Channel](/reference/typescript-api/entities/channel#channel)[Seller](/reference/typescript-api/entities/seller#seller)
### sellerChannelId​


[​](#sellerchannelid)[ID](/reference/typescript-api/common/id#id)
### shippingLine​


[​](#shippingline)[ShippingLine](/reference/typescript-api/entities/shipping-line#shippingline)The ShippingLine to which this line has been assigned.
This is determined by the configured ShippingLineAssignmentStrategy.

[ShippingLine](/reference/typescript-api/entities/shipping-line#shippingline)[ShippingLineAssignmentStrategy](/reference/typescript-api/shipping/shipping-line-assignment-strategy#shippinglineassignmentstrategy)
### shippingLineId​


[​](#shippinglineid)[ID](/reference/typescript-api/common/id#id)
### productVariant​


[​](#productvariant)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)The ProductVariant which is being ordered.

[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### productVariantId​


[​](#productvariantid)[ID](/reference/typescript-api/common/id#id)
### taxCategory​


[​](#taxcategory)[TaxCategory](/reference/typescript-api/entities/tax-category#taxcategory)
### taxCategoryId​


[​](#taxcategoryid)[ID](/reference/typescript-api/common/id#id)
### featuredAsset​


[​](#featuredasset)[Asset](/reference/typescript-api/entities/asset#asset)
### order​


[​](#order)[Order](/reference/typescript-api/entities/order#order)
### linesReferences​


[​](#linesreferences)[OrderLineReference](/reference/typescript-api/entities/order-line-reference#orderlinereference)
### sales​


[​](#sales)[Sale](/reference/typescript-api/entities/stock-movement#sale)
### quantity​


[​](#quantity)
### orderPlacedQuantity​


[​](#orderplacedquantity)The quantity of this OrderLine at the time the order was placed (as per the OrderPlacedStrategy).

[OrderPlacedStrategy](/reference/typescript-api/orders/order-placed-strategy#orderplacedstrategy)
### initialListPrice​


[​](#initiallistprice)The price as calculated when the OrderLine was first added to the Order. Usually will be identical to the
listPrice, except when the ProductVariant price has changed in the meantime and a re-calculation of
the Order has been performed.

### listPrice​


[​](#listprice)This is the price as listed by the ProductVariant (and possibly modified by the OrderItemPriceCalculationStrategy),
which, depending on the current Channel, may or may not include tax.

[OrderItemPriceCalculationStrategy](/reference/typescript-api/orders/order-item-price-calculation-strategy#orderitempricecalculationstrategy)
### listPriceIncludesTax​


[​](#listpriceincludestax)Whether the listPrice includes tax, which depends on the settings of the current Channel.

### adjustments​


[​](#adjustments)
### taxLines​


[​](#taxlines)
### cancellations​


[​](#cancellations)[Cancellation](/reference/typescript-api/entities/stock-movement#cancellation)
### allocations​


[​](#allocations)[Allocation](/reference/typescript-api/entities/stock-movement#allocation)
### customFields​


[​](#customfields)
### unitPrice​


[​](#unitprice)The price of a single unit, excluding tax and discounts.

### unitPriceWithTax​


[​](#unitpricewithtax)The price of a single unit, including tax but excluding discounts.

### unitPriceChangeSinceAdded​


[​](#unitpricechangesinceadded)Non-zero if the unitPrice has changed since it was initially added to Order.

### unitPriceWithTaxChangeSinceAdded​


[​](#unitpricewithtaxchangesinceadded)Non-zero if the unitPriceWithTax has changed since it was initially added to Order.

### discountedUnitPrice​


[​](#discountedunitprice)The price of a single unit including discounts, excluding tax.

If Order-level discounts have been applied, this will not be the
actual taxable unit price (see proratedUnitPrice), but is generally the
correct price to display to customers to avoid confusion
about the internal handling of distributed Order-level discounts.

### discountedUnitPriceWithTax​


[​](#discountedunitpricewithtax)The price of a single unit including discounts and tax

### proratedUnitPrice​


[​](#proratedunitprice)The actual unit price, taking into account both item discounts and prorated (proportionally-distributed)
Order-level discounts. This value is the true economic value of a single unit in this OrderLine, and is used in tax
and refund calculations.

### proratedUnitPriceWithTax​


[​](#proratedunitpricewithtax)The proratedUnitPrice including tax.

### unitTax​


[​](#unittax)
### proratedUnitTax​


[​](#proratedunittax)
### taxRate​


[​](#taxrate)
### linePrice​


[​](#lineprice)The total price of the line excluding tax and discounts.

### linePriceWithTax​


[​](#linepricewithtax)The total price of the line including tax but excluding discounts.

### discountedLinePrice​


[​](#discountedlineprice)The price of the line including discounts, excluding tax.

### discountedLinePriceWithTax​


[​](#discountedlinepricewithtax)The price of the line including discounts and tax.

### discounts​


[​](#discounts)
### lineTax​


[​](#linetax)The total tax on this line.

### proratedLinePrice​


[​](#proratedlineprice)The actual line price, taking into account both item discounts and prorated (proportionally-distributed)
Order-level discounts. This value is the true economic value of the OrderLine, and is used in tax
and refund calculations.

### proratedLinePriceWithTax​


[​](#proratedlinepricewithtax)The proratedLinePrice including tax.

### proratedLineTax​


[​](#proratedlinetax)
### addAdjustment​


[​](#addadjustment)
### clearAdjustments​


[​](#clearadjustments)


---

# OrderModification


## OrderModification​


[​](#ordermodification)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-modification.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/order-modification/order-modification.entity.ts#L21)An entity which represents a modification to an order which has been placed, and
then modified afterwards by an administrator.

```
class OrderModification extends VendureEntity {    constructor(input?: DeepPartial<OrderModification>)    @Column()    note: string;    @Index()    @ManyToOne(type => Order, order => order.modifications, { onDelete: 'CASCADE' })    order: Order;    @OneToMany(type => OrderModificationLine, line => line.modification)    lines: OrderModificationLine[];    @OneToMany(type => Surcharge, surcharge => surcharge.orderModification)    surcharges: Surcharge[];    @Money()    priceChange: number;    @ManyToOne(type => Payment)    @JoinColumn()    payment?: Payment;    @ManyToOne(type => Refund)    @JoinColumn()    refund?: Refund;    @Column('simple-json', { nullable: true }) shippingAddressChange: OrderAddress;    @Column('simple-json', { nullable: true }) billingAddressChange: OrderAddress;    isSettled: boolean}
```

- Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)
### constructor​


[​](#constructor)[OrderModification](/reference/typescript-api/entities/order-modification#ordermodification)
### note​


[​](#note)
### order​


[​](#order)[Order](/reference/typescript-api/entities/order#order)
### lines​


[​](#lines)[OrderModificationLine](/reference/typescript-api/entities/order-line-reference#ordermodificationline)
### surcharges​


[​](#surcharges)[Surcharge](/reference/typescript-api/entities/surcharge#surcharge)
### priceChange​


[​](#pricechange)
### payment​


[​](#payment)[Payment](/reference/typescript-api/entities/payment#payment)
### refund​


[​](#refund)[Refund](/reference/typescript-api/entities/refund#refund)
### shippingAddressChange​


[​](#shippingaddresschange)
### billingAddressChange​


[​](#billingaddresschange)
### isSettled​


[​](#issettled)

---

# Order


## Order​


[​](#order)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/order/order.entity.ts#L43)An Order is created whenever a Customer adds an item to the cart. It contains all the
information required to fulfill an order: which ProductVariants in what quantities;
the shipping address and price; any applicable promotions; payments etc.

[Customer](/reference/typescript-api/entities/customer#customer)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)An Order exists in a well-defined state according to the OrderState type. A state machine
is used to govern the transition from one state to another.

[OrderState](/reference/typescript-api/orders/order-process#orderstate)
```
class Order extends VendureEntity implements ChannelAware, HasCustomFields {    constructor(input?: DeepPartial<Order>)    @Column('varchar', { default: OrderType.Regular })    type: OrderType;    @OneToMany(type => Order, sellerOrder => sellerOrder.aggregateOrder)    sellerOrders: Order[];    @Index()    @ManyToOne(type => Order, aggregateOrder => aggregateOrder.sellerOrders)    aggregateOrder?: Order;    @EntityId({ nullable: true })    aggregateOrderId?: ID;    @Column()    @Index({ unique: true })    code: string;    @Column('varchar') state: OrderState;    @Column({ default: true })    active: boolean;    @Column({ nullable: true })    @Index()    orderPlacedAt?: Date;    @Index()    @ManyToOne(type => Customer, customer => customer.orders)    customer?: Customer;    @EntityId({ nullable: true })    customerId?: ID;    @OneToMany(type => OrderLine, line => line.order)    lines: OrderLine[];    @OneToMany(type => Surcharge, surcharge => surcharge.order)    surcharges: Surcharge[];    @Column('simple-array')    couponCodes: string[];    @ManyToMany(type => Promotion, promotion => promotion.orders)    @JoinTable()    promotions: Promotion[];    @Column('simple-json') shippingAddress: OrderAddress;    @Column('simple-json') billingAddress: OrderAddress;    @OneToMany(type => Payment, payment => payment.order)    payments: Payment[];    @ManyToMany(type => Fulfillment, fulfillment => fulfillment.orders)    @JoinTable()    fulfillments: Fulfillment[];    @Column('varchar')    currencyCode: CurrencyCode;    @Column(type => CustomOrderFields)    customFields: CustomOrderFields;    @EntityId({ nullable: true })    taxZoneId?: ID;    @ManyToMany(type => Channel)    @JoinTable()    channels: Channel[];    @OneToMany(type => OrderModification, modification => modification.order)    modifications: OrderModification[];    @Money()    subTotal: number;    @Money()    subTotalWithTax: number;    @OneToMany(type => ShippingLine, shippingLine => shippingLine.order)    shippingLines: ShippingLine[];    @Money({ default: 0 })    shipping: number;    @Money({ default: 0 })    shippingWithTax: number;    discounts: Discount[]    total: number    totalWithTax: number    totalQuantity: number    taxSummary: OrderTaxSummary[]}
```

- Extends: VendureEntity
- Implements: ChannelAware, HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: ChannelAware, HasCustomFields

[ChannelAware](/reference/typescript-api/entities/interfaces#channelaware)
### constructor​


[​](#constructor)[Order](/reference/typescript-api/entities/order#order)
### type​


[​](#type)
### sellerOrders​


[​](#sellerorders)[Order](/reference/typescript-api/entities/order#order)
### aggregateOrder​


[​](#aggregateorder)[Order](/reference/typescript-api/entities/order#order)
### aggregateOrderId​


[​](#aggregateorderid)[ID](/reference/typescript-api/common/id#id)
### code​


[​](#code)A unique code for the Order, generated according to the
OrderCodeStrategy. This should be used as an order reference
for Customers, rather than the Order's id.

[OrderCodeStrategy](/reference/typescript-api/orders/order-code-strategy#ordercodestrategy)
### state​


[​](#state)[OrderState](/reference/typescript-api/orders/order-process#orderstate)
### active​


[​](#active)Whether the Order is considered "active", meaning that the
Customer can still make changes to it and has not yet completed
the checkout process.
This is governed by the OrderPlacedStrategy.

[OrderPlacedStrategy](/reference/typescript-api/orders/order-placed-strategy#orderplacedstrategy)
### orderPlacedAt​


[​](#orderplacedat)The date & time that the Order was placed, i.e. the Customer
completed the checkout and the Order is no longer "active".
This is governed by the OrderPlacedStrategy.

[OrderPlacedStrategy](/reference/typescript-api/orders/order-placed-strategy#orderplacedstrategy)
### customer​


[​](#customer)[Customer](/reference/typescript-api/entities/customer#customer)
### customerId​


[​](#customerid)[ID](/reference/typescript-api/common/id#id)
### lines​


[​](#lines)[OrderLine](/reference/typescript-api/entities/order-line#orderline)
### surcharges​


[​](#surcharges)[Surcharge](/reference/typescript-api/entities/surcharge#surcharge)Surcharges are arbitrary modifications to the Order total which are neither
ProductVariants nor discounts resulting from applied Promotions. For example,
one-off discounts based on customer interaction, or surcharges based on payment
methods.

### couponCodes​


[​](#couponcodes)An array of all coupon codes applied to the Order.

### promotions​


[​](#promotions)[Promotion](/reference/typescript-api/entities/promotion#promotion)Promotions applied to the order. Only gets populated after the payment process has completed,
i.e. the Order is no longer active.

### shippingAddress​


[​](#shippingaddress)
### billingAddress​


[​](#billingaddress)
### payments​


[​](#payments)[Payment](/reference/typescript-api/entities/payment#payment)
### fulfillments​


[​](#fulfillments)[Fulfillment](/reference/typescript-api/entities/fulfillment#fulfillment)
### currencyCode​


[​](#currencycode)[CurrencyCode](/reference/typescript-api/common/currency-code#currencycode)
### customFields​


[​](#customfields)
### taxZoneId​


[​](#taxzoneid)[ID](/reference/typescript-api/common/id#id)
### channels​


[​](#channels)[Channel](/reference/typescript-api/entities/channel#channel)
### modifications​


[​](#modifications)[OrderModification](/reference/typescript-api/entities/order-modification#ordermodification)
### subTotal​


[​](#subtotal)The subTotal is the total of all OrderLines in the Order. This figure also includes any Order-level
discounts which have been prorated (proportionally distributed) amongst the OrderItems.
To get a total of all OrderLines which does not account for prorated discounts, use the
sum of OrderLine's discountedLinePrice values.

[OrderLine](/reference/typescript-api/entities/order-line#orderline)
### subTotalWithTax​


[​](#subtotalwithtax)Same as subTotal, but inclusive of tax.

### shippingLines​


[​](#shippinglines)[ShippingLine](/reference/typescript-api/entities/shipping-line#shippingline)The shipping charges applied to this order.

### shipping​


[​](#shipping)The total of all the shippingLines.

### shippingWithTax​


[​](#shippingwithtax)
### discounts​


[​](#discounts)
### total​


[​](#total)Equal to subTotal plus shipping

### totalWithTax​


[​](#totalwithtax)The final payable amount. Equal to subTotalWithTax plus shippingWithTax.

### totalQuantity​


[​](#totalquantity)
### taxSummary​


[​](#taxsummary)A summary of the taxes being applied to this Order.


---

# OrderableAsset


## OrderableAsset​


[​](#orderableasset)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[orderable-asset.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/asset/orderable-asset.entity.ts#L18)This base class is extended in order to enable specific ordering of the one-to-many
Entity -> Assets relation. Using a many-to-many relation does not provide a way
to guarantee order of the Assets, so this entity is used in place of the
usual join table that would be created by TypeORM.
See https://typeorm.io/#/many-to-many-relations/many-to-many-relations-with-custom-properties

[https://typeorm.io/#/many-to-many-relations/many-to-many-relations-with-custom-properties](https://typeorm.io/#/many-to-many-relations/many-to-many-relations-with-custom-properties)
```
class OrderableAsset extends VendureEntity implements Orderable {    constructor(input?: DeepPartial<OrderableAsset>)    @Column()    assetId: ID;    @Index()    @ManyToOne(type => Asset, { eager: true, onDelete: 'CASCADE' })    asset: Asset;    @Column()    position: number;}
```

- Extends: VendureEntity
- Implements: Orderable

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: Orderable

[Orderable](/reference/typescript-api/entities/interfaces#orderable)
### constructor​


[​](#constructor)[OrderableAsset](/reference/typescript-api/entities/orderable-asset#orderableasset)
### assetId​


[​](#assetid)[ID](/reference/typescript-api/common/id#id)
### asset​


[​](#asset)[Asset](/reference/typescript-api/entities/asset#asset)
### position​


[​](#position)


---

# PaymentMethod


## PaymentMethod​


[​](#paymentmethod)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-method.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/payment-method/payment-method.entity.ts#L21)A PaymentMethod is created automatically according to the configured PaymentMethodHandlers defined
in the PaymentOptions config.

[PaymentMethodHandler](/reference/typescript-api/payment/payment-method-handler#paymentmethodhandler)[PaymentOptions](/reference/typescript-api/payment/payment-options#paymentoptions)
```
class PaymentMethod extends VendureEntity implements Translatable, ChannelAware, HasCustomFields {    constructor(input?: DeepPartial<PaymentMethod>)    name: LocaleString;    @Column({ default: '' }) code: string;    description: LocaleString;    @OneToMany(type => PaymentMethodTranslation, translation => translation.base, { eager: true })    translations: Array<Translation<PaymentMethod>>;    @Column() enabled: boolean;    @Column('simple-json', { nullable: true }) checker: ConfigurableOperation | null;    @Column('simple-json') handler: ConfigurableOperation;    @ManyToMany(type => Channel, channel => channel.paymentMethods)    @JoinTable()    channels: Channel[];    @Column(type => CustomPaymentMethodFields)    customFields: CustomPaymentMethodFields;}
```

- Extends: VendureEntity
- Implements: Translatable, ChannelAware, HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: Translatable, ChannelAware, HasCustomFields

[Translatable](/reference/typescript-api/entities/interfaces#translatable)[ChannelAware](/reference/typescript-api/entities/interfaces#channelaware)
### constructor​


[​](#constructor)[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)
### name​


[​](#name)
### code​


[​](#code)
### description​


[​](#description)
### translations​


[​](#translations)[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)
### enabled​


[​](#enabled)
### checker​


[​](#checker)
### handler​


[​](#handler)
### channels​


[​](#channels)[Channel](/reference/typescript-api/entities/channel#channel)
### customFields​


[​](#customfields)

---


# Payment


## Payment​


[​](#payment)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/payment/payment.entity.ts#L20)A Payment represents a single payment transaction and exists in a well-defined state
defined by the PaymentState type.

[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)
```
class Payment extends VendureEntity implements HasCustomFields {    constructor(input?: DeepPartial<Payment>)    @Column() method: string;    @Money() amount: number;    @Column('varchar') state: PaymentState;    @Column({ type: 'varchar', nullable: true })    errorMessage: string | undefined;    @Column({ nullable: true })    transactionId: string;    @Column('simple-json') metadata: PaymentMetadata;    @Index()    @ManyToOne(type => Order, order => order.payments)    order: Order;    @OneToMany(type => Refund, refund => refund.payment)    refunds: Refund[];    @Column(type => CustomPaymentFields)    customFields: CustomPaymentFields;}
```

- Extends: VendureEntity
- Implements: HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: HasCustomFields

### constructor​


[​](#constructor)[Payment](/reference/typescript-api/entities/payment#payment)
### method​


[​](#method)
### amount​


[​](#amount)
### state​


[​](#state)[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)
### errorMessage​


[​](#errormessage)
### transactionId​


[​](#transactionid)
### metadata​


[​](#metadata)
### order​


[​](#order)[Order](/reference/typescript-api/entities/order#order)
### refunds​


[​](#refunds)[Refund](/reference/typescript-api/entities/refund#refund)
### customFields​


[​](#customfields)


---

# ProductOptionGroup


## ProductOptionGroup​


[​](#productoptiongroup)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-option-group.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/product-option-group/product-option-group.entity.ts#L20)A grouping of one or more ProductOptions.

[ProductOption](/reference/typescript-api/entities/product-option#productoption)
```
class ProductOptionGroup extends VendureEntity implements Translatable, HasCustomFields, SoftDeletable {    constructor(input?: DeepPartial<ProductOptionGroup>)    @Column({ type: Date, nullable: true })    deletedAt: Date | null;    name: LocaleString;    @Column()    code: string;    @OneToMany(type => ProductOptionGroupTranslation, translation => translation.base, { eager: true })    translations: Array<Translation<ProductOptionGroup>>;    @OneToMany(type => ProductOption, option => option.group)    options: ProductOption[];    @Index()    @ManyToOne(type => Product, product => product.optionGroups)    product: Product;    @Column(type => CustomProductOptionGroupFields)    customFields: CustomProductOptionGroupFields;}
```

- Extends: VendureEntity
- Implements: Translatable, HasCustomFields, SoftDeletable

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: Translatable, HasCustomFields, SoftDeletable

[Translatable](/reference/typescript-api/entities/interfaces#translatable)[SoftDeletable](/reference/typescript-api/entities/interfaces#softdeletable)
### constructor​


[​](#constructor)[ProductOptionGroup](/reference/typescript-api/entities/product-option-group#productoptiongroup)
### deletedAt​


[​](#deletedat)
### name​


[​](#name)
### code​


[​](#code)
### translations​


[​](#translations)[ProductOptionGroup](/reference/typescript-api/entities/product-option-group#productoptiongroup)
### options​


[​](#options)[ProductOption](/reference/typescript-api/entities/product-option#productoption)
### product​


[​](#product)[Product](/reference/typescript-api/entities/product#product)
### customFields​


[​](#customfields)


---

# ProductOption


## ProductOption​


[​](#productoption)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-option.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/product-option/product-option.entity.ts#L21)A ProductOption is used to differentiate ProductVariants from one another.

[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
```
class ProductOption extends VendureEntity implements Translatable, HasCustomFields, SoftDeletable {    constructor(input?: DeepPartial<ProductOption>)    @Column({ type: Date, nullable: true })    deletedAt: Date | null;    name: LocaleString;    @Column() code: string;    @OneToMany(type => ProductOptionTranslation, translation => translation.base, { eager: true })    translations: Array<Translation<ProductOption>>;    @Index()    @ManyToOne(type => ProductOptionGroup, group => group.options)    group: ProductOptionGroup;    @EntityId()    groupId: ID;    @ManyToMany(type => ProductVariant, variant => variant.options)    productVariants: ProductVariant[];    @Column(type => CustomProductOptionFields)    customFields: CustomProductOptionFields;}
```

- Extends: VendureEntity
- Implements: Translatable, HasCustomFields, SoftDeletable

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: Translatable, HasCustomFields, SoftDeletable

[Translatable](/reference/typescript-api/entities/interfaces#translatable)[SoftDeletable](/reference/typescript-api/entities/interfaces#softdeletable)
### constructor​


[​](#constructor)[ProductOption](/reference/typescript-api/entities/product-option#productoption)
### deletedAt​


[​](#deletedat)
### name​


[​](#name)
### code​


[​](#code)
### translations​


[​](#translations)[ProductOption](/reference/typescript-api/entities/product-option#productoption)
### group​


[​](#group)[ProductOptionGroup](/reference/typescript-api/entities/product-option-group#productoptiongroup)
### groupId​


[​](#groupid)[ID](/reference/typescript-api/common/id#id)
### productVariants​


[​](#productvariants)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### customFields​


[​](#customfields)


---

# ProductVariantPrice


## ProductVariantPrice​


[​](#productvariantprice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-variant-price.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/product-variant/product-variant-price.entity.ts#L20)A ProductVariantPrice is a Channel-specific price for a ProductVariant. For every Channel to
which a ProductVariant is assigned, there will be a corresponding ProductVariantPrice entity.

```
class ProductVariantPrice extends VendureEntity implements HasCustomFields {    constructor(input?: DeepPartial<ProductVariantPrice>)    @Money() price: number;    @EntityId({ nullable: true }) channelId: ID;    @Column('varchar')    currencyCode: CurrencyCode;    @Index()    @ManyToOne(type => ProductVariant, variant => variant.productVariantPrices, { onDelete: 'CASCADE' })    variant: ProductVariant;    @Column(type => CustomProductVariantPriceFields)    customFields: CustomProductVariantPriceFields;}
```

- Extends: VendureEntity
- Implements: HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: HasCustomFields

### constructor​


[​](#constructor)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)
### price​


[​](#price)
### channelId​


[​](#channelid)[ID](/reference/typescript-api/common/id#id)
### currencyCode​


[​](#currencycode)[CurrencyCode](/reference/typescript-api/common/currency-code#currencycode)
### variant​


[​](#variant)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### customFields​


[​](#customfields)


---

# ProductVariant


## ProductVariant​


[​](#productvariant)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-variant.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/product-variant/product-variant.entity.ts#L38)A ProductVariant represents a single stock keeping unit (SKU) in the store's inventory.
Whereas a Product is a "container" of variants, the variant itself holds the
data on price, tax category etc. When one adds items to their cart, they are adding
ProductVariants, not Products.

[Product](/reference/typescript-api/entities/product#product)
```
class ProductVariant extends VendureEntity implements Translatable, HasCustomFields, SoftDeletable, ChannelAware {    constructor(input?: DeepPartial<ProductVariant>)    @Column({ type: Date, nullable: true })    deletedAt: Date | null;    name: LocaleString;    @Column({ default: true })    enabled: boolean;    @Column()    sku: string;    listPrice: number;    listPriceIncludesTax: boolean;    currencyCode: CurrencyCode;    price: number    priceWithTax: number    taxRateApplied: TaxRate;    @Index()    @ManyToOne(type => Asset, asset => asset.featuredInVariants, { onDelete: 'SET NULL' })    featuredAsset: Asset;    @EntityId({ nullable: true })    featuredAssetId: ID;    @OneToMany(type => ProductVariantAsset, productVariantAsset => productVariantAsset.productVariant, {        onDelete: 'SET NULL',    })    assets: ProductVariantAsset[];    @Index()    @ManyToOne(type => TaxCategory, taxCategory => taxCategory.productVariants)    taxCategory: TaxCategory;    @EntityId({ nullable: true })    taxCategoryId: ID;    @OneToMany(type => ProductVariantPrice, price => price.variant, { eager: true })    productVariantPrices: ProductVariantPrice[];    @OneToMany(type => ProductVariantTranslation, translation => translation.base, { eager: true })    translations: Array<Translation<ProductVariant>>;    @Index()    @ManyToOne(type => Product, product => product.variants)    product: Product;    @EntityId({ nullable: true })    productId: ID;    @Column({ default: 0 })    outOfStockThreshold: number;    @Column({ default: true })    useGlobalOutOfStockThreshold: boolean;    @Column({ type: 'varchar', default: GlobalFlag.INHERIT })    trackInventory: GlobalFlag;    @OneToMany(type => StockLevel, stockLevel => stockLevel.productVariant)    stockLevels: StockLevel[];    @OneToMany(type => StockMovement, stockMovement => stockMovement.productVariant)    stockMovements: StockMovement[];    @ManyToMany(type => ProductOption, productOption => productOption.productVariants)    @JoinTable()    options: ProductOption[];    @ManyToMany(type => FacetValue, facetValue => facetValue.productVariants)    @JoinTable()    facetValues: FacetValue[];    @Column(type => CustomProductVariantFields)    customFields: CustomProductVariantFields;    @ManyToMany(type => Collection, collection => collection.productVariants)    collections: Collection[];    @ManyToMany(type => Channel, channel => channel.productVariants)    @JoinTable()    channels: Channel[];    @OneToMany(type => OrderLine, orderLine => orderLine.productVariant)    lines: OrderLine[];}
```

- Extends: VendureEntity
- Implements: Translatable, HasCustomFields, SoftDeletable, ChannelAware

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: Translatable, HasCustomFields, SoftDeletable, ChannelAware

[Translatable](/reference/typescript-api/entities/interfaces#translatable)[SoftDeletable](/reference/typescript-api/entities/interfaces#softdeletable)[ChannelAware](/reference/typescript-api/entities/interfaces#channelaware)
### constructor​


[​](#constructor)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### deletedAt​


[​](#deletedat)
### name​


[​](#name)
### enabled​


[​](#enabled)
### sku​


[​](#sku)
### listPrice​


[​](#listprice)
### listPriceIncludesTax​


[​](#listpriceincludestax)
### currencyCode​


[​](#currencycode)[CurrencyCode](/reference/typescript-api/common/currency-code#currencycode)
### price​


[​](#price)
### priceWithTax​


[​](#pricewithtax)
### taxRateApplied​


[​](#taxrateapplied)[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)
### featuredAsset​


[​](#featuredasset)[Asset](/reference/typescript-api/entities/asset#asset)
### featuredAssetId​


[​](#featuredassetid)[ID](/reference/typescript-api/common/id#id)
### assets​


[​](#assets)
### taxCategory​


[​](#taxcategory)[TaxCategory](/reference/typescript-api/entities/tax-category#taxcategory)
### taxCategoryId​


[​](#taxcategoryid)[ID](/reference/typescript-api/common/id#id)
### productVariantPrices​


[​](#productvariantprices)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)
### translations​


[​](#translations)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### product​


[​](#product)[Product](/reference/typescript-api/entities/product#product)
### productId​


[​](#productid)[ID](/reference/typescript-api/common/id#id)
### outOfStockThreshold​


[​](#outofstockthreshold)Specifies the value of stockOnHand at which the ProductVariant is considered
out of stock.

### useGlobalOutOfStockThreshold​


[​](#useglobaloutofstockthreshold)When true, the outOfStockThreshold value will be taken from the GlobalSettings and the
value set on this ProductVariant will be ignored.

### trackInventory​


[​](#trackinventory)
### stockLevels​


[​](#stocklevels)[StockLevel](/reference/typescript-api/entities/stock-level#stocklevel)
### stockMovements​


[​](#stockmovements)[StockMovement](/reference/typescript-api/entities/stock-movement#stockmovement)
### options​


[​](#options)[ProductOption](/reference/typescript-api/entities/product-option#productoption)
### facetValues​


[​](#facetvalues)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
### customFields​


[​](#customfields)
### collections​


[​](#collections)[Collection](/reference/typescript-api/entities/collection#collection)
### channels​


[​](#channels)[Channel](/reference/typescript-api/entities/channel#channel)
### lines​


[​](#lines)[OrderLine](/reference/typescript-api/entities/order-line#orderline)


---

# Product


## Product​


[​](#product)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/product/product.entity.ts#L26)A Product contains one or more ProductVariants and serves as a container for those variants,
providing an overall name, description etc.

[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
```
class Product extends VendureEntity implements Translatable, HasCustomFields, ChannelAware, SoftDeletable {    constructor(input?: DeepPartial<Product>)    @Column({ type: Date, nullable: true })    deletedAt: Date | null;    name: LocaleString;    slug: LocaleString;    description: LocaleString;    @Column({ default: true })    enabled: boolean;    @Index()    @ManyToOne(type => Asset, asset => asset.featuredInProducts, { onDelete: 'SET NULL' })    featuredAsset: Asset;    @EntityId({ nullable: true })    featuredAssetId: ID;    @OneToMany(type => ProductAsset, productAsset => productAsset.product)    assets: ProductAsset[];    @OneToMany(type => ProductTranslation, translation => translation.base, { eager: true })    translations: Array<Translation<Product>>;    @OneToMany(type => ProductVariant, variant => variant.product)    variants: ProductVariant[];    @OneToMany(type => ProductOptionGroup, optionGroup => optionGroup.product)    optionGroups: ProductOptionGroup[];    @ManyToMany(type => FacetValue, facetValue => facetValue.products)    @JoinTable()    facetValues: FacetValue[];    @ManyToMany(type => Channel, channel => channel.products)    @JoinTable()    channels: Channel[];    @Column(type => CustomProductFields)    customFields: CustomProductFields;}
```

- Extends: VendureEntity
- Implements: Translatable, HasCustomFields, ChannelAware, SoftDeletable

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: Translatable, HasCustomFields, ChannelAware, SoftDeletable

[Translatable](/reference/typescript-api/entities/interfaces#translatable)[ChannelAware](/reference/typescript-api/entities/interfaces#channelaware)[SoftDeletable](/reference/typescript-api/entities/interfaces#softdeletable)
### constructor​


[​](#constructor)[Product](/reference/typescript-api/entities/product#product)
### deletedAt​


[​](#deletedat)
### name​


[​](#name)
### slug​


[​](#slug)
### description​


[​](#description)
### enabled​


[​](#enabled)
### featuredAsset​


[​](#featuredasset)[Asset](/reference/typescript-api/entities/asset#asset)
### featuredAssetId​


[​](#featuredassetid)[ID](/reference/typescript-api/common/id#id)
### assets​


[​](#assets)
### translations​


[​](#translations)[Product](/reference/typescript-api/entities/product#product)
### variants​


[​](#variants)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### optionGroups​


[​](#optiongroups)[ProductOptionGroup](/reference/typescript-api/entities/product-option-group#productoptiongroup)
### facetValues​


[​](#facetvalues)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
### channels​


[​](#channels)[Channel](/reference/typescript-api/entities/channel#channel)
### customFields​


[​](#customfields)


---

# Promotion


## Promotion​


[​](#promotion)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/promotion/promotion.entity.ts#L61)A Promotion is used to define a set of conditions under which promotions actions (typically discounts)
will be applied to an Order.

Each assigned PromotionCondition is checked against the Order, and if they all return true,
then each assign PromotionItemAction / PromotionLineAction / PromotionOrderAction / PromotionShippingAction is applied to the Order.

[PromotionCondition](/reference/typescript-api/promotions/promotion-condition#promotioncondition)[PromotionItemAction](/reference/typescript-api/promotions/promotion-action#promotionitemaction)[PromotionLineAction](/reference/typescript-api/promotions/promotion-action#promotionlineaction)[PromotionOrderAction](/reference/typescript-api/promotions/promotion-action#promotionorderaction)[PromotionShippingAction](/reference/typescript-api/promotions/promotion-action#promotionshippingaction)
```
class Promotion extends AdjustmentSource implements ChannelAware, SoftDeletable, HasCustomFields, Translatable {    type = AdjustmentType.PROMOTION;    constructor(input?: DeepPartial<Promotion> & {            promotionConditions?: Array<PromotionCondition<any>>;            promotionActions?: Array<PromotionAction<any>>;        })    @Column({ type: Date, nullable: true })    deletedAt: Date | null;    @Column({ type: Date, nullable: true })    startsAt: Date | null;    @Column({ type: Date, nullable: true })    endsAt: Date | null;    @Column({ nullable: true })    couponCode: string;    @Column({ nullable: true })    perCustomerUsageLimit: number;    @Column({ nullable: true })    usageLimit: number;    name: LocaleString;    description: LocaleString;    @OneToMany(type => PromotionTranslation, translation => translation.base, { eager: true })    translations: Array<Translation<Promotion>>;    @Column() enabled: boolean;    @ManyToMany(type => Channel, channel => channel.promotions)    @JoinTable()    channels: Channel[];    @ManyToMany(type => Order, order => order.promotions)    orders: Order[];    @Column(type => CustomPromotionFields)    customFields: CustomPromotionFields;    @Column('simple-json') conditions: ConfigurableOperation[];    @Column('simple-json') actions: ConfigurableOperation[];    @Column() priorityScore: number;    apply(ctx: RequestContext, args: ApplyOrderActionArgs | ApplyOrderItemActionArgs | ApplyShippingActionArgs, state?: PromotionState) => Promise<Adjustment | undefined>;    test(ctx: RequestContext, order: Order) => Promise<PromotionTestResult>;    activate(ctx: RequestContext, order: Order) => ;    deactivate(ctx: RequestContext, order: Order) => ;}
```

- Extends: AdjustmentSource
- Implements: ChannelAware, SoftDeletable, HasCustomFields, Translatable

Extends: AdjustmentSource

Implements: ChannelAware, SoftDeletable, HasCustomFields, Translatable

[ChannelAware](/reference/typescript-api/entities/interfaces#channelaware)[SoftDeletable](/reference/typescript-api/entities/interfaces#softdeletable)[Translatable](/reference/typescript-api/entities/interfaces#translatable)
### type​


[​](#type)
### constructor​


[​](#constructor)[Promotion](/reference/typescript-api/entities/promotion#promotion)[PromotionCondition](/reference/typescript-api/promotions/promotion-condition#promotioncondition)[PromotionAction](/reference/typescript-api/promotions/promotion-action#promotionaction)
### deletedAt​


[​](#deletedat)
### startsAt​


[​](#startsat)
### endsAt​


[​](#endsat)
### couponCode​


[​](#couponcode)
### perCustomerUsageLimit​


[​](#percustomerusagelimit)
### usageLimit​


[​](#usagelimit)
### name​


[​](#name)
### description​


[​](#description)
### translations​


[​](#translations)[Promotion](/reference/typescript-api/entities/promotion#promotion)
### enabled​


[​](#enabled)
### channels​


[​](#channels)[Channel](/reference/typescript-api/entities/channel#channel)
### orders​


[​](#orders)[Order](/reference/typescript-api/entities/order#order)
### customFields​


[​](#customfields)
### conditions​


[​](#conditions)
### actions​


[​](#actions)
### priorityScore​


[​](#priorityscore)The PriorityScore is used to determine the sequence in which multiple promotions are tested
on a given order. A higher number moves the Promotion towards the end of the sequence.

The score is derived from the sum of the priorityValues of the PromotionConditions and
PromotionActions comprising this Promotion.

An example illustrating the need for a priority is this:

Consider 2 Promotions, 1) buy 1 get one free and 2) 10% off when order total is over $50.
If Promotion 2 is evaluated prior to Promotion 1, then it can trigger the 10% discount even
if the subsequent application of Promotion 1 brings the order total down to way below $50.

### apply​


[​](#apply)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### test​


[​](#test)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)
### activate​


[​](#activate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)
### deactivate​


[​](#deactivate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)


---

# Province


## Province​


[​](#province)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[province.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/region/province.entity.ts#L13)A Province represents an administrative subdivision of a Country. For example, in the
United States, the country would be "United States" and the province would be "California".

[Country](/reference/typescript-api/entities/country#country)
```
class Province extends Region {    constructor(input?: DeepPartial<Province>)    readonly type: RegionType = 'province';}
```

- Extends: Region

[Region](/reference/typescript-api/entities/region#region)
### constructor​


[​](#constructor)[Province](/reference/typescript-api/entities/province#province)
### type​


[​](#type)


---

# Refund


## Refund​


[​](#refund)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[refund.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/refund/refund.entity.ts#L19)A refund the belongs to an order

```
class Refund extends VendureEntity implements HasCustomFields {    constructor(input?: DeepPartial<Refund>)    @Money() items: number;    @Money() shipping: number;    @Money() adjustment: number;    @Money() total: number;    @Column() method: string;    @Column({ nullable: true }) reason: string;    @Column('varchar') state: RefundState;    @Column({ nullable: true }) transactionId: string;    @OneToMany(type => RefundLine, line => line.refund)    @JoinTable()    lines: RefundLine[];    @Index()    @ManyToOne(type => Payment, payment => payment.refunds)    @JoinColumn()    payment: Payment;    @EntityId()    paymentId: ID;    @Column('simple-json') metadata: PaymentMetadata;    @Column(type => CustomRefundFields)    customFields: CustomRefundFields;}
```

- Extends: VendureEntity
- Implements: HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: HasCustomFields

### constructor​


[​](#constructor)[Refund](/reference/typescript-api/entities/refund#refund)
### items​


[​](#items)
### shipping​


[​](#shipping)
### adjustment​


[​](#adjustment)
### total​


[​](#total)
### method​


[​](#method)
### reason​


[​](#reason)
### state​


[​](#state)[RefundState](/reference/typescript-api/payment/refund-state#refundstate)
### transactionId​


[​](#transactionid)
### lines​


[​](#lines)[RefundLine](/reference/typescript-api/entities/order-line-reference#refundline)
### payment​


[​](#payment)[Payment](/reference/typescript-api/entities/payment#payment)
### paymentId​


[​](#paymentid)[ID](/reference/typescript-api/common/id#id)
### metadata​


[​](#metadata)
### customFields​


[​](#customfields)


---

# Region


## Region​


[​](#region)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[region.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/region/region.entity.ts#L22)A Region represents a geographical administrative unit, such as a Country, Province, State, Prefecture etc.
This is an abstract class which is extended by the Country and Province entities.
Regions can be grouped into Zones which are in turn used to determine applicable shipping and taxes for an Order.

[Country](/reference/typescript-api/entities/country#country)[Province](/reference/typescript-api/entities/province#province)[Zone](/reference/typescript-api/entities/zone#zone)[Order](/reference/typescript-api/entities/order#order)
```
class Region extends VendureEntity implements Translatable, HasCustomFields {    @Column() code: string;    @Column({ nullable: false, type: 'varchar' })    readonly type: RegionType;    name: LocaleString;    @Index()    @ManyToOne(type => Region, { nullable: true, onDelete: 'SET NULL' })    parent?: Region;    @EntityId({ nullable: true })    parentId?: ID;    @Column() enabled: boolean;    @OneToMany(type => RegionTranslation, translation => translation.base, { eager: true })    translations: Array<Translation<Region>>;    @Column(type => CustomRegionFields)    customFields: CustomRegionFields;}
```

- Extends: VendureEntity
- Implements: Translatable, HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: Translatable, HasCustomFields

[Translatable](/reference/typescript-api/entities/interfaces#translatable)
### code​


[​](#code)A code representing the region. The code format will depend on the type of region. For
example, a Country code will be a 2-letter ISO code, whereas a Province code could use
a format relevant to the type of province, e.g. a US state code like "CA".

### type​


[​](#type)
### name​


[​](#name)
### parent​


[​](#parent)[Region](/reference/typescript-api/entities/region#region)
### parentId​


[​](#parentid)[ID](/reference/typescript-api/common/id#id)
### enabled​


[​](#enabled)
### translations​


[​](#translations)[Region](/reference/typescript-api/entities/region#region)
### customFields​


[​](#customfields)


---

# Role


## Role​


[​](#role)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[role.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/role/role.entity.ts#L16)A Role represents a collection of permissions which determine the authorization
level of a User on a given set of Channels.

[User](/reference/typescript-api/entities/user#user)[Channel](/reference/typescript-api/entities/channel#channel)
```
class Role extends VendureEntity implements ChannelAware {    constructor(input?: DeepPartial<Role>)    @Column() code: string;    @Column() description: string;    @Column('simple-array') permissions: Permission[];    @ManyToMany(type => Channel, channel => channel.roles)    @JoinTable()    channels: Channel[];}
```

- Extends: VendureEntity
- Implements: ChannelAware

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: ChannelAware

[ChannelAware](/reference/typescript-api/entities/interfaces#channelaware)
### constructor​


[​](#constructor)[Role](/reference/typescript-api/entities/role#role)
### code​


[​](#code)
### description​


[​](#description)
### permissions​


[​](#permissions)[Permission](/reference/typescript-api/common/permission#permission)
### channels​


[​](#channels)[Channel](/reference/typescript-api/entities/channel#channel)


---

# Seller


## Seller​


[​](#seller)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[seller.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/seller/seller.entity.ts#L17)A Seller represents the person or organization who is selling the goods on a given Channel.
By default, a single-channel Vendure installation will have a single default Seller.

[Channel](/reference/typescript-api/entities/channel#channel)
```
class Seller extends VendureEntity implements SoftDeletable, HasCustomFields {    constructor(input?: DeepPartial<Seller>)    @Column({ type: Date, nullable: true })    deletedAt: Date | null;    @Column() name: string;    @Column(type => CustomSellerFields)    customFields: CustomSellerFields;    @OneToMany(type => Channel, channel => channel.seller)    channels: Channel[];}
```

- Extends: VendureEntity
- Implements: SoftDeletable, HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: SoftDeletable, HasCustomFields

[SoftDeletable](/reference/typescript-api/entities/interfaces#softdeletable)
### constructor​


[​](#constructor)[Seller](/reference/typescript-api/entities/seller#seller)
### deletedAt​


[​](#deletedat)
### name​


[​](#name)
### customFields​


[​](#customfields)
### channels​


[​](#channels)[Channel](/reference/typescript-api/entities/channel#channel)


---

# Session


## Session​


[​](#session)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[session.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/session/session.entity.ts#L18)A Session is created when a user makes a request to restricted API operations. A Session can be an AnonymousSession
in the case of un-authenticated users, otherwise it is an AuthenticatedSession.

[AnonymousSession](/reference/typescript-api/entities/anonymous-session#anonymoussession)[AuthenticatedSession](/reference/typescript-api/entities/authenticated-session#authenticatedsession)
```
class Session extends VendureEntity implements HasCustomFields {    @Index({ unique: true })    @Column()    token: string;    @Column() expires: Date;    @Column() invalidated: boolean;    @EntityId({ nullable: true })    activeOrderId?: ID;    @Index()    @ManyToOne(type => Order)    activeOrder: Order | null;    @EntityId({ nullable: true })    activeChannelId?: ID;    @Index()    @ManyToOne(type => Channel)    activeChannel: Channel | null;    @Column(type => CustomSessionFields)    customFields: CustomSessionFields;}
```

- Extends: VendureEntity
- Implements: HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: HasCustomFields

### token​


[​](#token)
### expires​


[​](#expires)
### invalidated​


[​](#invalidated)
### activeOrderId​


[​](#activeorderid)[ID](/reference/typescript-api/common/id#id)
### activeOrder​


[​](#activeorder)[Order](/reference/typescript-api/entities/order#order)
### activeChannelId​


[​](#activechannelid)[ID](/reference/typescript-api/common/id#id)
### activeChannel​


[​](#activechannel)[Channel](/reference/typescript-api/entities/channel#channel)
### customFields​


[​](#customfields)


---

# SettingsStoreEntry


## SettingsStoreEntry​


[​](#settingsstoreentry)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[settings-store-entry.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/settings-store-entry/settings-store-entry.entity.ts#L15)An entity for storing arbitrary settings data with scoped isolation.
This is used by the SettingsStore system to provide flexible key-value storage
with support for user, channel, and custom scoping.

```
class SettingsStoreEntry extends VendureEntity {    constructor(input?: Partial<SettingsStoreEntry>)    @Index()    @Column()    key: string;    @Column('json', { nullable: true })    value: any | null;    @Index()    @Column({ type: 'varchar', nullable: true })    scope: string | null;}
```

- Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)
### constructor​


[​](#constructor)[SettingsStoreEntry](/reference/typescript-api/entities/settings-store-entry#settingsstoreentry)
### key​


[​](#key)The settings key, typically in the format 'namespace.fieldName'

### value​


[​](#value)The JSON value stored for this setting

### scope​


[​](#scope)The scope string that isolates this setting (e.g., 'user:123', 'channel:456', '')


---

# ShippingLine


## ShippingLine​


[​](#shippingline)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[shipping-line.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/shipping-line/shipping-line.entity.ts#L26)A ShippingLine is created when a ShippingMethod is applied to an Order.
It contains information about the price of the shipping method, any discounts that were
applied, and the resulting tax on the shipping method.

[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)[Order](/reference/typescript-api/entities/order#order)
```
class ShippingLine extends VendureEntity implements HasCustomFields {    constructor(input?: DeepPartial<ShippingLine>)    @EntityId()    shippingMethodId: ID | null;    @Index()    @ManyToOne(type => ShippingMethod)    shippingMethod: ShippingMethod;    @Index()    @ManyToOne(type => Order, order => order.shippingLines, { onDelete: 'CASCADE' })    order: Order;    @Money()    listPrice: number;    @Column()    listPriceIncludesTax: boolean;    @Column('simple-json')    adjustments: Adjustment[];    @Column('simple-json')    taxLines: TaxLine[];    @OneToMany(type => OrderLine, orderLine => orderLine.shippingLine)    orderLines: OrderLine[];    @Column(type => CustomShippingLineFields)    customFields: CustomShippingLineFields;    price: number    priceWithTax: number    discountedPrice: number    discountedPriceWithTax: number    taxRate: number    discounts: Discount[]    addAdjustment(adjustment: Adjustment) => ;    clearAdjustments() => ;}
```

- Extends: VendureEntity
- Implements: HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: HasCustomFields

### constructor​


[​](#constructor)[ShippingLine](/reference/typescript-api/entities/shipping-line#shippingline)
### shippingMethodId​


[​](#shippingmethodid)[ID](/reference/typescript-api/common/id#id)
### shippingMethod​


[​](#shippingmethod)[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)
### order​


[​](#order)[Order](/reference/typescript-api/entities/order#order)
### listPrice​


[​](#listprice)
### listPriceIncludesTax​


[​](#listpriceincludestax)
### adjustments​


[​](#adjustments)
### taxLines​


[​](#taxlines)
### orderLines​


[​](#orderlines)[OrderLine](/reference/typescript-api/entities/order-line#orderline)
### customFields​


[​](#customfields)
### price​


[​](#price)
### priceWithTax​


[​](#pricewithtax)
### discountedPrice​


[​](#discountedprice)
### discountedPriceWithTax​


[​](#discountedpricewithtax)
### taxRate​


[​](#taxrate)
### discounts​


[​](#discounts)
### addAdjustment​


[​](#addadjustment)
### clearAdjustments​


[​](#clearadjustments)


---

# ShippingMethod


## ShippingMethod​


[​](#shippingmethod)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[shipping-method.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/shipping-method/shipping-method.entity.ts#L34)A ShippingMethod is used to apply a shipping price to an Order. It is composed of a
ShippingEligibilityChecker and a ShippingCalculator. For a given Order,
the checker is used to determine whether this ShippingMethod can be used. If yes, then
the ShippingMethod can be applied and the calculator is used to determine the price of
shipping.

[Order](/reference/typescript-api/entities/order#order)[ShippingEligibilityChecker](/reference/typescript-api/shipping/shipping-eligibility-checker#shippingeligibilitychecker)[ShippingCalculator](/reference/typescript-api/shipping/shipping-calculator#shippingcalculator)
```
class ShippingMethod extends VendureEntity implements ChannelAware, SoftDeletable, HasCustomFields, Translatable {    constructor(input?: DeepPartial<ShippingMethod>)    @Column({ type: Date, nullable: true })    deletedAt: Date | null;    @Column() code: string;    name: LocaleString;    description: LocaleString;    @Column('simple-json') checker: ConfigurableOperation;    @Column('simple-json') calculator: ConfigurableOperation;    @Column()    fulfillmentHandlerCode: string;    @ManyToMany(type => Channel, channel => channel.shippingMethods)    @JoinTable()    channels: Channel[];    @OneToMany(type => ShippingMethodTranslation, translation => translation.base, { eager: true })    translations: Array<Translation<ShippingMethod>>;    @Column(type => CustomShippingMethodFields)    customFields: CustomShippingMethodFields;    apply(ctx: RequestContext, order: Order) => Promise<ShippingCalculationResult | undefined>;    test(ctx: RequestContext, order: Order) => Promise<boolean>;    toJSON() => any;}
```

- Extends: VendureEntity
- Implements: ChannelAware, SoftDeletable, HasCustomFields, Translatable

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: ChannelAware, SoftDeletable, HasCustomFields, Translatable

[ChannelAware](/reference/typescript-api/entities/interfaces#channelaware)[SoftDeletable](/reference/typescript-api/entities/interfaces#softdeletable)[Translatable](/reference/typescript-api/entities/interfaces#translatable)
### constructor​


[​](#constructor)[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)
### deletedAt​


[​](#deletedat)
### code​


[​](#code)
### name​


[​](#name)
### description​


[​](#description)
### checker​


[​](#checker)
### calculator​


[​](#calculator)
### fulfillmentHandlerCode​


[​](#fulfillmenthandlercode)
### channels​


[​](#channels)[Channel](/reference/typescript-api/entities/channel#channel)
### translations​


[​](#translations)[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)
### customFields​


[​](#customfields)
### apply​


[​](#apply)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[ShippingCalculationResult](/reference/typescript-api/shipping/shipping-calculator#shippingcalculationresult)
### test​


[​](#test)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)
### toJSON​


[​](#tojson)


---

# StockLevel


## StockLevel​


[​](#stocklevel)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[stock-level.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/stock-level/stock-level.entity.ts#L18)A StockLevel represents the number of a particular ProductVariant which are available
at a particular StockLocation.

[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)
```
class StockLevel extends VendureEntity implements HasCustomFields {    constructor(input: DeepPartial<StockLevel>)    @Index()    @ManyToOne(type => ProductVariant, productVariant => productVariant.stockLevels, { onDelete: 'CASCADE' })    productVariant: ProductVariant;    @EntityId()    productVariantId: ID;    @Index()    @ManyToOne(type => StockLocation, { onDelete: 'CASCADE' })    stockLocation: StockLocation;    @EntityId()    stockLocationId: ID;    @Column()    stockOnHand: number;    @Column()    stockAllocated: number;    @Column(type => CustomStockLevelFields)    customFields: CustomStockLevelFields;}
```

- Extends: VendureEntity
- Implements: HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: HasCustomFields

### constructor​


[​](#constructor)[StockLevel](/reference/typescript-api/entities/stock-level#stocklevel)
### productVariant​


[​](#productvariant)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### productVariantId​


[​](#productvariantid)[ID](/reference/typescript-api/common/id#id)
### stockLocation​


[​](#stocklocation)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)
### stockLocationId​


[​](#stocklocationid)[ID](/reference/typescript-api/common/id#id)
### stockOnHand​


[​](#stockonhand)
### stockAllocated​


[​](#stockallocated)
### customFields​


[​](#customfields)


---

# StockLocation


## StockLocation​


[​](#stocklocation)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[stock-location.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/stock-location/stock-location.entity.ts#L22)A StockLocation represents a physical location where stock is held. For example, a warehouse or a shop.

When the stock of a ProductVariant is adjusted, the adjustment is applied to a specific StockLocation,
and the stockOnHand of that ProductVariant is updated accordingly. When there are multiple StockLocations
configured, the StockLocationStrategy is used to determine which StockLocation should be used for
a given operation.

[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[StockLocationStrategy](/reference/typescript-api/products-stock/stock-location-strategy#stocklocationstrategy)
```
class StockLocation extends VendureEntity implements HasCustomFields, ChannelAware {    constructor(input: DeepPartial<StockLocation>)    @Column()    name: string;    @Column()    description: string;    @Column(type => CustomStockLocationFields)    customFields: CustomStockLocationFields;    @ManyToMany(type => Channel, channel => channel.stockLocations)    @JoinTable()    channels: Channel[];    @OneToMany(type => StockMovement, movement => movement.stockLocation)    stockMovements: StockMovement[];}
```

- Extends: VendureEntity
- Implements: HasCustomFields, ChannelAware

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: HasCustomFields, ChannelAware

[ChannelAware](/reference/typescript-api/entities/interfaces#channelaware)
### constructor​


[​](#constructor)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)
### name​


[​](#name)
### description​


[​](#description)
### customFields​


[​](#customfields)
### channels​


[​](#channels)[Channel](/reference/typescript-api/entities/channel#channel)
### stockMovements​


[​](#stockmovements)[StockMovement](/reference/typescript-api/entities/stock-movement#stockmovement)


---

# StockMovement


## StockMovement​


[​](#stockmovement)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[stock-movement.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/stock-movement/stock-movement.entity.ts#L21)A StockMovement is created whenever stock of a particular ProductVariant goes in
or out.

```
class StockMovement extends VendureEntity implements HasCustomFields {    @Column({ nullable: false, type: 'varchar' })    readonly type: StockMovementType;    @Index()    @ManyToOne(type => ProductVariant, variant => variant.stockMovements)    productVariant: ProductVariant;    @Index()    @ManyToOne(type => StockLocation, stockLocation => stockLocation.stockMovements, { onDelete: 'CASCADE' })    stockLocation: StockLocation;    @EntityId()    stockLocationId: ID;    @Column()    quantity: number;    @Column(type => CustomStockMovementFields)    customFields: CustomStockMovementFields;}
```

- Extends: VendureEntity
- Implements: HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: HasCustomFields

### type​


[​](#type)
### productVariant​


[​](#productvariant)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### stockLocation​


[​](#stocklocation)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)
### stockLocationId​


[​](#stocklocationid)[ID](/reference/typescript-api/common/id#id)
### quantity​


[​](#quantity)
### customFields​


[​](#customfields)
## Allocation​


[​](#allocation)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[allocation.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/stock-movement/allocation.entity.ts#L17)An Allocation is created for each ProductVariant in an Order when the checkout is completed
(as configured by the StockAllocationStrategy. This prevents stock being sold twice.

[StockAllocationStrategy](/reference/typescript-api/orders/stock-allocation-strategy#stockallocationstrategy)
```
class Allocation extends StockMovement {    readonly type = StockMovementType.ALLOCATION;    constructor(input: DeepPartial<Allocation>)    @Index()    @ManyToOne(type => OrderLine, orderLine => orderLine.allocations)    orderLine: OrderLine;}
```

- Extends: StockMovement

[StockMovement](/reference/typescript-api/entities/stock-movement#stockmovement)
### type​


[​](#type-1)
### constructor​


[​](#constructor)[Allocation](/reference/typescript-api/entities/stock-movement#allocation)
### orderLine​


[​](#orderline)[OrderLine](/reference/typescript-api/entities/order-line#orderline)
## Cancellation​


[​](#cancellation)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[cancellation.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/stock-movement/cancellation.entity.ts#L16)A Cancellation is created when OrderItems from a fulfilled Order are cancelled.

```
class Cancellation extends StockMovement {    readonly type = StockMovementType.CANCELLATION;    constructor(input: DeepPartial<Cancellation>)    @ManyToOne(type => OrderLine, orderLine => orderLine.cancellations)    orderLine: OrderLine;}
```

- Extends: StockMovement

[StockMovement](/reference/typescript-api/entities/stock-movement#stockmovement)
### type​


[​](#type-2)
### constructor​


[​](#constructor-1)[Cancellation](/reference/typescript-api/entities/stock-movement#cancellation)
### orderLine​


[​](#orderline-1)[OrderLine](/reference/typescript-api/entities/order-line#orderline)
## Release​


[​](#release)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[release.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/stock-movement/release.entity.ts#L17)A Release is created when OrderItems which have been allocated (but not yet fulfilled)
are cancelled.

```
class Release extends StockMovement {    readonly type = StockMovementType.RELEASE;    constructor(input: DeepPartial<Release>)    @ManyToOne(type => OrderLine)    orderLine: OrderLine;}
```

- Extends: StockMovement

[StockMovement](/reference/typescript-api/entities/stock-movement#stockmovement)
### type​


[​](#type-3)
### constructor​


[​](#constructor-2)[Release](/reference/typescript-api/entities/stock-movement#release)
### orderLine​


[​](#orderline-2)[OrderLine](/reference/typescript-api/entities/order-line#orderline)
## Sale​


[​](#sale)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[sale.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/stock-movement/sale.entity.ts#L16)A Sale is created when OrderItems are fulfilled.

```
class Sale extends StockMovement {    readonly type = StockMovementType.SALE;    constructor(input: DeepPartial<Sale>)    @ManyToOne(type => OrderLine, line => line.sales)    orderLine: OrderLine;}
```

- Extends: StockMovement

[StockMovement](/reference/typescript-api/entities/stock-movement#stockmovement)
### type​


[​](#type-4)
### constructor​


[​](#constructor-3)[Sale](/reference/typescript-api/entities/stock-movement#sale)
### orderLine​


[​](#orderline-3)[OrderLine](/reference/typescript-api/entities/order-line#orderline)
## StockAdjustment​


[​](#stockadjustment)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[stock-adjustment.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/stock-movement/stock-adjustment.entity.ts#L14)A StockAdjustment is created when the stockOnHand level of a ProductVariant is manually adjusted.

```
class StockAdjustment extends StockMovement {    readonly type = StockMovementType.ADJUSTMENT;    constructor(input: DeepPartial<StockAdjustment>)}
```

- Extends: StockMovement

[StockMovement](/reference/typescript-api/entities/stock-movement#stockmovement)
### type​


[​](#type-5)
### constructor​


[​](#constructor-4)[StockAdjustment](/reference/typescript-api/entities/stock-movement#stockadjustment)


---

# Surcharge


## Surcharge​


[​](#surcharge)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[surcharge.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/surcharge/surcharge.entity.ts#L21)A Surcharge represents an arbitrary extra item on an Order which is not
a ProductVariant. It can be used to e.g. represent payment-related surcharges.

[Order](/reference/typescript-api/entities/order#order)
```
class Surcharge extends VendureEntity {    constructor(input?: DeepPartial<Surcharge>)    @Column()    description: string;    @Money()    listPrice: number;    @Column()    listPriceIncludesTax: boolean;    @Column()    sku: string;    @Column('simple-json')    taxLines: TaxLine[];    @Index()    @ManyToOne(type => Order, order => order.surcharges, { onDelete: 'CASCADE' })    order: Order;    @Index()    @ManyToOne(type => OrderModification, orderModification => orderModification.surcharges)    orderModification: OrderModification;    price: number    priceWithTax: number    taxRate: number}
```

- Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)
### constructor​


[​](#constructor)[Surcharge](/reference/typescript-api/entities/surcharge#surcharge)
### description​


[​](#description)
### listPrice​


[​](#listprice)
### listPriceIncludesTax​


[​](#listpriceincludestax)
### sku​


[​](#sku)
### taxLines​


[​](#taxlines)
### order​


[​](#order)[Order](/reference/typescript-api/entities/order#order)
### orderModification​


[​](#ordermodification)[OrderModification](/reference/typescript-api/entities/order-modification#ordermodification)
### price​


[​](#price)
### priceWithTax​


[​](#pricewithtax)
### taxRate​


[​](#taxrate)


---

# Tag


## Tag​


[​](#tag)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[tag.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/tag/tag.entity.ts#L13)A tag is an arbitrary label which can be applied to certain entities.
It is used to help organize and filter those entities.

```
class Tag extends VendureEntity {    constructor(input?: DeepPartial<Tag>)    @Column()    value: string;}
```

- Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)
### constructor​


[​](#constructor)[Tag](/reference/typescript-api/entities/tag#tag)
### value​


[​](#value)


---

# TaxCategory


## TaxCategory​


[​](#taxcategory)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[tax-category.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/tax-category/tax-category.entity.ts#L16)A TaxCategory defines what type of taxes to apply to a ProductVariant.

[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
```
class TaxCategory extends VendureEntity implements HasCustomFields {    constructor(input?: DeepPartial<TaxCategory>)    @Column() name: string;    @Column({ default: false }) isDefault: boolean;    @Column(type => CustomTaxCategoryFields)    customFields: CustomTaxCategoryFields;    @OneToMany(type => ProductVariant, productVariant => productVariant.taxCategory)    productVariants: ProductVariant[];    @OneToMany(type => TaxRate, taxRate => taxRate.category)    taxRates: TaxRate[];}
```

- Extends: VendureEntity
- Implements: HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: HasCustomFields

### constructor​


[​](#constructor)[TaxCategory](/reference/typescript-api/entities/tax-category#taxcategory)
### name​


[​](#name)
### isDefault​


[​](#isdefault)
### customFields​


[​](#customfields)
### productVariants​


[​](#productvariants)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### taxRates​


[​](#taxrates)[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)


---


# TaxRate


## TaxRate​


[​](#taxrate)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[tax-rate.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/tax-rate/tax-rate.entity.ts#L26)A TaxRate defines the rate of tax to apply to a ProductVariant based on three factors:

[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)- the ProductVariant's TaxCategory
- the applicable Zone ("applicable" being defined by the configured TaxZoneStrategy)
- the CustomerGroup of the current Customer

[TaxCategory](/reference/typescript-api/entities/tax-category#taxcategory)[Zone](/reference/typescript-api/entities/zone#zone)[TaxZoneStrategy](/reference/typescript-api/tax/tax-zone-strategy#taxzonestrategy)[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)
```
class TaxRate extends VendureEntity implements HasCustomFields {    constructor(input?: DeepPartial<TaxRate>)    @Column() name: string;    @Column() enabled: boolean;    @Column({ type: 'decimal', precision: 5, scale: 2, transformer: new DecimalTransformer() }) value: number;    @Index()    @ManyToOne(type => TaxCategory, taxCategory => taxCategory.taxRates)    category: TaxCategory;    @EntityId({ nullable: true })    categoryId: ID;    @Index()    @ManyToOne(type => Zone, zone => zone.taxRates)    zone: Zone;    @EntityId({ nullable: true })    zoneId: ID;    @Index()    @ManyToOne(type => CustomerGroup, customerGroup => customerGroup.taxRates, { nullable: true })    customerGroup?: CustomerGroup;    @Column(type => CustomTaxRateFields)    customFields: CustomTaxRateFields;    taxComponentOf(grossPrice: number) => number;    netPriceOf(grossPrice: number) => number;    taxPayableOn(netPrice: number) => number;    grossPriceOf(netPrice: number) => number;    apply(price: number) => TaxLine;    test(zone: Zone | ID, taxCategory: TaxCategory | ID) => boolean;}
```

- Extends: VendureEntity
- Implements: HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: HasCustomFields

### constructor​


[​](#constructor)[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)
### name​


[​](#name)
### enabled​


[​](#enabled)
### value​


[​](#value)
### category​


[​](#category)[TaxCategory](/reference/typescript-api/entities/tax-category#taxcategory)
### categoryId​


[​](#categoryid)[ID](/reference/typescript-api/common/id#id)
### zone​


[​](#zone)[Zone](/reference/typescript-api/entities/zone#zone)
### zoneId​


[​](#zoneid)[ID](/reference/typescript-api/common/id#id)
### customerGroup​


[​](#customergroup)[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)
### customFields​


[​](#customfields)
### taxComponentOf​


[​](#taxcomponentof)
### netPriceOf​


[​](#netpriceof)
### taxPayableOn​


[​](#taxpayableon)
### grossPriceOf​


[​](#grosspriceof)
### apply​


[​](#apply)
### test​


[​](#test)[Zone](/reference/typescript-api/entities/zone#zone)[ID](/reference/typescript-api/common/id#id)[TaxCategory](/reference/typescript-api/entities/tax-category#taxcategory)[ID](/reference/typescript-api/common/id#id)


---

# User


## User​


[​](#user)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[user.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/user/user.entity.ts#L21)A User represents any authenticated user of the Vendure API. This includes both
Administrators as well as registered Customers.

[Administrator](/reference/typescript-api/entities/administrator#administrator)[Customer](/reference/typescript-api/entities/customer#customer)
```
class User extends VendureEntity implements HasCustomFields, SoftDeletable {    constructor(input?: DeepPartial<User>)    @Column({ type: Date, nullable: true })    deletedAt: Date | null;    @Column()    identifier: string;    @OneToMany(type => AuthenticationMethod, method => method.user)    authenticationMethods: AuthenticationMethod[];    @Column({ default: false })    verified: boolean;    @ManyToMany(type => Role)    @JoinTable()    roles: Role[];    @Column({ type: Date, nullable: true })    lastLogin: Date | null;    @Column(type => CustomUserFields)    customFields: CustomUserFields;    @OneToMany(type => AuthenticatedSession, session => session.user)    sessions: AuthenticatedSession[];    getNativeAuthenticationMethod() => NativeAuthenticationMethod;    getNativeAuthenticationMethod(strict?: boolean) => NativeAuthenticationMethod | undefined;    getNativeAuthenticationMethod(strict?: boolean) => NativeAuthenticationMethod | undefined;}
```

- Extends: VendureEntity
- Implements: HasCustomFields, SoftDeletable

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: HasCustomFields, SoftDeletable

[SoftDeletable](/reference/typescript-api/entities/interfaces#softdeletable)
### constructor​


[​](#constructor)[User](/reference/typescript-api/entities/user#user)
### deletedAt​


[​](#deletedat)
### identifier​


[​](#identifier)
### authenticationMethods​


[​](#authenticationmethods)[AuthenticationMethod](/reference/typescript-api/entities/authentication-method#authenticationmethod)
### verified​


[​](#verified)
### roles​


[​](#roles)[Role](/reference/typescript-api/entities/role#role)
### lastLogin​


[​](#lastlogin)
### customFields​


[​](#customfields)
### sessions​


[​](#sessions)[AuthenticatedSession](/reference/typescript-api/entities/authenticated-session#authenticatedsession)
### getNativeAuthenticationMethod​


[​](#getnativeauthenticationmethod)[NativeAuthenticationMethod](/reference/typescript-api/entities/authentication-method#nativeauthenticationmethod)
### getNativeAuthenticationMethod​


[​](#getnativeauthenticationmethod-1)[NativeAuthenticationMethod](/reference/typescript-api/entities/authentication-method#nativeauthenticationmethod)
### getNativeAuthenticationMethod​


[​](#getnativeauthenticationmethod-2)[NativeAuthenticationMethod](/reference/typescript-api/entities/authentication-method#nativeauthenticationmethod)


---

# VendureEntity


## VendureEntity​


[​](#vendureentity)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[base.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/base/base.entity.ts#L13)This is the base class from which all entities inherit. The type of
the id property is defined by the EntityIdStrategy.

[EntityIdStrategy](/reference/typescript-api/configuration/entity-id-strategy#entityidstrategy)
```
class VendureEntity {    constructor(input?: DeepPartial<VendureEntity>)    @PrimaryGeneratedId()    id: ID;    @CreateDateColumn() createdAt: Date;    @UpdateDateColumn() updatedAt: Date;}
```

### constructor​


[​](#constructor)[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)
### id​


[​](#id)[ID](/reference/typescript-api/common/id#id)
### createdAt​


[​](#createdat)
### updatedAt​


[​](#updatedat)


---

# Zone


## Zone​


[​](#zone)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[zone.entity.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/zone/zone.entity.ts#L19)A Zone is a grouping of one or more Country entities. It is used for
calculating applicable shipping and taxes.

[Country](/reference/typescript-api/entities/country#country)
```
class Zone extends VendureEntity implements HasCustomFields {    constructor(input?: DeepPartial<Zone>)    @Column() name: string;    @ManyToMany(type => Region)    @JoinTable()    members: Region[];    @Column(type => CustomZoneFields)    customFields: CustomZoneFields;    @OneToMany(type => Channel, country => country.defaultShippingZone)    defaultShippingZoneChannels: Channel[];    @OneToMany(type => Channel, country => country.defaultTaxZone)    defaultTaxZoneChannels: Channel[];    @OneToMany(type => TaxRate, taxRate => taxRate.zone)    taxRates: TaxRate[];}
```

- Extends: VendureEntity
- Implements: HasCustomFields

Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)Implements: HasCustomFields

### constructor​


[​](#constructor)[Zone](/reference/typescript-api/entities/zone#zone)
### name​


[​](#name)
### members​


[​](#members)[Region](/reference/typescript-api/entities/region#region)
### customFields​


[​](#customfields)
### defaultShippingZoneChannels​


[​](#defaultshippingzonechannels)[Channel](/reference/typescript-api/entities/channel#channel)
### defaultTaxZoneChannels​


[​](#defaulttaxzonechannels)[Channel](/reference/typescript-api/entities/channel#channel)
### taxRates​


[​](#taxrates)[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)


---

# ErrorHandlerStrategy


## ErrorHandlerStrategy​


[​](#errorhandlerstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[error-handler-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/system/error-handler-strategy.ts#L60)This strategy defines logic for handling errors thrown during on both the server
and the worker. It can be used for additional logging & monitoring, or for sending error
reports to external services.

This is configured via the systemOptions.errorHandlers property of
your VendureConfig.

Example

```
import { ArgumentsHost, ExecutionContext } from '@nestjs/common';import { GqlContextType, GqlExecutionContext } from '@nestjs/graphql';import { ErrorHandlerStrategy, I18nError, Injector, Job, LogLevel } from '@vendure/core';import { MonitoringService } from './monitoring.service';export class CustomErrorHandlerStrategy implements ErrorHandlerStrategy {    private monitoringService: MonitoringService;    init(injector: Injector) {        this.monitoringService = injector.get(MonitoringService);    }    handleServerError(error: Error, { host }: { host: ArgumentsHost }) {         const errorContext: any = {};         if (host?.getType<GqlContextType>() === 'graphql') {             const gqlContext = GqlExecutionContext.create(host as ExecutionContext);             const info = gqlContext.getInfo();             errorContext.graphQlInfo = {                 fieldName: info.fieldName,                 path: info.path,             };         }         this.monitoringService.captureException(error, errorContext);    }    handleWorkerError(error: Error, { job }: { job: Job }) {        const errorContext = {            queueName: job.queueName,            jobId: job.id,        };        this.monitoringService.captureException(error, errorContext);    }}
```

```
interface ErrorHandlerStrategy extends InjectableStrategy {    handleServerError(exception: Error, context: { host: ArgumentsHost }): void | Promise<void>;    handleWorkerError(exception: Error, context: { job: Job }): void | Promise<void>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### handleServerError​


[​](#handleservererror)This method will be invoked for any error thrown during the execution of the
server.

### handleWorkerError​


[​](#handleworkererror)[Job](/reference/typescript-api/job-queue/job#job)This method will be invoked for any error thrown during the execution of a
job on the worker.


---

# ErrorResultUnion


## ErrorResultUnion​


[​](#errorresultunion)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[error-result.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/error/error-result.ts#L44)Used to construct a TypeScript return type for a query or mutation which, in the GraphQL schema,
returns a union type composed of a success result (e.g. Order) plus one or more ErrorResult
types.

Since the TypeScript entities do not correspond 1-to-1 with their GraphQL type counterparts,
we use this type to substitute them.

Example

```
type UpdateOrderItemsResult = Order | OrderModificationError | OrderLimitError | NegativeQuantityError;type T1 = ErrorResultUnion<UpdateOrderItemsResult, VendureEntityOrder>;// T1 = VendureEntityOrder | OrderModificationError | OrderLimitError | NegativeQuantityError;
```

```
type ErrorResultUnion<T extends GraphQLErrorResult | U, E extends VendureEntity, U = any> = | JustErrorResults<T>    | E
```


---

# Error Types


## InternalServerError​


[​](#internalservererror)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[errors.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/error/errors.ts#L14)This error should be thrown when some unexpected and exceptional case is encountered.

```
class InternalServerError extends I18nError {    constructor(message: string, variables: { [key: string]: string | number } = {})}
```

- Extends: I18nError

[I18nError](/reference/typescript-api/errors/i18n-error#i18nerror)
### constructor​


[​](#constructor)
## UserInputError​


[​](#userinputerror)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[errors.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/error/errors.ts#L27)This error should be thrown when user input is not as expected.

```
class UserInputError extends I18nError {    constructor(message: string, variables: { [key: string]: string | number } = {})}
```

- Extends: I18nError

[I18nError](/reference/typescript-api/errors/i18n-error#i18nerror)
### constructor​


[​](#constructor-1)
## IllegalOperationError​


[​](#illegaloperationerror)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[errors.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/error/errors.ts#L40)This error should be thrown when an operation is attempted which is not allowed.

```
class IllegalOperationError extends I18nError {    constructor(message: string, variables: { [key: string]: string | number } = {})}
```

- Extends: I18nError

[I18nError](/reference/typescript-api/errors/i18n-error#i18nerror)
### constructor​


[​](#constructor-2)
## UnauthorizedError​


[​](#unauthorizederror)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[errors.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/error/errors.ts#L53)This error should be thrown when the user's authentication credentials do not match.

```
class UnauthorizedError extends I18nError {    constructor()}
```

- Extends: I18nError

[I18nError](/reference/typescript-api/errors/i18n-error#i18nerror)
### constructor​


[​](#constructor-3)
## ForbiddenError​


[​](#forbiddenerror)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[errors.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/error/errors.ts#L67)This error should be thrown when a user attempts to access a resource which is outside of
his or her privileges.

```
class ForbiddenError extends I18nError {    constructor(logLevel: LogLevel = LogLevel.Warn)}
```

- Extends: I18nError

[I18nError](/reference/typescript-api/errors/i18n-error#i18nerror)
### constructor​


[​](#constructor-4)[LogLevel](/reference/typescript-api/logger/log-level#loglevel)
## ChannelNotFoundError​


[​](#channelnotfounderror)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[errors.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/error/errors.ts#L81)This error should be thrown when a Channel cannot be found based on the provided
channel token.

[Channel](/reference/typescript-api/entities/channel#channel)
```
class ChannelNotFoundError extends I18nError {    constructor(token: string)}
```

- Extends: I18nError

[I18nError](/reference/typescript-api/errors/i18n-error#i18nerror)
### constructor​


[​](#constructor-5)
## EntityNotFoundError​


[​](#entitynotfounderror)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[errors.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/error/errors.ts#L95)This error should be thrown when an entity cannot be found in the database, i.e. no entity of
the given entityName (Product, User etc.) exists with the provided id.

```
class EntityNotFoundError extends I18nError {    constructor(entityName: keyof typeof coreEntitiesMap | string, id: ID)}
```

- Extends: I18nError

[I18nError](/reference/typescript-api/errors/i18n-error#i18nerror)
### constructor​


[​](#constructor-6)[ID](/reference/typescript-api/common/id#id)


---

# I18nError


## I18nError​


[​](#i18nerror)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[i18n-error.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/i18n/i18n-error.ts#L18)All errors thrown in the Vendure server must use or extend this error class. This allows the
error message to be translated before being served to the client.

The error messages should be provided in the form of a string key which corresponds to
a key defined in the i18n/messages/<languageCode>.json files.

Note that this class should not be directly used in code, but should be extended by
a more specific Error class.

```
class I18nError extends GraphQLError {    constructor(message: string, variables: { [key: string]: string | number } = {}, code?: string, logLevel: LogLevel = LogLevel.Warn)}
```

- Extends: GraphQLError

### constructor​


[​](#constructor)[LogLevel](/reference/typescript-api/logger/log-level#loglevel)


---

# IsGraphQlErrorResult


## isGraphQlErrorResult​


[​](#isgraphqlerrorresult)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[error-result.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/error/error-result.ts#L71)Returns true if the ErrorResultUnion is actually an ErrorResult type. This is useful when dealing with
certain internal service method that return an ErrorResultUnion.

[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)Example

```
import { isGraphQlErrorResult } from '@vendure/core';// ...const transitionResult = await this.orderService.transitionToState(ctx, order.id, newState);if (isGraphQlErrorResult(transitionResult)) {    // The transition failed with an ErrorResult    throw transitionResult;} else {    // TypeScript will correctly infer the type of `transitionResult` to be `Order`    return transitionResult;}
```

```
function isGraphQlErrorResult<T extends GraphQLErrorResult | U, U = any>(input: T): input is JustErrorResults<T>
```

Parameters

### input​


[​](#input)


---

# BlockingEventHandlerOptions


## BlockingEventHandlerOptions​


[​](#blockingeventhandleroptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[event-bus.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/event-bus.ts#L23)Options for registering a blocking event handler.

```
type BlockingEventHandlerOptions<T extends VendureEvent> = {    event: Type<T> | Array<Type<T>>;    handler: (event: T) => void | Promise<void>;    id: string;    before?: string;    after?: string;}
```

### event​


[​](#event)The event type to which the handler should listen.
Can be a single event type or an array of event types.

### handler​


[​](#handler)The handler function which will be executed when the event is published.
If the handler returns a Promise, the event publishing code will wait for the Promise to resolve
before continuing. Any errors thrown by the handler will cause the event publishing code to fail.

### id​


[​](#id)A unique identifier for the handler. This can then be used to specify the order in which
handlers should be executed using the before and after options in other handlers.

### before​


[​](#before)The ID of another handler which this handler should execute before.

### after​


[​](#after)The ID of another handler which this handler should execute after.


---

# EventBus


## EventBus​


[​](#eventbus)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[event-bus.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/event-bus.ts#L98)The EventBus is used to globally publish events which can then be subscribed to.

Events are published whenever certain actions take place within the Vendure server, for example:

- when a Product is updated (ProductEvent)
- when an Order transitions state (OrderStateTransitionEvent)
- when a Customer registers a new account (AccountRegistrationEvent)

[ProductEvent](/reference/typescript-api/events/event-types#productevent)[OrderStateTransitionEvent](/reference/typescript-api/events/event-types#orderstatetransitionevent)[AccountRegistrationEvent](/reference/typescript-api/events/event-types#accountregistrationevent)Using the EventBus it is possible to subscribe to an take action when these events occur.
This is done with the .ofType() method, which takes an event type and returns an rxjs observable
stream of events:

Example

```
import { OnApplicationBootstrap } from '@nestjs/common';import { EventBus, PluginCommonModule, VendurePlugin } from '@vendure/core';import { filter } from 'rxjs/operators';@VendurePlugin({    imports: [PluginCommonModule]})export class MyPlugin implements OnApplicationBootstrap {  constructor(private eventBus: EventBus) {}  async onApplicationBootstrap() {    this.eventBus      .ofType(OrderStateTransitionEvent)      .pipe(        filter(event => event.toState === 'PaymentSettled'),      )      .subscribe((event) => {        // do some action when this event fires      });  }}
```

```
class EventBus implements OnModuleDestroy {    constructor(transactionSubscriber: TransactionSubscriber)    publish(event: T) => Promise<void>;    ofType(type: Type<T>) => Observable<T>;    filter(predicate: (event: VendureEvent) => boolean) => Observable<T>;    registerBlockingEventHandler(handlerOptions: BlockingEventHandlerOptions<T>) => ;}
```

- Implements: OnModuleDestroy

### constructor​


[​](#constructor)
### publish​


[​](#publish)Publish an event which any subscribers can react to.

Example

```
await eventBus.publish(new SomeEvent());
```

### ofType​


[​](#oftype)Returns an RxJS Observable stream of events of the given type.
If the event contains a RequestContext object, the subscriber
will only get called after any active database transactions are complete.

[RequestContext](/reference/typescript-api/request/request-context#requestcontext)This means that the subscriber function can safely access all updated
data related to the event.

### filter​


[​](#filter)[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)Returns an RxJS Observable stream of events filtered by a custom predicate.
If the event contains a RequestContext object, the subscriber
will only get called after any active database transactions are complete.

[RequestContext](/reference/typescript-api/request/request-context#requestcontext)This means that the subscriber function can safely access all updated
data related to the event.

### registerBlockingEventHandler​


[​](#registerblockingeventhandler)[BlockingEventHandlerOptions](/reference/typescript-api/events/blocking-event-handler-options#blockingeventhandleroptions)Register an event handler function which will be executed when an event of the given type is published,
and will block execution of the code which published the event until the handler has completed.

This is useful when you need assurance that the event handler has successfully completed, and you want
the triggering code to fail if the handler fails.

::: warning
This API should be used with caution, as errors or performance issues in the handler can cause the
associated operation to be slow or fail entirely. For this reason, any handler which takes longer than
100ms to execute will log a warning. Any non-trivial task to be performed in a blocking event handler
should be offloaded to a background job using the JobQueueService.

[JobQueueService](/reference/typescript-api/job-queue/job-queue-service#jobqueueservice)Also, be aware that the handler will be executed in the same database transaction as the code which published
the event (as long as you pass the ctx object from the event to any TransactionalConnection calls).
:::

Example

```
eventBus.registerBlockingEventHandler({  event: OrderStateTransitionEvent,  id: 'my-order-state-transition-handler',  handler: async (event) => {    // perform some synchronous task  }});
```


---

# Event Types


## AccountRegistrationEvent​


[​](#accountregistrationevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[account-registration-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/account-registration-event.ts#L13)This event is fired when a new user registers an account, either as a stand-alone signup or after
placing an order.

```
class AccountRegistrationEvent extends VendureEvent {    constructor(ctx: RequestContext, user: User)}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)
## AccountVerifiedEvent​


[​](#accountverifiedevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[account-verified-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/account-verified-event.ts#L13)This event is fired when a users email address successfully gets verified after
the verifyCustomerAccount mutation was executed.

```
class AccountVerifiedEvent extends VendureEvent {    constructor(ctx: RequestContext, customer: Customer)}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Customer](/reference/typescript-api/entities/customer#customer)
## AdministratorEvent​


[​](#administratorevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[administrator-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/administrator-event.ts#L18)This event is fired whenever a Administrator is added, updated or deleted.

[Administrator](/reference/typescript-api/entities/administrator#administrator)
```
class AdministratorEvent extends VendureEntityEvent<Administrator, AdministratorInputTypes> {    constructor(ctx: RequestContext, entity: Administrator, type: 'created' | 'updated' | 'deleted', input?: AdministratorInputTypes)}
```

- Extends: VendureEntityEvent<Administrator, AdministratorInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[Administrator](/reference/typescript-api/entities/administrator#administrator)
### constructor​


[​](#constructor-2)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Administrator](/reference/typescript-api/entities/administrator#administrator)
## AssetChannelEvent​


[​](#assetchannelevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[asset-channel-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/asset-channel-event.ts#L15)This event is fired whenever an Asset is assigned or removed
From a channel.

[Asset](/reference/typescript-api/entities/asset#asset)
```
class AssetChannelEvent extends VendureEvent {    constructor(ctx: RequestContext, asset: Asset, channelId: ID, type: 'assigned' | 'removed')}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-3)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Asset](/reference/typescript-api/entities/asset#asset)[ID](/reference/typescript-api/common/id#id)
## AssetEvent​


[​](#assetevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[asset-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/asset-event.ts#L18)This event is fired whenever a Asset is added, updated or deleted.

[Asset](/reference/typescript-api/entities/asset#asset)
```
class AssetEvent extends VendureEntityEvent<Asset, AssetInputTypes> {    constructor(ctx: RequestContext, entity: Asset, type: 'created' | 'updated' | 'deleted', input?: AssetInputTypes)    asset: Asset}
```

- Extends: VendureEntityEvent<Asset, AssetInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[Asset](/reference/typescript-api/entities/asset#asset)
### constructor​


[​](#constructor-4)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Asset](/reference/typescript-api/entities/asset#asset)
### asset​


[​](#asset)[Asset](/reference/typescript-api/entities/asset#asset)
## AttemptedLoginEvent​


[​](#attemptedloginevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[attempted-login-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/attempted-login-event.ts#L14)This event is fired when an attempt is made to log in via the shop or admin API login mutation.
The strategy represents the name of the AuthenticationStrategy used in the login attempt.
If the "native" strategy is used, the additional identifier property will be available.

```
class AttemptedLoginEvent extends VendureEvent {    constructor(ctx: RequestContext, strategy: string, identifier?: string)}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-5)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
## ChangeChannelEvent​


[​](#changechannelevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[change-channel-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/change-channel-event.ts#L17)This event is fired whenever an ChannelAware entity is assigned or removed
from a channel. The entity property contains the value before updating the channels.

[ChannelAware](/reference/typescript-api/entities/interfaces#channelaware)
```
class ChangeChannelEvent<T extends ChannelAware & VendureEntity> extends VendureEvent {    constructor(ctx: RequestContext, entity: T, channelIds: ID[], type: 'assigned' | 'removed', entityType?: Type<T>)}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-6)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
## ChannelEvent​


[​](#channelevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[channel-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/channel-event.ts#L18)This event is fired whenever a Channel is added, updated or deleted.

[Channel](/reference/typescript-api/entities/channel#channel)
```
class ChannelEvent extends VendureEntityEvent<Channel, ChannelInputTypes> {    constructor(ctx: RequestContext, entity: Channel, type: 'created' | 'updated' | 'deleted', input?: ChannelInputTypes)}
```

- Extends: VendureEntityEvent<Channel, ChannelInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[Channel](/reference/typescript-api/entities/channel#channel)
### constructor​


[​](#constructor-7)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Channel](/reference/typescript-api/entities/channel#channel)
## CollectionEvent​


[​](#collectionevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[collection-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/collection-event.ts#L18)This event is fired whenever a Collection is added, updated or deleted.

[Collection](/reference/typescript-api/entities/collection#collection)
```
class CollectionEvent extends VendureEntityEvent<Collection, CollectionInputTypes> {    constructor(ctx: RequestContext, entity: Collection, type: 'created' | 'updated' | 'deleted', input?: CollectionInputTypes)}
```

- Extends: VendureEntityEvent<Collection, CollectionInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[Collection](/reference/typescript-api/entities/collection#collection)
### constructor​


[​](#constructor-8)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Collection](/reference/typescript-api/entities/collection#collection)
## CollectionModificationEvent​


[​](#collectionmodificationevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[collection-modification-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/collection-modification-event.ts#L18)This event is fired whenever a Collection is modified in some way. The productVariantIds
argument is an array of ids of all ProductVariants which:

- were part of this collection prior to modification and are no longer
- are now part of this collection after modification but were not before

```
class CollectionModificationEvent extends VendureEvent {    constructor(ctx: RequestContext, collection: Collection, productVariantIds: ID[])}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-9)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Collection](/reference/typescript-api/entities/collection#collection)[ID](/reference/typescript-api/common/id#id)
## CountryEvent​


[​](#countryevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[country-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/country-event.ts#L18)This event is fired whenever a Country is added, updated or deleted.

[Country](/reference/typescript-api/entities/country#country)
```
class CountryEvent extends VendureEntityEvent<Country, CountryInputTypes> {    constructor(ctx: RequestContext, entity: Country, type: 'created' | 'updated' | 'deleted', input?: CountryInputTypes)}
```

- Extends: VendureEntityEvent<Country, CountryInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[Country](/reference/typescript-api/entities/country#country)
### constructor​


[​](#constructor-10)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Country](/reference/typescript-api/entities/country#country)
## CouponCodeEvent​


[​](#couponcodeevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[coupon-code-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/coupon-code-event.ts#L15)This event is fired whenever an coupon code of an active Promotion
is assigned or removed to an Order.

[Promotion](/reference/typescript-api/entities/promotion#promotion)[Order](/reference/typescript-api/entities/order#order)
```
class CouponCodeEvent extends VendureEvent {    constructor(ctx: RequestContext, couponCode: string, orderId: ID, type: 'assigned' | 'removed')}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-11)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
## CustomerAddressEvent​


[​](#customeraddressevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[customer-address-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/customer-address-event.ts#L22)This event is fired whenever a Address is added, updated
or deleted.

[Address](/reference/typescript-api/entities/address#address)
```
class CustomerAddressEvent extends VendureEntityEvent<Address, CustomerAddressInputTypes> {    constructor(ctx: RequestContext, entity: Address, type: 'created' | 'updated' | 'deleted', input?: CustomerAddressInputTypes)    address: Address}
```

- Extends: VendureEntityEvent<Address, CustomerAddressInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[Address](/reference/typescript-api/entities/address#address)
### constructor​


[​](#constructor-12)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Address](/reference/typescript-api/entities/address#address)
### address​


[​](#address)[Address](/reference/typescript-api/entities/address#address)
## CustomerEvent​


[​](#customerevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[customer-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/customer-event.ts#L22)This event is fired whenever a Customer is added, updated
or deleted.

[Customer](/reference/typescript-api/entities/customer#customer)
```
class CustomerEvent extends VendureEntityEvent<Customer, CustomerInputTypes> {    constructor(ctx: RequestContext, entity: Customer, type: 'created' | 'updated' | 'deleted', input?: CustomerInputTypes)    customer: Customer}
```

- Extends: VendureEntityEvent<Customer, CustomerInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[Customer](/reference/typescript-api/entities/customer#customer)
### constructor​


[​](#constructor-13)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Customer](/reference/typescript-api/entities/customer#customer)
### customer​


[​](#customer)[Customer](/reference/typescript-api/entities/customer#customer)
## CustomerGroupChangeEvent​


[​](#customergroupchangeevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[customer-group-change-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/customer-group-change-event.ts#L15)This event is fired whenever one or more Customer is assigned to or removed from a
CustomerGroup.

[Customer](/reference/typescript-api/entities/customer#customer)[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)
```
class CustomerGroupChangeEvent extends VendureEvent {    constructor(ctx: RequestContext, customers: Customer[], customGroup: CustomerGroup, type: 'assigned' | 'removed')}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-14)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Customer](/reference/typescript-api/entities/customer#customer)[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)
## CustomerGroupEvent​


[​](#customergroupevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[customer-group-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/customer-group-event.ts#L18)This event is fired whenever a CustomerGroup is added, updated or deleted.

[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)
```
class CustomerGroupEvent extends VendureEntityEvent<CustomerGroup, CustomerGroupInputTypes> {    constructor(ctx: RequestContext, entity: CustomerGroup, type: 'created' | 'updated' | 'deleted', input?: CustomerGroupInputTypes)}
```

- Extends: VendureEntityEvent<CustomerGroup, CustomerGroupInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)
### constructor​


[​](#constructor-15)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)
## FacetEvent​


[​](#facetevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[facet-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/facet-event.ts#L18)This event is fired whenever a Facet is added, updated or deleted.

[Facet](/reference/typescript-api/entities/facet#facet)
```
class FacetEvent extends VendureEntityEvent<Facet, FacetInputTypes> {    constructor(ctx: RequestContext, entity: Facet, type: 'created' | 'updated' | 'deleted', input?: FacetInputTypes)}
```

- Extends: VendureEntityEvent<Facet, FacetInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[Facet](/reference/typescript-api/entities/facet#facet)
### constructor​


[​](#constructor-16)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Facet](/reference/typescript-api/entities/facet#facet)
## FacetValueEvent​


[​](#facetvalueevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[facet-value-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/facet-value-event.ts#L26)This event is fired whenever a FacetValue is added, updated or deleted.

[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
```
class FacetValueEvent extends VendureEntityEvent<FacetValue, FacetValueInputTypes> {    constructor(ctx: RequestContext, entity: FacetValue, type: 'created' | 'updated' | 'deleted', input?: FacetValueInputTypes)}
```

- Extends: VendureEntityEvent<FacetValue, FacetValueInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
### constructor​


[​](#constructor-17)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
## FulfillmentEvent​


[​](#fulfillmentevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[fulfillment-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/fulfillment-event.ts#L27)This event is fired whenever a Fulfillment is added. The type is always created.

[Fulfillment](/reference/typescript-api/entities/fulfillment#fulfillment)
```
class FulfillmentEvent extends VendureEntityEvent<Fulfillment, CreateFulfillmentInput> {    constructor(ctx: RequestContext, entity: Fulfillment, input?: CreateFulfillmentInput)}
```

- Extends: VendureEntityEvent<Fulfillment, CreateFulfillmentInput>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[Fulfillment](/reference/typescript-api/entities/fulfillment#fulfillment)
### constructor​


[​](#constructor-18)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Fulfillment](/reference/typescript-api/entities/fulfillment#fulfillment)
## FulfillmentStateTransitionEvent​


[​](#fulfillmentstatetransitionevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[fulfillment-state-transition-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/fulfillment-state-transition-event.ts#L13)This event is fired whenever an Fulfillment transitions from one FulfillmentState to another.

[Fulfillment](/reference/typescript-api/entities/fulfillment#fulfillment)[FulfillmentState](/reference/typescript-api/fulfillment/fulfillment-state#fulfillmentstate)
```
class FulfillmentStateTransitionEvent extends VendureEvent {    constructor(fromState: FulfillmentState, toState: FulfillmentState, ctx: RequestContext, fulfillment: Fulfillment)}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-19)[FulfillmentState](/reference/typescript-api/fulfillment/fulfillment-state#fulfillmentstate)[FulfillmentState](/reference/typescript-api/fulfillment/fulfillment-state#fulfillmentstate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Fulfillment](/reference/typescript-api/entities/fulfillment#fulfillment)
## GlobalSettingsEvent​


[​](#globalsettingsevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[global-settings-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/global-settings-event.ts#L16)This event is fired whenever a GlobalSettings is added. The type is always updated, because it's
only created once and never deleted.

[GlobalSettings](/reference/typescript-api/entities/global-settings#globalsettings)
```
class GlobalSettingsEvent extends VendureEntityEvent<GlobalSettings, UpdateGlobalSettingsInput> {    constructor(ctx: RequestContext, entity: GlobalSettings, input?: UpdateGlobalSettingsInput)}
```

- Extends: VendureEntityEvent<GlobalSettings, UpdateGlobalSettingsInput>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[GlobalSettings](/reference/typescript-api/entities/global-settings#globalsettings)
### constructor​


[​](#constructor-20)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[GlobalSettings](/reference/typescript-api/entities/global-settings#globalsettings)
## HistoryEntryEvent​


[​](#historyentryevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[history-entry-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/history-entry-event.ts#L23)This event is fired whenever one HistoryEntry is added, updated or deleted.

[HistoryEntry](/reference/typescript-api/entities/history-entry#historyentry)
```
class HistoryEntryEvent extends VendureEntityEvent<HistoryEntry, HistoryInput> {    public readonly historyType: 'order' | 'customer' | string;    constructor(ctx: RequestContext, entity: HistoryEntry, type: 'created' | 'updated' | 'deleted', historyType: 'order' | 'customer' | string, input?: HistoryInput)}
```

- Extends: VendureEntityEvent<HistoryEntry, HistoryInput>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[HistoryEntry](/reference/typescript-api/entities/history-entry#historyentry)
### historyType​


[​](#historytype)
### constructor​


[​](#constructor-21)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[HistoryEntry](/reference/typescript-api/entities/history-entry#historyentry)
## IdentifierChangeEvent​


[​](#identifierchangeevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[identifier-change-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/identifier-change-event.ts#L13)This event is fired when a registered user successfully changes the identifier (ie email address)
associated with their account.

```
class IdentifierChangeEvent extends VendureEvent {    constructor(ctx: RequestContext, user: User, oldIdentifier: string)}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-22)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)
## IdentifierChangeRequestEvent​


[​](#identifierchangerequestevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[identifier-change-request-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/identifier-change-request-event.ts#L13)This event is fired when a registered user requests to update the identifier (ie email address)
associated with the account.

```
class IdentifierChangeRequestEvent extends VendureEvent {    constructor(ctx: RequestContext, user: User)}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-23)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)
## InitializerEvent​


[​](#initializerevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[initializer-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/initializer-event.ts#L11)This event is fired when vendure finished initializing its services inside the InitializerService

[InitializerService](/reference/typescript-api/services/initializer-service#initializerservice)
```
class InitializerEvent extends VendureEvent {    constructor()}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-24)
## LoginEvent​


[​](#loginevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[login-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/login-event.ts#L12)This event is fired when a user successfully logs in via the shop or admin API login mutation.

```
class LoginEvent extends VendureEvent {    constructor(ctx: RequestContext, user: User)}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-25)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)
## LogoutEvent​


[​](#logoutevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[logout-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/logout-event.ts#L12)This event is fired when a user logs out via the shop or admin API logout mutation.

```
class LogoutEvent extends VendureEvent {    constructor(ctx: RequestContext)}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-26)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
## OrderEvent​


[​](#orderevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/order-event.ts#L17)This event is fired whenever an Order is added, updated
or deleted.

[Order](/reference/typescript-api/entities/order#order)
```
class OrderEvent extends VendureEntityEvent<Order, OrderInputTypes> {    constructor(ctx: RequestContext, order: Order, type: 'created' | 'updated' | 'deleted', input?: OrderInputTypes)    order: Order}
```

- Extends: VendureEntityEvent<Order, OrderInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[Order](/reference/typescript-api/entities/order#order)
### constructor​


[​](#constructor-27)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)
### order​


[​](#order)[Order](/reference/typescript-api/entities/order#order)
## OrderLineEvent​


[​](#orderlineevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-line-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/order-line-event.ts#L13)This event is fired whenever an OrderLine is added, updated
or deleted.

[OrderLine](/reference/typescript-api/entities/order-line#orderline)
```
class OrderLineEvent extends VendureEvent {    constructor(ctx: RequestContext, order: Order, orderLine: OrderLine, type: 'created' | 'updated' | 'deleted' | 'cancelled')}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-28)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[OrderLine](/reference/typescript-api/entities/order-line#orderline)
## OrderPlacedEvent​


[​](#orderplacedevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-placed-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/order-placed-event.ts#L17)This event is fired whenever an Order is set as "placed", which by default is
when it transitions from 'ArrangingPayment' to either 'PaymentAuthorized' or 'PaymentSettled'.

[Order](/reference/typescript-api/entities/order#order)Note that the exact point that it is set as "placed" can be configured according to the
OrderPlacedStrategy.

[OrderPlacedStrategy](/reference/typescript-api/orders/order-placed-strategy#orderplacedstrategy)
```
class OrderPlacedEvent extends VendureEvent {    constructor(fromState: OrderState, toState: OrderState, ctx: RequestContext, order: Order)}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-29)[OrderState](/reference/typescript-api/orders/order-process#orderstate)[OrderState](/reference/typescript-api/orders/order-process#orderstate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)
## OrderStateTransitionEvent​


[​](#orderstatetransitionevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-state-transition-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/order-state-transition-event.ts#L13)This event is fired whenever an Order transitions from one OrderState to another.

[Order](/reference/typescript-api/entities/order#order)[OrderState](/reference/typescript-api/orders/order-process#orderstate)
```
class OrderStateTransitionEvent extends VendureEvent {    constructor(fromState: OrderState, toState: OrderState, ctx: RequestContext, order: Order)}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-30)[OrderState](/reference/typescript-api/orders/order-process#orderstate)[OrderState](/reference/typescript-api/orders/order-process#orderstate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)
## PasswordResetEvent​


[​](#passwordresetevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[password-reset-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/password-reset-event.ts#L12)This event is fired when a Customer requests a password reset email.

```
class PasswordResetEvent extends VendureEvent {    constructor(ctx: RequestContext, user: User)}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-31)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)
## PasswordResetVerifiedEvent​


[​](#passwordresetverifiedevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[password-reset-verified-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/password-reset-verified-event.ts#L13)This event is fired when a password reset is executed with a verified token.

```
class PasswordResetVerifiedEvent extends VendureEvent {    constructor(ctx: RequestContext, user: User)}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-32)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)
## PaymentMethodEvent​


[​](#paymentmethodevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-method-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/payment-method-event.ts#L18)This event is fired whenever a PaymentMethod is added, updated
or deleted.

[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)
```
class PaymentMethodEvent extends VendureEntityEvent<PaymentMethod, PaymentMethodInputTypes> {    constructor(ctx: RequestContext, entity: PaymentMethod, type: 'created' | 'updated' | 'deleted', input?: PaymentMethodInputTypes)}
```

- Extends: VendureEntityEvent<PaymentMethod, PaymentMethodInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)
### constructor​


[​](#constructor-33)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)
## PaymentStateTransitionEvent​


[​](#paymentstatetransitionevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-state-transition-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/payment-state-transition-event.ts#L15)This event is fired whenever a Payment transitions from one PaymentState to another, e.g.
a Payment is authorized by the payment provider.

[Payment](/reference/typescript-api/entities/payment#payment)[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)
```
class PaymentStateTransitionEvent extends VendureEvent {    constructor(fromState: PaymentState, toState: PaymentState, ctx: RequestContext, payment: Payment, order: Order)}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-34)[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Payment](/reference/typescript-api/entities/payment#payment)[Order](/reference/typescript-api/entities/order#order)
## ProductChannelEvent​


[​](#productchannelevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-channel-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/product-channel-event.ts#L15)This event is fired whenever a Product is added, updated
or deleted.

[Product](/reference/typescript-api/entities/product#product)
```
class ProductChannelEvent extends VendureEvent {    constructor(ctx: RequestContext, product: Product, channelId: ID, type: 'assigned' | 'removed')}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-35)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Product](/reference/typescript-api/entities/product#product)[ID](/reference/typescript-api/common/id#id)
## ProductEvent​


[​](#productevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/product-event.ts#L18)This event is fired whenever a Product is added, updated
or deleted.

[Product](/reference/typescript-api/entities/product#product)
```
class ProductEvent extends VendureEntityEvent<Product, ProductInputTypes> {    constructor(ctx: RequestContext, entity: Product, type: 'created' | 'updated' | 'deleted', input?: ProductInputTypes)    product: Product}
```

- Extends: VendureEntityEvent<Product, ProductInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[Product](/reference/typescript-api/entities/product#product)
### constructor​


[​](#constructor-36)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Product](/reference/typescript-api/entities/product#product)
### product​


[​](#product)[Product](/reference/typescript-api/entities/product#product)
## ProductOptionEvent​


[​](#productoptionevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-option-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/product-option-event.ts#L26)This event is fired whenever a ProductOption is added or updated.

[ProductOption](/reference/typescript-api/entities/product-option#productoption)
```
class ProductOptionEvent extends VendureEntityEvent<ProductOption, ProductOptionInputTypes> {    constructor(ctx: RequestContext, entity: ProductOption, type: 'created' | 'updated' | 'deleted', input?: ProductOptionInputTypes)}
```

- Extends: VendureEntityEvent<ProductOption, ProductOptionInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[ProductOption](/reference/typescript-api/entities/product-option#productoption)
### constructor​


[​](#constructor-37)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductOption](/reference/typescript-api/entities/product-option#productoption)
## ProductOptionGroupChangeEvent​


[​](#productoptiongroupchangeevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-option-group-change-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/product-option-group-change-event.ts#L15)This event is fired whenever a ProductOptionGroup is assigned or removed from a Product.

[ProductOptionGroup](/reference/typescript-api/entities/product-option-group#productoptiongroup)[Product](/reference/typescript-api/entities/product#product)
```
class ProductOptionGroupChangeEvent extends VendureEvent {    constructor(ctx: RequestContext, product: Product, optionGroupId: ID, type: 'assigned' | 'removed')}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-38)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Product](/reference/typescript-api/entities/product#product)[ID](/reference/typescript-api/common/id#id)
## ProductOptionGroupEvent​


[​](#productoptiongroupevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-option-group-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/product-option-group-event.ts#L24)This event is fired whenever a ProductOptionGroup is added or updated.

[ProductOptionGroup](/reference/typescript-api/entities/product-option-group#productoptiongroup)
```
class ProductOptionGroupEvent extends VendureEntityEvent<    ProductOptionGroup,    ProductOptionGroupInputTypes> {    constructor(ctx: RequestContext, entity: ProductOptionGroup, type: 'created' | 'updated' | 'deleted', input?: ProductOptionGroupInputTypes)}
```

- Extends: VendureEntityEvent<     ProductOptionGroup,     ProductOptionGroupInputTypes >

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[ProductOptionGroup](/reference/typescript-api/entities/product-option-group#productoptiongroup)
### constructor​


[​](#constructor-39)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductOptionGroup](/reference/typescript-api/entities/product-option-group#productoptiongroup)
## ProductVariantChannelEvent​


[​](#productvariantchannelevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-variant-channel-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/product-variant-channel-event.ts#L14)This event is fired whenever a ProductVariant is assigned or removed from a Channel.

[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[Channel](/reference/typescript-api/entities/channel#channel)
```
class ProductVariantChannelEvent extends VendureEvent {    constructor(ctx: RequestContext, productVariant: ProductVariant, channelId: ID, type: 'assigned' | 'removed')}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-40)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[ID](/reference/typescript-api/common/id#id)
## ProductVariantEvent​


[​](#productvariantevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-variant-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/product-variant-event.ts#L18)This event is fired whenever a ProductVariant is added, updated
or deleted.

[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
```
class ProductVariantEvent extends VendureEntityEvent<ProductVariant[], ProductVariantInputTypes> {    constructor(ctx: RequestContext, entity: ProductVariant[], type: 'created' | 'updated' | 'deleted', input?: ProductVariantInputTypes)    variants: ProductVariant[]}
```

- Extends: VendureEntityEvent<ProductVariant[], ProductVariantInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### constructor​


[​](#constructor-41)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### variants​


[​](#variants)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
## ProductVariantPriceEvent​


[​](#productvariantpriceevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-variant-price-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/product-variant-price-event.ts#L17)This event is fired whenever a ProductVariantPrice is added, updated or deleted.

[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)
```
class ProductVariantPriceEvent extends VendureEntityEvent<    ProductVariantPrice[],    ProductVariantInputTypes> {    constructor(ctx: RequestContext, entity: ProductVariantPrice[], type: 'created' | 'updated' | 'deleted', input?: ProductVariantInputTypes)}
```

- Extends: VendureEntityEvent<     ProductVariantPrice[],     ProductVariantInputTypes >

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)
### constructor​


[​](#constructor-42)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)
## PromotionEvent​


[​](#promotionevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/promotion-event.ts#L18)This event is fired whenever a Promotion is added, updated
or deleted.

[Promotion](/reference/typescript-api/entities/promotion#promotion)
```
class PromotionEvent extends VendureEntityEvent<Promotion, PromotionInputTypes> {    constructor(ctx: RequestContext, entity: Promotion, type: 'created' | 'updated' | 'deleted', input?: PromotionInputTypes)}
```

- Extends: VendureEntityEvent<Promotion, PromotionInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[Promotion](/reference/typescript-api/entities/promotion#promotion)
### constructor​


[​](#constructor-43)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Promotion](/reference/typescript-api/entities/promotion#promotion)
## ProvinceEvent​


[​](#provinceevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[province-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/province-event.ts#L18)This event is fired whenever a Province is added, updated or deleted.

[Province](/reference/typescript-api/entities/province#province)
```
class ProvinceEvent extends VendureEntityEvent<Province, ProvinceInputTypes> {    constructor(ctx: RequestContext, entity: Province, type: 'created' | 'updated' | 'deleted', input?: ProvinceInputTypes)}
```

- Extends: VendureEntityEvent<Province, ProvinceInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[Province](/reference/typescript-api/entities/province#province)
### constructor​


[​](#constructor-44)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Province](/reference/typescript-api/entities/province#province)
## RefundEvent​


[​](#refundevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[refund-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/refund-event.ts#L12)This event is fired whenever a Refund is created

[Refund](/reference/typescript-api/entities/refund#refund)
```
class RefundEvent extends VendureEvent {    constructor(ctx: RequestContext, order: Order, refund: Refund, type: 'created')}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-45)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Refund](/reference/typescript-api/entities/refund#refund)
## RefundStateTransitionEvent​


[​](#refundstatetransitionevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[refund-state-transition-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/refund-state-transition-event.ts#L14)This event is fired whenever a Refund transitions from one RefundState to another.

[Refund](/reference/typescript-api/entities/refund#refund)[RefundState](/reference/typescript-api/payment/refund-state#refundstate)
```
class RefundStateTransitionEvent extends VendureEvent {    constructor(fromState: RefundState, toState: RefundState, ctx: RequestContext, refund: Refund, order: Order)}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-46)[RefundState](/reference/typescript-api/payment/refund-state#refundstate)[RefundState](/reference/typescript-api/payment/refund-state#refundstate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Refund](/reference/typescript-api/entities/refund#refund)[Order](/reference/typescript-api/entities/order#order)
## RoleChangeEvent​


[​](#rolechangeevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[role-change-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/role-change-event.ts#L16)This event is fired whenever one Role is assigned or removed from a user.
The property roleIds only contains the removed or assigned role ids.

[Role](/reference/typescript-api/entities/role#role)
```
class RoleChangeEvent extends VendureEvent {    constructor(ctx: RequestContext, admin: Administrator, roleIds: ID[], type: 'assigned' | 'removed')}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-47)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Administrator](/reference/typescript-api/entities/administrator#administrator)[ID](/reference/typescript-api/common/id#id)
## RoleEvent​


[​](#roleevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[role-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/role-event.ts#L18)This event is fired whenever one Role is added, updated or deleted.

[Role](/reference/typescript-api/entities/role#role)
```
class RoleEvent extends VendureEntityEvent<Role, RoleInputTypes> {    constructor(ctx: RequestContext, entity: Role, type: 'created' | 'updated' | 'deleted', input?: RoleInputTypes)}
```

- Extends: VendureEntityEvent<Role, RoleInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[Role](/reference/typescript-api/entities/role#role)
### constructor​


[​](#constructor-48)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Role](/reference/typescript-api/entities/role#role)
## SearchEvent​


[​](#searchevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[search-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/search-event.ts#L18)This event is fired whenever a search query is executed.

```
class SearchEvent extends VendureEvent {    constructor(ctx: RequestContext, input: ExtendedSearchInput)}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-49)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
## SellerEvent​


[​](#sellerevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[seller-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/seller-event.ts#L19)This event is fired whenever one Seller is added, updated or deleted.

[Seller](/reference/typescript-api/entities/seller#seller)
```
class SellerEvent extends VendureEntityEvent<Seller, SellerInputTypes> {    constructor(ctx: RequestContext, entity: Seller, type: 'created' | 'updated' | 'deleted', input?: SellerInputTypes)}
```

- Extends: VendureEntityEvent<Seller, SellerInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[Seller](/reference/typescript-api/entities/seller#seller)
### constructor​


[​](#constructor-50)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Seller](/reference/typescript-api/entities/seller#seller)
## ShippingMethodEvent​


[​](#shippingmethodevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[shipping-method-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/shipping-method-event.ts#L18)This event is fired whenever a ShippingMethod is added, updated
or deleted.

[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)
```
class ShippingMethodEvent extends VendureEntityEvent<ShippingMethod, ShippingMethodInputTypes> {    constructor(ctx: RequestContext, entity: ShippingMethod, type: 'created' | 'updated' | 'deleted', input?: ShippingMethodInputTypes)}
```

- Extends: VendureEntityEvent<ShippingMethod, ShippingMethodInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)
### constructor​


[​](#constructor-51)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)
## StockLocationEvent​


[​](#stocklocationevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[stock-location-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/stock-location-event.ts#L18)This event is fired whenever a StockLocation is added, updated
or deleted.

[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)
```
class StockLocationEvent extends VendureEntityEvent<StockLocation, StockLocationInputTypes> {    constructor(ctx: RequestContext, entity: StockLocation, type: 'created' | 'updated' | 'deleted', input?: StockLocationInputTypes)}
```

- Extends: VendureEntityEvent<StockLocation, StockLocationInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)
### constructor​


[​](#constructor-52)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)
## StockMovementEvent​


[​](#stockmovementevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[stock-movement-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/stock-movement-event.ts#L16)This event is fired whenever a StockMovement entity is created, which occurs when the saleable
stock level of a ProductVariant is altered due to things like sales, manual adjustments, and cancellations.

[StockMovement](/reference/typescript-api/entities/stock-movement#stockmovement)
```
class StockMovementEvent extends VendureEvent {    public readonly type: StockMovementType;    constructor(ctx: RequestContext, stockMovements: StockMovement[])}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### type​


[​](#type)
### constructor​


[​](#constructor-53)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[StockMovement](/reference/typescript-api/entities/stock-movement#stockmovement)
## TaxCategoryEvent​


[​](#taxcategoryevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[tax-category-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/tax-category-event.ts#L18)This event is fired whenever a TaxCategory is added, updated
or deleted.

[TaxCategory](/reference/typescript-api/entities/tax-category#taxcategory)
```
class TaxCategoryEvent extends VendureEntityEvent<TaxCategory, TaxCategoryInputTypes> {    constructor(ctx: RequestContext, entity: TaxCategory, type: 'created' | 'updated' | 'deleted', input?: TaxCategoryInputTypes)}
```

- Extends: VendureEntityEvent<TaxCategory, TaxCategoryInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[TaxCategory](/reference/typescript-api/entities/tax-category#taxcategory)
### constructor​


[​](#constructor-54)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[TaxCategory](/reference/typescript-api/entities/tax-category#taxcategory)
## TaxRateEvent​


[​](#taxrateevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[tax-rate-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/tax-rate-event.ts#L18)This event is fired whenever a TaxRate is added, updated
or deleted.

[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)
```
class TaxRateEvent extends VendureEntityEvent<TaxRate, TaxRateInputTypes> {    constructor(ctx: RequestContext, entity: TaxRate, type: 'created' | 'updated' | 'deleted', input?: TaxRateInputTypes)}
```

- Extends: VendureEntityEvent<TaxRate, TaxRateInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)
### constructor​


[​](#constructor-55)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)
## TaxRateModificationEvent​


[​](#taxratemodificationevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[tax-rate-modification-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/tax-rate-modification-event.ts#L13)This event is fired whenever a TaxRate is changed

```
class TaxRateModificationEvent extends VendureEvent {    constructor(ctx: RequestContext, taxRate: TaxRate)}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-56)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)
## ZoneEvent​


[​](#zoneevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[zone-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/zone-event.ts#L18)This event is fired whenever a Zone is added, updated
or deleted.

[Zone](/reference/typescript-api/entities/zone#zone)
```
class ZoneEvent extends VendureEntityEvent<Zone, ZoneInputTypes> {    constructor(ctx: RequestContext, entity: Zone, type: 'created' | 'updated' | 'deleted', input?: ZoneInputTypes)}
```

- Extends: VendureEntityEvent<Zone, ZoneInputTypes>

[VendureEntityEvent](/reference/typescript-api/events/vendure-entity-event#vendureentityevent)[Zone](/reference/typescript-api/entities/zone#zone)
### constructor​


[​](#constructor-57)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Zone](/reference/typescript-api/entities/zone#zone)
## ZoneMembersEvent​


[​](#zonemembersevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[zone-members-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/events/zone-members-event.ts#L15)This event is fired whenever a Zone gets Country members assigned or removed
The entity property contains the zone with the already updated member field.

[Zone](/reference/typescript-api/entities/zone#zone)[Country](/reference/typescript-api/entities/country#country)
```
class ZoneMembersEvent extends VendureEvent {    constructor(ctx: RequestContext, entity: Zone, type: 'assigned' | 'removed', memberIds: ID[])}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### constructor​


[​](#constructor-58)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Zone](/reference/typescript-api/entities/zone#zone)[ID](/reference/typescript-api/common/id#id)


---

# VendureEntityEvent


## VendureEntityEvent​


[​](#vendureentityevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-entity-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/vendure-entity-event.ts#L12)The base class for all entity events used by the EventBus system.

- For event type 'deleted' the input will most likely be an id: ID

```
class VendureEntityEvent<Entity, Input = any> extends VendureEvent {    public readonly entity: Entity;    public readonly type: 'created' | 'updated' | 'deleted';    public readonly ctx: RequestContext;    public readonly input?: Input;    constructor(entity: Entity, type: 'created' | 'updated' | 'deleted', ctx: RequestContext, input?: Input)}
```

- Extends: VendureEvent

[VendureEvent](/reference/typescript-api/events/vendure-event#vendureevent)
### entity​


[​](#entity)
### type​


[​](#type)
### ctx​


[​](#ctx)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### input​


[​](#input)
### constructor​


[​](#constructor)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)


---

# VendureEvent


## VendureEvent​


[​](#vendureevent)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-event.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/event-bus/vendure-event.ts#L7)The base class for all events used by the EventBus system.

```
class VendureEvent {    public readonly createdAt: Date;    constructor()}
```

### createdAt​


[​](#createdat)
### constructor​


[​](#constructor)


---

# FulfillmentHandler


## FulfillmentHandler​


[​](#fulfillmenthandler)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[fulfillment-handler.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/fulfillment/fulfillment-handler.ts#L149)A FulfillmentHandler is used when creating a new Fulfillment. When the addFulfillmentToOrder mutation
is executed, the specified handler will be used and it's createFulfillment method is called. This method
may perform async tasks such as calling a 3rd-party shipping API to register a new shipment and receive
a tracking code. This data can then be returned and will be incorporated into the created Fulfillment.

[Fulfillment](/reference/typescript-api/entities/fulfillment#fulfillment)If the args property is defined, this means that arguments passed to the addFulfillmentToOrder mutation
will be passed through to the createFulfillment method as the last argument.

Example

```
let shipomatic;export const shipomaticFulfillmentHandler = new FulfillmentHandler({  code: 'ship-o-matic',  description: [{    languageCode: LanguageCode.en,    value: 'Generate tracking codes via the Ship-o-matic API'  }],  args: {    preferredService: {      type: 'string',      ui: {        component: 'select-form-input',        options: [          { value: 'first_class' },          { value: 'priority'},          { value: 'standard' },        ],      },    }  },  init: () => {    // some imaginary shipping service    shipomatic = new ShipomaticClient(API_KEY);  },  createFulfillment: async (ctx, orders, lines, args) => {     const shipment = getShipmentFromOrders(orders, lines);     try {       const transaction = await shipomatic.transaction.create({         shipment,         service_level: args.preferredService,         label_file_type: 'png',       })       return {         method: `Ship-o-matic ${args.preferredService}`,         trackingCode: transaction.tracking_code,         customFields: {           shippingTransactionId: transaction.id,         }       };     } catch (e: any) {       // Errors thrown from within this function will       // result in a CreateFulfillmentError being returned       throw e;     }  },  onFulfillmentTransition: async (fromState, toState, { fulfillment }) => {    if (toState === 'Cancelled') {      await shipomatic.transaction.cancel({        transaction_id: fulfillment.customFields.shippingTransactionId,      });    }  }});
```

```
class FulfillmentHandler<T extends ConfigArgs = ConfigArgs> extends ConfigurableOperationDef<T> {    constructor(config: FulfillmentHandlerConfig<T>)}
```

- Extends: ConfigurableOperationDef<T>

[ConfigurableOperationDef](/reference/typescript-api/configurable-operation-def/#configurableoperationdef)
### constructor​


[​](#constructor)[FulfillmentHandlerConfig](/reference/typescript-api/fulfillment/fulfillment-handler#fulfillmenthandlerconfig)
## FulfillmentHandlerConfig​


[​](#fulfillmenthandlerconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[fulfillment-handler.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/fulfillment/fulfillment-handler.ts#L48)The configuration object used to instantiate a FulfillmentHandler.

[FulfillmentHandler](/reference/typescript-api/fulfillment/fulfillment-handler#fulfillmenthandler)
```
interface FulfillmentHandlerConfig<T extends ConfigArgs> extends ConfigurableOperationDefOptions<T> {    createFulfillment: CreateFulfillmentFn<T>;    onFulfillmentTransition?: OnTransitionStartFn<FulfillmentState, FulfillmentTransitionData>;}
```

- Extends: ConfigurableOperationDefOptions<T>

[ConfigurableOperationDefOptions](/reference/typescript-api/configurable-operation-def/configurable-operation-def-options#configurableoperationdefoptions)
### createFulfillment​


[​](#createfulfillment)[CreateFulfillmentFn](/reference/typescript-api/fulfillment/fulfillment-handler#createfulfillmentfn)Invoked when the addFulfillmentToOrder mutation is executed with this handler selected.

If an Error is thrown from within this function, no Fulfillment is created and the CreateFulfillmentError
result will be returned.

### onFulfillmentTransition​


[​](#onfulfillmenttransition)[OnTransitionStartFn](/reference/typescript-api/state-machine/state-machine-config#ontransitionstartfn)[FulfillmentState](/reference/typescript-api/fulfillment/fulfillment-state#fulfillmentstate)[FulfillmentTransitionData](/reference/typescript-api/fulfillment/fulfillment-transition-data#fulfillmenttransitiondata)This allows the handler to intercept state transitions of the created Fulfillment. This works much in the
same way as the FulfillmentProcess onTransitionStart method (i.e. returning false or
string will be interpreted as an error and prevent the state transition), except that it is only invoked
on Fulfillments which were created with this particular FulfillmentHandler.

[FulfillmentProcess](/reference/typescript-api/fulfillment/fulfillment-process#fulfillmentprocess)It can be useful e.g. to intercept Fulfillment cancellations and relay that information to a 3rd-party
shipping API.

## CreateFulfillmentFn​


[​](#createfulfillmentfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[fulfillment-handler.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/fulfillment/fulfillment-handler.ts#L33)The function called when creating a new Fulfillment

```
type CreateFulfillmentFn<T extends ConfigArgs> = (    ctx: RequestContext,    orders: Order[],    lines: OrderLineInput[],    args: ConfigArgValues<T>,) => CreateFulfillmentResult | Promise<CreateFulfillmentResult>
```

## CreateFulfillmentResult​


[​](#createfulfillmentresult)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[fulfillment-handler.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/fulfillment/fulfillment-handler.ts#L23)
```
type CreateFulfillmentResult = Partial<Pick<Fulfillment, 'trackingCode' | 'method' | 'customFields'>>
```


---

# FulfillmentProcess


## defaultFulfillmentProcess​


[​](#defaultfulfillmentprocess)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-fulfillment-process.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/fulfillment/default-fulfillment-process.ts#L45)The default FulfillmentProcess. This process includes the following actions:

[FulfillmentProcess](/reference/typescript-api/fulfillment/fulfillment-process#fulfillmentprocess)- Executes the configured FulfillmentHandler.onFulfillmentTransition() before any state
transition.
- On cancellation of a Fulfillment, creates the necessary Cancellation & Allocation
stock movement records.
- When a Fulfillment transitions from the Created to Pending state, the necessary
Sale stock movements are created.

[Cancellation](/reference/typescript-api/entities/stock-movement#cancellation)[Allocation](/reference/typescript-api/entities/stock-movement#allocation)[Sale](/reference/typescript-api/entities/stock-movement#sale)
## FulfillmentProcess​


[​](#fulfillmentprocess)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[fulfillment-process.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/fulfillment/fulfillment-process.ts#L26)A FulfillmentProcess is used to define the way the fulfillment process works as in: what states a Fulfillment can be
in, and how it may transition from one state to another. Using the onTransitionStart() hook, a
FulfillmentProcess can perform checks before allowing a state transition to occur, and the onTransitionEnd()
hook allows logic to be executed after a state change.

For detailed description of the interface members, see the StateMachineConfig docs.

[StateMachineConfig](/reference/typescript-api/state-machine/state-machine-config#statemachineconfig)
```
interface FulfillmentProcess<State extends keyof CustomFulfillmentStates | string> extends InjectableStrategy {    transitions?: Transitions<State, State | FulfillmentState> &        Partial<Transitions<FulfillmentState | State>>;    onTransitionStart?: OnTransitionStartFn<State | FulfillmentState, FulfillmentTransitionData>;    onTransitionEnd?: OnTransitionEndFn<State | FulfillmentState, FulfillmentTransitionData>;    onTransitionError?: OnTransitionErrorFn<State | FulfillmentState>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### transitions​


[​](#transitions)[Transitions](/reference/typescript-api/state-machine/transitions#transitions)[FulfillmentState](/reference/typescript-api/fulfillment/fulfillment-state#fulfillmentstate)[Transitions](/reference/typescript-api/state-machine/transitions#transitions)[FulfillmentState](/reference/typescript-api/fulfillment/fulfillment-state#fulfillmentstate)
### onTransitionStart​


[​](#ontransitionstart)[OnTransitionStartFn](/reference/typescript-api/state-machine/state-machine-config#ontransitionstartfn)[FulfillmentState](/reference/typescript-api/fulfillment/fulfillment-state#fulfillmentstate)[FulfillmentTransitionData](/reference/typescript-api/fulfillment/fulfillment-transition-data#fulfillmenttransitiondata)
### onTransitionEnd​


[​](#ontransitionend)[OnTransitionEndFn](/reference/typescript-api/state-machine/state-machine-config#ontransitionendfn)[FulfillmentState](/reference/typescript-api/fulfillment/fulfillment-state#fulfillmentstate)[FulfillmentTransitionData](/reference/typescript-api/fulfillment/fulfillment-transition-data#fulfillmenttransitiondata)
### onTransitionError​


[​](#ontransitionerror)[OnTransitionErrorFn](/reference/typescript-api/state-machine/state-machine-config#ontransitionerrorfn)[FulfillmentState](/reference/typescript-api/fulfillment/fulfillment-state#fulfillmentstate)


---

# FulfillmentState


## FulfillmentState​


[​](#fulfillmentstate)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[fulfillment-state.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/fulfillment-state-machine/fulfillment-state.ts#L29)These are the default states of the fulfillment process. By default, they will be extended
by the defaultFulfillmentProcess to also include Shipped and Delivered.

[defaultFulfillmentProcess](/reference/typescript-api/fulfillment/fulfillment-process#defaultfulfillmentprocess)
```
type FulfillmentState = | 'Created'    | 'Pending'    | 'Cancelled'    | keyof CustomFulfillmentStates    | keyof FulfillmentStates
```

---

# FulfillmentStates


## FulfillmentStates​


[​](#fulfillmentstates)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[fulfillment-state.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/fulfillment-state-machine/fulfillment-state.ts#L19)An interface to extend standard FulfillmentState.

[FulfillmentState](/reference/typescript-api/fulfillment/fulfillment-state#fulfillmentstate)
```
interface FulfillmentStates {}
```


---

# FulfillmentTransitionData


## FulfillmentTransitionData​


[​](#fulfillmenttransitiondata)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[fulfillment-state.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/fulfillment-state-machine/fulfillment-state.ts#L42)The data which is passed to the state transition handler of the FulfillmentStateMachine.

```
interface FulfillmentTransitionData {    ctx: RequestContext;    orders: Order[];    fulfillment: Fulfillment;}
```

### ctx​


[​](#ctx)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### orders​


[​](#orders)[Order](/reference/typescript-api/entities/order#order)
### fulfillment​


[​](#fulfillment)[Fulfillment](/reference/typescript-api/entities/fulfillment#fulfillment)


---

# HealthCheckRegistryService


## HealthCheckRegistryService​


[​](#healthcheckregistryservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[health-check-registry.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/health-check/health-check-registry.service.ts#L47)This service is used to register health indicator functions to be included in the
health check. Health checks can be used by automated services such as Kubernetes
to determine the state of applications it is running. They are also useful for
administrators to get an overview of the health of all the parts of the
Vendure stack.

It wraps the Nestjs Terminus module,
so see those docs for information on creating custom health checks.

[Nestjs Terminus module](https://docs.nestjs.com/recipes/terminus)Plugins which rely on external services (web services, databases etc.) can make use of this
service to add a check for that dependency to the Vendure health check.

Since v1.6.0, the preferred way to implement a custom health check is by creating a new HealthCheckStrategy
and then passing it to the systemOptions.healthChecks array.
See the HealthCheckStrategy docs for an example configuration.

[HealthCheckStrategy](/reference/typescript-api/health-check/health-check-strategy#healthcheckstrategy)[HealthCheckStrategy](/reference/typescript-api/health-check/health-check-strategy#healthcheckstrategy)The alternative way to register a health check is by injecting this service directly into your
plugin module. To use it in your plugin, you'll need to import the PluginCommonModule:

[PluginCommonModule](/reference/typescript-api/plugin/plugin-common-module#plugincommonmodule)Example

```
import { HealthCheckRegistryService, PluginCommonModule, VendurePlugin } from '@vendure/core';import { TerminusModule } from '@nestjs/terminus';@VendurePlugin({  imports: [PluginCommonModule, TerminusModule],})export class MyPlugin {  constructor(    private registry: HealthCheckRegistryService    private httpIndicator: HttpHealthIndicator  ) {    registry.registerIndicatorFunction(      () => this.httpIndicator.pingCheck('vendure-docs', 'https://www.vendure.io/docs/'),    )  }}
```

```
class HealthCheckRegistryService {    registerIndicatorFunction(fn: HealthIndicatorFunction | HealthIndicatorFunction[]) => ;}
```

### registerIndicatorFunction​


[​](#registerindicatorfunction)Registers one or more HealthIndicatorFunctions (see Nestjs docs)
to be added to the health check endpoint.
The indicator will also appear in the Admin UI's "system status" view.

[Nestjs docs](https://docs.nestjs.com/recipes/terminus#setting-up-a-healthcheck)


---

# HealthCheckStrategy


## HealthCheckStrategy​


[​](#healthcheckstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[health-check-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/system/health-check-strategy.ts#L48)This strategy defines health checks which are included as part of the
/health endpoint. They should only be used to monitor critical systems
on which proper functioning of the Vendure server depends.

For more information on the underlying mechanism, see the
NestJS Terminus module docs.

[NestJS Terminus module docs](https://docs.nestjs.com/recipes/terminus)Custom strategies should be added to the systemOptions.healthChecks array.
By default, Vendure includes the TypeORMHealthCheckStrategy, so if you set the value of the healthChecks
array, be sure to include it manually.

Vendure also ships with the HttpHealthCheckStrategy, which is convenient
for adding a health check dependent on an HTTP ping.

[HttpHealthCheckStrategy](/reference/typescript-api/health-check/http-health-check-strategy#httphealthcheckstrategy)This is configured via the systemOptions.healthChecks property of
your VendureConfig.

Example

```
import { HttpHealthCheckStrategy, TypeORMHealthCheckStrategy } from '@vendure/core';import { MyCustomHealthCheckStrategy } from './config/custom-health-check-strategy';export const config = {  // ...  systemOptions: {    healthChecks: [      new TypeORMHealthCheckStrategy(),      new HttpHealthCheckStrategy({ key: 'my-service', url: 'https://my-service.com' }),      new MyCustomHealthCheckStrategy(),    ],  },};
```

```
interface HealthCheckStrategy extends InjectableStrategy {    getHealthIndicator(): HealthIndicatorFunction;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### getHealthIndicator​


[​](#gethealthindicator)Should return a HealthIndicatorFunction, as defined by the
NestJS Terminus module.

[NestJS Terminus module](https://docs.nestjs.com/recipes/terminus)


---

# HttpHealthCheckStrategy


## HttpHealthCheckStrategy​


[​](#httphealthcheckstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[http-health-check-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/health-check/http-health-check-strategy.ts#L37)A HealthCheckStrategy used to check health by pinging a url. Internally it uses
the NestJS HttpHealthIndicator.

[HealthCheckStrategy](/reference/typescript-api/health-check/health-check-strategy#healthcheckstrategy)[NestJS HttpHealthIndicator](https://docs.nestjs.com/recipes/terminus#http-healthcheck)Example

```
import { HttpHealthCheckStrategy, TypeORMHealthCheckStrategy } from '@vendure/core';export const config = {  // ...  systemOptions: {    healthChecks: [      new TypeORMHealthCheckStrategy(),      new HttpHealthCheckStrategy({ key: 'my-service', url: 'https://my-service.com' }),    ]  },};
```

```
class HttpHealthCheckStrategy implements HealthCheckStrategy {    constructor(options: HttpHealthCheckOptions)    init(injector: Injector) => ;    getHealthIndicator() => HealthIndicatorFunction;}
```

- Implements: HealthCheckStrategy

[HealthCheckStrategy](/reference/typescript-api/health-check/health-check-strategy#healthcheckstrategy)
### constructor​


[​](#constructor)
### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)
### getHealthIndicator​


[​](#gethealthindicator)


---

# TypeORMHealthCheckStrategy


## TypeORMHealthCheckStrategy​


[​](#typeormhealthcheckstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[typeorm-health-check-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/health-check/typeorm-health-check-strategy.ts#L38)A HealthCheckStrategy used to check the health of the database. This health
check is included by default, but can be customized by explicitly adding it to the
systemOptions.healthChecks array:

[HealthCheckStrategy](/reference/typescript-api/health-check/health-check-strategy#healthcheckstrategy)Example

```
import { TypeORMHealthCheckStrategy } from '@vendure/core';export const config = {  // ...  systemOptions: {    healthChecks:[        // The default key is "database" and the default timeout is 1000ms        // Sometimes this is too short and leads to false negatives in the        // /health endpoint.        new TypeORMHealthCheckStrategy({ key: 'postgres-db', timeout: 5000 }),    ]  }}
```

```
class TypeORMHealthCheckStrategy implements HealthCheckStrategy {    constructor(options?: TypeORMHealthCheckOptions)    init(injector: Injector) => ;    getHealthIndicator() => HealthIndicatorFunction;}
```

- Implements: HealthCheckStrategy

[HealthCheckStrategy](/reference/typescript-api/health-check/health-check-strategy#healthcheckstrategy)
### constructor​


[​](#constructor)
### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)
### getHealthIndicator​


[​](#gethealthindicator)

---

# AssetImportStrategy


## AssetImportStrategy​


[​](#assetimportstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[asset-import-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/asset-import-strategy/asset-import-strategy.ts#L25)The AssetImportStrategy determines how asset files get imported based on the path given in the
import CSV or via the AssetImporter getAssets() method.

[AssetImporter](/reference/typescript-api/import-export/asset-importer#assetimporter)The DefaultAssetImportStrategy is able to load files from either the local filesystem
or from a remote URL.

[DefaultAssetImportStrategy](/reference/typescript-api/import-export/default-asset-import-strategy#defaultassetimportstrategy)A custom strategy could be created which could e.g. get the asset file from an S3 bucket.

This is configured via the importExportOptions.assetImportStrategy property of
your VendureConfig.

```
interface AssetImportStrategy extends InjectableStrategy {    getStreamFromPath(assetPath: string): Readable | Promise<Readable>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### getStreamFromPath​


[​](#getstreamfrompath)Given an asset path, this method should return a Stream of file data. This could
e.g. be read from a file system or fetch from a remote location.


---

# AssetImporter


## AssetImporter​


[​](#assetimporter)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[asset-importer.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/data-import/providers/asset-importer/asset-importer.ts#L17)This service creates new Asset entities based on string paths provided in the CSV
import format. The source files are resolved by joining the value of importExportOptions.importAssetsDir
with the asset path. This service is used internally by the Importer service.

[Asset](/reference/typescript-api/entities/asset#asset)[Importer](/reference/typescript-api/import-export/importer#importer)
```
class AssetImporter {    getAssets(assetPaths: string[], ctx?: RequestContext) => Promise<{ assets: Asset[]; errors: string[] }>;}
```

### getAssets​


[​](#getassets)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Asset](/reference/typescript-api/entities/asset#asset)Creates Asset entities for the given paths, using the assetMap cache to prevent the
creation of duplicates.


---

# DefaultAssetImportStrategy


## DefaultAssetImportStrategy​


[​](#defaultassetimportstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-asset-import-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/asset-import-strategy/default-asset-import-strategy.ts#L50)The DefaultAssetImportStrategy is able to import paths from the local filesystem (taking into account the
importExportOptions.importAssetsDir setting) as well as remote http/https urls.

```
class DefaultAssetImportStrategy implements AssetImportStrategy {    constructor(options?: {            retryDelayMs: number;            retryCount: number;        })    init(injector: Injector) => ;    getStreamFromPath(assetPath: string) => ;}
```

- Implements: AssetImportStrategy

[AssetImportStrategy](/reference/typescript-api/import-export/asset-import-strategy#assetimportstrategy)
### constructor​


[​](#constructor)
### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)
### getStreamFromPath​


[​](#getstreamfrompath)


---

# FastImporterService


## FastImporterService​


[​](#fastimporterservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[fast-importer.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/data-import/providers/importer/fast-importer.service.ts#L41)A service to import entities into the database. This replaces the regular create methods of the service layer with faster
versions which skip much of the defensive checks and other DB calls which are not needed when running an import. It also
does not publish any events, so e.g. will not trigger search index jobs.

In testing, the use of the FastImporterService approximately doubled the speed of bulk imports.

```
class FastImporterService {    initialize(channel?: Channel) => ;    createProduct(input: CreateProductInput) => Promise<ID>;    createProductOptionGroup(input: CreateProductOptionGroupInput) => Promise<ID>;    createProductOption(input: CreateProductOptionInput) => Promise<ID>;    addOptionGroupToProduct(productId: ID, optionGroupId: ID) => ;    createProductVariant(input: CreateProductVariantInput) => Promise<ID>;}
```

### initialize​


[​](#initialize)[Channel](/reference/typescript-api/entities/channel#channel)This should be called prior to any of the import methods, as it establishes the
default Channel as well as the context in which the new entities will be created.

Passing a channel argument means that Products and ProductVariants will be assigned
to that Channel.

### createProduct​


[​](#createproduct)[ID](/reference/typescript-api/common/id#id)
### createProductOptionGroup​


[​](#createproductoptiongroup)[ID](/reference/typescript-api/common/id#id)
### createProductOption​


[​](#createproductoption)[ID](/reference/typescript-api/common/id#id)
### addOptionGroupToProduct​


[​](#addoptiongrouptoproduct)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)
### createProductVariant​


[​](#createproductvariant)[ID](/reference/typescript-api/common/id#id)


---


# ImportExportOptions


## ImportExportOptions​


[​](#importexportoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts#L936)Options related to importing & exporting data.

```
interface ImportExportOptions {    importAssetsDir?: string;    assetImportStrategy?: AssetImportStrategy;}
```

### importAssetsDir​


[​](#importassetsdir)The directory in which assets to be imported are located.

### assetImportStrategy​


[​](#assetimportstrategy)[AssetImportStrategy](/reference/typescript-api/import-export/asset-import-strategy#assetimportstrategy)This strategy determines how asset files get imported based on the path given in the
import CSV or via the AssetImporter getAssets() method.

[AssetImporter](/reference/typescript-api/import-export/asset-importer#assetimporter)


---

# ImportParser


## ImportParser​


[​](#importparser)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[import-parser.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/data-import/providers/import-parser/import-parser.ts#L152)Validates and parses CSV files into a data structure which can then be used to created new entities.
This is used internally by the Importer.

[Importer](/reference/typescript-api/import-export/importer#importer)
```
class ImportParser {    parseProducts(input: string | Stream, mainLanguage: LanguageCode = this.configService.defaultLanguageCode) => Promise<ParseResult<ParsedProductWithVariants>>;}
```

### parseProducts​


[​](#parseproducts)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)[ParseResult](/reference/typescript-api/import-export/import-parser#parseresult)[ParsedProductWithVariants](/reference/typescript-api/import-export/import-parser#parsedproductwithvariants)Parses the contents of the product import CSV file and
returns a data structure which can then be used to populate Vendure using the FastImporterService.

[product import CSV file](/guides/developer-guide/importing-data/#product-import-format)[FastImporterService](/reference/typescript-api/import-export/fast-importer-service#fastimporterservice)
## ParsedOptionGroup​


[​](#parsedoptiongroup)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[import-parser.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/data-import/providers/import-parser/import-parser.ts#L45)The intermediate representation of an OptionGroup after it has been parsed
by the ImportParser.

[ImportParser](/reference/typescript-api/import-export/import-parser#importparser)
```
interface ParsedOptionGroup {    translations: Array<{        languageCode: LanguageCode;        name: string;        values: string[];    }>;}
```

### translations​


[​](#translations)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)
## ParsedFacet​


[​](#parsedfacet)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[import-parser.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/data-import/providers/import-parser/import-parser.ts#L61)The intermediate representation of a Facet after it has been parsed
by the ImportParser.

[ImportParser](/reference/typescript-api/import-export/import-parser#importparser)
```
interface ParsedFacet {    translations: Array<{        languageCode: LanguageCode;        facet: string;        value: string;    }>;}
```

### translations​


[​](#translations-1)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)
## ParsedProductVariant​


[​](#parsedproductvariant)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[import-parser.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/data-import/providers/import-parser/import-parser.ts#L77)The intermediate representation of a ProductVariant after it has been parsed
by the ImportParser.

[ImportParser](/reference/typescript-api/import-export/import-parser#importparser)
```
interface ParsedProductVariant {    sku: string;    price: number;    taxCategory: string;    stockOnHand: number;    trackInventory: GlobalFlag;    assetPaths: string[];    facets: ParsedFacet[];    translations: Array<{        languageCode: LanguageCode;        optionValues: string[];        customFields: {            [name: string]: string;        };    }>;}
```

### sku​


[​](#sku)
### price​


[​](#price)
### taxCategory​


[​](#taxcategory)
### stockOnHand​


[​](#stockonhand)
### trackInventory​


[​](#trackinventory)
### assetPaths​


[​](#assetpaths)
### facets​


[​](#facets)[ParsedFacet](/reference/typescript-api/import-export/import-parser#parsedfacet)
### translations​


[​](#translations-2)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)
## ParsedProduct​


[​](#parsedproduct)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[import-parser.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/data-import/providers/import-parser/import-parser.ts#L102)The intermediate representation of a Product after it has been parsed
by the ImportParser.

[ImportParser](/reference/typescript-api/import-export/import-parser#importparser)
```
interface ParsedProduct {    assetPaths: string[];    optionGroups: ParsedOptionGroup[];    facets: ParsedFacet[];    translations: Array<{        languageCode: LanguageCode;        name: string;        slug: string;        description: string;        customFields: {            [name: string]: string;        };    }>;}
```

### assetPaths​


[​](#assetpaths-1)
### optionGroups​


[​](#optiongroups)[ParsedOptionGroup](/reference/typescript-api/import-export/import-parser#parsedoptiongroup)
### facets​


[​](#facets-1)[ParsedFacet](/reference/typescript-api/import-export/import-parser#parsedfacet)
### translations​


[​](#translations-3)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)
## ParsedProductWithVariants​


[​](#parsedproductwithvariants)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[import-parser.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/data-import/providers/import-parser/import-parser.ts#L125)The data structure into which an import CSV file is parsed by the
ImportParser parseProducts() method.

[ImportParser](/reference/typescript-api/import-export/import-parser#importparser)
```
interface ParsedProductWithVariants {    product: ParsedProduct;    variants: ParsedProductVariant[];}
```

### product​


[​](#product)[ParsedProduct](/reference/typescript-api/import-export/import-parser#parsedproduct)
### variants​


[​](#variants)[ParsedProductVariant](/reference/typescript-api/import-export/import-parser#parsedproductvariant)
## ParseResult​


[​](#parseresult)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[import-parser.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/data-import/providers/import-parser/import-parser.ts#L137)The result returned by the ImportParser parseProducts() method.

[ImportParser](/reference/typescript-api/import-export/import-parser#importparser)
```
interface ParseResult<T> {    results: T[];    errors: string[];    processed: number;}
```

### results​


[​](#results)
### errors​


[​](#errors)
### processed​


[​](#processed)


---

# Importer


## Importer​


[​](#importer)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[importer.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/data-import/providers/importer/importer.ts#L42)Parses and imports Products using the CSV import format.

Internally it is using the ImportParser to parse the CSV file, and then the
FastImporterService and the AssetImporter to actually create the resulting
entities in the Vendure database.

[ImportParser](/reference/typescript-api/import-export/import-parser#importparser)[FastImporterService](/reference/typescript-api/import-export/fast-importer-service#fastimporterservice)[AssetImporter](/reference/typescript-api/import-export/asset-importer#assetimporter)
```
class Importer {    parseAndImport(input: string | Stream, ctxOrLanguageCode: RequestContext | LanguageCode, reportProgress: boolean = false) => Observable<ImportProgress>;    importProducts(ctx: RequestContext, rows: ParsedProductWithVariants[], onProgress: OnProgressFn) => Promise<string[]>;    getFacetValueIds(ctx: RequestContext, facets: ParsedFacet[], languageCode: LanguageCode) => Promise<ID[]>;    processCustomFieldValues(customFields: { [field: string]: string }, config: CustomFieldConfig[]) => ;}
```

### parseAndImport​


[​](#parseandimport)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)Parses the contents of the product import CSV file and imports
the resulting Product & ProductVariants, as well as any associated Assets, Facets & FacetValues.

[product import CSV file](/guides/developer-guide/importing-data/#product-import-format)The ctxOrLanguageCode argument is used to specify the languageCode to be used when creating the Products.

### importProducts​


[​](#importproducts)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ParsedProductWithVariants](/reference/typescript-api/import-export/import-parser#parsedproductwithvariants)Imports the products specified in the rows object. Return an array of error messages.

### getFacetValueIds​


[​](#getfacetvalueids)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ParsedFacet](/reference/typescript-api/import-export/import-parser#parsedfacet)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)[ID](/reference/typescript-api/common/id#id)
### processCustomFieldValues​


[​](#processcustomfieldvalues)[CustomFieldConfig](/reference/typescript-api/custom-fields/custom-field-config#customfieldconfig)


---

# InitialData


## InitialData​


[​](#initialdata)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/data-import/types.ts#L47)An object defining initial settings for a new Vendure installation.

```
interface InitialData {    defaultLanguage: LanguageCode;    defaultZone: string;    roles?: RoleDefinition[];    countries: CountryDefinition[];    taxRates: Array<{ name: string; percentage: number }>;    shippingMethods: Array<{ name: string; price: number; taxRate?: number }>;    paymentMethods: Array<{ name: string; handler: ConfigurableOperationInput }>;    collections: CollectionDefinition[];}
```

### defaultLanguage​


[​](#defaultlanguage)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)
### defaultZone​


[​](#defaultzone)
### roles​


[​](#roles)
### countries​


[​](#countries)
### taxRates​


[​](#taxrates)
### shippingMethods​


[​](#shippingmethods)
### paymentMethods​


[​](#paymentmethods)
### collections​


[​](#collections)


---

# Populate


## populate​


[​](#populate)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[populate.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/cli/populate.ts#L51)Populates the Vendure server with some initial data and (optionally) product data from
a supplied CSV file. The format of the CSV file is described in the section
Importing Product Data.

[Importing Product Data](/guides/developer-guide/importing-data/)If the channelOrToken argument is provided, all ChannelAware entities (Products, ProductVariants,
Assets, ShippingMethods, PaymentMethods etc.) will be assigned to the specified Channel.
The argument can be either a Channel object or a valid channel token.

Internally the populate() function does the following:

- Uses the Populator to populate the InitialData.
- If productsCsvPath is provided, uses Importer to populate Product data.
- Uses Populator to populate collections specified in the InitialData.

[Populator](/reference/typescript-api/import-export/populator#populator)[InitialData](/reference/typescript-api/import-export/initial-data#initialdata)[Importer](/reference/typescript-api/import-export/importer#importer)[Populator](/reference/typescript-api/import-export/populator#populator)[InitialData](/reference/typescript-api/import-export/initial-data#initialdata)Example

```
import { bootstrap } from '@vendure/core';import { populate } from '@vendure/core/cli';import { config } from './vendure-config.ts'import { initialData } from './my-initial-data.ts';const productsCsvFile = path.join(__dirname, 'path/to/products.csv')populate(  () => bootstrap(config),  initialData,  productsCsvFile,).then(app => app.close()).then(  () => process.exit(0),  err => {    console.log(err);    process.exit(1);  },);
```

```
function populate<T extends INestApplicationContext>(bootstrapFn: () => Promise<T | undefined>, initialDataPathOrObject: string | object, productsCsvPath?: string, channelOrToken?: string | import('@vendure/core').Channel): Promise<T>
```

Parameters

### bootstrapFn​


[​](#bootstrapfn)
### initialDataPathOrObject​


[​](#initialdatapathorobject)
### productsCsvPath​


[​](#productscsvpath)
### channelOrToken​


[​](#channelortoken)[Channel](/reference/typescript-api/entities/channel#channel)


---

# Populator


## Populator​


[​](#populator)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[populator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/data-import/providers/populator/populator.ts#L46)Responsible for populating the database with InitialData, i.e. non-product data such as countries, tax rates,
shipping methods, payment methods & roles.

[InitialData](/reference/typescript-api/import-export/initial-data#initialdata)
```
class Populator {    populateInitialData(data: InitialData, channel?: Channel) => ;    populateCollections(data: InitialData, channel?: Channel) => ;}
```

### populateInitialData​


[​](#populateinitialdata)[InitialData](/reference/typescript-api/import-export/initial-data#initialdata)[Channel](/reference/typescript-api/entities/channel#channel)Should be run before populating the products, so that there are TaxRates by which
product prices can be set. If the channel argument is set, then any ChannelAwareentities will be assigned to that Channel.

[ChannelAware](/reference/typescript-api/entities/interfaces#channelaware)
### populateCollections​


[​](#populatecollections)[InitialData](/reference/typescript-api/import-export/initial-data#initialdata)[Channel](/reference/typescript-api/entities/channel#channel)Should be run after the products have been populated, otherwise the expected FacetValues will not
yet exist.


---

# JobQueue


## JobQueue​


[​](#jobqueue)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[job-queue.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/job-queue/job-queue.ts#L21)A JobQueue is used to process Jobs. A job is added to the queue via the
.add() method, and the configured JobQueueStrategy will check for new jobs and process each
according to the defined process function.

[Job](/reference/typescript-api/job-queue/job#job)[JobQueueStrategy](/reference/typescript-api/job-queue/job-queue-strategy#jobqueuestrategy)Note: JobQueue instances should not be directly instantiated. Rather, the
JobQueueService createQueue() method should be used (see that service
for example usage).

[JobQueueService](/reference/typescript-api/job-queue/job-queue-service#jobqueueservice)
```
class JobQueue<Data extends JobData<Data> = object> {    name: string    started: boolean    constructor(options: CreateQueueOptions<Data>, jobQueueStrategy: JobQueueStrategy, jobBufferService: JobBufferService)    add(data: Data, options?: JobOptions<Data>) => Promise<SubscribableJob<Data>>;}
```

### name​


[​](#name)
### started​


[​](#started)
### constructor​


[​](#constructor)[CreateQueueOptions](/reference/typescript-api/job-queue/types#createqueueoptions)[JobQueueStrategy](/reference/typescript-api/job-queue/job-queue-strategy#jobqueuestrategy)
### add​


[​](#add)[SubscribableJob](/reference/typescript-api/job-queue/subscribable-job#subscribablejob)Adds a new Job to the queue. The resolved SubscribableJob allows the
calling code to subscribe to updates to the Job:

[Job](/reference/typescript-api/job-queue/job#job)[SubscribableJob](/reference/typescript-api/job-queue/subscribable-job#subscribablejob)Example

```
const job = await this.myQueue.add({ intervalMs, shouldFail }, { retries: 2 });return job.updates().pipe(  map(update => {    // The returned Observable will emit a value for every update to the job    // such as when the `progress` or `status` value changes.    Logger.info(`Job ${update.id}: progress: ${update.progress}`);    if (update.state === JobState.COMPLETED) {      Logger.info(`COMPLETED ${update.id}: ${update.result}`);    }    return update.result;  }),  catchError(err => of(err.message)),);
```

Alternatively, if you aren't interested in the intermediate
progress changes, you can convert to a Promise like this:

Example

```
const job = await this.myQueue.add({ intervalMs, shouldFail }, { retries: 2 });return job.updates().toPromise()  .then(update => update.result),  .catch(err => err.message);
```


---

# DefaultJobQueuePlugin


## DefaultJobQueuePlugin​


[​](#defaultjobqueueplugin)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-job-queue-plugin.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/default-job-queue-plugin/default-job-queue-plugin.ts#L127)A plugin which configures Vendure to use the SQL database to persist the JobQueue jobs using the SqlJobQueueStrategy. If you add this
plugin to an existing Vendure installation, you'll need to run a database migration, since this
plugin will add a new "job_record" table to the database.

[SqlJobQueueStrategy](/reference/typescript-api/job-queue/sql-job-queue-strategy#sqljobqueuestrategy)[database migration](/guides/developer-guide/migrations)Example

```
import { DefaultJobQueuePlugin, VendureConfig } from '@vendure/core';export const config: VendureConfig = {  // Add an instance of the plugin to the plugins array  plugins: [    DefaultJobQueuePlugin,  ],};
```

## Configuration​


[​](#configuration)It is possible to configure the behaviour of the SqlJobQueueStrategy by passing options to the static init() function:

[SqlJobQueueStrategy](/reference/typescript-api/job-queue/sql-job-queue-strategy#sqljobqueuestrategy)
### pollInterval​


[​](#pollinterval)The interval in ms between polling for new jobs. The default is 200ms.
Using a longer interval reduces load on the database but results in a slight
delay in processing jobs. For more control, it is possible to supply a function which can specify
a pollInterval based on the queue name:

Example

```
export const config: VendureConfig = {  plugins: [    DefaultJobQueuePlugin.init({      pollInterval: queueName => {        if (queueName === 'cart-recovery-email') {          // This queue does not need to be polled so frequently,          // so we set a longer interval in order to reduce load          // on the database.          return 10000;        }        return 200;      },    }),  ],};
```

### concurrency​


[​](#concurrency)The number of jobs to process concurrently per worker. Defaults to 1.

### backoffStrategy​


[​](#backoffstrategy)Defines the backoff strategy used when retrying failed jobs. In other words, if a job fails
and is configured to be re-tried, how long should we wait before the next attempt?

By default, a job will be retried as soon as possible, but in some cases this is not desirable. For example,
a job may interact with an unreliable 3rd-party API which is sensitive to too many requests. In this case, an
exponential backoff may be used which progressively increases the delay between each subsequent retry.

Example

```
export const config: VendureConfig = {  plugins: [    DefaultJobQueuePlugin.init({      pollInterval: 5000,      concurrency: 2      backoffStrategy: (queueName, attemptsMade, job) => {        if (queueName === 'transcode-video') {          // exponential backoff example          return (attemptsMade ** 2) * 1000;        }        // A default delay for all other queues        return 1000;      },      setRetries: (queueName, job) => {        if (queueName === 'send-email') {          // Override the default number of retries          // for the 'send-email' job because we have          // a very unreliable email service.          return 10;        }        return job.retries;      }    }),  ],};
```

### Removing old jobs​


[​](#removing-old-jobs)Since v3.3, the job queue will automatically remove old jobs from the database. This is done by a scheduled task
which runs every 2 hours by default. The number of jobs to keep in the database can be configured using the
keepJobsCount option. The default is 1000.

Example

```
export const config: VendureConfig = {  plugins: [    DefaultJobQueuePlugin.init({      // The number of completed/failed/cancelled      // jobs to keep in the database. The default is 1000.      keepJobsCount: 100,      // The interval at which to run the clean-up task.      // This can be a standard cron expression or a function      // that returns a cron expression. The default is every 2 hours.      cleanJobsSchedule: cron => cron.every(5).hours(),    }),  ],};
```

```
class DefaultJobQueuePlugin {    init(options: DefaultJobQueueOptions) => Type<DefaultJobQueuePlugin>;}
```

### init​


[​](#init)[DefaultJobQueueOptions](/reference/typescript-api/job-queue/default-job-queue-plugin#defaultjobqueueoptions)[DefaultJobQueuePlugin](/reference/typescript-api/job-queue/default-job-queue-plugin#defaultjobqueueplugin)
## cleanJobsTask​


[​](#cleanjobstask)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[clean-jobs-task.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/default-job-queue-plugin/clean-jobs-task.ts#L18)A ScheduledTask that cleans up old jobs from the database when using the DefaultJobQueuePlugin.
You can configure the settings & schedule of the task via the DefaultJobQueuePlugin options.

[ScheduledTask](/reference/typescript-api/scheduled-tasks/scheduled-task#scheduledtask)[DefaultJobQueuePlugin](/reference/typescript-api/job-queue/default-job-queue-plugin#defaultjobqueueplugin)
## DefaultJobQueueOptions​


[​](#defaultjobqueueoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/default-job-queue-plugin/types.ts#L12)Configuration options for the DefaultJobQueuePlugin. These values get passed into the
SqlJobQueueStrategy.

[SqlJobQueueStrategy](/reference/typescript-api/job-queue/sql-job-queue-strategy#sqljobqueuestrategy)
```
interface DefaultJobQueueOptions {    pollInterval?: number | ((queueName: string) => number);    concurrency?: number;    backoffStrategy?: BackoffStrategy;    setRetries?: (queueName: string, job: Job) => number;    useDatabaseForBuffer?: boolean;    gracefulShutdownTimeout?: number;    keepJobsCount?: number;    cleanJobsSchedule?: ScheduledTaskConfig['schedule'];}
```

### pollInterval​


[​](#pollinterval-1)The interval in ms between polling the database for new jobs. If many job queues
are active, the polling may cause undue load on the database, in which case this value
should be increased to e.g. 1000.

### concurrency​


[​](#concurrency-1)How many jobs from a given queue to process concurrently.

### backoffStrategy​


[​](#backoffstrategy-1)[BackoffStrategy](/reference/typescript-api/job-queue/types#backoffstrategy)The strategy used to decide how long to wait before retrying a failed job.

### setRetries​


[​](#setretries)[Job](/reference/typescript-api/job-queue/job#job)When a job is added to the JobQueue using JobQueue.add(), the calling
code may specify the number of retries in case of failure. This option allows
you to override that number and specify your own number of retries based on
the job being added.

Example

```
setRetries: (queueName, job) => {  if (queueName === 'send-email') {    // Override the default number of retries    // for the 'send-email' job because we have    // a very unreliable email service.    return 10;  }  return job.retries;}
```

### useDatabaseForBuffer​


[​](#usedatabaseforbuffer)If set to true, the database will be used to store buffered jobs. This is
recommended for production.

When enabled, a new JobRecordBuffer database entity will be defined which will
require a migration when first enabling this option.

### gracefulShutdownTimeout​


[​](#gracefulshutdowntimeout)The timeout in ms which the queue will use when attempting a graceful shutdown.
That means when the server is shut down but a job is running, the job queue will
wait for the job to complete before allowing the server to shut down. If the job
does not complete within this timeout window, the job will be forced to stop
and the server will shut down anyway.

### keepJobsCount​


[​](#keepjobscount)The number of completed/failed jobs to keep in the database. This is useful for
debugging and auditing purposes, but if you have a lot of jobs, it may be
desirable to limit the number of records in the database.

### cleanJobsSchedule​


[​](#cleanjobsschedule)[ScheduledTaskConfig](/reference/typescript-api/scheduled-tasks/scheduled-task#scheduledtaskconfig)The schedule for the "clean-jobs" task. This task will run periodically to clean up
old jobs from the database. The schedule can be a cron expression or a function
that returns a cron expression.


---

# InMemoryJobBufferStorageStrategy


## InMemoryJobBufferStorageStrategy​


[​](#inmemoryjobbufferstoragestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[in-memory-job-buffer-storage-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/job-queue/job-buffer/in-memory-job-buffer-storage-strategy.ts#L17)A JobBufferStorageStrategy which keeps the buffered jobs in memory. Should
not be used in production, since it will lose data in the event of the server
stopping.

[JobBufferStorageStrategy](/reference/typescript-api/job-queue/job-buffer-storage-strategy#jobbufferstoragestrategy)Instead, use the DefaultJobQueuePlugin with the useDatabaseForBuffer: true option set,
or the BullMQJobQueuePlugin or another custom strategy with persistent storage.

[DefaultJobQueuePlugin](/reference/typescript-api/job-queue/default-job-queue-plugin#defaultjobqueueplugin)[BullMQJobQueuePlugin](/reference/core-plugins/job-queue-plugin/bull-mqjob-queue-plugin#bullmqjobqueueplugin)
```
class InMemoryJobBufferStorageStrategy implements JobBufferStorageStrategy {    protected bufferStorage = new Map<string, Set<Job>>();    add(bufferId: string, job: Job) => Promise<Job>;    bufferSize(bufferIds?: string[]) => Promise<{ [bufferId: string]: number }>;    flush(bufferIds?: string[]) => Promise<{ [bufferId: string]: Job[] }>;}
```

- Implements: JobBufferStorageStrategy

[JobBufferStorageStrategy](/reference/typescript-api/job-queue/job-buffer-storage-strategy#jobbufferstoragestrategy)
### bufferStorage​


[​](#bufferstorage)
### add​


[​](#add)[Job](/reference/typescript-api/job-queue/job#job)[Job](/reference/typescript-api/job-queue/job#job)
### bufferSize​


[​](#buffersize)
### flush​


[​](#flush)[Job](/reference/typescript-api/job-queue/job#job)


---

# InMemoryJobQueueStrategy


## InMemoryJobQueueStrategy​


[​](#inmemoryjobqueuestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[in-memory-job-queue-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/job-queue/in-memory-job-queue-strategy.ts#L42)An in-memory JobQueueStrategy. This is the default strategy if not using a dedicated
JobQueue plugin (e.g. DefaultJobQueuePlugin). Not recommended for production, since
the queue will be cleared when the server stops, and can only be used when the JobQueueService is
started from the main server process:

[JobQueueStrategy](/reference/typescript-api/job-queue/job-queue-strategy#jobqueuestrategy)[DefaultJobQueuePlugin](/reference/typescript-api/job-queue/default-job-queue-plugin#defaultjobqueueplugin)Example

```
bootstrap(config)  .then(app => app.get(JobQueueService).start());
```

Attempting to use this strategy when running the worker in a separate process (using bootstrapWorker())
will result in an error on startup.

Completed jobs will be evicted from the store every 2 hours to prevent a memory leak.

```
class InMemoryJobQueueStrategy extends PollingJobQueueStrategy implements InspectableJobQueueStrategy {    protected jobs = new Map<ID, Job>();    protected unsettledJobs: { [queueName: string]: Array<{ job: Job; updatedAt: Date }> } = {};    init(injector: Injector) => ;    destroy() => ;    add(job: Job<Data>) => Promise<Job<Data>>;    findOne(id: ID) => Promise<Job | undefined>;    findMany(options?: JobListOptions) => Promise<PaginatedList<Job>>;    findManyById(ids: ID[]) => Promise<Job[]>;    next(queueName: string, waitingJobs: Job[] = []) => Promise<Job | undefined>;    update(job: Job) => Promise<void>;    removeSettledJobs(queueNames: string[] = [], olderThan?: Date) => Promise<number>;}
```

- Extends: PollingJobQueueStrategy
- Implements: InspectableJobQueueStrategy

Extends: PollingJobQueueStrategy

[PollingJobQueueStrategy](/reference/typescript-api/job-queue/polling-job-queue-strategy#pollingjobqueuestrategy)Implements: InspectableJobQueueStrategy

[InspectableJobQueueStrategy](/reference/typescript-api/job-queue/inspectable-job-queue-strategy#inspectablejobqueuestrategy)
### jobs​


[​](#jobs)
### unsettledJobs​


[​](#unsettledjobs)[Job](/reference/typescript-api/job-queue/job#job)
### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)
### destroy​


[​](#destroy)
### add​


[​](#add)[Job](/reference/typescript-api/job-queue/job#job)[Job](/reference/typescript-api/job-queue/job#job)
### findOne​


[​](#findone)[ID](/reference/typescript-api/common/id#id)[Job](/reference/typescript-api/job-queue/job#job)
### findMany​


[​](#findmany)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Job](/reference/typescript-api/job-queue/job#job)
### findManyById​


[​](#findmanybyid)[ID](/reference/typescript-api/common/id#id)[Job](/reference/typescript-api/job-queue/job#job)
### next​


[​](#next)[Job](/reference/typescript-api/job-queue/job#job)[Job](/reference/typescript-api/job-queue/job#job)
### update​


[​](#update)[Job](/reference/typescript-api/job-queue/job#job)
### removeSettledJobs​


[​](#removesettledjobs)


---

# InspectableJobQueueStrategy


## InspectableJobQueueStrategy​


[​](#inspectablejobqueuestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[inspectable-job-queue-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/job-queue/inspectable-job-queue-strategy.ts#L14)Defines a job queue strategy that can be inspected using the default admin ui

```
interface InspectableJobQueueStrategy extends JobQueueStrategy {    findOne(id: ID): Promise<Job | undefined>;    findMany(options?: JobListOptions): Promise<PaginatedList<Job>>;    findManyById(ids: ID[]): Promise<Job[]>;    removeSettledJobs(queueNames?: string[], olderThan?: Date): Promise<number>;    cancelJob(jobId: ID): Promise<Job | undefined>;}
```

- Extends: JobQueueStrategy

[JobQueueStrategy](/reference/typescript-api/job-queue/job-queue-strategy#jobqueuestrategy)
### findOne​


[​](#findone)[ID](/reference/typescript-api/common/id#id)[Job](/reference/typescript-api/job-queue/job#job)Returns a job by its id.

### findMany​


[​](#findmany)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Job](/reference/typescript-api/job-queue/job#job)Returns a list of jobs according to the specified options.

### findManyById​


[​](#findmanybyid)[ID](/reference/typescript-api/common/id#id)[Job](/reference/typescript-api/job-queue/job#job)Returns an array of jobs for the given ids.

### removeSettledJobs​


[​](#removesettledjobs)Remove all settled jobs in the specified queues older than the given date.
If no queueName is passed, all queues will be considered. If no olderThan
date is passed, all jobs older than the current time will be removed.

Returns a promise of the number of jobs removed.

### cancelJob​


[​](#canceljob)[ID](/reference/typescript-api/common/id#id)[Job](/reference/typescript-api/job-queue/job#job)


---

# JobBufferStorageStrategy


## JobBufferStorageStrategy​


[​](#jobbufferstoragestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[job-buffer-storage-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/job-queue/job-buffer/job-buffer-storage-strategy.ts#L19)This strategy defines where to store jobs that have been collected by a
JobBuffer.

[JobBuffer](/reference/typescript-api/job-queue/job-buffer#jobbuffer)This is configured via the jobQueueOptions.jobBufferStorageStrategy property of
your VendureConfig.

```
interface JobBufferStorageStrategy extends InjectableStrategy {    add(bufferId: string, job: Job): Promise<Job>;    bufferSize(bufferIds?: string[]): Promise<{ [bufferId: string]: number }>;    flush(bufferIds?: string[]): Promise<{ [bufferId: string]: Job[] }>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### add​


[​](#add)[Job](/reference/typescript-api/job-queue/job#job)[Job](/reference/typescript-api/job-queue/job#job)Persist a job to the storage medium. The storage format should
take into account the bufferId argument, as it is necessary to be
able to later retrieve jobs by that id.

### bufferSize​


[​](#buffersize)Returns an object containing the number of buffered jobs arranged by bufferId.

Passing bufferIds limits the results to the specified bufferIds.
If the array is empty, sizes will be returned for all bufferIds.

Example

```
const sizes = await myJobBufferStrategy.bufferSize(['buffer-1', 'buffer-2']);// sizes = { 'buffer-1': 12, 'buffer-2': 3 }
```

### flush​


[​](#flush)[Job](/reference/typescript-api/job-queue/job#job)Clears all jobs from the storage medium which match the specified bufferIds (if the
array is empty, clear for all bufferIds), and returns those jobs in an object
arranged by bufferId

Example

```
const result = await myJobBufferStrategy.flush(['buffer-1', 'buffer-2']);// result = {//   'buffer-1': [Job, Job, Job, ...],//   'buffer-2': [Job, Job, Job, ...],// };
```


---

# JobBuffer


## JobBuffer​


[​](#jobbuffer)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[job-buffer.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/job-queue/job-buffer/job-buffer.ts#L83)A JobBuffer is used to temporarily prevent jobs from being sent to the job queue for processing.
Instead, it collects certain jobs (as specified by the collect() method), and stores them.

How these buffered jobs are stored is determined by the configured JobBufferStorageStrategy.

[JobBufferStorageStrategy](/reference/typescript-api/job-queue/job-buffer-storage-strategy#jobbufferstoragestrategy)The JobBuffer can be thought of as a kind of "interceptor" of jobs. That is, when a JobBuffer is active,
it sits in between calls to JobQueue.add() and the actual adding of the job to the queue.

At some later point, the buffer can be flushed (by calling JobQueue.flush()), at which point all the jobs
that were collected into the buffer will be removed from the buffer and passed to the JobBuffer.reduce() method.
This method is able to perform additional logic to e.g. aggregate many jobs into a single job in order to de-duplicate
work.

Example

```
// This is a buffer which will collect all the// 'apply-collection-filters' jobs and buffer them.export class CollectionJobBuffer implements JobBuffer<ApplyCollectionFiltersJobData> {  readonly id = 'apply-collection-filters-buffer';  collect(job: Job): boolean {    return job.queueName === 'apply-collection-filters';  }  // When the buffer gets flushed, this function will be passed all the collected jobs  // and will reduce them down to a single job that has aggregated all of the collectionIds.  reduce(collectedJobs: Array<Job<ApplyCollectionFiltersJobData>>): Array<Job<any>> {    // Concatenate all the collectionIds from all the events that were buffered    const collectionIdsToUpdate = collectedJobs.reduce((result, job) => {      return [...result, ...job.data.collectionIds];    }, [] as ID[]);    const referenceJob = collectedJobs[0];    // Create a new Job containing all the concatenated collectionIds,    // de-duplicated to include each collectionId only once.    const batchedCollectionJob = new Job<ApplyCollectionFiltersJobData>({      ...referenceJob,      id: undefined,      data: {        collectionIds: unique(collectionIdsToUpdate),        ctx: referenceJob.data.ctx,        applyToChangedVariantsOnly: referenceJob.data.applyToChangedVariantsOnly,      },    });    // Only this single job will get added to the job queue    return [batchedCollectionJob];  }}
```

A JobBuffer is used by adding it to the JobQueueService, at which point it will become active
and start collecting jobs.

[JobQueueService](/reference/typescript-api/job-queue/job-queue-service#jobqueueservice)At some later point, the buffer can be flushed, causing the buffered jobs to be passed through the
reduce() method and sent to the job queue.

Example

```
const collectionBuffer = new CollectionJobBuffer();await this.jobQueueService.addBuffer(collectionBuffer);// Here you can perform some work which would ordinarily// trigger the 'apply-collection-filters' job, such as updating// collection filters or changing ProductVariant prices.await this.jobQueueService.flush(collectionBuffer);await this.jobQueueService.removeBuffer(collectionBuffer);
```

```
interface JobBuffer<Data extends JobData<Data> = object> {    readonly id: string;    collect(job: Job<Data>): boolean | Promise<boolean>;    reduce(collectedJobs: Array<Job<Data>>): Array<Job<Data>> | Promise<Array<Job<Data>>>;}
```

### id​


[​](#id)
### collect​


[​](#collect)[Job](/reference/typescript-api/job-queue/job#job)This method is called whenever a job is added to the job queue. If it returns true, then
the job will be buffered and not added to the job queue. If it returns false, the job
will be added to the job queue as normal.

### reduce​


[​](#reduce)[Job](/reference/typescript-api/job-queue/job#job)[Job](/reference/typescript-api/job-queue/job#job)[Job](/reference/typescript-api/job-queue/job#job)This method is called whenever the buffer gets flushed via a call to JobQueueService.flush().
It allows logic to be run on the buffered jobs which enables optimizations such as
aggregating and de-duplicating the work of many jobs into one job.


---

# JobQueueOptions


## JobQueueOptions​


[​](#jobqueueoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts#L960)Options related to the built-in job queue.

```
interface JobQueueOptions {    jobQueueStrategy?: JobQueueStrategy;    jobBufferStorageStrategy?: JobBufferStorageStrategy;    activeQueues?: string[];    prefix?: string;}
```

### jobQueueStrategy​


[​](#jobqueuestrategy)[JobQueueStrategy](/reference/typescript-api/job-queue/job-queue-strategy#jobqueuestrategy)[InMemoryJobQueueStrategy](/reference/typescript-api/job-queue/in-memory-job-queue-strategy#inmemoryjobqueuestrategy)Defines how the jobs in the queue are persisted and accessed.

### jobBufferStorageStrategy​


[​](#jobbufferstoragestrategy)[JobBufferStorageStrategy](/reference/typescript-api/job-queue/job-buffer-storage-strategy#jobbufferstoragestrategy)
### activeQueues​


[​](#activequeues)Defines the queues that will run in this process.
This can be used to configure only certain queues to run in this process.
If its empty all queues will be run. Note: this option is primarily intended
to apply to the Worker process. Jobs will always get published to the queue
regardless of this setting, but this setting determines whether they get
processed or not.

### prefix​


[​](#prefix)Prefixes all job queue names with the passed string. This is useful with multiple deployments
in cloud environments using services such as Amazon SQS or Google Cloud Tasks.

For example, we might have a staging and a production deployment in the same account/project and
each one will need its own task queue. We can achieve this with a prefix.


---

# JobQueueService


## JobQueueService​


[​](#jobqueueservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[job-queue.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/job-queue/job-queue.service.ts#L49)The JobQueueService is used to create new JobQueue instances and access
existing jobs.

[JobQueue](/reference/typescript-api/job-queue/#jobqueue)Example

```
// A service which transcodes video filesclass VideoTranscoderService {  private jobQueue: JobQueue<{ videoId: string; }>;  async onModuleInit() {    // The JobQueue is created on initialization    this.jobQueue = await this.jobQueueService.createQueue({      name: 'transcode-video',      process: async job => {        return await this.transcodeVideo(job.data.videoId);      },    });  }  addToTranscodeQueue(videoId: string) {    this.jobQueue.add({ videoId, })  }  private async transcodeVideo(videoId: string) {    // e.g. call some external transcoding service  }}
```

```
class JobQueueService implements OnModuleDestroy {    constructor(configService: ConfigService, jobBufferService: JobBufferService)    createQueue(options: CreateQueueOptions<Data>) => Promise<JobQueue<Data>>;    start() => Promise<void>;    addBuffer(buffer: JobBuffer<any>) => ;    removeBuffer(buffer: JobBuffer<any>) => ;    bufferSize(forBuffers: Array<JobBuffer<any> | string>) => Promise<{ [bufferId: string]: number }>;    flush(forBuffers: Array<JobBuffer<any> | string>) => Promise<Job[]>;    getJobQueues() => GraphQlJobQueue[];}
```

- Implements: OnModuleDestroy

### constructor​


[​](#constructor)
### createQueue​


[​](#createqueue)[CreateQueueOptions](/reference/typescript-api/job-queue/types#createqueueoptions)[JobQueue](/reference/typescript-api/job-queue/#jobqueue)Configures and creates a new JobQueue instance.

[JobQueue](/reference/typescript-api/job-queue/#jobqueue)
### start​


[​](#start)
### addBuffer​


[​](#addbuffer)[JobBuffer](/reference/typescript-api/job-queue/job-buffer#jobbuffer)Adds a JobBuffer, which will make it active and begin collecting
jobs to buffer.

[JobBuffer](/reference/typescript-api/job-queue/job-buffer#jobbuffer)
### removeBuffer​


[​](#removebuffer)[JobBuffer](/reference/typescript-api/job-queue/job-buffer#jobbuffer)Removes a JobBuffer, prevent it from collecting and buffering any
subsequent jobs.

[JobBuffer](/reference/typescript-api/job-queue/job-buffer#jobbuffer)
### bufferSize​


[​](#buffersize)[JobBuffer](/reference/typescript-api/job-queue/job-buffer#jobbuffer)Returns an object containing the number of buffered jobs arranged by bufferId. This
can be used to decide whether a particular buffer has any jobs to flush.

Passing in JobBuffer instances or ids limits the results to the specified JobBuffers.
If no argument is passed, sizes will be returned for all JobBuffers.

Example

```
const sizes = await this.jobQueueService.bufferSize('buffer-1', 'buffer-2');// sizes = { 'buffer-1': 12, 'buffer-2': 3 }
```

### flush​


[​](#flush)[JobBuffer](/reference/typescript-api/job-queue/job-buffer#jobbuffer)[Job](/reference/typescript-api/job-queue/job#job)Flushes the specified buffers, which means that the buffer is cleared and the jobs get
sent to the job queue for processing. Before sending the jobs to the job queue,
they will be passed through each JobBuffer's reduce() method, which is can be used
to optimize the amount of work to be done by e.g. de-duplicating identical jobs or
aggregating data over the collected jobs.

Passing in JobBuffer instances or ids limits the action to the specified JobBuffers.
If no argument is passed, all JobBuffers will be flushed.

Returns an array of all Jobs which were added to the job queue.

### getJobQueues​


[​](#getjobqueues)Returns an array of { name: string; running: boolean; } for each
registered JobQueue.


---

# JobQueueStrategy


## JobQueueStrategy​


[​](#jobqueuestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[job-queue-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/job-queue/job-queue-strategy.ts#L24)Defines how the jobs in the JobQueueService are persisted and
accessed. Custom strategies can be defined to make use of external
services such as Redis.

[JobQueueService](/reference/typescript-api/job-queue/job-queue-service#jobqueueservice)This is configured via the jobQueueOptions.jobQueueStrategy property of
your VendureConfig.

```
interface JobQueueStrategy extends InjectableStrategy {    add<Data extends JobData<Data> = object>(job: Job<Data>, jobOptions?: JobQueueStrategyJobOptions<Data>): Promise<Job<Data>>;    start<Data extends JobData<Data> = object>(        queueName: string,        process: (job: Job<Data>) => Promise<any>,    ): Promise<void>;    stop<Data extends JobData<Data> = object>(        queueName: string,        process: (job: Job<Data>) => Promise<any>,    ): Promise<void>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### add​


[​](#add)[Job](/reference/typescript-api/job-queue/job#job)[Job](/reference/typescript-api/job-queue/job#job)Add a new job to the queue.

### start​


[​](#start)[Job](/reference/typescript-api/job-queue/job#job)Start the job queue

### stop​


[​](#stop)[Job](/reference/typescript-api/job-queue/job#job)Stops a queue from running. Its not guaranteed to stop immediately.


---

# Job


## Job​


[​](#job)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[job.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/job-queue/job.ts#L37)A Job represents a piece of work to be run in the background, i.e. outside the request-response cycle.
It is intended to be used for long-running work triggered by API requests. Jobs should now generally
be directly instantiated. Rather, the JobQueue add() method should be used to create and
add a new Job to a queue.

[JobQueue](/reference/typescript-api/job-queue/#jobqueue)
```
class Job<T extends JobData<T> = any> {    readonly id: number | string | null;    readonly queueName: string;    readonly retries: number;    readonly createdAt: Date;    name: string    data: T    state: JobState    progress: number    result: any    error: any    isSettled: boolean    startedAt: Date | undefined    settledAt: Date | undefined    duration: number    attempts: number    constructor(config: JobConfig<T>)    start() => ;    setProgress(percent: number) => ;    complete(result?: any) => ;    fail(err?: any) => ;    cancel() => ;    defer() => ;    on(eventType: JobEventType, listener: JobEventListener<T>) => ;    off(eventType: JobEventType, listener: JobEventListener<T>) => ;}
```

### id​


[​](#id)
### queueName​


[​](#queuename)
### retries​


[​](#retries)
### createdAt​


[​](#createdat)
### name​


[​](#name)
### data​


[​](#data)
### state​


[​](#state)[JobState](/reference/typescript-api/common/job-state#jobstate)
### progress​


[​](#progress)
### result​


[​](#result)
### error​


[​](#error)
### isSettled​


[​](#issettled)
### startedAt​


[​](#startedat)
### settledAt​


[​](#settledat)
### duration​


[​](#duration)
### attempts​


[​](#attempts)
### constructor​


[​](#constructor)[JobConfig](/reference/typescript-api/job-queue/types#jobconfig)
### start​


[​](#start)Calling this signifies that the job work has started. This method should be
called in the JobQueueStrategy next() method.

[JobQueueStrategy](/reference/typescript-api/job-queue/job-queue-strategy#jobqueuestrategy)
### setProgress​


[​](#setprogress)Sets the progress (0 - 100) of the job.

### complete​


[​](#complete)Calling this method signifies that the job succeeded. The result
will be stored in the Job.result property.

### fail​


[​](#fail)Calling this method signifies that the job failed.

### cancel​


[​](#cancel)
### defer​


[​](#defer)Sets a RUNNING job back to PENDING. Should be used when the JobQueue is being
destroyed before the job has been completed.

### on​


[​](#on)[JobEventType](/reference/typescript-api/job-queue/job#jobeventtype)[JobEventListener](/reference/typescript-api/job-queue/job#jobeventlistener)Used to register event handler for job events

### off​


[​](#off)[JobEventType](/reference/typescript-api/job-queue/job#jobeventtype)[JobEventListener](/reference/typescript-api/job-queue/job#jobeventlistener)
## JobEventType​


[​](#jobeventtype)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[job.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/job-queue/job.ts#L15)An event raised by a Job.

```
type JobEventType = 'progress'
```

## JobEventListener​


[​](#jobeventlistener)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[job.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/job-queue/job.ts#L24)The signature of the event handler expected by the Job.on() method.

```
type JobEventListener<T extends JobData<T>> = (job: Job<T>) => void
```


---

# PollingJobQueueStrategy


## PollingJobQueueStrategy​


[​](#pollingjobqueuestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[polling-job-queue-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/job-queue/polling-job-queue-strategy.ts#L242)This class allows easier implementation of JobQueueStrategy in a polling style.
Instead of providing JobQueueStrategy start() you should provide a next method.

[JobQueueStrategy](/reference/typescript-api/job-queue/job-queue-strategy#jobqueuestrategy)[JobQueueStrategy](/reference/typescript-api/job-queue/job-queue-strategy#jobqueuestrategy)This class should be extended by any strategy which does not support a push-based system
to notify on new jobs. It is used by the SqlJobQueueStrategy and InMemoryJobQueueStrategy.

[SqlJobQueueStrategy](/reference/typescript-api/job-queue/sql-job-queue-strategy#sqljobqueuestrategy)[InMemoryJobQueueStrategy](/reference/typescript-api/job-queue/in-memory-job-queue-strategy#inmemoryjobqueuestrategy)
```
class PollingJobQueueStrategy extends InjectableJobQueueStrategy {    public concurrency: number;    public pollInterval: number | ((queueName: string) => number);    public setRetries: (queueName: string, job: Job) => number;    public backOffStrategy?: BackoffStrategy;    public gracefulShutdownTimeout: number;    protected activeQueues = new QueueNameProcessStorage<ActiveQueue<any>>();    constructor(config?: PollingJobQueueStrategyConfig)    constructor(concurrency?: number, pollInterval?: number)    constructor(concurrencyOrConfig?: number | PollingJobQueueStrategyConfig, maybePollInterval?: number)    start(queueName: string, process: (job: Job<Data>) => Promise<any>) => ;    stop(queueName: string, process: (job: Job<Data>) => Promise<any>) => ;    cancelJob(jobId: ID) => Promise<Job | undefined>;    next(queueName: string) => Promise<Job | undefined>;    update(job: Job) => Promise<void>;    findOne(id: ID) => Promise<Job | undefined>;}
```

- Extends: InjectableJobQueueStrategy

### concurrency​


[​](#concurrency)
### pollInterval​


[​](#pollinterval)
### setRetries​


[​](#setretries)[Job](/reference/typescript-api/job-queue/job#job)
### backOffStrategy​


[​](#backoffstrategy)[BackoffStrategy](/reference/typescript-api/job-queue/types#backoffstrategy)
### gracefulShutdownTimeout​


[​](#gracefulshutdowntimeout)
### activeQueues​


[​](#activequeues)
### constructor​


[​](#constructor)
### constructor​


[​](#constructor-1)
### constructor​


[​](#constructor-2)
### start​


[​](#start)[Job](/reference/typescript-api/job-queue/job#job)
### stop​


[​](#stop)[Job](/reference/typescript-api/job-queue/job#job)
### cancelJob​


[​](#canceljob)[ID](/reference/typescript-api/common/id#id)[Job](/reference/typescript-api/job-queue/job#job)
### next​


[​](#next)[Job](/reference/typescript-api/job-queue/job#job)Should return the next job in the given queue. The implementation is
responsible for returning the correct job according to the time of
creation.

### update​


[​](#update)[Job](/reference/typescript-api/job-queue/job#job)Update the job details in the store.

### findOne​


[​](#findone)[ID](/reference/typescript-api/common/id#id)[Job](/reference/typescript-api/job-queue/job#job)Returns a job by its id.


---

# SqlJobQueueStrategy


## SqlJobQueueStrategy​


[​](#sqljobqueuestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[sql-job-queue-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/default-job-queue-plugin/sql-job-queue-strategy.ts#L22)A JobQueueStrategy which uses the configured SQL database to persist jobs in the queue.
This strategy is used by the DefaultJobQueuePlugin.

[JobQueueStrategy](/reference/typescript-api/job-queue/job-queue-strategy#jobqueuestrategy)[DefaultJobQueuePlugin](/reference/typescript-api/job-queue/default-job-queue-plugin#defaultjobqueueplugin)
```
class SqlJobQueueStrategy extends PollingJobQueueStrategy implements InspectableJobQueueStrategy {    init(injector: Injector) => ;    destroy() => ;    add(job: Job<Data>, jobOptions?: JobQueueStrategyJobOptions<Data>) => Promise<Job<Data>>;    next(queueName: string) => Promise<Job | undefined>;    update(job: Job<any>) => Promise<void>;    findMany(options?: JobListOptions) => Promise<PaginatedList<Job>>;    findOne(id: ID) => Promise<Job | undefined>;    findManyById(ids: ID[]) => Promise<Job[]>;    removeSettledJobs(queueNames: string[] = [], olderThan?: Date) => ;}
```

- Extends: PollingJobQueueStrategy
- Implements: InspectableJobQueueStrategy

Extends: PollingJobQueueStrategy

[PollingJobQueueStrategy](/reference/typescript-api/job-queue/polling-job-queue-strategy#pollingjobqueuestrategy)Implements: InspectableJobQueueStrategy

[InspectableJobQueueStrategy](/reference/typescript-api/job-queue/inspectable-job-queue-strategy#inspectablejobqueuestrategy)
### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)
### destroy​


[​](#destroy)
### add​


[​](#add)[Job](/reference/typescript-api/job-queue/job#job)[Job](/reference/typescript-api/job-queue/job#job)
### next​


[​](#next)[Job](/reference/typescript-api/job-queue/job#job)
### update​


[​](#update)[Job](/reference/typescript-api/job-queue/job#job)
### findMany​


[​](#findmany)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Job](/reference/typescript-api/job-queue/job#job)
### findOne​


[​](#findone)[ID](/reference/typescript-api/common/id#id)[Job](/reference/typescript-api/job-queue/job#job)
### findManyById​


[​](#findmanybyid)[ID](/reference/typescript-api/common/id#id)[Job](/reference/typescript-api/job-queue/job#job)
### removeSettledJobs​


[​](#removesettledjobs)


---

# SubscribableJob


## SubscribableJob​


[​](#subscribablejob)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[subscribable-job.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/job-queue/subscribable-job.ts#L59)This is a type of Job object that allows you to subscribe to updates to the Job. It is returned
by the JobQueue's add() method. Note that the subscription capability is only supported
if the JobQueueStrategy implements the InspectableJobQueueStrategy interface (e.g.
the SqlJobQueueStrategy does support this).

[JobQueue](/reference/typescript-api/job-queue/#jobqueue)[JobQueueStrategy](/reference/typescript-api/job-queue/job-queue-strategy#jobqueuestrategy)[InspectableJobQueueStrategy](/reference/typescript-api/job-queue/inspectable-job-queue-strategy#inspectablejobqueuestrategy)[SqlJobQueueStrategy](/reference/typescript-api/job-queue/sql-job-queue-strategy#sqljobqueuestrategy)
```
class SubscribableJob<T extends JobData<T> = any> extends Job<T> {    constructor(job: Job<T>, jobQueueStrategy: JobQueueStrategy)    updates(options?: JobUpdateOptions) => Observable<JobUpdate<T>>;}
```

- Extends: Job<T>

[Job](/reference/typescript-api/job-queue/job#job)
### constructor​


[​](#constructor)[Job](/reference/typescript-api/job-queue/job#job)[JobQueueStrategy](/reference/typescript-api/job-queue/job-queue-strategy#jobqueuestrategy)
### updates​


[​](#updates)[JobUpdateOptions](/reference/typescript-api/job-queue/types#jobupdateoptions)[JobUpdate](/reference/typescript-api/job-queue/types#jobupdate)Returns an Observable stream of updates to the Job. Works by polling the current JobQueueStrategy's findOne() method
to obtain updates. If the updates are not subscribed to, then no polling occurs.

Polling interval, timeout and other options may be configured with an options arguments JobUpdateOptions.

[JobUpdateOptions](/reference/typescript-api/job-queue/types#jobupdateoptions)


---

# Types


## BackoffStrategy​


[​](#backoffstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[polling-job-queue-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/job-queue/polling-job-queue-strategy.ts#L22)Defines the backoff strategy used when retrying failed jobs. Returns the delay in
ms that should pass before the failed job is retried.

```
type BackoffStrategy = (queueName: string, attemptsMade: number, job: Job) => number
```

## JobUpdate​


[​](#jobupdate)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[subscribable-job.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/job-queue/subscribable-job.ts#L23)Job update status as returned from the SubscribableJob's update() method.

[SubscribableJob](/reference/typescript-api/job-queue/subscribable-job#subscribablejob)
```
type JobUpdate<T extends JobData<T>> = Pick<    Job<T>,    'id' | 'state' | 'progress' | 'result' | 'error' | 'data'>
```

## JobUpdateOptions​


[​](#jobupdateoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[subscribable-job.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/job-queue/subscribable-job.ts#L35)Job update options, that you can specify by calling SubscribableJob updates method.

[SubscribableJob](/reference/typescript-api/job-queue/subscribable-job#subscribablejob)
```
type JobUpdateOptions = {    pollInterval?: number;    timeoutMs?: number;    errorOnFail?: boolean;}
```

### pollInterval​


[​](#pollinterval)
### timeoutMs​


[​](#timeoutms)
### errorOnFail​


[​](#erroronfail)
## CreateQueueOptions​


[​](#createqueueoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/job-queue/types.ts#L15)Used to configure a new JobQueue instance.

[JobQueue](/reference/typescript-api/job-queue/#jobqueue)
```
interface CreateQueueOptions<T extends JobData<T>> {    name: string;    process: (job: Job<T>) => Promise<any>;}
```

### name​


[​](#name)The name of the queue, e.g. "image processing", "re-indexing" etc.

### process​


[​](#process)[Job](/reference/typescript-api/job-queue/job#job)Defines the work to be done for each job in the queue. The returned promise
should resolve when the job is complete, or be rejected in case of an error.

## JobData​


[​](#jobdata)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/job-queue/types.ts#L37)A JSON-serializable data type which provides a Jobwith the data it needs to be processed.

[Job](/reference/typescript-api/job-queue/job#job)
```
type JobData<T> = JsonCompatible<T>
```

## JobConfig​


[​](#jobconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/job-queue/types.ts#L46)Used to instantiate a new Job

[Job](/reference/typescript-api/job-queue/job#job)
```
interface JobConfig<T extends JobData<T>> {    queueName: string;    data: T;    retries?: number;    attempts?: number;    id?: ID;    state?: JobState;    progress?: number;    result?: any;    error?: any;    createdAt?: Date;    startedAt?: Date;    settledAt?: Date;}
```

### queueName​


[​](#queuename)
### data​


[​](#data)
### retries​


[​](#retries)
### attempts​


[​](#attempts)
### id​


[​](#id)[ID](/reference/typescript-api/common/id#id)
### state​


[​](#state)[JobState](/reference/typescript-api/common/job-state#jobstate)
### progress​


[​](#progress)
### result​


[​](#result)
### error​


[​](#error)
### createdAt​


[​](#createdat)
### startedAt​


[​](#startedat)
### settledAt​


[​](#settledat)


---

# Logger


## Logger​


[​](#logger)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-logger.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/logger/vendure-logger.ts#L136)The Logger is responsible for all logging in a Vendure application.

It is intended to be used as a static class:

Example

```
import { Logger } from '@vendure/core';Logger.info(`Some log message`, 'My Vendure Plugin');
```

The actual implementation - where the logs are written to - is defined by the VendureLogger
instance configured in the VendureConfig. By default, the DefaultLogger is used, which
logs to the console.

[VendureLogger](/reference/typescript-api/logger/vendure-logger#vendurelogger)[VendureConfig](/reference/typescript-api/configuration/vendure-config#vendureconfig)[DefaultLogger](/reference/typescript-api/logger/default-logger#defaultlogger)
## Implementing a custom logger​


[​](#implementing-a-custom-logger)A custom logger can be passed to the logger config option by creating a class which implements the
VendureLogger interface. For example, here is how you might go about implementing a logger which
logs to a file:

[VendureLogger](/reference/typescript-api/logger/vendure-logger#vendurelogger)Example

```
import { VendureLogger } from '@vendure/core';import fs from 'fs';// A simple custom logger which writes all logs to a file.export class SimpleFileLogger implements VendureLogger {    private logfile: fs.WriteStream;    constructor(logfileLocation: string) {        this.logfile = fs.createWriteStream(logfileLocation, { flags: 'w' });    }    error(message: string, context?: string) {        this.logfile.write(`ERROR: [${context}] ${message}\n`);    }    warn(message: string, context?: string) {        this.logfile.write(`WARN: [${context}] ${message}\n`);    }    info(message: string, context?: string) {        this.logfile.write(`INFO: [${context}] ${message}\n`);    }    verbose(message: string, context?: string) {        this.logfile.write(`VERBOSE: [${context}] ${message}\n`);    }    debug(message: string, context?: string) {        this.logfile.write(`DEBUG: [${context}] ${message}\n`);    }}// in the VendureConfigexport const config = {    // ...    logger: new SimpleFileLogger('server.log'),}
```

```
class Logger implements LoggerService {    logger: VendureLogger    error(message: string, context?: string, trace?: string) => void;    warn(message: string, context?: string) => void;    info(message: string, context?: string) => void;    verbose(message: string, context?: string) => void;    debug(message: string, context?: string) => void;}
```

- Implements: LoggerService

### logger​


[​](#logger-1)[VendureLogger](/reference/typescript-api/logger/vendure-logger#vendurelogger)
### error​


[​](#error)
### warn​


[​](#warn)
### info​


[​](#info)
### verbose​


[​](#verbose)
### debug​


[​](#debug)


---

# DefaultLogger


## DefaultLogger​


[​](#defaultlogger)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-logger.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/logger/default-logger.ts#L25)The default logger, which logs to the console (stdout) with optional timestamps. Since this logger is part of the
default Vendure configuration, you do not need to specify it explicitly in your server config. You would only need
to specify it if you wish to change the log level (which defaults to LogLevel.Info) or remove the timestamp.

Example

```
import { DefaultLogger, LogLevel, VendureConfig } from '@vendure/core';export config: VendureConfig = {    // ...    logger: new DefaultLogger({ level: LogLevel.Debug, timestamp: false }),}
```

```
class DefaultLogger implements VendureLogger {    constructor(options?: { level?: LogLevel; timestamp?: boolean })    setDefaultContext(defaultContext: string) => ;    error(message: string, context?: string, trace?: string | undefined) => void;    warn(message: string, context?: string) => void;    info(message: string, context?: string) => void;    verbose(message: string, context?: string) => void;    debug(message: string, context?: string) => void;}
```

- Implements: VendureLogger

[VendureLogger](/reference/typescript-api/logger/vendure-logger#vendurelogger)
### constructor​


[​](#constructor)[LogLevel](/reference/typescript-api/logger/log-level#loglevel)
### setDefaultContext​


[​](#setdefaultcontext)
### error​


[​](#error)
### warn​


[​](#warn)
### info​


[​](#info)
### verbose​


[​](#verbose)
### debug​


[​](#debug)


---

# LogLevel


## LogLevel​


[​](#loglevel)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-logger.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/logger/vendure-logger.ts#L9)An enum of valid logging levels.

```
enum LogLevel {    // Log Errors only. These are usually indicative of some potentiallyserious issue, so should be acted upon.    Error = 0    // Warnings indicate that some situation may require investigationand handling. But not as serious as an Error.    Warn = 1    // Logs general information such as startup messages.    Info = 2    // Logs additional information    Verbose = 3    // Logs detailed info useful in debug scenarios, including stack traces forall errors. In production this would probably generate too much noise.    Debug = 4}
```


---

# VendureLogger


## VendureLogger​


[​](#vendurelogger)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-logger.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/logger/vendure-logger.ts#L47)The VendureLogger interface defines the shape of a logger service which may be provided in
the config.

```
interface VendureLogger {    error(message: string, context?: string, trace?: string): void;    warn(message: string, context?: string): void;    info(message: string, context?: string): void;    verbose(message: string, context?: string): void;    debug(message: string, context?: string): void;    setDefaultContext?(defaultContext: string): void;}
```

### error​


[​](#error)
### warn​


[​](#warn)
### info​


[​](#info)
### verbose​


[​](#verbose)
### debug​


[​](#debug)
### setDefaultContext​


[​](#setdefaultcontext)


---

# GenerateMigration


## generateMigration​


[​](#generatemigration)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[migrate.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/migrate.ts#L118)Generates a new migration file based on any schema changes (e.g. adding or removing CustomFields).
See TypeORM migration docs for more information about the
underlying migration mechanism.

[TypeORM migration docs](https://typeorm.io/#/migrations)
```
function generateMigration(userConfig: Partial<VendureConfig>, options: MigrationOptions): Promise<string | undefined>
```

Parameters

### userConfig​


[​](#userconfig)[VendureConfig](/reference/typescript-api/configuration/vendure-config#vendureconfig)
### options​


[​](#options)[MigrationOptions](/reference/typescript-api/migration/migration-options#migrationoptions)


---

# MigrationOptions


## MigrationOptions​


[​](#migrationoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[migrate.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/migrate.ts#L19)Configuration for generating a new migration script via generateMigration.

[generateMigration](/reference/typescript-api/migration/generate-migration#generatemigration)
```
interface MigrationOptions {    name: string;    outputDir?: string;}
```

### name​


[​](#name)The name of the migration. The resulting migration script will be named
{TIMESTAMP}-{name}.ts.

### outputDir​


[​](#outputdir)The output directory of the generated migration scripts.


---

# RevertLastMigration


## revertLastMigration​


[​](#revertlastmigration)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[migrate.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/migrate.ts#L89)Reverts the last applied database migration. See TypeORM migration docs
for more information about the underlying migration mechanism.

[TypeORM migration docs](https://typeorm.io/#/migrations)
```
function revertLastMigration(userConfig: Partial<VendureConfig>): void
```

Parameters

### userConfig​


[​](#userconfig)[VendureConfig](/reference/typescript-api/configuration/vendure-config#vendureconfig)


---

# RunMigrations


## runMigrations​


[​](#runmigrations)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[migrate.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/migrate.ts#L40)Runs any pending database migrations. See TypeORM migration docs
for more information about the underlying migration mechanism.

[TypeORM migration docs](https://typeorm.io/#/migrations)
```
function runMigrations(userConfig: Partial<VendureConfig>): Promise<string[]>
```

Parameters

### userConfig​


[​](#userconfig)[VendureConfig](/reference/typescript-api/configuration/vendure-config#vendureconfig)


---

# BigIntMoneyStrategy


## BigIntMoneyStrategy​


[​](#bigintmoneystrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[bigint-money-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/entity/bigint-money-strategy.ts#L18)A MoneyStrategy that stores monetary values as a bigint type in the database, which
allows values up to ~9 quadrillion to be stored (limited by JavaScript's MAX_SAFE_INTEGER limit).

[MoneyStrategy](/reference/typescript-api/money/money-strategy#moneystrategy)This strategy also slightly differs in the way rounding is performed, with rounding being done after
multiplying the unit price, rather than before (as is the case with the DefaultMoneyStrategy.

[DefaultMoneyStrategy](/reference/typescript-api/money/default-money-strategy#defaultmoneystrategy)
```
class BigIntMoneyStrategy implements MoneyStrategy {    readonly moneyColumnOptions: ColumnOptions = {        type: 'bigint',        transformer: {            to: (entityValue: number) => {                return entityValue;            },            from: (databaseValue: string): number => {                if (databaseValue == null) {                    return databaseValue;                }                const intVal = Number.parseInt(databaseValue, 10);                if (!Number.isSafeInteger(intVal)) {                    Logger.warn(`Monetary value ${databaseValue} is not a safe integer!`);                }                if (Number.isNaN(intVal)) {                    Logger.warn(`Monetary value ${databaseValue} is not a number!`);                }                return intVal;            },        },    };    precision = 2;    round(value: number, quantity:  = 1) => number;}
```

- Implements: MoneyStrategy

[MoneyStrategy](/reference/typescript-api/money/money-strategy#moneystrategy)
### moneyColumnOptions​


[​](#moneycolumnoptions)
### precision​


[​](#precision)
### round​


[​](#round)

---


# DefaultMoneyStrategy


## DefaultMoneyStrategy​


[​](#defaultmoneystrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-money-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/entity/default-money-strategy.ts#L14)A MoneyStrategy that stores monetary values as a int type in the database.
The storage configuration and rounding logic replicates the behaviour of Vendure pre-2.0.

[MoneyStrategy](/reference/typescript-api/money/money-strategy#moneystrategy)
```
class DefaultMoneyStrategy implements MoneyStrategy {    readonly moneyColumnOptions: ColumnOptions = {        type: 'int',    };    readonly precision: number = 2;    round(value: number, quantity:  = 1) => number;}
```

- Implements: MoneyStrategy

[MoneyStrategy](/reference/typescript-api/money/money-strategy#moneystrategy)
### moneyColumnOptions​


[​](#moneycolumnoptions)
### precision​


[​](#precision)
### round​


[​](#round)


---

# Money Decorator


## Money​


[​](#money)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[money.decorator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/entity/money.decorator.ts#L26)Use this decorator for any entity field that is storing a monetary value.
This allows the column type to be defined by the configured MoneyStrategy.

[MoneyStrategy](/reference/typescript-api/money/money-strategy#moneystrategy)
```
function Money(options?: MoneyColumnOptions): void
```

Parameters

### options​


[​](#options)


---

# MoneyStrategy


## MoneyStrategy​


[​](#moneystrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[money-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/entity/money-strategy.ts#L63)The MoneyStrategy defines how monetary values are stored and manipulated. The MoneyStrategy
is defined in EntityOptions:

[EntityOptions](/reference/typescript-api/configuration/entity-options#entityoptions)Example

```
const config: VendureConfig = {  entityOptions: {    moneyStrategy: new MyCustomMoneyStrategy(),  }};
```

## Range​


[​](#range)The DefaultMoneyStrategy uses an int field in the database, which puts an
effective limit of ~21.4 million on any stored value. For certain use cases
(e.g. business sales with very high amounts, or currencies with very large
denominations), this may cause issues. In this case, you can use the
BigIntMoneyStrategy which will use the bigint type to store monetary values,
giving an effective upper limit of over 9 quadrillion.

[DefaultMoneyStrategy](/reference/typescript-api/money/default-money-strategy#defaultmoneystrategy)[BigIntMoneyStrategy](/reference/typescript-api/money/big-int-money-strategy#bigintmoneystrategy)
## Precision​


[​](#precision)Both the DefaultMoneyStrategy and BigIntMoneyStrategy store monetary values as integers, representing
the price in the minor units of the currency (i.e. cents in USD or pennies in GBP).

Since v2.2.0, you can configure the precision of the stored values via the precision property of the
strategy. Changing the precision has no effect on the stored value. It is merely a hint to the
UI as to how many decimal places to display.

Example

```
import { DefaultMoneyStrategy, VendureConfig } from '@vendure/core';export class ThreeDecimalPlacesMoneyStrategy extends DefaultMoneyStrategy {  readonly precision = 3;}export const config: VendureConfig = {  // ...  entityOptions: {    moneyStrategy: new ThreeDecimalPlacesMoneyStrategy(),  }};
```

This is configured via the entityOptions.moneyStrategy property of
your VendureConfig.

```
interface MoneyStrategy extends InjectableStrategy {    readonly moneyColumnOptions: ColumnOptions;    readonly precision?: number;    round(value: number, quantity?: number): number;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### moneyColumnOptions​


[​](#moneycolumnoptions)Defines the TypeORM column used to store monetary values.

### precision​


[​](#precision-1)Defines the precision (i.e. number of decimal places) represented by the monetary values.
For example, consider a product variant with a price value of 12345.

- If the precision is 2, then the price is 123.45.
- If the precision is 3, then the price is 12.345.

Changing the precision has no effect on the stored value. It is merely a hint to the
UI as to how many decimal places to display.

### round​


[​](#round)Defines the logic used to round monetary values. For instance, the default behavior
in the DefaultMoneyStrategy is to round the value, then multiply.

[DefaultMoneyStrategy](/reference/typescript-api/money/default-money-strategy#defaultmoneystrategy)
```
return Math.round(value * quantity);
```

However, it may be desirable to instead round only after the unit amount has been
multiplied. In this case you can define a custom strategy with logic like this:

```
return Math.round(value * quantity);
```


---

# RoundMoney


## roundMoney​


[​](#roundmoney)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[round-money.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/round-money.ts#L13)Rounds a monetary value according to the configured MoneyStrategy.

[MoneyStrategy](/reference/typescript-api/money/money-strategy#moneystrategy)
```
function roundMoney(value: number, quantity:  = 1): number
```

Parameters

### value​


[​](#value)
### quantity​


[​](#quantity)


---

# ActiveOrderService


## ActiveOrderService​


[​](#activeorderservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[active-order.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/active-order/active-order.service.ts#L18)This helper class is used to get a reference to the active Order from the current RequestContext.

```
class ActiveOrderService {    constructor(sessionService: SessionService, orderService: OrderService, connection: TransactionalConnection, configService: ConfigService)    getOrderFromContext(ctx: RequestContext) => Promise<Order | undefined>;    getOrderFromContext(ctx: RequestContext, createIfNotExists: true) => Promise<Order>;    getOrderFromContext(ctx: RequestContext, createIfNotExists:  = false) => Promise<Order | undefined>;    getActiveOrder(ctx: RequestContext, input: { [strategyName: string]: any } | undefined) => Promise<Order | undefined>;    getActiveOrder(ctx: RequestContext, input: { [strategyName: string]: any } | undefined, createIfNotExists: true) => Promise<Order>;    getActiveOrder(ctx: RequestContext, input: { [strategyName: string]: Record<string, any> | undefined } | undefined, createIfNotExists:  = false) => Promise<Order | undefined>;}
```

### constructor​


[​](#constructor)[SessionService](/reference/typescript-api/services/session-service#sessionservice)[OrderService](/reference/typescript-api/services/order-service#orderservice)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)
### getOrderFromContext​


[​](#getorderfromcontext)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)Gets the active Order object from the current Session. Optionally can create a new Order if
no active Order exists.

Intended to be used at the Resolver layer for those resolvers that depend upon an active Order
being present.

### getOrderFromContext​


[​](#getorderfromcontext-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)
### getOrderFromContext​


[​](#getorderfromcontext-2)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)
### getActiveOrder​


[​](#getactiveorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)Retrieves the active Order based on the configured ActiveOrderStrategy.

[ActiveOrderStrategy](/reference/typescript-api/orders/active-order-strategy#activeorderstrategy)
### getActiveOrder​


[​](#getactiveorder-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)
### getActiveOrder​


[​](#getactiveorder-2)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)


---

# ActiveOrderStrategy


## ActiveOrderStrategy​


[​](#activeorderstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[active-order-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/active-order-strategy.ts#L127)This strategy is used to determine the active Order for all order-related operations in
the Shop API. By default, all the Shop API operations that relate to the active Order (e.g.
activeOrder, addItemToOrder, applyCouponCode etc.) will implicitly create a new Order
and set it on the current Session, and then read the session to obtain the active Order.
This behaviour is defined by the DefaultActiveOrderStrategy.

[DefaultActiveOrderStrategy](/reference/typescript-api/orders/default-active-order-strategy#defaultactiveorderstrategy)The InputType generic argument should correspond to the input type defined by the
defineInputType() method.

When defineInputType() is used, then the following Shop API operations will receive an additional
activeOrderInput argument allowing the active order input to be specified:

- activeOrder
- eligibleShippingMethods
- eligiblePaymentMethods
- nextOrderStates
- addItemToOrder
- adjustOrderLine
- removeOrderLine
- removeAllOrderLines
- applyCouponCode
- removeCouponCode
- addPaymentToOrder
- setCustomerForOrder
- setOrderShippingAddress
- setOrderBillingAddress
- setOrderShippingMethod
- setOrderCustomFields
- transitionOrderToState

Example

```
mutation AddItemToOrder {  addItemToOrder(    productVariantId: 42,    quantity: 1,    activeOrderInput: { token: "123456" }  ) {    ...on Order {      id      # ...etc    }  }}

```

Example

```
import { ID } from '@vendure/common/lib/shared-types';import {  ActiveOrderStrategy,  CustomerService,  idsAreEqual,  Injector,  Order,  OrderService,  RequestContext,  TransactionalConnection,} from '@vendure/core';import gql from 'graphql-tag';// This strategy assumes a "orderToken" custom field is defined on the Order// entity, and uses that token to perform a lookup to determine the active Order.//// Additionally, it does _not_ define a `createActiveOrder()` method, which// means that a custom mutation would be required to create the initial Order in// the first place and set the "orderToken" custom field.class TokenActiveOrderStrategy implements ActiveOrderStrategy<{ token: string }> {  readonly name = 'orderToken';  private connection: TransactionalConnection;  private orderService: OrderService;  init(injector: Injector) {    this.connection = injector.get(TransactionalConnection);    this.orderService = injector.get(OrderService);  }  defineInputType = () => gql`    input OrderTokenActiveOrderInput {      token: String    }  `;  async determineActiveOrder(ctx: RequestContext, input: { token: string }) {    const qb = this.connection      .getRepository(ctx, Order)      .createQueryBuilder('order')      .leftJoinAndSelect('order.customer', 'customer')      .leftJoinAndSelect('customer.user', 'user')      .where('order.customFields.orderToken = :orderToken', { orderToken: input.token });    const order = await qb.getOne();    if (!order) {      return;    }    // Ensure the active user is the owner of this Order    const orderUserId = order.customer && order.customer.user && order.customer.user.id;    if (order.customer && idsAreEqual(orderUserId, ctx.activeUserId)) {      return order;    }  }}// in vendure-config.tsexport const config = {  // ...  orderOptions: {    activeOrderStrategy: new TokenActiveOrderStrategy(),  },}
```

```
interface ActiveOrderStrategy<InputType extends Record<string, any> | void = void> extends InjectableStrategy {    readonly name: string;    defineInputType?: () => DocumentNode;    createActiveOrder?: (ctx: RequestContext, input: InputType) => Promise<Order>;    determineActiveOrder(ctx: RequestContext, input: InputType): Promise<Order | undefined>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### name​


[​](#name)The name of the strategy, e.g. "orderByToken", which will also be used as the
field name in the ActiveOrderInput type.

### defineInputType​


[​](#defineinputtype)Defines the type of the GraphQL Input object expected by the activeOrderInput
input argument.

Example

For example, given the following:

```
defineInputType() {  return gql`     input OrderTokenInput {       token: String!     }  `;}
```

assuming the strategy name is "orderByToken", then the resulting call to activeOrder (or any of the other
affected Shop API operations) would look like:

```
activeOrder(activeOrderInput: {  orderByToken: {    token: "foo"  }}) {  # ...}

```

Note: if more than one graphql input type is being defined (as in a nested input type), then
the first input will be assumed to be the top-level input.

### createActiveOrder​


[​](#createactiveorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)Certain mutations such as addItemToOrder can automatically create a new Order if one does not exist.
In these cases, this method will be called to create the new Order.

If automatic creation of an Order does not make sense in your strategy, then leave this method
undefined. You'll then need to take care of creating an order manually by defining a custom mutation.

### determineActiveOrder​


[​](#determineactiveorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)This method is used to determine the active Order based on the current RequestContext in addition to any
input values provided, as defined by the defineInputType method of this strategy.

Note that this method is invoked frequently, so you should aim to keep it efficient. The returned Order,
for example, does not need to have its various relations joined.


---

# ChangedPriceHandlingStrategy


## ChangedPriceHandlingStrategy​


[​](#changedpricehandlingstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[changed-price-handling-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/changed-price-handling-strategy.ts#L24)This strategy defines how we handle the situation where an item exists in an Order, and
then later on another is added but in the meantime the price of the ProductVariant has changed.

By default, the latest price will be used. Any price changes resulting from using a newer price
will be reflected in the GraphQL OrderLine.unitPrice[WithTax]ChangeSinceAdded field.

This is configured via the orderOptions.changedPriceHandlingStrategy property of
your VendureConfig.

```
interface ChangedPriceHandlingStrategy extends InjectableStrategy {    handlePriceChange(        ctx: RequestContext,        current: PriceCalculationResult,        orderLine: OrderLine,        order: Order,    ): PriceCalculationResult | Promise<PriceCalculationResult>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### handlePriceChange​


[​](#handlepricechange)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[PriceCalculationResult](/reference/typescript-api/common/price-calculation-result#pricecalculationresult)[OrderLine](/reference/typescript-api/entities/order-line#orderline)[Order](/reference/typescript-api/entities/order#order)[PriceCalculationResult](/reference/typescript-api/common/price-calculation-result#pricecalculationresult)[PriceCalculationResult](/reference/typescript-api/common/price-calculation-result#pricecalculationresult)This method is called when adding to or adjusting OrderLines, if the latest price
(as determined by the ProductVariant price, potentially modified by the configured
OrderItemPriceCalculationStrategy) differs from the initial price at the time
that the OrderLine was created.

[OrderItemPriceCalculationStrategy](/reference/typescript-api/orders/order-item-price-calculation-strategy#orderitempricecalculationstrategy)


---

# CustomOrderStates


## CustomOrderStates​


[​](#customorderstates)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-state.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/order-state-machine/order-state.ts#L11)An interface to extend standard OrderState.

[OrderState](/reference/typescript-api/orders/order-process#orderstate)
```
interface CustomOrderStates {}
```


---

# DefaultActiveOrderStrategy


## DefaultActiveOrderStrategy​


[​](#defaultactiveorderstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-active-order-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/default-active-order-strategy.ts#L18)The default ActiveOrderStrategy, which uses the current Session to determine
the active Order, and requires no additional input in the Shop API since it is based on the
session which is part of the RequestContext.

[ActiveOrderStrategy](/reference/typescript-api/orders/active-order-strategy#activeorderstrategy)[Session](/reference/typescript-api/entities/session#session)
```
class DefaultActiveOrderStrategy implements ActiveOrderStrategy {    name: 'default-active-order-strategy';    init(injector: Injector) => ;    createActiveOrder(ctx: RequestContext) => ;    determineActiveOrder(ctx: RequestContext) => ;}
```

- Implements: ActiveOrderStrategy

[ActiveOrderStrategy](/reference/typescript-api/orders/active-order-strategy#activeorderstrategy)
### name​


[​](#name)
### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)
### createActiveOrder​


[​](#createactiveorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### determineActiveOrder​


[​](#determineactiveorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)


---

# DefaultGuestCheckoutStrategy


## DefaultGuestCheckoutStrategy​


[​](#defaultguestcheckoutstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-guest-checkout-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/default-guest-checkout-strategy.ts#L64)The default implementation of the GuestCheckoutStrategy. This strategy allows
guest checkouts by default, but can be configured to disallow them.

[GuestCheckoutStrategy](/reference/typescript-api/orders/guest-checkout-strategy#guestcheckoutstrategy)Example

```
import { DefaultGuestCheckoutStrategy, VendureConfig } from '@vendure/core';export const config: VendureConfig = {  orderOptions: {    guestCheckoutStrategy: new DefaultGuestCheckoutStrategy({      allowGuestCheckouts: false,      allowGuestCheckoutForRegisteredCustomers: false,    }),  },  // ...};
```

```
class DefaultGuestCheckoutStrategy implements GuestCheckoutStrategy {    init(injector: Injector) => ;    constructor(options?: DefaultGuestCheckoutStrategyOptions)    setCustomerForOrder(ctx: RequestContext, order: Order, input: CreateCustomerInput) => Promise<ErrorResultUnion<SetCustomerForOrderResult, Customer>>;}
```

- Implements: GuestCheckoutStrategy

[GuestCheckoutStrategy](/reference/typescript-api/orders/guest-checkout-strategy#guestcheckoutstrategy)
### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)
### constructor​


[​](#constructor)[DefaultGuestCheckoutStrategyOptions](/reference/typescript-api/orders/default-guest-checkout-strategy#defaultguestcheckoutstrategyoptions)
### setCustomerForOrder​


[​](#setcustomerfororder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Customer](/reference/typescript-api/entities/customer#customer)
## DefaultGuestCheckoutStrategyOptions​


[​](#defaultguestcheckoutstrategyoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-guest-checkout-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/default-guest-checkout-strategy.ts#L20)Options available for the DefaultGuestCheckoutStrategy.

[DefaultGuestCheckoutStrategy](/reference/typescript-api/orders/default-guest-checkout-strategy#defaultguestcheckoutstrategy)
```
interface DefaultGuestCheckoutStrategyOptions {    allowGuestCheckouts?: boolean;    allowGuestCheckoutForRegisteredCustomers?: boolean;}
```

### allowGuestCheckouts​


[​](#allowguestcheckouts)Whether to allow guest checkouts.

### allowGuestCheckoutForRegisteredCustomers​


[​](#allowguestcheckoutforregisteredcustomers)Whether to allow guest checkouts for customers who already have an account.
Note that when this is enabled, the details provided in the CreateCustomerInput
will overwrite the existing customer details of the registered customer.


---

# DefaultOrderItemPriceCalculationStrategy


## DefaultOrderItemPriceCalculationStrategy​


[​](#defaultorderitempricecalculationstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-order-item-price-calculation-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/default-order-item-price-calculation-strategy.ts#L14)The default OrderItemPriceCalculationStrategy, which simply passes through the price of
the ProductVariant without performing any calculations

[OrderItemPriceCalculationStrategy](/reference/typescript-api/orders/order-item-price-calculation-strategy#orderitempricecalculationstrategy)
```
class DefaultOrderItemPriceCalculationStrategy implements OrderItemPriceCalculationStrategy {    calculateUnitPrice(ctx: RequestContext, productVariant: ProductVariant) => PriceCalculationResult | Promise<PriceCalculationResult>;}
```

- Implements: OrderItemPriceCalculationStrategy

[OrderItemPriceCalculationStrategy](/reference/typescript-api/orders/order-item-price-calculation-strategy#orderitempricecalculationstrategy)
### calculateUnitPrice​


[​](#calculateunitprice)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[PriceCalculationResult](/reference/typescript-api/common/price-calculation-result#pricecalculationresult)[PriceCalculationResult](/reference/typescript-api/common/price-calculation-result#pricecalculationresult)


---

# DefaultOrderPlacedStrategy


## DefaultOrderPlacedStrategy​


[​](#defaultorderplacedstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-order-placed-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/default-order-placed-strategy.ts#L14)The default OrderPlacedStrategy. The order is set as "placed" when it transitions from
'ArrangingPayment' to either 'PaymentAuthorized' or 'PaymentSettled'.

[OrderPlacedStrategy](/reference/typescript-api/orders/order-placed-strategy#orderplacedstrategy)
```
class DefaultOrderPlacedStrategy implements OrderPlacedStrategy {    shouldSetAsPlaced(ctx: RequestContext, fromState: OrderState, toState: OrderState, order: Order) => boolean;}
```

- Implements: OrderPlacedStrategy

[OrderPlacedStrategy](/reference/typescript-api/orders/order-placed-strategy#orderplacedstrategy)
### shouldSetAsPlaced​


[​](#shouldsetasplaced)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[OrderState](/reference/typescript-api/orders/order-process#orderstate)[OrderState](/reference/typescript-api/orders/order-process#orderstate)[Order](/reference/typescript-api/entities/order#order)


---

# DefaultStockAllocationStrategy


## DefaultStockAllocationStrategy​


[​](#defaultstockallocationstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-stock-allocation-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/default-stock-allocation-strategy.ts#L14)Allocates stock when the Order transitions from ArrangingPayment to either
PaymentAuthorized or PaymentSettled.

```
class DefaultStockAllocationStrategy implements StockAllocationStrategy {    shouldAllocateStock(ctx: RequestContext, fromState: OrderState, toState: OrderState, order: Order) => boolean | Promise<boolean>;}
```

- Implements: StockAllocationStrategy

[StockAllocationStrategy](/reference/typescript-api/orders/stock-allocation-strategy#stockallocationstrategy)
### shouldAllocateStock​


[​](#shouldallocatestock)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[OrderState](/reference/typescript-api/orders/order-process#orderstate)[OrderState](/reference/typescript-api/orders/order-process#orderstate)[Order](/reference/typescript-api/entities/order#order)


---

# GuestCheckoutStrategy


## GuestCheckoutStrategy​


[​](#guestcheckoutstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[guest-checkout-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/guest-checkout-strategy.ts#L33)A strategy that determines how to deal with guest checkouts - i.e. when a customer
checks out without being logged in. For example, a strategy could be used to implement
business rules such as:

- No guest checkouts allowed
- No guest checkouts allowed for customers who already have an account
- No guest checkouts allowed for customers who have previously placed an order
- Allow guest checkouts, but create a new Customer entity if the email address
is already in use
- Allow guest checkouts, but update the existing Customer entity if the email address
is already in use

This is configured via the orderOptions.guestCheckoutStrategy property of
your VendureConfig.

```
interface GuestCheckoutStrategy extends InjectableStrategy {    setCustomerForOrder(        ctx: RequestContext,        order: Order,        input: CreateCustomerInput,    ):        | ErrorResultUnion<SetCustomerForOrderResult, Customer>        | Promise<ErrorResultUnion<SetCustomerForOrderResult, Customer>>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### setCustomerForOrder​


[​](#setcustomerfororder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Customer](/reference/typescript-api/entities/customer#customer)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Customer](/reference/typescript-api/entities/customer#customer)This method is called when the setCustomerForOrder mutation is executed.
It should return either a Customer object or an ErrorResult.


---

# Merge Strategies


## MergeOrdersStrategy​


[​](#mergeordersstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[merge-orders-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/merge-orders-strategy.ts#L15)Merges both Orders. If the guest order contains items which are already in the
existing Order, the guest Order quantity will replace that of the existing Order.

```
class MergeOrdersStrategy implements OrderMergeStrategy {    merge(ctx: RequestContext, guestOrder: Order, existingOrder: Order) => MergedOrderLine[];}
```

- Implements: OrderMergeStrategy

[OrderMergeStrategy](/reference/typescript-api/orders/order-merge-strategy#ordermergestrategy)
### merge​


[​](#merge)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Order](/reference/typescript-api/entities/order#order)[MergedOrderLine](/reference/typescript-api/orders/order-merge-strategy#mergedorderline)
## UseExistingStrategy​


[​](#useexistingstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[use-existing-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/use-existing-strategy.ts#L13)The guest order is discarded and the existing order is used as the active order.

```
class UseExistingStrategy implements OrderMergeStrategy {    merge(ctx: RequestContext, guestOrder: Order, existingOrder: Order) => MergedOrderLine[];}
```

- Implements: OrderMergeStrategy

[OrderMergeStrategy](/reference/typescript-api/orders/order-merge-strategy#ordermergestrategy)
### merge​


[​](#merge-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Order](/reference/typescript-api/entities/order#order)[MergedOrderLine](/reference/typescript-api/orders/order-merge-strategy#mergedorderline)
## UseGuestIfExistingEmptyStrategy​


[​](#useguestifexistingemptystrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[use-guest-if-existing-empty-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/use-guest-if-existing-empty-strategy.ts#L13)If the existing order is empty, then the guest order is used. Otherwise the existing order is used.

```
class UseGuestIfExistingEmptyStrategy implements OrderMergeStrategy {    merge(ctx: RequestContext, guestOrder: Order, existingOrder: Order) => MergedOrderLine[];}
```

- Implements: OrderMergeStrategy

[OrderMergeStrategy](/reference/typescript-api/orders/order-merge-strategy#ordermergestrategy)
### merge​


[​](#merge-2)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Order](/reference/typescript-api/entities/order#order)[MergedOrderLine](/reference/typescript-api/orders/order-merge-strategy#mergedorderline)
## UseGuestStrategy​


[​](#usegueststrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[use-guest-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/use-guest-strategy.ts#L13)Any existing order is discarded and the guest order is set as the active order.

```
class UseGuestStrategy implements OrderMergeStrategy {    merge(ctx: RequestContext, guestOrder: Order, existingOrder: Order) => MergedOrderLine[];}
```

- Implements: OrderMergeStrategy

[OrderMergeStrategy](/reference/typescript-api/orders/order-merge-strategy#ordermergestrategy)
### merge​


[​](#merge-3)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Order](/reference/typescript-api/entities/order#order)[MergedOrderLine](/reference/typescript-api/orders/order-merge-strategy#mergedorderline)

---

# OrderByCodeAccessStrategy


## OrderByCodeAccessStrategy​


[​](#orderbycodeaccessstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-by-code-access-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/order-by-code-access-strategy.ts#L38)The OrderByCodeAccessStrategy determines how access to a placed Order via the
orderByCode query is granted.
With a custom strategy anonymous access could be made permanent or tied to specific
conditions like IP range or an Order status.

Example

This example grants access to the requested Order to anyone – unless it's Monday.

```
export class NotMondayOrderByCodeAccessStrategy implements OrderByCodeAccessStrategy {    canAccessOrder(ctx: RequestContext, order: Order): boolean {        const MONDAY = 1;        const today = (new Date()).getDay();        return today !== MONDAY;    }}
```

This is configured via the orderOptions.orderByCodeAccessStrategy property of
your VendureConfig.

```
interface OrderByCodeAccessStrategy extends InjectableStrategy {    canAccessOrder(ctx: RequestContext, order: Order): boolean | Promise<boolean>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### canAccessOrder​


[​](#canaccessorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)Gives or denies permission to access the requested Order

## DefaultOrderByCodeAccessStrategy​


[​](#defaultorderbycodeaccessstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-by-code-access-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/order-by-code-access-strategy.ts#L57)The default OrderByCodeAccessStrategy used by Vendure. It permitts permanent access to
the Customer owning the Order and anyone within a given time period after placing the Order
(defaults to 2h).

```
class DefaultOrderByCodeAccessStrategy implements OrderByCodeAccessStrategy {    constructor(anonymousAccessDuration: string)    canAccessOrder(ctx: RequestContext, order: Order) => boolean;}
```

- Implements: OrderByCodeAccessStrategy

[OrderByCodeAccessStrategy](/reference/typescript-api/orders/order-by-code-access-strategy#orderbycodeaccessstrategy)
### constructor​


[​](#constructor)
### canAccessOrder​


[​](#canaccessorder-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)


---

# OrderCodeStrategy


## OrderCodeStrategy​


[​](#ordercodestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-code-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/order-code-strategy.ts#L39)The OrderCodeStrategy determines how Order codes are generated.
A custom strategy can be defined which e.g. integrates with an
existing system to generate a code:

This is configured via the orderOptions.orderCodeStrategy property of
your VendureConfig.

Example

```
class MyOrderCodeStrategy implements OrderCodeStrategy {  // Some imaginary service which calls out to an existing external  // order management system.  private mgmtService: ExternalOrderManagementService;  init(injector: Injector) {    this.mgmtService = injector.get(ExternalOrderManagementService);  }  async generate(ctx: RequestContext) {    const result = await this.mgmtService.getAvailableOrderParams();    return result.code;  }}
```

```
interface OrderCodeStrategy extends InjectableStrategy {    generate(ctx: RequestContext): string | Promise<string>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### generate​


[​](#generate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Generates the order code.

## DefaultOrderCodeStrategy​


[​](#defaultordercodestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-code-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/order-code-strategy.ts#L55)The default OrderCodeStrategy generates a random string consisting
of 16 uppercase letters and numbers.

```
class DefaultOrderCodeStrategy implements OrderCodeStrategy {    generate(ctx: RequestContext) => string;}
```

- Implements: OrderCodeStrategy

[OrderCodeStrategy](/reference/typescript-api/orders/order-code-strategy#ordercodestrategy)
### generate​


[​](#generate-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)


---

# OrderInterceptor


## OrderInterceptor​


[​](#orderinterceptor)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-interceptor.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/order-interceptor.ts#L214)An OrderInterceptor is a class which can be used to intercept and modify the behavior of order-related
operations.

It does this by providing methods which are called whenever the contents of an order are about
to get changed. These methods are able to prevent the operation from proceeding by returning a string
error message.

Examples of use-cases for an OrderInterceptor include:

- Preventing certain products from being added to the order based on some criteria, e.g. if the
product is already in another active order.
- Enforcing a minimum or maximum quantity of a given product in the order
- Using a CAPTCHA to prevent automated order creation

This is configured via the orderOptions.orderInterceptors property of
your VendureConfig.

OrderInterceptors are executed when the following mutations are called:

- addItemToOrder
- adjustOrderLine
- removeItemFromOrder

Additionally, if you are working directly with the OrderService, the following methods will trigger
any registered OrderInterceptors:

[OrderService](/reference/typescript-api/services/order-service#orderservice)- addItemToOrder
- addItemsToOrder
- adjustOrderLine
- adjustOrderLines
- removeItemFromOrder
- removeItemsFromOrder

When an OrderInterceptor is registered, it will be called in the order in which it was registered.
If an interceptor method resolves to a string, the operation will be prevented and the string will be used as the error message.

When multiple interceptors are registered, the first interceptor to resolve to a string will prevent the operation from proceeding.

Errors returned by OrderInterceptors are surfaced to the GraphQL API as an OrderInterceptorError and can be
queried like this:

```
mutation AddItemToOrder($productVariantId: ID!, $quantity: Int!) {  addItemToOrder(productVariantId: $productVariantId, quantity: $quantity) {    ... on Order {      id      code      # ... other Order fields    }    ... on ErrorResult {      errorCode      message    }    ... on OrderInterceptorError {      interceptorError    }  }}

```

In the above example, the error message returned by the OrderInterceptor would be available in the interceptorError field.

## Example: Min/max order quantity​


[​](#example-minmax-order-quantity)Let's say we want to allow ProductVariants to specify the minimum or maximum amount which may be added
to an order. We can define custom fields to store this information and
then use this custom field value to prevent an order line from being added to the order if the quantity
is below the minimum.

Example

```
import {  EntityHydrator,  Injector,  LanguageCode,  Order,  OrderInterceptor,  ProductVariant,  RequestContext,  TranslatorService,  VendurePlugin,  WillAddItemToOrderInput,  WillAdjustOrderLineInput,} from '@vendure/core';declare module '@vendure/core/dist/entity/custom-entity-fields' {  interface CustomProductVariantFields {    minOrderQuantity?: number;    maxOrderQuantity?: number;  }}// This OrderInterceptor enforces minimum and maximum order quantities on ProductVariants.export class MinMaxOrderInterceptor implements OrderInterceptor { private entityHydrator: EntityHydrator; private translatorService: TranslatorService; init(injector: Injector) {   this.entityHydrator = injector.get(EntityHydrator);   this.translatorService = injector.get(TranslatorService); } willAddItemToOrder(   ctx: RequestContext,   order: Order,   input: WillAddItemToOrderInput, ): Promise<void | string> | void | string {   const { productVariant, quantity } = input;   const min = productVariant.customFields?.minOrderQuantity;   const max = productVariant.customFields?.maxOrderQuantity;   if (min && quantity < min) {     return this.minErrorMessage(ctx, productVariant, min);   }   if (max && quantity > max) {     return this.maxErrorMessage(ctx, productVariant, max);   } } willAdjustOrderLine(   ctx: RequestContext,   order: Order,   input: WillAdjustOrderLineInput, ): Promise<void | string> | void | string {   const { orderLine, quantity } = input;   const min = orderLine.productVariant.customFields?.minOrderQuantity;   const max = orderLine.productVariant.customFields?.maxOrderQuantity;   if (min && quantity < min) {     return this.minErrorMessage(ctx, orderLine.productVariant, min);   }   if (max && quantity > max) {     return this.maxErrorMessage(ctx, orderLine.productVariant, max);   } } private async minErrorMessage(ctx: RequestContext, variant: ProductVariant, min: number) {   const variantName = await this.getTranslatedVariantName(ctx, variant);   return `Minimum order quantity for "${variantName}" is ${min}`; } private async maxErrorMessage(ctx: RequestContext, variant: ProductVariant, max: number) {   const variantName = await this.getTranslatedVariantName(ctx, variant);   return `Maximum order quantity for "${variantName}" is ${max}`; } private async getTranslatedVariantName(ctx: RequestContext, variant: ProductVariant) {   await this.entityHydrator.hydrate(ctx, variant, { relations: ['translations'] });   const translated = this.translatorService.translate(variant, ctx);   return translated.name; }}// This plugin enforces minimum and maximum order quantities on ProductVariants.// It adds two new custom fields to ProductVariant:// - minOrderQuantity// - maxOrderQuantity//// It also adds an OrderInterceptor which enforces these limits.@VendurePlugin({ configuration: config => { // Here we add the custom fields to the ProductVariant entity   config.customFields.ProductVariant.push({     type: 'int',     min: 0,     name: 'minOrderQuantity',     label: [{ languageCode: LanguageCode.en, value: 'Minimum order quantity' }],     nullable: true,   });   config.customFields.ProductVariant.push({     type: 'int',     min: 0,     name: 'maxOrderQuantity',     label: [{ languageCode: LanguageCode.en, value: 'Maximum order quantity' }],     nullable: true,   });   // Here we add the MinMaxOrderInterceptor to the orderInterceptors array   config.orderOptions.orderInterceptors.push(new MinMaxOrderInterceptor());   return config; },})export class OrderQuantityLimitsPlugin {}
```

```
interface OrderInterceptor extends InjectableStrategy {    willAddItemToOrder?(        ctx: RequestContext,        order: Order,        input: WillAddItemToOrderInput,    ): Promise<void | string> | void | string;    willAdjustOrderLine?(        ctx: RequestContext,        order: Order,        input: WillAdjustOrderLineInput,    ): Promise<void | string> | void | string;    willRemoveItemFromOrder?(        ctx: RequestContext,        order: Order,        orderLine: OrderLine,    ): Promise<void | string> | void | string;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### willAddItemToOrder​


[​](#willadditemtoorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)Called when a new item is about to be added to the order,
as in the addItemToOrder mutation or the addItemToOrder() / addItemsToOrder() method
of the OrderService.

[OrderService](/reference/typescript-api/services/order-service#orderservice)
### willAdjustOrderLine​


[​](#willadjustorderline)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)Called when an existing order line is about to be adjusted,
as in the adjustOrderLine mutation or the adjustOrderLine() / adjustOrderLines() method
of the OrderService.

[OrderService](/reference/typescript-api/services/order-service#orderservice)
### willRemoveItemFromOrder​


[​](#willremoveitemfromorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[OrderLine](/reference/typescript-api/entities/order-line#orderline)Called when an item is about to be removed from the order,
as in the removeItemFromOrder mutation or the removeItemFromOrder() / removeItemsFromOrder() method
of the OrderService.

[OrderService](/reference/typescript-api/services/order-service#orderservice)


---

# OrderItemPriceCalculationStrategy


## OrderItemPriceCalculationStrategy​


[​](#orderitempricecalculationstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-item-price-calculation-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/order-item-price-calculation-strategy.ts#L60)The OrderItemPriceCalculationStrategy defines the listPrice of an OrderLine when adding an item to an Order. By default the
DefaultOrderItemPriceCalculationStrategy is used.

[DefaultOrderItemPriceCalculationStrategy](/reference/typescript-api/orders/default-order-item-price-calculation-strategy#defaultorderitempricecalculationstrategy)This is configured via the orderOptions.orderItemPriceCalculationStrategy property of
your VendureConfig.

### When is the strategy invoked ?​


[​](#when-is-the-strategy-invoked-)- addItemToOrder (only on the new order line)
- adjustOrderLine  (only on the adjusted order line)
- setOrderShippingAddress (on all order lines)
- setOrderBillingAddress (on all order lines)

### OrderItemPriceCalculationStrategy vs Promotions​


[​](#orderitempricecalculationstrategy-vs-promotions)Both the OrderItemPriceCalculationStrategy and Promotions can be used to alter the price paid for a product.

The main difference is when a Promotion is applied, it adds a discount line to the Order, and the regular
price is used for the value of OrderLine.listPrice property, whereas
the OrderItemPriceCalculationStrategy actually alters the value of OrderLine.listPrice itself, and does not
add any discounts to the Order.

Use OrderItemPriceCalculationStrategy if:

- The price calculation is based on the properties of the ProductVariant and any CustomFields
specified on the OrderLine, for example via a product configurator.
- The logic is a permanent part of your business requirements.

Use Promotions if:

- You want to implement "discounts" and "special offers"
- The calculation is not a permanent part of your business requirements.
- The price depends on dynamic aspects such as quantities and which other
ProductVariants are in the Order.
- The configuration of the logic needs to be manipulated via the Admin UI.

### Example use-cases​


[​](#example-use-cases)A custom OrderItemPriceCalculationStrategy can be used to implement things like:

- A gift-wrapping service, where a boolean custom field is defined on the OrderLine. If true,
a gift-wrapping surcharge would be added to the price.
- A product-configurator where e.g. various finishes, colors, and materials can be selected and stored
as OrderLine custom fields (see the Custom Fields guide.
- Price lists or bulk pricing, where different price bands are stored e.g. in a customField on the ProductVariant, and this
is used to calculate the price based on the current quantity.

[the Custom Fields guide](/guides/developer-guide/custom-fields/)
```
interface OrderItemPriceCalculationStrategy extends InjectableStrategy {    calculateUnitPrice(        ctx: RequestContext,        productVariant: ProductVariant,        orderLineCustomFields: { [key: string]: any },        order: Order,        quantity: number,    ): PriceCalculationResult | Promise<PriceCalculationResult>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### calculateUnitPrice​


[​](#calculateunitprice)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[Order](/reference/typescript-api/entities/order#order)[PriceCalculationResult](/reference/typescript-api/common/price-calculation-result#pricecalculationresult)[PriceCalculationResult](/reference/typescript-api/common/price-calculation-result#pricecalculationresult)Receives the ProductVariant to be added to the Order as well as any OrderLine custom fields and returns
the price for a single unit.

Note: if you have any relation type custom fields defined on the OrderLine entity, they will only be
passed in to this method if they are set to eager: true. Otherwise, you can use the EntityHydratorto join the missing relations.

[EntityHydrator](/reference/typescript-api/data-access/entity-hydrator#entityhydrator)Note: the quantity argument was added in v2.0.0


---

# OrderMergeStrategy


## OrderMergeStrategy​


[​](#ordermergestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-merge-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/order-merge-strategy.ts#L48)An OrderMergeStrategy defines what happens when a Customer with an existing Order
signs in with a guest Order, where both Orders may contain differing OrderLines.

Somehow these differing OrderLines need to be reconciled into a single collection
of OrderLines. The OrderMergeStrategy defines the rules governing this reconciliation.

This is configured via the orderOptions.mergeStrategy property of
your VendureConfig.

```
interface OrderMergeStrategy extends InjectableStrategy {    merge(ctx: RequestContext, guestOrder: Order, existingOrder: Order): MergedOrderLine[];}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### merge​


[​](#merge)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Order](/reference/typescript-api/entities/order#order)[MergedOrderLine](/reference/typescript-api/orders/order-merge-strategy#mergedorderline)Merges the lines of the guest Order with those of the existing Order which is associated
with the active customer.

## MergedOrderLine​


[​](#mergedorderline)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-merge-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/order-merge-strategy.ts#L15)The result of the OrderMergeStrategy merge method.

[OrderMergeStrategy](/reference/typescript-api/orders/order-merge-strategy#ordermergestrategy)
```
interface MergedOrderLine {    orderLineId: ID;    quantity: number;    customFields?: any;}
```

### orderLineId​


[​](#orderlineid)[ID](/reference/typescript-api/common/id#id)
### quantity​


[​](#quantity)
### customFields​


[​](#customfields)


---

# OrderOptions


## OrderOptions​


[​](#orderoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts#L521)
```
interface OrderOptions {    orderItemsLimit?: number;    orderLineItemsLimit?: number;    orderItemPriceCalculationStrategy?: OrderItemPriceCalculationStrategy;    process?: Array<OrderProcess<any>>;    stockAllocationStrategy?: StockAllocationStrategy;    mergeStrategy?: OrderMergeStrategy;    checkoutMergeStrategy?: OrderMergeStrategy;    orderCodeStrategy?: OrderCodeStrategy;    orderByCodeAccessStrategy?: OrderByCodeAccessStrategy;    changedPriceHandlingStrategy?: ChangedPriceHandlingStrategy;    orderPlacedStrategy?: OrderPlacedStrategy;    activeOrderStrategy?: ActiveOrderStrategy<any> | Array<ActiveOrderStrategy<any>>;    orderSellerStrategy?: OrderSellerStrategy;    guestCheckoutStrategy?: GuestCheckoutStrategy;    orderInterceptors?: OrderInterceptor[];}
```

### orderItemsLimit​


[​](#orderitemslimit)The maximum number of individual items allowed in a single order. This option exists
to prevent excessive resource usage when dealing with very large orders. For example,
if an order contains a million items, then any operations on that order (modifying a quantity,
adding or removing an item) will require Vendure to loop through all million items
to perform price calculations against active promotions and taxes. This can have a significant
performance impact for very large values.

Attempting to exceed this limit will cause Vendure to throw a OrderLimitError.

### orderLineItemsLimit​


[​](#orderlineitemslimit)The maximum number of items allowed per order line. This option is an addition
on the orderItemsLimit for more granular control. Note orderItemsLimit is still
important in order to prevent excessive resource usage.

Attempting to exceed this limit will cause Vendure to throw a OrderLimitError`.

### orderItemPriceCalculationStrategy​


[​](#orderitempricecalculationstrategy)[OrderItemPriceCalculationStrategy](/reference/typescript-api/orders/order-item-price-calculation-strategy#orderitempricecalculationstrategy)Defines the logic used to calculate the unit price of an OrderLine when adding an
item to an Order.

### process​


[​](#process)[OrderProcess](/reference/typescript-api/orders/order-process#orderprocess)Allows the definition of custom states and transition logic for the order process state machine.
Takes an array of objects implementing the OrderProcess interface.

[OrderProcess](/reference/typescript-api/orders/order-process#orderprocess)
### stockAllocationStrategy​


[​](#stockallocationstrategy)[StockAllocationStrategy](/reference/typescript-api/orders/stock-allocation-strategy#stockallocationstrategy)[DefaultStockAllocationStrategy](/reference/typescript-api/orders/default-stock-allocation-strategy#defaultstockallocationstrategy)Determines the point of the order process at which stock gets allocated.

### mergeStrategy​


[​](#mergestrategy)[OrderMergeStrategy](/reference/typescript-api/orders/order-merge-strategy#ordermergestrategy)[MergeOrdersStrategy](/reference/typescript-api/orders/merge-strategies#mergeordersstrategy)Defines the strategy used to merge a guest Order and an existing Order when
signing in.

### checkoutMergeStrategy​


[​](#checkoutmergestrategy)[OrderMergeStrategy](/reference/typescript-api/orders/order-merge-strategy#ordermergestrategy)[UseGuestStrategy](/reference/typescript-api/orders/merge-strategies#usegueststrategy)Defines the strategy used to merge a guest Order and an existing Order when
signing in as part of the checkout flow.

### orderCodeStrategy​


[​](#ordercodestrategy)[OrderCodeStrategy](/reference/typescript-api/orders/order-code-strategy#ordercodestrategy)[DefaultOrderCodeStrategy](/reference/typescript-api/orders/order-code-strategy#defaultordercodestrategy)Allows a user-defined function to create Order codes. This can be useful when
integrating with existing systems. By default, Vendure will generate a 16-character
alphanumeric string.

Note: when using a custom function for Order codes, bear in mind the database limit
for string types (e.g. 255 chars for a varchar field in MySQL), and also the need
for codes to be unique.

### orderByCodeAccessStrategy​


[​](#orderbycodeaccessstrategy)[OrderByCodeAccessStrategy](/reference/typescript-api/orders/order-by-code-access-strategy#orderbycodeaccessstrategy)[DefaultOrderByCodeAccessStrategy](/reference/typescript-api/orders/order-by-code-access-strategy#defaultorderbycodeaccessstrategy)Defines the strategy used to check if and how an Order may be retrieved via the orderByCode query.

The default strategy permits permanent access to the Customer owning the Order and anyone
within 2 hours after placing the Order.

### changedPriceHandlingStrategy​


[​](#changedpricehandlingstrategy)[ChangedPriceHandlingStrategy](/reference/typescript-api/orders/changed-price-handling-strategy#changedpricehandlingstrategy)Defines how we handle the situation where an item exists in an Order, and
then later on another is added but in the meantime the price of the ProductVariant has changed.

By default, the latest price will be used. Any price changes resulting from using a newer price
will be reflected in the GraphQL OrderLine.unitPrice[WithTax]ChangeSinceAdded field.

### orderPlacedStrategy​


[​](#orderplacedstrategy)[OrderPlacedStrategy](/reference/typescript-api/orders/order-placed-strategy#orderplacedstrategy)[DefaultOrderPlacedStrategy](/reference/typescript-api/orders/default-order-placed-strategy#defaultorderplacedstrategy)Defines the point of the order process at which the Order is set as "placed".

### activeOrderStrategy​


[​](#activeorderstrategy)[ActiveOrderStrategy](/reference/typescript-api/orders/active-order-strategy#activeorderstrategy)[ActiveOrderStrategy](/reference/typescript-api/orders/active-order-strategy#activeorderstrategy)[DefaultActiveOrderStrategy](/reference/typescript-api/orders/default-active-order-strategy#defaultactiveorderstrategy)Defines the strategy used to determine the active Order when interacting with Shop API operations
such as activeOrder and addItemToOrder. By default, the strategy uses the active Session.

Note that if multiple strategies are defined, they will be checked in order and the first one that
returns an Order will be used.

### orderSellerStrategy​


[​](#ordersellerstrategy)[OrderSellerStrategy](/reference/typescript-api/orders/order-seller-strategy#ordersellerstrategy)[DefaultOrderSellerStrategy](/reference/typescript-api/orders/order-seller-strategy#defaultordersellerstrategy)Defines how Orders will be split amongst multiple Channels in a multivendor scenario.

### guestCheckoutStrategy​


[​](#guestcheckoutstrategy)[GuestCheckoutStrategy](/reference/typescript-api/orders/guest-checkout-strategy#guestcheckoutstrategy)[DefaultGuestCheckoutStrategy](/reference/typescript-api/orders/default-guest-checkout-strategy#defaultguestcheckoutstrategy)Defines how we deal with guest checkouts.

### orderInterceptors​


[​](#orderinterceptors)[OrderInterceptor](/reference/typescript-api/orders/order-interceptor#orderinterceptor)An array of OrderInterceptors which can be used to modify the behavior of the Order process.

[OrderInterceptor](/reference/typescript-api/orders/order-interceptor#orderinterceptor)


---

# OrderPlacedStrategy


## OrderPlacedStrategy​


[​](#orderplacedstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-placed-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/order-placed-strategy.ts#L24)This strategy is responsible for deciding at which stage in the order process
the Order will be set as "placed" (i.e. the Customer has checked out, and
next it must be processed by an Administrator).

By default, the order is set as "placed" when it transitions from
'ArrangingPayment' to either 'PaymentAuthorized' or 'PaymentSettled'.

This is configured via the orderOptions.orderPlacedStrategy property of
your VendureConfig.

```
interface OrderPlacedStrategy extends InjectableStrategy {    shouldSetAsPlaced(        ctx: RequestContext,        fromState: OrderState,        toState: OrderState,        order: Order,    ): boolean | Promise<boolean>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### shouldSetAsPlaced​


[​](#shouldsetasplaced)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[OrderState](/reference/typescript-api/orders/order-process#orderstate)[OrderState](/reference/typescript-api/orders/order-process#orderstate)[Order](/reference/typescript-api/entities/order#order)This method is called whenever an active Order transitions from one state to another.
If it resolves to true, then the Order will be set as "placed", which means:

- Order.active = false
- Order.placedAt = new Date()
- Any active Promotions are linked to the Order

---

# OrderProcess


## OrderProcess​


[​](#orderprocess)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-process.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/order-process.ts#L35)An OrderProcess is used to define the way the order process works as in: what states an Order can be
in, and how it may transition from one state to another. Using the onTransitionStart() hook, an
OrderProcess can perform checks before allowing a state transition to occur, and the onTransitionEnd()
hook allows logic to be executed after a state change.

For detailed description of the interface members, see the StateMachineConfig docs.

[StateMachineConfig](/reference/typescript-api/state-machine/state-machine-config#statemachineconfig)This is configured via the orderOptions.process property of
your VendureConfig.

```
interface OrderProcess<State extends keyof CustomOrderStates | string> extends InjectableStrategy {    transitions?: Transitions<State, State | OrderState> & Partial<Transitions<OrderState | State>>;    onTransitionStart?: OnTransitionStartFn<State | OrderState, OrderTransitionData>;    onTransitionEnd?: OnTransitionEndFn<State | OrderState, OrderTransitionData>;    onTransitionError?: OnTransitionErrorFn<State | OrderState>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### transitions​


[​](#transitions)[Transitions](/reference/typescript-api/state-machine/transitions#transitions)[OrderState](/reference/typescript-api/orders/order-process#orderstate)[Transitions](/reference/typescript-api/state-machine/transitions#transitions)[OrderState](/reference/typescript-api/orders/order-process#orderstate)
### onTransitionStart​


[​](#ontransitionstart)[OnTransitionStartFn](/reference/typescript-api/state-machine/state-machine-config#ontransitionstartfn)[OrderState](/reference/typescript-api/orders/order-process#orderstate)[OrderTransitionData](/reference/typescript-api/orders/order-process#ordertransitiondata)
### onTransitionEnd​


[​](#ontransitionend)[OnTransitionEndFn](/reference/typescript-api/state-machine/state-machine-config#ontransitionendfn)[OrderState](/reference/typescript-api/orders/order-process#orderstate)[OrderTransitionData](/reference/typescript-api/orders/order-process#ordertransitiondata)
### onTransitionError​


[​](#ontransitionerror)[OnTransitionErrorFn](/reference/typescript-api/state-machine/state-machine-config#ontransitionerrorfn)[OrderState](/reference/typescript-api/orders/order-process#orderstate)
## DefaultOrderProcessOptions​


[​](#defaultorderprocessoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-order-process.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/default-order-process.ts#L50)Options which can be passed to the configureDefaultOrderProcess function
to configure an instance of the default OrderProcess. By default, all
options are set to true.

[configureDefaultOrderProcess](/reference/typescript-api/orders/order-process#configuredefaultorderprocess)[OrderProcess](/reference/typescript-api/orders/order-process#orderprocess)
```
interface DefaultOrderProcessOptions {    checkModificationPayments?: boolean;    checkAdditionalPaymentsAmount?: boolean;    checkAllVariantsExist?: boolean;    arrangingPaymentRequiresContents?: boolean;    arrangingPaymentRequiresCustomer?: boolean;    arrangingPaymentRequiresShipping?: boolean;    arrangingPaymentRequiresStock?: boolean;    checkPaymentsCoverTotal?: boolean;    checkAllItemsBeforeCancel?: boolean;    checkFulfillmentStates?: boolean;}
```

### checkModificationPayments​


[​](#checkmodificationpayments)Prevents an Order from transitioning out of the Modifying state if
the Order price has changed and there is no Payment or Refund associated
with the Modification.

### checkAdditionalPaymentsAmount​


[​](#checkadditionalpaymentsamount)Prevents an Order from transitioning out of the ArrangingAdditionalPayment state if
the Order's Payments do not cover the full amount of totalWithTax.

### checkAllVariantsExist​


[​](#checkallvariantsexist)Prevents the transition from AddingItems to any other state (apart from Cancelled) if
and of the ProductVariants no longer exists due to deletion.

### arrangingPaymentRequiresContents​


[​](#arrangingpaymentrequirescontents)Prevents transition to the ArrangingPayment state if the active Order has no lines.

### arrangingPaymentRequiresCustomer​


[​](#arrangingpaymentrequirescustomer)Prevents transition to the ArrangingPayment state if the active Order has no customer
associated with it.

### arrangingPaymentRequiresShipping​


[​](#arrangingpaymentrequiresshipping)Prevents transition to the ArrangingPayment state if the active Order has no shipping
method set.

### arrangingPaymentRequiresStock​


[​](#arrangingpaymentrequiresstock)Prevents transition to the ArrangingPayment state if there is insufficient saleable
stock to cover the contents of the Order.

### checkPaymentsCoverTotal​


[​](#checkpaymentscovertotal)Prevents transition to the PaymentAuthorized or PaymentSettled states if the order
totalWithTax amount is not covered by Payment(s) in the corresponding states.

### checkAllItemsBeforeCancel​


[​](#checkallitemsbeforecancel)Prevents transition to the Cancelled state unless all OrderItems are already
cancelled.

### checkFulfillmentStates​


[​](#checkfulfillmentstates)Prevents transition to the Shipped, PartiallyShipped, Delivered & PartiallyDelivered states unless
there are corresponding Fulfillments in the correct states to allow this. E.g. Shipped only if all items in
the Order are part of a Fulfillment which itself is in the Shipped state.

## configureDefaultOrderProcess​


[​](#configuredefaultorderprocess)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-order-process.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/default-order-process.ts#L163)Used to configure a customized instance of the default OrderProcess that ships with Vendure.
Using this function allows you to turn off certain checks and constraints that are enabled by default.

[OrderProcess](/reference/typescript-api/orders/order-process#orderprocess)
```
import { configureDefaultOrderProcess, VendureConfig } from '@vendure/core';const myCustomOrderProcess = configureDefaultOrderProcess({  // Disable the constraint that requires  // Orders to have a shipping method assigned  // before payment.  arrangingPaymentRequiresShipping: false,});export const config: VendureConfig = {  orderOptions: {    process: [myCustomOrderProcess],  },};
```

The DefaultOrderProcessOptions type defines all available options. If you require even
more customization, you can create your own implementation of the OrderProcess interface.

[DefaultOrderProcessOptions](/reference/typescript-api/orders/order-process#defaultorderprocessoptions)[OrderProcess](/reference/typescript-api/orders/order-process#orderprocess)
```
function configureDefaultOrderProcess(options: DefaultOrderProcessOptions): void
```

Parameters

### options​


[​](#options)[DefaultOrderProcessOptions](/reference/typescript-api/orders/order-process#defaultorderprocessoptions)
## defaultOrderProcess​


[​](#defaultorderprocess)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-order-process.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/default-order-process.ts#L475)This is the built-in OrderProcess that ships with Vendure. A customized version of this process
can be created using the configureDefaultOrderProcess function, which allows you to pass in an object
to enable/disable certain checks.

[OrderProcess](/reference/typescript-api/orders/order-process#orderprocess)[configureDefaultOrderProcess](/reference/typescript-api/orders/order-process#configuredefaultorderprocess)
## OrderStates​


[​](#orderstates)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-state.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/order-state-machine/order-state.ts#L21)An interface to extend the OrderState type.

[OrderState](/reference/typescript-api/orders/order-process#orderstate)
```
interface OrderStates {}
```

## OrderState​


[​](#orderstate)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-state.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/order-state-machine/order-state.ts#L42)These are the default states of the Order process. They can be augmented and
modified by using the OrderOptions process property, and by default
the defaultOrderProcess will add the states

[OrderOptions](/reference/typescript-api/orders/order-options#orderoptions)[defaultOrderProcess](/reference/typescript-api/orders/order-process#defaultorderprocess)- ArrangingPayment
- PaymentAuthorized
- PaymentSettled
- PartiallyShipped
- Shipped
- PartiallyDelivered
- Delivered
- Modifying
- ArrangingAdditionalPayment

```
type OrderState = | 'Created'    | 'Draft'    | 'AddingItems'    | 'Cancelled'    | keyof CustomOrderStates    | keyof OrderStates
```

## OrderTransitionData​


[​](#ordertransitiondata)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-state.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/order-state-machine/order-state.ts#L57)This is the object passed to the OrderProcess state transition hooks.

[OrderProcess](/reference/typescript-api/orders/order-process#orderprocess)
```
interface OrderTransitionData {    ctx: RequestContext;    order: Order;}
```

### ctx​


[​](#ctx)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### order​


[​](#order)[Order](/reference/typescript-api/entities/order#order)


---

# OrderSellerStrategy


## OrderSellerStrategy​


[​](#ordersellerstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-seller-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/order-seller-strategy.ts#L43)This strategy defines how an Order can be split into multiple sub-orders for the use-case of
a multivendor application.

This is configured via the orderOptions.orderSellerStrategy property of
your VendureConfig.

```
interface OrderSellerStrategy extends InjectableStrategy {    setOrderLineSellerChannel?(        ctx: RequestContext,        orderLine: OrderLine,    ): Channel | undefined | Promise<Channel | undefined>;    splitOrder?(ctx: RequestContext, order: Order): SplitOrderContents[] | Promise<SplitOrderContents[]>;    afterSellerOrdersCreated?(        ctx: RequestContext,        aggregateOrder: Order,        sellerOrders: Order[],    ): void | Promise<void>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### setOrderLineSellerChannel​


[​](#setorderlinesellerchannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[OrderLine](/reference/typescript-api/entities/order-line#orderline)[Channel](/reference/typescript-api/entities/channel#channel)[Channel](/reference/typescript-api/entities/channel#channel)This method is called whenever a new OrderLine is added to the Order via the addItemToOrder mutation or the
underlying addItemToOrder() method of the OrderService.

[OrderService](/reference/typescript-api/services/order-service#orderservice)It should return the Channel to which this OrderLine will be assigned, which will be used to set the
OrderLine sellerChannel property.

[OrderLine](/reference/typescript-api/entities/order-line#orderline)
### splitOrder​


[​](#splitorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[SplitOrderContents](/reference/typescript-api/orders/order-seller-strategy#splitordercontents)[SplitOrderContents](/reference/typescript-api/orders/order-seller-strategy#splitordercontents)Upon checkout (by default, when the Order moves from "active" to "inactive" according to the OrderPlacedStrategy),
this method will be called in order to split the Order into multiple Orders, one for each Seller.

[OrderPlacedStrategy](/reference/typescript-api/orders/order-placed-strategy#orderplacedstrategy)
### afterSellerOrdersCreated​


[​](#aftersellerorderscreated)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Order](/reference/typescript-api/entities/order#order)This method is called after splitting the orders, including calculating the totals for each of the seller Orders.
This method can be used to set platform fee surcharges on the seller Orders as well as perform any payment processing
needed.

## DefaultOrderSellerStrategy​


[​](#defaultordersellerstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-order-seller-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/default-order-seller-strategy.ts#L11)The DefaultOrderSellerStrategy treats the Order as single-vendor.

```
class DefaultOrderSellerStrategy implements OrderSellerStrategy {}
```

- Implements: OrderSellerStrategy

[OrderSellerStrategy](/reference/typescript-api/orders/order-seller-strategy#ordersellerstrategy)
## SplitOrderContents​


[​](#splitordercontents)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-seller-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/order-seller-strategy.ts#L19)The contents of the aggregate Order which make up a single seller Order.

```
interface SplitOrderContents {    channelId: ID;    state: OrderState;    lines: OrderLine[];    shippingLines: ShippingLine[];}
```

### channelId​


[​](#channelid)[ID](/reference/typescript-api/common/id#id)
### state​


[​](#state)[OrderState](/reference/typescript-api/orders/order-process#orderstate)
### lines​


[​](#lines)[OrderLine](/reference/typescript-api/entities/order-line#orderline)
### shippingLines​


[​](#shippinglines)[ShippingLine](/reference/typescript-api/entities/shipping-line#shippingline)


---

# StockAllocationStrategy


## StockAllocationStrategy​


[​](#stockallocationstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[stock-allocation-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/order/stock-allocation-strategy.ts#L20)This strategy is responsible for deciding at which stage in the order process
stock will be allocated.

This is configured via the orderOptions.stockAllocationStrategy property of
your VendureConfig.

```
interface StockAllocationStrategy extends InjectableStrategy {    shouldAllocateStock(        ctx: RequestContext,        fromState: OrderState,        toState: OrderState,        order: Order,    ): boolean | Promise<boolean>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### shouldAllocateStock​


[​](#shouldallocatestock)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[OrderState](/reference/typescript-api/orders/order-process#orderstate)[OrderState](/reference/typescript-api/orders/order-process#orderstate)[Order](/reference/typescript-api/entities/order#order)This method is called whenever an Order transitions from one state to another.
If it resolves to true, then stock will be allocated for this order.


---

# DefaultPaymentProcess


## defaultPaymentProcess​


[​](#defaultpaymentprocess)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-payment-process.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/payment/default-payment-process.ts#L26)The default PaymentProcess

[PaymentProcess](/reference/typescript-api/payment/payment-process#paymentprocess)

---

# DefaultRefundProcess


## defaultRefundProcess​


[​](#defaultrefundprocess)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-refund-process.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/refund/default-refund-process.ts#L16)The default RefundProcess.

[RefundProcess](/reference/typescript-api/payment/refund-process#refundprocess)

---

# DummyPaymentHandler


## dummyPaymentHandler​


[​](#dummypaymenthandler)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[dummy-payment-method-handler.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/payment/dummy-payment-method-handler.ts#L27)A dummy PaymentMethodHandler which simply creates a Payment without any integration
with an external payment provider. Intended only for use in development.

By specifying certain metadata keys, failures can be simulated:

Example

```
addPaymentToOrder(input: {  method: 'dummy-payment-method',  metadata: {    shouldDecline: false,    shouldError: false,    shouldErrorOnSettle: true,  }}) {  # ...}

```


---

# PaymentMethodConfigOptions


## PaymentMethodConfigOptions​


[​](#paymentmethodconfigoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-method-handler.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/payment/payment-method-handler.ts#L255)Defines the object which is used to construct the PaymentMethodHandler.

[PaymentMethodHandler](/reference/typescript-api/payment/payment-method-handler#paymentmethodhandler)
```
interface PaymentMethodConfigOptions<T extends ConfigArgs> extends ConfigurableOperationDefOptions<T> {    createPayment: CreatePaymentFn<T>;    settlePayment: SettlePaymentFn<T>;    cancelPayment?: CancelPaymentFn<T>;    createRefund?: CreateRefundFn<T>;    onStateTransitionStart?: OnTransitionStartFn<PaymentState, PaymentTransitionData>;}
```

- Extends: ConfigurableOperationDefOptions<T>

[ConfigurableOperationDefOptions](/reference/typescript-api/configurable-operation-def/configurable-operation-def-options#configurableoperationdefoptions)
### createPayment​


[​](#createpayment)[CreatePaymentFn](/reference/typescript-api/payment/payment-method-types#createpaymentfn)This function provides the logic for creating a payment. For example,
it may call out to a third-party service with the data and should return a
CreatePaymentResult object contains the details of the payment.

[CreatePaymentResult](/reference/typescript-api/payment/payment-method-types#createpaymentresult)
### settlePayment​


[​](#settlepayment)[SettlePaymentFn](/reference/typescript-api/payment/payment-method-types#settlepaymentfn)This function provides the logic for settling a payment, also known as "capturing".
For payment integrations that settle/capture the payment on creation (i.e. the
createPayment() method returns with a state of 'Settled') this method
need only return { success: true }.

### cancelPayment​


[​](#cancelpayment)[CancelPaymentFn](/reference/typescript-api/payment/payment-method-types#cancelpaymentfn)This function provides the logic for cancelling a payment, which would be invoked when a call is
made to the cancelPayment mutation in the Admin API. Cancelling a payment can apply
if, for example, you have created a "payment intent" with the payment provider but not yet
completed the payment. It allows the incomplete payment to be cleaned up on the provider's end
if it gets cancelled via Vendure.

### createRefund​


[​](#createrefund)[CreateRefundFn](/reference/typescript-api/payment/payment-method-types#createrefundfn)This function provides the logic for refunding a payment created with this
payment method. Some payment providers may not provide the facility to
programmatically create a refund. In such a case, this method should be
omitted and any Refunds will have to be settled manually by an administrator.

### onStateTransitionStart​


[​](#onstatetransitionstart)[OnTransitionStartFn](/reference/typescript-api/state-machine/state-machine-config#ontransitionstartfn)[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)[PaymentTransitionData](/reference/typescript-api/payment/payment-transition-data#paymenttransitiondata)This function, when specified, will be invoked before any transition from one PaymentState to another.
The return value (a sync / async boolean) is used to determine whether the transition is permitted.

[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)


---

# PaymentMethodEligibilityChecker


## PaymentMethodEligibilityChecker​


[​](#paymentmethodeligibilitychecker)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-method-eligibility-checker.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/payment/payment-method-eligibility-checker.ts#L47)The PaymentMethodEligibilityChecker class is used to check whether an order qualifies for a
given PaymentMethod.

[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)Example

```
const ccPaymentEligibilityChecker = new PaymentMethodEligibilityChecker({    code: 'order-total-payment-eligibility-checker',    description: [{ languageCode: LanguageCode.en, value: 'Checks that the order total is above some minimum value' }],    args: {        orderMinimum: { type: 'int', ui: { component: 'currency-form-input' } },    },    check: (ctx, order, args) => {        return order.totalWithTax >= args.orderMinimum;    },});
```

```
class PaymentMethodEligibilityChecker<T extends ConfigArgs = ConfigArgs> extends ConfigurableOperationDef<T> {    constructor(config: PaymentMethodEligibilityCheckerConfig<T>)}
```

- Extends: ConfigurableOperationDef<T>

[ConfigurableOperationDef](/reference/typescript-api/configurable-operation-def/#configurableoperationdef)
### constructor​


[​](#constructor)[PaymentMethodEligibilityCheckerConfig](/reference/typescript-api/payment/payment-method-eligibility-checker#paymentmethodeligibilitycheckerconfig)
## PaymentMethodEligibilityCheckerConfig​


[​](#paymentmethodeligibilitycheckerconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-method-eligibility-checker.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/payment/payment-method-eligibility-checker.ts#L20)Configuration passed into the constructor of a PaymentMethodEligibilityChecker to
configure its behavior.

[PaymentMethodEligibilityChecker](/reference/typescript-api/payment/payment-method-eligibility-checker#paymentmethodeligibilitychecker)
```
interface PaymentMethodEligibilityCheckerConfig<T extends ConfigArgs> extends ConfigurableOperationDefOptions<T> {    check: CheckPaymentMethodEligibilityCheckerFn<T>;}
```

- Extends: ConfigurableOperationDefOptions<T>

[ConfigurableOperationDefOptions](/reference/typescript-api/configurable-operation-def/configurable-operation-def-options#configurableoperationdefoptions)
### check​


[​](#check)[CheckPaymentMethodEligibilityCheckerFn](/reference/typescript-api/payment/payment-method-eligibility-checker#checkpaymentmethodeligibilitycheckerfn)
## CheckPaymentMethodEligibilityCheckerFn​


[​](#checkpaymentmethodeligibilitycheckerfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-method-eligibility-checker.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/payment/payment-method-eligibility-checker.ts#L83)A function which implements logic to determine whether a given Order is eligible for
a particular payment method. If the function resolves to false or a string, the check is
considered to have failed. A string result can be used to provide information about the
reason for ineligibility, if desired.

[Order](/reference/typescript-api/entities/order#order)
```
type CheckPaymentMethodEligibilityCheckerFn<T extends ConfigArgs> = (    ctx: RequestContext,    order: Order,    args: ConfigArgValues<T>,    method: PaymentMethod,) => boolean | string | Promise<boolean | string>
```


---

# PaymentMethodHandler


## PaymentMethodHandler​


[​](#paymentmethodhandler)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-method-handler.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/payment/payment-method-handler.ts#L354)A PaymentMethodHandler contains the code which is used to generate a Payment when a call to the
addPaymentToOrder mutation is made. It contains any necessary steps of interfacing with a
third-party payment gateway before the Payment is created and can also define actions to fire
when the state of the payment is changed.

PaymentMethodHandlers are instantiated using a PaymentMethodConfigOptions object, which
configures the business logic used to create, settle and refund payments.

[PaymentMethodConfigOptions](/reference/typescript-api/payment/payment-method-config-options#paymentmethodconfigoptions)Example

```
import { PaymentMethodHandler, CreatePaymentResult, SettlePaymentResult, LanguageCode } from '@vendure/core';// A mock 3rd-party payment SDKimport gripeSDK from 'gripe';export const examplePaymentHandler = new PaymentMethodHandler({  code: 'example-payment-provider',  description: [{    languageCode: LanguageCode.en,    value: 'Example Payment Provider',  }],  args: {    apiKey: { type: 'string' },  },  createPayment: async (ctx, order, amount, args, metadata): Promise<CreatePaymentResult> => {    try {      const result = await gripeSDK.charges.create({        amount,        apiKey: args.apiKey,        source: metadata.authToken,      });      return {        amount: order.total,        state: 'Settled' as const,        transactionId: result.id.toString(),        metadata: result.outcome,      };    } catch (err: any) {      return {        amount: order.total,        state: 'Declined' as const,        metadata: {          errorMessage: err.message,        },      };    }  },  settlePayment: async (ctx, order, payment, args): Promise<SettlePaymentResult> => {    return { success: true };  }});
```

```
class PaymentMethodHandler<T extends ConfigArgs = ConfigArgs> extends ConfigurableOperationDef<T> {    constructor(config: PaymentMethodConfigOptions<T>)}
```

- Extends: ConfigurableOperationDef<T>

[ConfigurableOperationDef](/reference/typescript-api/configurable-operation-def/#configurableoperationdef)
### constructor​


[​](#constructor)[PaymentMethodConfigOptions](/reference/typescript-api/payment/payment-method-config-options#paymentmethodconfigoptions)


---

# Payment Method Types


## CreatePaymentResult​


[​](#createpaymentresult)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-method-handler.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/payment/payment-method-handler.ts#L30)This object is the return value of the CreatePaymentFn.

[CreatePaymentFn](/reference/typescript-api/payment/payment-method-types#createpaymentfn)
```
interface CreatePaymentResult {    amount: number;    state: Exclude<PaymentState, 'Error'>;    transactionId?: string;    errorMessage?: string;    metadata?: PaymentMetadata;}
```

### amount​


[​](#amount)The amount (as an integer - i.e. $10 = 1000) that this payment is for.
Typically this should equal the Order total, unless multiple payment methods
are being used for the order.

### state​


[​](#state)[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)The PaymentState of the resulting Payment.

[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)In a single-step payment flow, this should be set to 'Settled'.
In a two-step flow, this should be set to 'Authorized'.

If using a PaymentProcess, may be something else
entirely according to your business logic.

[PaymentProcess](/reference/typescript-api/payment/payment-process#paymentprocess)
### transactionId​


[​](#transactionid)The unique payment reference code typically assigned by
the payment provider.

### errorMessage​


[​](#errormessage)If the payment is declined or fails for ome other reason, pass the
relevant error message here, and it gets returned with the
ErrorResponse of the addPaymentToOrder mutation.

### metadata​


[​](#metadata)This field can be used to store other relevant data which is often
provided by the payment provider, such as security data related to
the payment method or data used in troubleshooting or debugging.

Any data stored in the optional public property will be available
via the Shop API. This is useful for certain checkout flows such as
external gateways, where the payment provider returns a unique
url which must then be passed to the storefront app.

## CreatePaymentErrorResult​


[​](#createpaymenterrorresult)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-method-handler.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/payment/payment-method-handler.ts#L83)This object is the return value of the CreatePaymentFn when there has been an error.

[CreatePaymentFn](/reference/typescript-api/payment/payment-method-types#createpaymentfn)
```
interface CreatePaymentErrorResult {    amount: number;    state: 'Error';    transactionId?: string;    errorMessage: string;    metadata?: PaymentMetadata;}
```

### amount​


[​](#amount-1)
### state​


[​](#state-1)
### transactionId​


[​](#transactionid-1)
### errorMessage​


[​](#errormessage-1)
### metadata​


[​](#metadata-1)
## CreateRefundResult​


[​](#createrefundresult)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-method-handler.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/payment/payment-method-handler.ts#L98)This object is the return value of the CreateRefundFn.

[CreateRefundFn](/reference/typescript-api/payment/payment-method-types#createrefundfn)
```
interface CreateRefundResult {    state: RefundState;    transactionId?: string;    metadata?: PaymentMetadata;}
```

### state​


[​](#state-2)[RefundState](/reference/typescript-api/payment/refund-state#refundstate)
### transactionId​


[​](#transactionid-2)
### metadata​


[​](#metadata-2)
## SettlePaymentResult​


[​](#settlepaymentresult)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-method-handler.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/payment/payment-method-handler.ts#L112)This object is the return value of the SettlePaymentFn when the Payment
has been successfully settled.

[SettlePaymentFn](/reference/typescript-api/payment/payment-method-types#settlepaymentfn)
```
interface SettlePaymentResult {    success: true;    metadata?: PaymentMetadata;}
```

### success​


[​](#success)
### metadata​


[​](#metadata-3)
## SettlePaymentErrorResult​


[​](#settlepaymenterrorresult)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-method-handler.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/payment/payment-method-handler.ts#L125)This object is the return value of the SettlePaymentFn when the Payment
could not be settled.

[SettlePaymentFn](/reference/typescript-api/payment/payment-method-types#settlepaymentfn)
```
interface SettlePaymentErrorResult {    success: false;    state?: Exclude<PaymentState, 'Settled'>;    errorMessage?: string;    metadata?: PaymentMetadata;}
```

### success​


[​](#success-1)
### state​


[​](#state-3)[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)The state to transition this Payment to upon unsuccessful settlement.
Defaults to Error. Note that if using a different state, it must be
legal to transition to that state from the Authorized state according
to the PaymentState config (which can be customized using the
PaymentProcess).

[PaymentProcess](/reference/typescript-api/payment/payment-process#paymentprocess)
### errorMessage​


[​](#errormessage-2)The message that will be returned when attempting to settle the payment, and will
also be persisted as Payment.errorMessage.

### metadata​


[​](#metadata-4)
## CancelPaymentResult​


[​](#cancelpaymentresult)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-method-handler.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/payment/payment-method-handler.ts#L153)This object is the return value of the CancelPaymentFn when the Payment
has been successfully cancelled.

[CancelPaymentFn](/reference/typescript-api/payment/payment-method-types#cancelpaymentfn)
```
interface CancelPaymentResult {    success: true;    metadata?: PaymentMetadata;}
```

### success​


[​](#success-2)
### metadata​


[​](#metadata-5)
## CancelPaymentErrorResult​


[​](#cancelpaymenterrorresult)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-method-handler.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/payment/payment-method-handler.ts#L165)This object is the return value of the CancelPaymentFn when the Payment
could not be cancelled.

[CancelPaymentFn](/reference/typescript-api/payment/payment-method-types#cancelpaymentfn)
```
interface CancelPaymentErrorResult {    success: false;    state?: Exclude<PaymentState, 'Cancelled'>;    errorMessage?: string;    metadata?: PaymentMetadata;}
```

### success​


[​](#success-3)
### state​


[​](#state-4)[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)The state to transition this Payment to upon unsuccessful cancellation.
Defaults to Error. Note that if using a different state, it must be
legal to transition to that state from the Authorized state according
to the PaymentState config (which can be customized using the
PaymentProcess).

[PaymentProcess](/reference/typescript-api/payment/payment-process#paymentprocess)
### errorMessage​


[​](#errormessage-3)The message that will be returned when attempting to cancel the payment, and will
also be persisted as Payment.errorMessage.

### metadata​


[​](#metadata-6)
## CreatePaymentFn​


[​](#createpaymentfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-method-handler.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/payment/payment-method-handler.ts#L193)This function contains the logic for creating a payment. See PaymentMethodHandler for an example.

[PaymentMethodHandler](/reference/typescript-api/payment/payment-method-handler#paymentmethodhandler)Returns a CreatePaymentResult.

[CreatePaymentResult](/reference/typescript-api/payment/payment-method-types#createpaymentresult)
```
type CreatePaymentFn<T extends ConfigArgs> = (    ctx: RequestContext,    order: Order,    amount: number,    args: ConfigArgValues<T>,    metadata: PaymentMetadata,    method: PaymentMethod,) => CreatePaymentResult | CreatePaymentErrorResult | Promise<CreatePaymentResult | CreatePaymentErrorResult>
```

## SettlePaymentFn​


[​](#settlepaymentfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-method-handler.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/payment/payment-method-handler.ts#L209)This function contains the logic for settling a payment. See PaymentMethodHandler for an example.

[PaymentMethodHandler](/reference/typescript-api/payment/payment-method-handler#paymentmethodhandler)
```
type SettlePaymentFn<T extends ConfigArgs> = (    ctx: RequestContext,    order: Order,    payment: Payment,    args: ConfigArgValues<T>,    method: PaymentMethod,) => SettlePaymentResult | SettlePaymentErrorResult | Promise<SettlePaymentResult | SettlePaymentErrorResult>
```

## CancelPaymentFn​


[​](#cancelpaymentfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-method-handler.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/payment/payment-method-handler.ts#L224)This function contains the logic for cancelling a payment. See PaymentMethodHandler for an example.

[PaymentMethodHandler](/reference/typescript-api/payment/payment-method-handler#paymentmethodhandler)
```
type CancelPaymentFn<T extends ConfigArgs> = (    ctx: RequestContext,    order: Order,    payment: Payment,    args: ConfigArgValues<T>,    method: PaymentMethod,) => CancelPaymentResult | CancelPaymentErrorResult | Promise<CancelPaymentResult | CancelPaymentErrorResult>
```

## CreateRefundFn​


[​](#createrefundfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-method-handler.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/payment/payment-method-handler.ts#L239)This function contains the logic for creating a refund. See PaymentMethodHandler for an example.

[PaymentMethodHandler](/reference/typescript-api/payment/payment-method-handler#paymentmethodhandler)
```
type CreateRefundFn<T extends ConfigArgs> = (    ctx: RequestContext,    input: RefundOrderInput,    amount: number,    order: Order,    payment: Payment,    args: ConfigArgValues<T>,    method: PaymentMethod,) => CreateRefundResult | Promise<CreateRefundResult>
```


---

# PaymentOptions


## PaymentOptions​


[​](#paymentoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts#L873)Defines payment-related options in the VendureConfig.

[VendureConfig](/reference/typescript-api/configuration/vendure-config#vendureconfig)
```
interface PaymentOptions {    paymentMethodHandlers: PaymentMethodHandler[];    paymentMethodEligibilityCheckers?: PaymentMethodEligibilityChecker[];    customPaymentProcess?: Array<PaymentProcess<any>>;    process?: Array<PaymentProcess<any>>;    refundProcess?: Array<RefundProcess<any>>;}
```

### paymentMethodHandlers​


[​](#paymentmethodhandlers)[PaymentMethodHandler](/reference/typescript-api/payment/payment-method-handler#paymentmethodhandler)Defines which PaymentMethodHandlers are available when configuring
PaymentMethods

[PaymentMethodHandler](/reference/typescript-api/payment/payment-method-handler#paymentmethodhandler)[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)
### paymentMethodEligibilityCheckers​


[​](#paymentmethodeligibilitycheckers)[PaymentMethodEligibilityChecker](/reference/typescript-api/payment/payment-method-eligibility-checker#paymentmethodeligibilitychecker)Defines which PaymentMethodEligibilityCheckers are available when configuring
PaymentMethods

[PaymentMethodEligibilityChecker](/reference/typescript-api/payment/payment-method-eligibility-checker#paymentmethodeligibilitychecker)[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)
### customPaymentProcess​


[​](#custompaymentprocess)[PaymentProcess](/reference/typescript-api/payment/payment-process#paymentprocess)
### process​


[​](#process)[PaymentProcess](/reference/typescript-api/payment/payment-process#paymentprocess)[defaultPaymentProcess](/reference/typescript-api/payment/default-payment-process#defaultpaymentprocess)Allows the definition of custom states and transition logic for the payment process state machine.
Takes an array of objects implementing the PaymentProcess interface.

[PaymentProcess](/reference/typescript-api/payment/payment-process#paymentprocess)
### refundProcess​


[​](#refundprocess)[RefundProcess](/reference/typescript-api/payment/refund-process#refundprocess)[defaultRefundProcess](/reference/typescript-api/payment/default-refund-process#defaultrefundprocess)Allows the definition of custom states and transition logic for the refund process state machine.
Takes an array of objects implementing the RefundProcess interface.

[RefundProcess](/reference/typescript-api/payment/refund-process#refundprocess)


---

# PaymentProcess


## PaymentProcess​


[​](#paymentprocess)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-process.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/payment/payment-process.ts#L33)A PaymentProcess is used to define the way the payment process works as in: what states a Payment can be
in, and how it may transition from one state to another. Using the onTransitionStart() hook, a
PaymentProcess can perform checks before allowing a state transition to occur, and the onTransitionEnd()
hook allows logic to be executed after a state change.

For detailed description of the interface members, see the StateMachineConfig docs.

[StateMachineConfig](/reference/typescript-api/state-machine/state-machine-config#statemachineconfig)This is configured via the paymentOptions.process property of
your VendureConfig.

```
interface PaymentProcess<State extends keyof CustomPaymentStates | string> extends InjectableStrategy {    transitions?: Transitions<State, State | PaymentState> & Partial<Transitions<PaymentState | State>>;    onTransitionStart?: OnTransitionStartFn<State | PaymentState, PaymentTransitionData>;    onTransitionEnd?: OnTransitionEndFn<State | PaymentState, PaymentTransitionData>;    onTransitionError?: OnTransitionErrorFn<State | PaymentState>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### transitions​


[​](#transitions)[Transitions](/reference/typescript-api/state-machine/transitions#transitions)[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)[Transitions](/reference/typescript-api/state-machine/transitions#transitions)[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)
### onTransitionStart​


[​](#ontransitionstart)[OnTransitionStartFn](/reference/typescript-api/state-machine/state-machine-config#ontransitionstartfn)[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)[PaymentTransitionData](/reference/typescript-api/payment/payment-transition-data#paymenttransitiondata)
### onTransitionEnd​


[​](#ontransitionend)[OnTransitionEndFn](/reference/typescript-api/state-machine/state-machine-config#ontransitionendfn)[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)[PaymentTransitionData](/reference/typescript-api/payment/payment-transition-data#paymenttransitiondata)
### onTransitionError​


[​](#ontransitionerror)[OnTransitionErrorFn](/reference/typescript-api/state-machine/state-machine-config#ontransitionerrorfn)[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)


---

# PaymentState


## PaymentState​


[​](#paymentstate)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-state.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/payment-state-machine/payment-state.ts#L27)These are the default states of the payment process.

```
type PaymentState = | 'Created'    | 'Error'    | 'Cancelled'    | keyof CustomPaymentStates    | keyof PaymentStates
```


---

# PaymentStates


## PaymentStates​


[​](#paymentstates)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-state.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/payment-state-machine/payment-state.ts#L19)An interface to extend standard PaymentState.

[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)
```
interface PaymentStates {}
```


---

# PaymentTransitionData


## PaymentTransitionData​


[​](#paymenttransitiondata)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-state.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/payment-state-machine/payment-state.ts#L41)The data which is passed to the onStateTransitionStart function configured when constructing
a new PaymentMethodHandler

```
interface PaymentTransitionData {    ctx: RequestContext;    payment: Payment;    order: Order;}
```

### ctx​


[​](#ctx)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### payment​


[​](#payment)[Payment](/reference/typescript-api/entities/payment#payment)
### order​


[​](#order)[Order](/reference/typescript-api/entities/order#order)


---

# RefundProcess


## RefundProcess​


[​](#refundprocess)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[refund-process.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/refund/refund-process.ts#L25)A RefundProcess is used to define the way the refund process works as in: what states a Refund can be
in, and how it may transition from one state to another. Using the onTransitionStart() hook, a
RefundProcess can perform checks before allowing a state transition to occur, and the onTransitionEnd()
hook allows logic to be executed after a state change.

For detailed description of the interface members, see the StateMachineConfig docs.

[StateMachineConfig](/reference/typescript-api/state-machine/state-machine-config#statemachineconfig)
```
interface RefundProcess<State extends keyof CustomRefundStates | string> extends InjectableStrategy {    transitions?: Transitions<State, State | RefundState> & Partial<Transitions<RefundState | State>>;    onTransitionStart?: OnTransitionStartFn<State | RefundState, RefundTransitionData>;    onTransitionEnd?: OnTransitionEndFn<State | RefundState, RefundTransitionData>;    onTransitionError?: OnTransitionErrorFn<State | RefundState>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### transitions​


[​](#transitions)[Transitions](/reference/typescript-api/state-machine/transitions#transitions)[RefundState](/reference/typescript-api/payment/refund-state#refundstate)[Transitions](/reference/typescript-api/state-machine/transitions#transitions)[RefundState](/reference/typescript-api/payment/refund-state#refundstate)
### onTransitionStart​


[​](#ontransitionstart)[OnTransitionStartFn](/reference/typescript-api/state-machine/state-machine-config#ontransitionstartfn)[RefundState](/reference/typescript-api/payment/refund-state#refundstate)[RefundTransitionData](/reference/typescript-api/payment/refund-transition-data#refundtransitiondata)
### onTransitionEnd​


[​](#ontransitionend)[OnTransitionEndFn](/reference/typescript-api/state-machine/state-machine-config#ontransitionendfn)[RefundState](/reference/typescript-api/payment/refund-state#refundstate)[RefundTransitionData](/reference/typescript-api/payment/refund-transition-data#refundtransitiondata)
### onTransitionError​


[​](#ontransitionerror)[OnTransitionErrorFn](/reference/typescript-api/state-machine/state-machine-config#ontransitionerrorfn)[RefundState](/reference/typescript-api/payment/refund-state#refundstate)


---

# RefundState


## RefundState​


[​](#refundstate)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[refund-state.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/refund-state-machine/refund-state.ts#L27)These are the default states of the refund process.

```
type RefundState = 'Pending' | 'Settled' | 'Failed' | keyof CustomRefundStates | keyof RefundStates
```


---

# RefundStates


## RefundStates​


[​](#refundstates)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[refund-state.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/refund-state-machine/refund-state.ts#L19)An interface to extend standard RefundState.

[RefundState](/reference/typescript-api/payment/refund-state#refundstate)
```
interface RefundStates {}
```


---

# RefundTransitionData


## RefundTransitionData​


[​](#refundtransitiondata)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[refund-state.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/refund-state-machine/refund-state.ts#L35)The data which is passed to the state transition handler of the RefundStateMachine.

```
interface RefundTransitionData {    ctx: RequestContext;    order: Order;    refund: Refund;}
```

### ctx​


[​](#ctx)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### order​


[​](#order)[Order](/reference/typescript-api/entities/order#order)
### refund​


[​](#refund)[Refund](/reference/typescript-api/entities/refund#refund)


---

# PluginCommonModule


## PluginCommonModule​


[​](#plugincommonmodule)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[plugin-common.module.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/plugin-common.module.ts#L30)This module provides the common services, configuration, and event bus capabilities
required by a typical plugin. It should be imported into plugins to avoid having to
repeat the same boilerplate for each individual plugin.

The PluginCommonModule exports:

- EventBusModule, allowing the injection of the EventBus service.
- ServiceModule allowing the injection of any of the various entity services such as ProductService, OrderService etc.
- ConfigModule, allowing the injection of the ConfigService.
- JobQueueModule, allowing the injection of the JobQueueService.
- HealthCheckModule, allowing the injection of the HealthCheckRegistryService.

[EventBus](/reference/typescript-api/events/event-bus#eventbus)[JobQueueService](/reference/typescript-api/job-queue/job-queue-service#jobqueueservice)[HealthCheckRegistryService](/reference/typescript-api/health-check/health-check-registry-service#healthcheckregistryservice)
```
class PluginCommonModule {}
```

---

# Plugin Utilities


## createProxyHandler​


[​](#createproxyhandler)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[plugin-utils.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/plugin-utils.ts#L37)Creates a proxy middleware which proxies the given route to the given port.
Useful for plugins which start their own servers but should be accessible
via the main Vendure url.

Example

```
// Example usage in the `configuration` method of a VendurePlugin.// Imagine that we have started a Node server on port 5678// running some service which we want to access via the `/my-plugin/`// route of the main Vendure server.@VendurePlugin({  configuration: (config: Required<VendureConfig>) => {      config.apiOptions.middleware.push({          handler: createProxyHandler({              label: 'Admin UI',              route: 'my-plugin',              port: 5678,          }),          route: 'my-plugin',      });      return config;  }})export class MyPlugin {}
```

```
function createProxyHandler(options: ProxyOptions): RequestHandler
```

Parameters

### options​


[​](#options)[ProxyOptions](/reference/typescript-api/plugin/plugin-utilities#proxyoptions)
## ProxyOptions​


[​](#proxyoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[plugin-utils.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/plugin-utils.ts#L74)Options to configure proxy middleware via createProxyHandler.

[createProxyHandler](/reference/typescript-api/plugin/plugin-utilities#createproxyhandler)
```
interface ProxyOptions {    label: string;    route: string;    port: number;    hostname?: string;    basePath?: string;}
```

### label​


[​](#label)A human-readable label for the service which is being proxied. Used to
generate more informative logs.

### route​


[​](#route)The route of the Vendure server which will act as the proxy url.

### port​


[​](#port)The port on which the service being proxied is running.

### hostname​


[​](#hostname)The hostname of the server on which the service being proxied is running.

### basePath​


[​](#basepath)An optional base path on the proxied server.


---

# VendurePluginMetadata


## VendurePluginMetadata​


[​](#vendurepluginmetadata)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-plugin.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/vendure-plugin.ts#L23)Defines the metadata of a Vendure plugin. This interface is an superset of the Nestjs ModuleMetadata
(which allows the definition of imports, exports, providers and controllers), which means
that any Nestjs Module is a valid Vendure plugin. In addition, the VendurePluginMetadata allows the definition of
extra properties specific to Vendure.

[Nestjs ModuleMetadata](https://docs.nestjs.com/modules)
```
interface VendurePluginMetadata extends ModuleMetadata {    configuration?: PluginConfigurationFn;    shopApiExtensions?: APIExtensionDefinition;    adminApiExtensions?: APIExtensionDefinition;    entities?: Array<Type<any>> | (() => Array<Type<any>>);    dashboard?: DashboardExtension;    compatibility?: string;}
```

- Extends: ModuleMetadata

### configuration​


[​](#configuration)[PluginConfigurationFn](/reference/typescript-api/plugin/vendure-plugin-metadata#pluginconfigurationfn)A function which can modify the VendureConfig object before the server bootstraps.

[VendureConfig](/reference/typescript-api/configuration/vendure-config#vendureconfig)
### shopApiExtensions​


[​](#shopapiextensions)[APIExtensionDefinition](/reference/typescript-api/plugin/vendure-plugin-metadata#apiextensiondefinition)The plugin may extend the default Vendure GraphQL shop api by providing extended
schema definitions and any required resolvers.

### adminApiExtensions​


[​](#adminapiextensions)[APIExtensionDefinition](/reference/typescript-api/plugin/vendure-plugin-metadata#apiextensiondefinition)The plugin may extend the default Vendure GraphQL admin api by providing extended
schema definitions and any required resolvers.

### entities​


[​](#entities)The plugin may define custom TypeORM database entities.

[TypeORM database entities](https://typeorm.io/#/entities)
### dashboard​


[​](#dashboard)
### compatibility​


[​](#compatibility)The plugin should define a valid semver version string to indicate which versions of
Vendure core it is compatible with. Attempting to use a plugin with an incompatible
version of Vendure will result in an error and the server will be unable to bootstrap.

[semver version string](https://www.npmjs.com/package/semver)If a plugin does not define this property, a message will be logged on bootstrap that the plugin is not
guaranteed to be compatible with the current version of Vendure.

To effectively disable this check for a plugin, you can use an overly-permissive string such as >0.0.0.

Since Vendure v3.1.0, it is possible to ignore compatibility errors for specific plugins by
passing the ignoreCompatibilityErrorsForPlugins option to the bootstrap function.

[bootstrap](/reference/typescript-api/common/bootstrap#bootstrap)Example

```
compatibility: '^3.0.0'
```

## APIExtensionDefinition​


[​](#apiextensiondefinition)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-plugin.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/vendure-plugin.ts#L80)An object which allows a plugin to extend the Vendure GraphQL API.

```
interface APIExtensionDefinition {    schema?: DocumentNode | ((schema?: GraphQLSchema) => DocumentNode | undefined);    resolvers?: Array<Type<any>> | (() => Array<Type<any>>);    scalars?: Record<string, GraphQLScalarType> | (() => Record<string, GraphQLScalarType>);}
```

### schema​


[​](#schema)Extensions to the schema.
Passes the current schema as an optional argument, allowing the extension to be based on the existing schema.

Example

```
const schema = gql`extend type SearchReindexResponse {    timeTaken: Int!    indexedItemCount: Int!}`;
```

### resolvers​


[​](#resolvers)An array of resolvers for the schema extensions. Should be defined as Nestjs GraphQL resolver
classes, i.e. using the Nest @Resolver() decorator etc.

[Nestjs GraphQL resolver](https://docs.nestjs.com/graphql/resolvers-map)
### scalars​


[​](#scalars)A map of GraphQL scalar types which should correspond to any custom scalars defined in your schema.
Read more about defining custom scalars in the
Apollo Server Custom Scalars docs

[Apollo Server Custom Scalars docs](https://www.apollographql.com/docs/apollo-server/schema/custom-scalars)
## PluginConfigurationFn​


[​](#pluginconfigurationfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-plugin.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/vendure-plugin.ts#L119)This method is called before the app bootstraps and should be used to perform any needed modifications to the VendureConfig.

[VendureConfig](/reference/typescript-api/configuration/vendure-config#vendureconfig)
```
type PluginConfigurationFn = (    config: RuntimeVendureConfig,) => RuntimeVendureConfig | Promise<RuntimeVendureConfig>
```


---

# VendurePlugin


## VendurePlugin​


[​](#vendureplugin)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-plugin.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/vendure-plugin.ts#L164)The VendurePlugin decorator is a means of configuring and/or extending the functionality of the Vendure server. A Vendure plugin is
a Nestjs Module, with optional additional metadata defining things like extensions to the GraphQL API, custom
configuration or new database entities.

[Nestjs Module](https://docs.nestjs.com/modules)As well as configuring the app, a plugin may also extend the GraphQL schema by extending existing types or adding
entirely new types. Database entities and resolvers can also be defined to handle the extended GraphQL types.

Example

```
import { Controller, Get } from '@nestjs/common';import { Ctx, PluginCommonModule, ProductService, RequestContext, VendurePlugin } from '@vendure/core';@Controller('products')export class ProductsController {    constructor(private productService: ProductService) {}    @Get()    findAll(@Ctx() ctx: RequestContext) {        return this.productService.findAll(ctx);    }}//A simple plugin which adds a REST endpoint for querying products.@VendurePlugin({    imports: [PluginCommonModule],    controllers: [ProductsController],})export class RestPlugin {}
```

```
function VendurePlugin(pluginMetadata: VendurePluginMetadata): ClassDecorator
```

Parameters

### pluginMetadata​


[​](#pluginmetadata)[VendurePluginMetadata](/reference/typescript-api/plugin/vendure-plugin-metadata#vendurepluginmetadata)


---

# CatalogOptions


## CatalogOptions​


[​](#catalogoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts#L722)Options related to products and collections.

```
interface CatalogOptions {    collectionFilters?: Array<CollectionFilter<any>>;    productVariantPriceSelectionStrategy?: ProductVariantPriceSelectionStrategy;    productVariantPriceCalculationStrategy?: ProductVariantPriceCalculationStrategy;    productVariantPriceUpdateStrategy?: ProductVariantPriceUpdateStrategy;    stockDisplayStrategy?: StockDisplayStrategy;    stockLocationStrategy?: StockLocationStrategy;}
```

### collectionFilters​


[​](#collectionfilters)[CollectionFilter](/reference/typescript-api/configuration/collection-filter#collectionfilter)Allows custom CollectionFilters to be defined.

[CollectionFilter](/reference/typescript-api/configuration/collection-filter#collectionfilter)
### productVariantPriceSelectionStrategy​


[​](#productvariantpriceselectionstrategy)[ProductVariantPriceSelectionStrategy](/reference/typescript-api/configuration/product-variant-price-selection-strategy#productvariantpriceselectionstrategy)[DefaultProductVariantPriceSelectionStrategy](/reference/typescript-api/configuration/product-variant-price-selection-strategy#defaultproductvariantpriceselectionstrategy)Defines the strategy used to select the price of a ProductVariant, based on factors
such as the active Channel and active CurrencyCode.

### productVariantPriceCalculationStrategy​


[​](#productvariantpricecalculationstrategy)[ProductVariantPriceCalculationStrategy](/reference/typescript-api/products-stock/product-variant-price-calculation-strategy#productvariantpricecalculationstrategy)Defines the strategy used for calculating the price of ProductVariants based
on the Channel settings and active tax Zone.

### productVariantPriceUpdateStrategy​


[​](#productvariantpriceupdatestrategy)[ProductVariantPriceUpdateStrategy](/reference/typescript-api/configuration/product-variant-price-update-strategy#productvariantpriceupdatestrategy)[DefaultProductVariantPriceUpdateStrategy](/reference/typescript-api/configuration/product-variant-price-update-strategy#defaultproductvariantpriceupdatestrategy)Defines the strategy which determines what happens to a ProductVariant's prices
when one of the prices gets updated. For instance, this can be used to synchronize
prices across multiple Channels.

### stockDisplayStrategy​


[​](#stockdisplaystrategy)[StockDisplayStrategy](/reference/typescript-api/products-stock/stock-display-strategy#stockdisplaystrategy)[DefaultStockDisplayStrategy](/reference/typescript-api/products-stock/default-stock-display-strategy#defaultstockdisplaystrategy)Defines how the ProductVariant.stockLevel value is obtained. It is usually not desirable
to directly expose stock levels over a public API, as this could be considered a leak of
sensitive information. However, the storefront will usually want to display some indication
of whether a given ProductVariant is in stock. The default StockDisplayStrategy will
display "IN_STOCK", "OUT_OF_STOCK" or "LOW_STOCK" rather than exposing the actual saleable
stock level.

### stockLocationStrategy​


[​](#stocklocationstrategy)[StockLocationStrategy](/reference/typescript-api/products-stock/stock-location-strategy#stocklocationstrategy)[DefaultStockLocationStrategy](/reference/typescript-api/products-stock/default-stock-location-strategy#defaultstocklocationstrategy)Defines the strategy used to determine which StockLocation should be used when performing
stock operations such as allocating and releasing stock as well as determining the
amount of stock available for sale.


---

# DefaultProductVariantPriceCalculationStrategy


## DefaultProductVariantPriceCalculationStrategy​


[​](#defaultproductvariantpricecalculationstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-product-variant-price-calculation-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/catalog/default-product-variant-price-calculation-strategy.ts#L18)A default ProductVariant price calculation function.

```
class DefaultProductVariantPriceCalculationStrategy implements ProductVariantPriceCalculationStrategy {    init(injector: Injector) => ;    calculate(args: ProductVariantPriceCalculationArgs) => Promise<PriceCalculationResult>;}
```

- Implements: ProductVariantPriceCalculationStrategy

[ProductVariantPriceCalculationStrategy](/reference/typescript-api/products-stock/product-variant-price-calculation-strategy#productvariantpricecalculationstrategy)
### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)
### calculate​


[​](#calculate)[ProductVariantPriceCalculationArgs](/reference/typescript-api/products-stock/product-variant-price-calculation-strategy#productvariantpricecalculationargs)[PriceCalculationResult](/reference/typescript-api/common/price-calculation-result#pricecalculationresult)


---

# DefaultStockDisplayStrategy


## DefaultStockDisplayStrategy​


[​](#defaultstockdisplaystrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-stock-display-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/catalog/default-stock-display-strategy.ts#L14)Displays the ProductVariant.stockLevel as either 'IN_STOCK', 'OUT_OF_STOCK' or 'LOW_STOCK'.
Low stock is defined as a saleable stock level less than or equal to the lowStockLevel as passed in
to the constructor (defaults to 2).

```
class DefaultStockDisplayStrategy implements StockDisplayStrategy {    constructor(lowStockLevel: number = 2)    getStockLevel(ctx: RequestContext, productVariant: ProductVariant, saleableStockLevel: number) => string;}
```

- Implements: StockDisplayStrategy

[StockDisplayStrategy](/reference/typescript-api/products-stock/stock-display-strategy#stockdisplaystrategy)
### constructor​


[​](#constructor)
### getStockLevel​


[​](#getstocklevel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)


---

# DefaultStockLocationStrategy


## DefaultStockLocationStrategy​


[​](#defaultstocklocationstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-stock-location-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/catalog/default-stock-location-strategy.ts#L105)The DefaultStockLocationStrategy was the default implementation of the StockLocationStrategy
prior to the introduction of the MultiChannelStockLocationStrategy.
It assumes only a single StockLocation and that all stock is allocated from that location. When
more than one StockLocation or Channel is used, it will not behave as expected.

[StockLocationStrategy](/reference/typescript-api/products-stock/stock-location-strategy#stocklocationstrategy)[MultiChannelStockLocationStrategy](/reference/typescript-api/products-stock/multi-channel-stock-location-strategy#multichannelstocklocationstrategy)
```
class DefaultStockLocationStrategy extends BaseStockLocationStrategy {    init(injector: Injector) => ;    getAvailableStock(ctx: RequestContext, productVariantId: ID, stockLevels: StockLevel[]) => AvailableStock;    forAllocation(ctx: RequestContext, stockLocations: StockLocation[], orderLine: OrderLine, quantity: number) => LocationWithQuantity[] | Promise<LocationWithQuantity[]>;}
```

- Extends: BaseStockLocationStrategy

### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)
### getAvailableStock​


[​](#getavailablestock)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[StockLevel](/reference/typescript-api/entities/stock-level#stocklevel)[AvailableStock](/reference/typescript-api/products-stock/stock-location-strategy#availablestock)
### forAllocation​


[​](#forallocation)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)[OrderLine](/reference/typescript-api/entities/order-line#orderline)[LocationWithQuantity](/reference/typescript-api/products-stock/stock-location-strategy#locationwithquantity)[LocationWithQuantity](/reference/typescript-api/products-stock/stock-location-strategy#locationwithquantity)


---

# MultiChannelStockLocationStrategy


## MultiChannelStockLocationStrategy​


[​](#multichannelstocklocationstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[multi-channel-stock-location-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/catalog/multi-channel-stock-location-strategy.ts#L32)The MultiChannelStockLocationStrategy is an implementation of the StockLocationStrategy.
which is suitable for both single- and multichannel setups. It takes into account the active
channel when determining stock levels, and also ensures that allocations are made only against
stock locations which are associated with the active channel.

[StockLocationStrategy](/reference/typescript-api/products-stock/stock-location-strategy#stocklocationstrategy)This strategy became the default in Vendure 3.1.0. If you want to use the previous strategy which
does not take channels into account, update your VendureConfig to use to DefaultStockLocationStrategy.

[DefaultStockLocationStrategy](/reference/typescript-api/products-stock/default-stock-location-strategy#defaultstocklocationstrategy)
```
class MultiChannelStockLocationStrategy extends BaseStockLocationStrategy {    getAvailableStock(ctx: RequestContext, productVariantId: ID, stockLevels: StockLevel[]) => Promise<AvailableStock>;    forAllocation(ctx: RequestContext, stockLocations: StockLocation[], orderLine: OrderLine, quantity: number) => Promise<LocationWithQuantity[]>;}
```

- Extends: BaseStockLocationStrategy

### getAvailableStock​


[​](#getavailablestock)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[StockLevel](/reference/typescript-api/entities/stock-level#stocklevel)[AvailableStock](/reference/typescript-api/products-stock/stock-location-strategy#availablestock)Returns the available stock for the given ProductVariant, taking into account the active Channel.

### forAllocation​


[​](#forallocation)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)[OrderLine](/reference/typescript-api/entities/order-line#orderline)[LocationWithQuantity](/reference/typescript-api/products-stock/stock-location-strategy#locationwithquantity)This method takes into account whether the stock location is applicable to the active channel.
It furthermore respects the trackInventory and outOfStockThreshold settings of the ProductVariant,
in order to allocate stock only from locations which are relevant to the active channel and which
have sufficient stock available.


---

# ProductVariantPriceCalculationStrategy


## ProductVariantPriceCalculationStrategy​


[​](#productvariantpricecalculationstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-variant-price-calculation-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/catalog/product-variant-price-calculation-strategy.ts#L23)Defines how ProductVariant are calculated based on the input price, tax zone and current request context.

This is configured via the catalogOptions.productVariantPriceCalculationStrategy property of
your VendureConfig.

```
interface ProductVariantPriceCalculationStrategy extends InjectableStrategy {    calculate(args: ProductVariantPriceCalculationArgs): Promise<PriceCalculationResult>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### calculate​


[​](#calculate)[ProductVariantPriceCalculationArgs](/reference/typescript-api/products-stock/product-variant-price-calculation-strategy#productvariantpricecalculationargs)[PriceCalculationResult](/reference/typescript-api/common/price-calculation-result#pricecalculationresult)
## ProductVariantPriceCalculationArgs​


[​](#productvariantpricecalculationargs)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-variant-price-calculation-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/catalog/product-variant-price-calculation-strategy.ts#L36)The arguments passed the calculate method of the configured ProductVariantPriceCalculationStrategy.

[ProductVariantPriceCalculationStrategy](/reference/typescript-api/products-stock/product-variant-price-calculation-strategy#productvariantpricecalculationstrategy)The productVariant argument was added in v2.1.0.

```
interface ProductVariantPriceCalculationArgs {    inputPrice: number;    productVariantPrice?: ProductVariantPrice;    productVariant: ProductVariant;    taxCategory: TaxCategory;    activeTaxZone: Zone;    ctx: RequestContext;}
```

### inputPrice​


[​](#inputprice)
### productVariantPrice​


[​](#productvariantprice)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)
### productVariant​


[​](#productvariant)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### taxCategory​


[​](#taxcategory)[TaxCategory](/reference/typescript-api/entities/tax-category#taxcategory)
### activeTaxZone​


[​](#activetaxzone)[Zone](/reference/typescript-api/entities/zone#zone)
### ctx​


[​](#ctx)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)


---

# StockDisplayStrategy


## StockDisplayStrategy​


[​](#stockdisplaystrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[stock-display-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/catalog/stock-display-strategy.ts#L21)Defines how the ProductVariant.stockLevel value is obtained. It is usually not desirable
to directly expose stock levels over a public API, as this could be considered a leak of
sensitive information. However, the storefront will usually want to display some indication
of whether a given ProductVariant is in stock.

This is configured via the catalogOptions.stockDisplayStrategy property of
your VendureConfig.

```
interface StockDisplayStrategy extends InjectableStrategy {    getStockLevel(        ctx: RequestContext,        productVariant: ProductVariant,        saleableStockLevel: number,    ): string | Promise<string>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### getStockLevel​


[​](#getstocklevel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)Returns a string representing the stock level, which will be used directly
in the GraphQL ProductVariant.stockLevel field.


---

# StockLocationStrategy


## StockLocationStrategy​


[​](#stocklocationstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[stock-location-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/catalog/stock-location-strategy.ts#L55)The StockLocationStrategy is responsible for determining which StockLocations
should be used to fulfill an OrderLine and how much stock should be allocated
from each location. It is also used to determine the available stock for a given
ProductVariant.

[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)[OrderLine](/reference/typescript-api/entities/order-line#orderline)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)This is configured via the catalogOptions.stockLocationStrategy property of
your VendureConfig.

```
interface StockLocationStrategy extends InjectableStrategy {    getAvailableStock(        ctx: RequestContext,        productVariantId: ID,        stockLevels: StockLevel[],    ): AvailableStock | Promise<AvailableStock>;    forAllocation(        ctx: RequestContext,        stockLocations: StockLocation[],        orderLine: OrderLine,        quantity: number,    ): LocationWithQuantity[] | Promise<LocationWithQuantity[]>;    forRelease(        ctx: RequestContext,        stockLocations: StockLocation[],        orderLine: OrderLine,        quantity: number,    ): LocationWithQuantity[] | Promise<LocationWithQuantity[]>;    forSale(        ctx: RequestContext,        stockLocations: StockLocation[],        orderLine: OrderLine,        quantity: number,    ): LocationWithQuantity[] | Promise<LocationWithQuantity[]>;    forCancellation(        ctx: RequestContext,        stockLocations: StockLocation[],        orderLine: OrderLine,        quantity: number,    ): LocationWithQuantity[] | Promise<LocationWithQuantity[]>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### getAvailableStock​


[​](#getavailablestock)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[StockLevel](/reference/typescript-api/entities/stock-level#stocklevel)[AvailableStock](/reference/typescript-api/products-stock/stock-location-strategy#availablestock)[AvailableStock](/reference/typescript-api/products-stock/stock-location-strategy#availablestock)Returns the available stock for the given ProductVariant, taking into account
the stock levels at each StockLocation.

### forAllocation​


[​](#forallocation)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)[OrderLine](/reference/typescript-api/entities/order-line#orderline)[LocationWithQuantity](/reference/typescript-api/products-stock/stock-location-strategy#locationwithquantity)[LocationWithQuantity](/reference/typescript-api/products-stock/stock-location-strategy#locationwithquantity)Determines which StockLocations should be used to when allocating stock when
and Order is placed.

### forRelease​


[​](#forrelease)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)[OrderLine](/reference/typescript-api/entities/order-line#orderline)[LocationWithQuantity](/reference/typescript-api/products-stock/stock-location-strategy#locationwithquantity)[LocationWithQuantity](/reference/typescript-api/products-stock/stock-location-strategy#locationwithquantity)Determines which StockLocations should be used to when releasing allocated
stock when an OrderLine is cancelled before being fulfilled.

### forSale​


[​](#forsale)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)[OrderLine](/reference/typescript-api/entities/order-line#orderline)[LocationWithQuantity](/reference/typescript-api/products-stock/stock-location-strategy#locationwithquantity)[LocationWithQuantity](/reference/typescript-api/products-stock/stock-location-strategy#locationwithquantity)Determines which StockLocations should be used to when creating a Sale
and reducing the stockOnHand upon fulfillment.

### forCancellation​


[​](#forcancellation)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)[OrderLine](/reference/typescript-api/entities/order-line#orderline)[LocationWithQuantity](/reference/typescript-api/products-stock/stock-location-strategy#locationwithquantity)[LocationWithQuantity](/reference/typescript-api/products-stock/stock-location-strategy#locationwithquantity)Determines which StockLocations should be used to when creating a Cancellation
of an OrderLine which has already been fulfilled.

## AvailableStock​


[​](#availablestock)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[stock-location-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/catalog/stock-location-strategy.ts#L18)The overall available stock for a ProductVariant as determined by the logic of the
StockLocationStrategy's getAvailableStock method.

[StockLocationStrategy](/reference/typescript-api/products-stock/stock-location-strategy#stocklocationstrategy)
```
interface AvailableStock {    stockOnHand: number;    stockAllocated: number;}
```

### stockOnHand​


[​](#stockonhand)
### stockAllocated​


[​](#stockallocated)
## LocationWithQuantity​


[​](#locationwithquantity)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[stock-location-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/catalog/stock-location-strategy.ts#L32)Returned by the StockLocationStrategy methods to indicate how much stock from each
location should be used in the allocation/sale/release/cancellation of an OrderLine.

```
interface LocationWithQuantity {    location: StockLocation;    quantity: number;}
```

### location​


[​](#location)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)
### quantity​


[​](#quantity)


---

# FacetValueChecker


## FacetValueChecker​


[​](#facetvaluechecker)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[facet-value-checker.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/facet-value-checker/facet-value-checker.ts#L53)The FacetValueChecker is a helper class used to determine whether a given OrderLine consists
of ProductVariants containing the given FacetValues.

Example

```
import { FacetValueChecker, LanguageCode, PromotionCondition, TransactionalConnection } from '@vendure/core';let facetValueChecker: FacetValueChecker;export const hasFacetValues = new PromotionCondition({  code: 'at_least_n_with_facets',  description: [    { languageCode: LanguageCode.en, value: 'Buy at least { minimum } products with the given facets' },  ],  args: {    minimum: { type: 'int' },    facets: { type: 'ID', list: true, ui: { component: 'facet-value-form-input' } },  },  init(injector) {    facetValueChecker = injector.get(FacetValueChecker);  },  async check(ctx, order, args) {    let matches = 0;    for (const line of order.lines) {      if (await facetValueChecker.hasFacetValues(line, args.facets)) {          matches += line.quantity;      }    }    return args.minimum <= matches;  },});
```

```
class FacetValueChecker implements OnModuleInit {    constructor(connection: TransactionalConnection, cacheService: CacheService, eventBus?: EventBus)    onModuleInit() => any;    hasFacetValues(orderLine: OrderLine, facetValueIds: ID[], ctx?: RequestContext) => Promise<boolean>;}
```

- Implements: OnModuleInit

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[CacheService](/reference/typescript-api/cache/cache-service#cacheservice)[EventBus](/reference/typescript-api/events/event-bus#eventbus)
### onModuleInit​


[​](#onmoduleinit)
### hasFacetValues​


[​](#hasfacetvalues)[OrderLine](/reference/typescript-api/entities/order-line#orderline)[ID](/reference/typescript-api/common/id#id)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Checks a given OrderLine against the facetValueIds and returns
true if the associated ProductVariant & Product together
have all the specified FacetValues.

[OrderLine](/reference/typescript-api/entities/order-line#orderline)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[Product](/reference/typescript-api/entities/product#product)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)


---

# Promotion Action


## PromotionAction​


[​](#promotionaction)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion-action.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/promotion/promotion-action.ts#L281)An abstract class which is extended by PromotionItemAction, PromotionOrderAction,
and PromotionShippingAction.

[PromotionItemAction](/reference/typescript-api/promotions/promotion-action#promotionitemaction)[PromotionOrderAction](/reference/typescript-api/promotions/promotion-action#promotionorderaction)[PromotionShippingAction](/reference/typescript-api/promotions/promotion-action#promotionshippingaction)
```
class PromotionAction<T extends ConfigArgs = ConfigArgs, U extends PromotionCondition[] | undefined = any> extends ConfigurableOperationDef<T> {    readonly priorityValue: number;    constructor(config: PromotionActionConfig<T, U>)}
```

- Extends: ConfigurableOperationDef<T>

[ConfigurableOperationDef](/reference/typescript-api/configurable-operation-def/#configurableoperationdef)
### priorityValue​


[​](#priorityvalue)Used to determine the order of application of multiple Promotions
on the same Order. See the Promotion priorityScore field for
more information.

[Promotion](/reference/typescript-api/entities/promotion#promotion)
### constructor​


[​](#constructor)[PromotionActionConfig](/reference/typescript-api/promotions/promotion-action#promotionactionconfig)
## PromotionItemAction​


[​](#promotionitemaction)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion-action.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/promotion/promotion-action.ts#L354)Represents a PromotionAction which applies to individual OrderLines.

[OrderLine](/reference/typescript-api/entities/order-line#orderline)Example

```
// Applies a percentage discount to each OrderLineconst itemPercentageDiscount = new PromotionItemAction({    code: 'item_percentage_discount',    args: { discount: 'percentage' },    execute(ctx, orderLine, args) {        return -orderLine.unitPrice * (args.discount / 100);    },    description: 'Discount every item by { discount }%',});
```

```
class PromotionItemAction<T extends ConfigArgs = ConfigArgs, U extends Array<PromotionCondition<any>> = []> extends PromotionAction<T, U> {    constructor(config: PromotionItemActionConfig<T, U>)}
```

- Extends: PromotionAction<T, U>

[PromotionAction](/reference/typescript-api/promotions/promotion-action#promotionaction)
### constructor​


[​](#constructor-1)[PromotionItemActionConfig](/reference/typescript-api/promotions/promotion-action#promotionitemactionconfig)
## PromotionOrderAction​


[​](#promotionorderaction)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion-action.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/promotion/promotion-action.ts#L464)Represents a PromotionAction which applies to the Order as a whole.

[Order](/reference/typescript-api/entities/order#order)Example

```
// Applies a percentage discount to the entire Orderconst orderPercentageDiscount = new PromotionOrderAction({    code: 'order_percentage_discount',    args: { discount: 'percentage' },    execute(ctx, order, args) {        return -order.subTotal * (args.discount / 100);    },    description: 'Discount order by { discount }%',});
```

```
class PromotionOrderAction<T extends ConfigArgs = ConfigArgs, U extends PromotionCondition[] = []> extends PromotionAction<T, U> {    constructor(config: PromotionOrderActionConfig<T, U>)}
```

- Extends: PromotionAction<T, U>

[PromotionAction](/reference/typescript-api/promotions/promotion-action#promotionaction)
### constructor​


[​](#constructor-2)[PromotionOrderActionConfig](/reference/typescript-api/promotions/promotion-action#promotionorderactionconfig)
## PromotionShippingAction​


[​](#promotionshippingaction)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion-action.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/promotion/promotion-action.ts#L506)Represents a PromotionAction which applies to the shipping cost of an Order.

```
class PromotionShippingAction<T extends ConfigArgs = ConfigArgs, U extends PromotionCondition[] = []> extends PromotionAction<T, U> {    constructor(config: PromotionShippingActionConfig<T, U>)}
```

- Extends: PromotionAction<T, U>

[PromotionAction](/reference/typescript-api/promotions/promotion-action#promotionaction)
### constructor​


[​](#constructor-3)[PromotionShippingActionConfig](/reference/typescript-api/promotions/promotion-action#promotionshippingactionconfig)
## ExecutePromotionItemActionFn​


[​](#executepromotionitemactionfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion-action.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/promotion/promotion-action.ts#L72)The function which is used by a PromotionItemAction to calculate the
discount on the OrderLine for each item.

```
type ExecutePromotionItemActionFn<T extends ConfigArgs, U extends Array<PromotionCondition<any>>> = (    ctx: RequestContext,    orderLine: OrderLine,    args: ConfigArgValues<T>,    state: ConditionState<U>,    promotion: Promotion,) => number | Promise<number>
```

## ExecutePromotionLineActionFn​


[​](#executepromotionlineactionfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion-action.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/promotion/promotion-action.ts#L88)The function which is used by a PromotionLineAction to calculate the
discount on the OrderLine.

```
type ExecutePromotionLineActionFn<T extends ConfigArgs, U extends Array<PromotionCondition<any>>> = (    ctx: RequestContext,    orderLine: OrderLine,    args: ConfigArgValues<T>,    state: ConditionState<U>,    promotion: Promotion,) => number | Promise<number>
```

## ExecutePromotionOrderActionFn​


[​](#executepromotionorderactionfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion-action.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/promotion/promotion-action.ts#L104)The function which is used by a PromotionOrderAction to calculate the
discount on the Order.

```
type ExecutePromotionOrderActionFn<T extends ConfigArgs, U extends Array<PromotionCondition<any>>> = (    ctx: RequestContext,    order: Order,    args: ConfigArgValues<T>,    state: ConditionState<U>,    promotion: Promotion,) => number | Promise<number>
```

## ExecutePromotionShippingActionFn​


[​](#executepromotionshippingactionfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion-action.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/promotion/promotion-action.ts#L120)The function which is used by a PromotionOrderAction to calculate the
discount on the Order.

```
type ExecutePromotionShippingActionFn<T extends ConfigArgs, U extends Array<PromotionCondition<any>>> = (    ctx: RequestContext,    shippingLine: ShippingLine,    order: Order,    args: ConfigArgValues<T>,    state: ConditionState<U>,    promotion: Promotion,) => number | Promise<number>
```

## PromotionActionSideEffectFn​


[​](#promotionactionsideeffectfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion-action.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/promotion/promotion-action.ts#L141)The signature of a PromotionAction's side-effect functions onActivate and onDeactivate.

```
type PromotionActionSideEffectFn<T extends ConfigArgs> = (    ctx: RequestContext,    order: Order,    args: ConfigArgValues<T>,    promotion: Promotion,) => void | Promise<void>
```

## PromotionActionConfig​


[​](#promotionactionconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion-action.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/promotion/promotion-action.ts#L155)Configuration for all types of PromotionAction.

[PromotionAction](/reference/typescript-api/promotions/promotion-action#promotionaction)
```
interface PromotionActionConfig<T extends ConfigArgs, U extends Array<PromotionCondition<any>> | undefined> extends ConfigurableOperationDefOptions<T> {    priorityValue?: number;    conditions?: U extends undefined ? undefined : ConditionTuple<Exclude<U, undefined>>;    onActivate?: PromotionActionSideEffectFn<T>;    onDeactivate?: PromotionActionSideEffectFn<T>;}
```

- Extends: ConfigurableOperationDefOptions<T>

[ConfigurableOperationDefOptions](/reference/typescript-api/configurable-operation-def/configurable-operation-def-options#configurableoperationdefoptions)
### priorityValue​


[​](#priorityvalue-1)Used to determine the order of application of multiple Promotions
on the same Order. See the Promotion priorityScore field for
more information.

[Promotion](/reference/typescript-api/entities/promotion#promotion)
### conditions​


[​](#conditions)Allows PromotionActions to define one or more PromotionConditions as dependencies. Having a PromotionCondition
as a dependency has the following consequences:

- A Promotion using this PromotionAction is only valid if it also contains all PromotionConditions
on which it depends.
- The execute() function will receive a statically-typed state argument which will contain
the return values of the PromotionConditions' check() function.

### onActivate​


[​](#onactivate)[PromotionActionSideEffectFn](/reference/typescript-api/promotions/promotion-action#promotionactionsideeffectfn)An optional side effect function which is invoked when the promotion
becomes active. It can be used for things like adding a free gift to the order
or other side effects that are unrelated to price calculations.

If used, make sure to use the corresponding onDeactivate function to clean up
or reverse any side effects as needed.

### onDeactivate​


[​](#ondeactivate)[PromotionActionSideEffectFn](/reference/typescript-api/promotions/promotion-action#promotionactionsideeffectfn)Used to reverse or clean up any side effects executed as part of the onActivate function.

## PromotionItemActionConfig​


[​](#promotionitemactionconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion-action.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/promotion/promotion-action.ts#L209)Configuration for a PromotionItemAction

[PromotionItemAction](/reference/typescript-api/promotions/promotion-action#promotionitemaction)
```
interface PromotionItemActionConfig<T extends ConfigArgs, U extends PromotionCondition[]> extends PromotionActionConfig<T, U> {    execute: ExecutePromotionItemActionFn<T, U>;}
```

- Extends: PromotionActionConfig<T, U>

[PromotionActionConfig](/reference/typescript-api/promotions/promotion-action#promotionactionconfig)
### execute​


[​](#execute)[ExecutePromotionItemActionFn](/reference/typescript-api/promotions/promotion-action#executepromotionitemactionfn)The function which contains the promotion calculation logic.
Should resolve to a number which represents the amount by which to discount
the OrderLine, i.e. the number should be negative.

## PromotionLineActionConfig​


[​](#promotionlineactionconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion-action.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/promotion/promotion-action.ts#L227)Configuration for a PromotionLineAction

[PromotionLineAction](/reference/typescript-api/promotions/promotion-action#promotionlineaction)
```
interface PromotionLineActionConfig<T extends ConfigArgs, U extends PromotionCondition[]> extends PromotionActionConfig<T, U> {    execute: ExecutePromotionLineActionFn<T, U>;}
```

- Extends: PromotionActionConfig<T, U>

[PromotionActionConfig](/reference/typescript-api/promotions/promotion-action#promotionactionconfig)
### execute​


[​](#execute-1)[ExecutePromotionLineActionFn](/reference/typescript-api/promotions/promotion-action#executepromotionlineactionfn)The function which contains the promotion calculation logic.
Should resolve to a number which represents the amount by which to discount
the OrderLine, i.e. the number should be negative.

## PromotionOrderActionConfig​


[​](#promotionorderactionconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion-action.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/promotion/promotion-action.ts#L244)
```
interface PromotionOrderActionConfig<T extends ConfigArgs, U extends PromotionCondition[]> extends PromotionActionConfig<T, U> {    execute: ExecutePromotionOrderActionFn<T, U>;}
```

- Extends: PromotionActionConfig<T, U>

[PromotionActionConfig](/reference/typescript-api/promotions/promotion-action#promotionactionconfig)
### execute​


[​](#execute-2)[ExecutePromotionOrderActionFn](/reference/typescript-api/promotions/promotion-action#executepromotionorderactionfn)The function which contains the promotion calculation logic.
Should resolve to a number which represents the amount by which to discount
the Order, i.e. the number should be negative.

## PromotionShippingActionConfig​


[​](#promotionshippingactionconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion-action.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/promotion/promotion-action.ts#L261)
```
interface PromotionShippingActionConfig<T extends ConfigArgs, U extends PromotionCondition[]> extends PromotionActionConfig<T, U> {    execute: ExecutePromotionShippingActionFn<T, U>;}
```

- Extends: PromotionActionConfig<T, U>

[PromotionActionConfig](/reference/typescript-api/promotions/promotion-action#promotionactionconfig)
### execute​


[​](#execute-3)[ExecutePromotionShippingActionFn](/reference/typescript-api/promotions/promotion-action#executepromotionshippingactionfn)The function which contains the promotion calculation logic.
Should resolve to a number which represents the amount by which to discount
the Shipping, i.e. the number should be negative.

## PromotionLineAction​


[​](#promotionlineaction)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion-action.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/promotion/promotion-action.ts#L409)Represents a PromotionAction which applies to individual OrderLines.
The difference from PromotionItemAction is that it applies regardless of the Quantity of the OrderLine.

[OrderLine](/reference/typescript-api/entities/order-line#orderline)Example

```
// Applies a percentage discount to each OrderLineconst linePercentageDiscount = new PromotionLineAction({    code: 'line_percentage_discount',    args: { discount: 'percentage' },    execute(ctx, orderLine, args) {        return -orderLine.linePrice * (args.discount / 100);    },    description: 'Discount every line by { discount }%',});
```

```
class PromotionLineAction<T extends ConfigArgs = ConfigArgs, U extends Array<PromotionCondition<any>> = []> extends PromotionAction<T, U> {    constructor(config: PromotionLineActionConfig<T, U>)}
```

- Extends: PromotionAction<T, U>

[PromotionAction](/reference/typescript-api/promotions/promotion-action#promotionaction)
### constructor​


[​](#constructor-4)[PromotionLineActionConfig](/reference/typescript-api/promotions/promotion-action#promotionlineactionconfig)


---

# Promotion Condition


## PromotionCondition​


[​](#promotioncondition)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion-condition.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/promotion/promotion-condition.ts#L66)PromotionConditions are used to create Promotions. The purpose of a PromotionCondition
is to check the order against a particular predicate function (the check function) and to return
true if the Order satisfies the condition, or false if it does not.

[Promotion](/reference/typescript-api/entities/promotion#promotion)
```
class PromotionCondition<T extends ConfigArgs = ConfigArgs, C extends string = string, R extends CheckPromotionConditionResult = any> extends ConfigurableOperationDef<T> {    readonly priorityValue: number;    code: C    constructor(config: PromotionConditionConfig<T, C, R>)    check(ctx: RequestContext, order: Order, args: ConfigArg[], promotion: Promotion) => Promise<R>;}
```

- Extends: ConfigurableOperationDef<T>

[ConfigurableOperationDef](/reference/typescript-api/configurable-operation-def/#configurableoperationdef)
### priorityValue​


[​](#priorityvalue)Used to determine the order of application of multiple Promotions
on the same Order. See the Promotion priorityScore field for
more information.

[Promotion](/reference/typescript-api/entities/promotion#promotion)
### code​


[​](#code)
### constructor​


[​](#constructor)[PromotionConditionConfig](/reference/typescript-api/promotions/promotion-condition#promotionconditionconfig)
### check​


[​](#check)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Promotion](/reference/typescript-api/entities/promotion#promotion)This is the function which contains the conditional logic to decide whether
a Promotion should apply to an Order. See CheckPromotionConditionFn.

[CheckPromotionConditionFn](/reference/typescript-api/promotions/promotion-condition#checkpromotionconditionfn)
## PromotionConditionConfig​


[​](#promotionconditionconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion-condition.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/promotion/promotion-condition.ts#L46)This object is used to configure a PromotionCondition.

```
interface PromotionConditionConfig<T extends ConfigArgs, C extends string, R extends CheckPromotionConditionResult> extends ConfigurableOperationDefOptions<T> {    code: C;    check: CheckPromotionConditionFn<T, R>;    priorityValue?: number;}
```

- Extends: ConfigurableOperationDefOptions<T>

[ConfigurableOperationDefOptions](/reference/typescript-api/configurable-operation-def/configurable-operation-def-options#configurableoperationdefoptions)
### code​


[​](#code-1)
### check​


[​](#check-1)[CheckPromotionConditionFn](/reference/typescript-api/promotions/promotion-condition#checkpromotionconditionfn)
### priorityValue​


[​](#priorityvalue-1)
## CheckPromotionConditionFn​


[​](#checkpromotionconditionfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion-condition.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/promotion/promotion-condition.ts#L31)A function which checks whether or not a given Order satisfies the PromotionCondition.

[Order](/reference/typescript-api/entities/order#order)[PromotionCondition](/reference/typescript-api/promotions/promotion-condition#promotioncondition)The function should return either a boolean or and plain object type:

- false: The condition is not satisfied - do not apply PromotionActions
- true: The condition is satisfied, apply PromotionActions
- { [key: string]: any; }: The condition is satisfied, apply PromotionActions
and pass this object into the PromotionAction's state argument.

```
type CheckPromotionConditionFn<T extends ConfigArgs, R extends CheckPromotionConditionResult> = (    ctx: RequestContext,    order: Order,    args: ConfigArgValues<T>,    promotion: Promotion,) => R | Promise<R>
```


---

# PromotionOptions


## PromotionOptions​


[​](#promotionoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts#L784)
```
interface PromotionOptions {    promotionConditions?: Array<PromotionCondition<any>>;    promotionActions?: Array<PromotionAction<any>>;}
```

### promotionConditions​


[​](#promotionconditions)[PromotionCondition](/reference/typescript-api/promotions/promotion-condition#promotioncondition)An array of conditions which can be used to construct Promotions

### promotionActions​


[​](#promotionactions)[PromotionAction](/reference/typescript-api/promotions/promotion-action#promotionaction)An array of actions which can be used to construct Promotions


---

# Allow Decorator


## Allow​


[​](#allow)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[allow.decorator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/api/decorators/allow.decorator.ts#L38)Attaches metadata to the resolver defining which permissions are required to execute the
operation, using one or more Permission values.

[Permission](/reference/typescript-api/common/permission#permission)In a GraphQL context, it can be applied to top-level queries and mutations as well as field resolvers.

For REST controllers, it can be applied to route handler.

## Allow and Sessions​


[​](#allow-and-sessions)The @Allow() decorator is closely linked to the way Vendure manages sessions. For any operation or route that is decorated
with @Allow(), there must be an authenticated session in progress, which would have been created during a prior authentication
step.

The exception to this is when the operation is decorated with @Allow(Permission.Owner). This is a special permission which is designed
to give access to certain resources to potentially un-authenticated users. For this reason, any operation decorated with this permission
will always have an anonymous session created if no session is currently in progress.

For more information see Understanding Permission.Owner.

[Understanding Permission.Owner](/reference/typescript-api/common/permission/#understanding-permissionowner)Example

```
 @Allow(Permission.SuperAdmin) @Query() getAdministrators() {     // ... }
```


---

# Api Decorator


## Api​


[​](#api)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[api.decorator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/api/decorators/api.decorator.ts#L26)Resolver param decorator which returns which Api the request came though.
This is useful because sometimes the same resolver will have different behaviour
depending whether it is being called from the shop API or the admin API.

Returns a string of type ApiType.

[ApiType](/reference/typescript-api/request/api-type#apitype)Example

```
 @Query() getAdministrators(@Api() apiType: ApiType) {   if (apiType === 'admin') {     // ...   } }
```


---

# ApiType


## ApiType​


[​](#apitype)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[get-api-type.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/api/common/get-api-type.ts#L9)Which of the GraphQL APIs the current request came via.

```
type ApiType = 'admin' | 'shop' | 'custom'
```


---

# Ctx Decorator


## Ctx​


[​](#ctx)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[request-context.decorator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/api/decorators/request-context.decorator.ts#L23)Resolver param decorator which extracts the RequestContext from the incoming
request object.

[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Example

```
 @Query() getAdministrators(@Ctx() ctx: RequestContext) {     // ... }
```


---

# Relations Decorator


## Relations​


[​](#relations)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[relations.decorator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/api/decorators/relations.decorator.ts#L136)Resolver param decorator which returns an array of relation paths which can be passed through
to the TypeORM data layer in order to join only the required relations. This works by inspecting
the GraphQL info object, examining the field selection, and then comparing this with information
about the return type's relations.

In addition to analyzing the field selection, this decorator also checks for any @Calculated()
properties on the entity, and additionally includes relations from the relations array of the calculated
metadata, if defined.

So if, for example, the query only selects the id field of an Order, then no other relations need
be joined in the resulting SQL query. This can massively speed up execution time for queries which do
not include many deep nested relations.

Example

```
@Query()@Allow(Permission.ReadOrder)orders(    @Ctx() ctx: RequestContext,    @Args() args: QueryOrdersArgs,    @Relations(Order) relations: RelationPaths<Order>,): Promise<PaginatedList<Order>> {    return this.orderService.findAll(ctx, args.options || undefined, relations);}
```

In the above example, given the following query:

Example

```
{  orders(options: { take: 10 }) {    items {      id      customer {        id        firstName        lastName      }      totalQuantity      totalWithTax    }  }}
```

then the value of relations will be

```
['customer', 'lines'']
```

The 'customer' comes from the fact that the query is nesting the "customer" object, and the 'lines' is taken
from the Order entity's totalQuantity property, which uses Calculated decorator and defines those relations as dependencies
for deriving the calculated value.

[Calculated](/reference/typescript-api/data-access/calculated#calculated)
## Depth​


[​](#depth)By default, when inspecting the GraphQL query, the Relations decorator will look 3 levels deep in any nested fields. So, e.g. if
the above orders query were changed to:

Example

```
{  orders(options: { take: 10 }) {    items {      id      lines {        productVariant {          product {            featuredAsset {              preview            }          }        }      }    }  }}
```

then the relations array would include 'lines', 'lines.productVariant', & 'lines.productVariant.product' - 3 levels deep - but it would
not include 'lines.productVariant.product.featuredAsset' since that exceeds the default depth. To specify a custom depth, you would
use the decorator like this:

Example

```
@Relations({ entity: Order, depth: 2 }) relations: RelationPaths<Order>,
```

## Omit​


[​](#omit)The omit option is used to explicitly omit certain relations from the calculated relations array. This is useful in certain
cases where we know for sure that we need to run the field resolver anyway. A good example is the Collection.productVariants relation.
When a GraphQL query comes in for a Collection and also requests its productVariants field, there is no point using a lookahead to eagerly
join that relation, because we will throw that data away anyway when the productVariants field resolver executes, since it returns a
PaginatedList query rather than a simple array.

Example

```
@Relations({ entity: Collection, omit: ['productVariant'] }) relations: RelationPaths<Collection>,
```


---

# RequestContextService


## RequestContextService​


[​](#requestcontextservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[request-context.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/request-context/request-context.service.ts#L25)Creates new RequestContext instances.

[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
```
class RequestContextService {    create(config: {        req?: Request;        apiType: ApiType;        channelOrToken?: Channel | string;        languageCode?: LanguageCode;        currencyCode?: CurrencyCode;        user?: User;        activeOrderId?: ID;    }) => Promise<RequestContext>;    fromRequest(req: Request, info?: GraphQLResolveInfo, requiredPermissions?: Permission[], session?: CachedSession) => Promise<RequestContext>;}
```

### create​


[​](#create)[ApiType](/reference/typescript-api/request/api-type#apitype)[Channel](/reference/typescript-api/entities/channel#channel)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)[CurrencyCode](/reference/typescript-api/common/currency-code#currencycode)[User](/reference/typescript-api/entities/user#user)[ID](/reference/typescript-api/common/id#id)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Creates a RequestContext based on the config provided. This can be useful when interacting
with services outside the request-response cycle, for example in stand-alone scripts or in
worker jobs.

### fromRequest​


[​](#fromrequest)[Permission](/reference/typescript-api/common/permission#permission)[CachedSession](/reference/typescript-api/auth/session-cache-strategy#cachedsession)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Creates a new RequestContext based on an Express request object. This is used internally
in the API layer by the AuthGuard, and creates the RequestContext which is then passed
to all resolvers & controllers.


---

# RequestContext


## RequestContext​


[​](#requestcontext)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[request-context.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/api/common/request-context.ts#L179)The RequestContext holds information relevant to the current request, which may be
required at various points of the stack.

It is a good practice to inject the RequestContext (using the Ctx decorator) into
all resolvers & REST handler, and then pass it through to the service layer.

[Ctx](/reference/typescript-api/request/ctx-decorator#ctx)This allows the service layer to access information about the current user, the active language,
the active Channel, and so on. In addition, the TransactionalConnection relies on the
presence of the RequestContext object in order to correctly handle per-request database transactions.

[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)The RequestContext also provides mechanisms for managing the database replication mode via the
setReplicationMode method and the replicationMode getter. This allows for finer control
over whether database queries within the context should be executed against the master or a replica
database, which can be particularly useful in distributed database environments.

Example

```
@Query()myQuery(@Ctx() ctx: RequestContext) {  return this.myService.getData(ctx);}
```

Example

```
@Query()myMutation(@Ctx() ctx: RequestContext) {  ctx.setReplicationMode('master');  return this.myService.getData(ctx);}
```

```
class RequestContext {    empty() => RequestContext;    deserialize(ctxObject: SerializedRequestContext) => RequestContext;    userHasPermissions(permissions: Permission[]) => boolean;    serialize() => SerializedRequestContext;    copy() => RequestContext;    req: Request | undefined    apiType: ApiType    channel: Channel    channelId: ID    languageCode: LanguageCode    currencyCode: CurrencyCode    session: CachedSession | undefined    activeUserId: ID | undefined    isAuthorized: boolean    authorizedAsOwnerOnly: boolean    translate(key: string, variables?: { [k: string]: any }) => string;    setReplicationMode(mode: ReplicationMode) => void;    replicationMode: ReplicationMode | undefined}
```

### empty​


[​](#empty)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Creates an "empty" RequestContext object. This is only intended to be used
when a service method must be called outside the normal request-response
cycle, e.g. when programmatically populating data. Usually a better alternative
is to use the RequestContextService create() method, which allows more control
over the resulting RequestContext object.

[RequestContextService](/reference/typescript-api/request/request-context-service#requestcontextservice)
### deserialize​


[​](#deserialize)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Creates a new RequestContext object from a serialized object created by the
serialize() method.

### userHasPermissions​


[​](#userhaspermissions)[Permission](/reference/typescript-api/common/permission#permission)Returns true if there is an active Session & User associated with this request,
and that User has the specified permissions on the active Channel.

### serialize​


[​](#serialize)Serializes the RequestContext object into a JSON-compatible simple object.
This is useful when you need to send a RequestContext object to another
process, e.g. to pass it to the Job Queue via the JobQueueService.

[JobQueueService](/reference/typescript-api/job-queue/job-queue-service#jobqueueservice)
### copy​


[​](#copy)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Creates a shallow copy of the RequestContext instance. This means that
mutations to the copy itself will not affect the original, but deep mutations
(e.g. copy.channel.code = 'new') will also affect the original.

### req​


[​](#req)The raw Express request object.

### apiType​


[​](#apitype)[ApiType](/reference/typescript-api/request/api-type#apitype)Signals which API this request was received by, e.g. admin or shop.

### channel​


[​](#channel)[Channel](/reference/typescript-api/entities/channel#channel)The active Channel of this request.

[Channel](/reference/typescript-api/entities/channel#channel)
### channelId​


[​](#channelid)[ID](/reference/typescript-api/common/id#id)
### languageCode​


[​](#languagecode)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)
### currencyCode​


[​](#currencycode)[CurrencyCode](/reference/typescript-api/common/currency-code#currencycode)
### session​


[​](#session)[CachedSession](/reference/typescript-api/auth/session-cache-strategy#cachedsession)
### activeUserId​


[​](#activeuserid)[ID](/reference/typescript-api/common/id#id)
### isAuthorized​


[​](#isauthorized)True if the current session is authorized to access the current resolver method.

### authorizedAsOwnerOnly​


[​](#authorizedasowneronly)True if the current anonymous session is only authorized to operate on entities that
are owned by the current session.

### translate​


[​](#translate)Translate the given i18n key

### setReplicationMode​


[​](#setreplicationmode)Sets the replication mode for the current RequestContext. This mode determines whether the operations
within this context should interact with the master database or a replica. Use this method to explicitly
define the replication mode for the context.

### replicationMode​


[​](#replicationmode)Gets the current replication mode of the RequestContext. If no replication mode has been set,
it returns undefined. This property indicates whether the context is configured to interact with
the master database or a replica.


---

# Transaction Decorator


## Transaction​


[​](#transaction)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[transaction.decorator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/api/decorators/transaction.decorator.ts#L81)Runs the decorated method in a TypeORM transaction. It works by creating a transactional
QueryRunner which gets attached to the RequestContext object. When the RequestContext
is the passed to the TransactionalConnection getRepository() method, this
QueryRunner is used to execute the queries within this transaction.

[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)Essentially, the entire resolver function is wrapped in a try-catch block which commits the
transaction on successful completion of the method, or rolls back the transaction in an unhandled
error is thrown.

Example

```
// in a GraphQL resolver file@Transaction()async myMutation(@Ctx() ctx: RequestContext) {  // as long as the `ctx` object is passed in to  // all database operations, the entire mutation  // will be run as an atomic transaction, and rolled  // back if an error is thrown.  const result = this.myService.createThing(ctx);  return this.myService.updateOtherThing(ctx, result.id);}
```

## TransactionMode​


[​](#transactionmode)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[transaction.decorator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/api/decorators/transaction.decorator.ts#L32)The Transaction decorator can handle transactions automatically (which is the default) or be set to
"manual" mode, where the TransactionalConnection .startTransaction() and .commitOpenTransaction()
methods must them be used.

[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)Example

```
// in a GraphQL resolver file@Transaction('manual')async myMutation(@Ctx() ctx: RequestContext) {  await this.connection.startTransaction(ctx);  const result = this.myService.createThing(ctx);  const thing = this.myService.updateOtherThing(ctx, result.id);  await this.connection.commitOpenTransaction(ctx);  return thing;}
```

Note that even in manual mode, a rollback will be automatically performed in
the case that an uncaught error is thrown within the resolver.

```
type TransactionMode = 'auto' | 'manual'
```

## TransactionIsolationLevel​


[​](#transactionisolationlevel)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[transaction.decorator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/api/decorators/transaction.decorator.ts#L45)Transactions can be run at different isolation levels. The default is undefined, which
falls back to the default of your database. See the documentation of your database for more
information on available isolation levels.

```
type TransactionIsolationLevel = | 'READ UNCOMMITTED'    | 'READ COMMITTED'    | 'REPEATABLE READ'    | 'SERIALIZABLE'
```


---

# CleanSessionsTask


## cleanSessionsTask​


[​](#cleansessionstask)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[clean-sessions-task.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/scheduler/tasks/clean-sessions-task.ts#L37)A ScheduledTask that cleans expired & inactive sessions from the database.

[ScheduledTask](/reference/typescript-api/scheduled-tasks/scheduled-task#scheduledtask)Example

```
import { cleanSessionsTask, VendureConfig } from '@vendure/core';export const config: VendureConfig = {  // ...  schedulerOptions: {    tasks: [      // Use the task as is      cleanSessionsTask,      // or configure the task      cleanSessionsTask.configure({        // Run the task every day at 3:00am        // The default schedule is every day at 00:00am        schedule: cron => cron.everyDayAt(3, 0),        params: {          // How many sessions to process in each batch          // Default: 1000          batchSize: 5_000,        },      }),    ],  },};
```


---

# DefaultSchedulerPlugin


## DefaultSchedulerPlugin​


[​](#defaultschedulerplugin)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-scheduler.plugin.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/default-scheduler-plugin/default-scheduler.plugin.ts#L40)This plugin configures a default scheduling strategy that executes scheduled
tasks using the database to ensure that each task is executed exactly once
at the scheduled time, even if there are multiple instances of the worker
running.

Example

```
import { DefaultSchedulerPlugin, VendureConfig } from '@vendure/core';export const config: VendureConfig = {  plugins: [    DefaultSchedulerPlugin.init({      // The default is 60s, but you can override it here      defaultTimeout: '10s',    }),  ],};
```

```
class DefaultSchedulerPlugin {    static options: DefaultSchedulerPluginOptions = {        defaultTimeout: DEFAULT_TIMEOUT,        manualTriggerCheckInterval: DEFAULT_MANUAL_TRIGGER_CHECK_INTERVAL,    };    init(config?: DefaultSchedulerPluginOptions) => ;}
```

### options​


[​](#options)[DefaultSchedulerPluginOptions](/reference/typescript-api/scheduled-tasks/default-scheduler-plugin#defaultschedulerpluginoptions)
### init​


[​](#init)[DefaultSchedulerPluginOptions](/reference/typescript-api/scheduled-tasks/default-scheduler-plugin#defaultschedulerpluginoptions)
## DefaultSchedulerPluginOptions​


[​](#defaultschedulerpluginoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/default-scheduler-plugin/types.ts#L9)The options for the DefaultSchedulerPlugin.

[DefaultSchedulerPlugin](/reference/typescript-api/scheduled-tasks/default-scheduler-plugin#defaultschedulerplugin)
```
interface DefaultSchedulerPluginOptions {    defaultTimeout?: string | number;    manualTriggerCheckInterval?: string | number;}
```

### defaultTimeout​


[​](#defaulttimeout)The default timeout for scheduled tasks.

### manualTriggerCheckInterval​


[​](#manualtriggercheckinterval)The interval at which the plugin will check for manually triggered tasks.


---

# DefaultSchedulerStrategy


## DefaultSchedulerStrategy​


[​](#defaultschedulerstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-scheduler-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/plugin/default-scheduler-plugin/default-scheduler-strategy.ts#L28)The default SchedulerStrategy implementation that uses the database to
execute scheduled tasks. This strategy is configured when you use the
DefaultSchedulerPlugin.

[SchedulerStrategy](/reference/typescript-api/scheduled-tasks/scheduler-strategy#schedulerstrategy)[DefaultSchedulerPlugin](/reference/typescript-api/scheduled-tasks/default-scheduler-plugin#defaultschedulerplugin)
```
class DefaultSchedulerStrategy implements SchedulerStrategy {    init(injector: Injector) => ;    destroy() => ;    registerTask(task: ScheduledTask) => void;    executeTask(task: ScheduledTask) => ;    getTasks() => Promise<TaskReport[]>;    getTask(id: string) => Promise<TaskReport | undefined>;    updateTask(input: UpdateScheduledTaskInput) => Promise<TaskReport>;    triggerTask(task: ScheduledTask) => Promise<void>;}
```

- Implements: SchedulerStrategy

[SchedulerStrategy](/reference/typescript-api/scheduled-tasks/scheduler-strategy#schedulerstrategy)
### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)
### destroy​


[​](#destroy)
### registerTask​


[​](#registertask)[ScheduledTask](/reference/typescript-api/scheduled-tasks/scheduled-task#scheduledtask)
### executeTask​


[​](#executetask)[ScheduledTask](/reference/typescript-api/scheduled-tasks/scheduled-task#scheduledtask)
### getTasks​


[​](#gettasks)[TaskReport](/reference/typescript-api/scheduled-tasks/scheduler-strategy#taskreport)
### getTask​


[​](#gettask)[TaskReport](/reference/typescript-api/scheduled-tasks/scheduler-strategy#taskreport)
### updateTask​


[​](#updatetask)[TaskReport](/reference/typescript-api/scheduled-tasks/scheduler-strategy#taskreport)
### triggerTask​


[​](#triggertask)[ScheduledTask](/reference/typescript-api/scheduled-tasks/scheduled-task#scheduledtask)


---

# ScheduledTask


## ScheduledTask​


[​](#scheduledtask)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[scheduled-task.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/scheduler/scheduled-task.ts#L120)Use this class to define a scheduled task that will be executed at a given cron schedule.

Example

```
import { ScheduledTask } from '@vendure/core';const task = new ScheduledTask({    id: 'test-job',    schedule: cron => cron.every(2).minutes(),    execute: async ({ injector, scheduledContext, params }) => {        // some logic here    },});
```

```
class ScheduledTask<C extends Record<string, any> = Record<string, any>> {    constructor(config: ScheduledTaskConfig<C>)    id: void    options: void    execute(injector: Injector) => ;    configure(additionalConfig: Partial<Pick<ScheduledTaskConfig<C>, 'schedule' | 'timeout' | 'params'>>) => ;}
```

### constructor​


[​](#constructor)[ScheduledTaskConfig](/reference/typescript-api/scheduled-tasks/scheduled-task#scheduledtaskconfig)
### id​


[​](#id)
### options​


[​](#options)
### execute​


[​](#execute)[Injector](/reference/typescript-api/common/injector#injector)
### configure​


[​](#configure)[ScheduledTaskConfig](/reference/typescript-api/scheduled-tasks/scheduled-task#scheduledtaskconfig)This method allows you to further configure existing scheduled tasks. For example, you may
wish to change the schedule or timeout of a task, without having to define a new task.

Example

```
import { ScheduledTask } from '@vendure/core';const task = new ScheduledTask({    id: 'test-job',    schedule: cron => cron.every(2).minutes(),    execute: async ({ injector, scheduledContext, params }) => {        // some logic here    },});// later, you can configure the tasktask.configure({ schedule: cron => cron.every(5).minutes() });
```

## ScheduledTaskExecutionArgs​


[​](#scheduledtaskexecutionargs)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[scheduled-task.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/scheduler/scheduled-task.ts#L16)The arguments passed to the execute method of a scheduled task.

```
interface ScheduledTaskExecutionArgs<C extends Record<string, any> = Record<string, any>> {    injector: Injector;    scheduledContext: RequestContext;    params: C;}
```

### injector​


[​](#injector)[Injector](/reference/typescript-api/common/injector#injector)The injector instance.

### scheduledContext​


[​](#scheduledcontext)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)A RequestContext instance that is configured for the scheduled task.

### params​


[​](#params)The parameters for the scheduled task.

## ScheduledTaskConfig​


[​](#scheduledtaskconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[scheduled-task.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/scheduler/scheduled-task.ts#L42)The configuration for a scheduled task.

```
interface ScheduledTaskConfig<C extends Record<string, any> = Record<string, any>> {    id: string;    description?: string;    params?: C;    schedule: string | ((cronTime: typeof CronTime) => string);    timeout?: number | string;    preventOverlap?: boolean;    execute(args: ScheduledTaskExecutionArgs<C>): Promise<any>;}
```

### id​


[​](#id-1)The unique identifier for the scheduled task.

### description​


[​](#description)The description for the scheduled task.

### params​


[​](#params-1)Optional parameters that will be passed to the execute function.

### schedule​


[​](#schedule)The cron schedule for the scheduled task. This can be a standard cron expression or
a function that returns a cron-time-generator
expression.

[cron-time-generator](https://www.npmjs.com/package/cron-time-generator)Example

```
// Standard cron expression{ schedule: '0 0-23/5 * * *', } // every 5 hours{ schedule: '0 22 * * *', } // every day at 10:00 PM// Cron-time-generator expression{ schedule: cronTime => cronTime.every(2).minutes(), }{ schedule: cronTime => cronTime.every(5).hours(), }
```

### timeout​


[​](#timeout)The timeout for the scheduled task. If the task takes longer than the timeout, the task
will be considered to have failed with a timeout error.

### preventOverlap​


[​](#preventoverlap)Whether the scheduled task should be prevented from running if it is already running.

### execute​


[​](#execute-1)[ScheduledTaskExecutionArgs](/reference/typescript-api/scheduled-tasks/scheduled-task#scheduledtaskexecutionargs)The function that will be executed when the scheduled task is run.


---

# SchedulerOptions


## SchedulerOptions​


[​](#scheduleroptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts#L999)Options related to scheduled tasks..

```
interface SchedulerOptions {    schedulerStrategy?: SchedulerStrategy;    tasks?: ScheduledTask[];    runTasksInWorkerOnly?: boolean;}
```

### schedulerStrategy​


[​](#schedulerstrategy)[SchedulerStrategy](/reference/typescript-api/scheduled-tasks/scheduler-strategy#schedulerstrategy)The strategy used to execute scheduled tasks. If you are using the
DefaultSchedulerPlugin (which is recommended) then this will be set to the
DefaultSchedulerStrategy.

[DefaultSchedulerPlugin](/reference/typescript-api/scheduled-tasks/default-scheduler-plugin#defaultschedulerplugin)[DefaultSchedulerStrategy](/reference/typescript-api/scheduled-tasks/default-scheduler-strategy#defaultschedulerstrategy)
### tasks​


[​](#tasks)[ScheduledTask](/reference/typescript-api/scheduled-tasks/scheduled-task#scheduledtask)The tasks to be executed.

### runTasksInWorkerOnly​


[​](#runtasksinworkeronly)Whether to run tasks only in the worker process. Generally this should
be left as true, since tasks may involve expensive operations that should
not be allowed to interfere with the server responsiveness.

This option mainly exists for testing purposes.


---

# SchedulerService


## SchedulerService​


[​](#schedulerservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[scheduler.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/scheduler/scheduler.service.ts#L34)The service that is responsible for setting up and querying the scheduled tasks.

```
class SchedulerService implements OnApplicationBootstrap, OnApplicationShutdown {    constructor(configService: ConfigService, processContext: ProcessContext)    onApplicationBootstrap() => ;    onApplicationShutdown(signal?: string) => ;    getTaskList() => Promise<TaskInfo[]>;    updateTask(input: UpdateScheduledTaskInput) => Promise<TaskInfo>;    runTask(taskId: string) => Promise<Success>;}
```

- Implements: OnApplicationBootstrap, OnApplicationShutdown

### constructor​


[​](#constructor)[ProcessContext](/reference/typescript-api/common/process-context#processcontext)
### onApplicationBootstrap​


[​](#onapplicationbootstrap)
### onApplicationShutdown​


[​](#onapplicationshutdown)
### getTaskList​


[​](#gettasklist)Returns a list of all the scheduled tasks and their current status.

### updateTask​


[​](#updatetask)
### runTask​


[​](#runtask)


---

# SchedulerStrategy


## SchedulerStrategy​


[​](#schedulerstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[scheduler-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/scheduler/scheduler-strategy.ts#L42)This strategy is used to define the mechanism by which scheduled tasks are executed
and how they are reported on. The main purpose of this strategy is to ensure
that a given task is executed exactly once at the scheduled time, even if there
are multiple instances of the worker running.

To do this, the strategy must use some form of shared storage and a method of
locking so that only a single worker is allowed to execute the task.

By default, the DefaultSchedulerStrategy will use the database to enable
this functionality.

[DefaultSchedulerStrategy](/reference/typescript-api/scheduled-tasks/default-scheduler-strategy#defaultschedulerstrategy)
```
interface SchedulerStrategy extends InjectableStrategy {    registerTask?(task: ScheduledTask): void;    executeTask(task: ScheduledTask): (job?: Cron) => Promise<any> | any;    getTasks(): Promise<TaskReport[]>;    getTask(id: string): Promise<TaskReport | undefined>;    triggerTask(task: ScheduledTask): Promise<void>;    updateTask(input: UpdateScheduledTaskInput): Promise<TaskReport>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### registerTask​


[​](#registertask)[ScheduledTask](/reference/typescript-api/scheduled-tasks/scheduled-task#scheduledtask)An optional method that may be used by the strategy to register all the configured
tasks ahead of time. This can be useful for keeping an internal reference of
all the tasks to aid in the specific strategy implemetation.

### executeTask​


[​](#executetask)[ScheduledTask](/reference/typescript-api/scheduled-tasks/scheduled-task#scheduledtask)Execute a scheduled task. This method must also take care of
ensuring that the task is executed exactly once at the scheduled time,
even if there are multiple instances of the worker running.

For instance, in the DefaultSchedulerStrategy we make use of a
dedicated database table and a locking mechansim. If you implement a custom
SchedulerStrategy, you must use some other form of shared locking mechanism
that could make use of something like Redis etc. to ensure that the task
is executed exactly once at the scheduled time.

[DefaultSchedulerStrategy](/reference/typescript-api/scheduled-tasks/default-scheduler-strategy#defaultschedulerstrategy)The function returned is then called in order to execture the task. The
job argument is an instance of the croner Cron class, except when
the task has been manually triggered, in which case it will be undefined.

### getTasks​


[​](#gettasks)[TaskReport](/reference/typescript-api/scheduled-tasks/scheduler-strategy#taskreport)Get all scheduled tasks.

### getTask​


[​](#gettask)[TaskReport](/reference/typescript-api/scheduled-tasks/scheduler-strategy#taskreport)Get a single scheduled task by its id.

### triggerTask​


[​](#triggertask)[ScheduledTask](/reference/typescript-api/scheduled-tasks/scheduled-task#scheduledtask)Manually trigger a given task. This method is not used to actually invoke the
task function itself, since that would cause the task to run on the server
instance which we typically do not want. Instead, it should be used
to signal to the strategy that this specific task needs to be invoked
at the soonest opportunity.

For instance, in the DefaultSchedulerStrategy this is done by setting
a flag in the database table which is checked periodically and causes those tasks
to get immediately invoked.

[DefaultSchedulerStrategy](/reference/typescript-api/scheduled-tasks/default-scheduler-strategy#defaultschedulerstrategy)
### updateTask​


[​](#updatetask)[TaskReport](/reference/typescript-api/scheduled-tasks/scheduler-strategy#taskreport)Update a scheduled task.

## TaskReport​


[​](#taskreport)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[scheduler-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/scheduler/scheduler-strategy.ts#L16)A report on the status of a scheduled task.

```
interface TaskReport {    id: string;    lastExecutedAt: Date | null;    isRunning: boolean;    lastResult: any;    enabled: boolean;}
```

### id​


[​](#id)
### lastExecutedAt​


[​](#lastexecutedat)
### isRunning​


[​](#isrunning)
### lastResult​


[​](#lastresult)
### enabled​


[​](#enabled)


---

# EntityDuplicatorService


## EntityDuplicatorService​


[​](#entityduplicatorservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[entity-duplicator.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/entity-duplicator/entity-duplicator.service.ts#L23)This service is used to duplicate entities using one of the configured
EntityDuplicator functions.

[EntityDuplicator](/reference/typescript-api/configuration/entity-duplicator#entityduplicator)
```
class EntityDuplicatorService {    constructor(configService: ConfigService, configArgService: ConfigArgService, connection: TransactionalConnection)    getEntityDuplicators(ctx: RequestContext) => EntityDuplicatorDefinition[];    duplicateEntity(ctx: RequestContext, input: DuplicateEntityInput) => Promise<DuplicateEntityResult>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)
### getEntityDuplicators​


[​](#getentityduplicators)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Returns all configured EntityDuplicator definitions.

[EntityDuplicator](/reference/typescript-api/configuration/entity-duplicator#entityduplicator)
### duplicateEntity​


[​](#duplicateentity)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Duplicates an entity using the specified EntityDuplicator. The duplication is performed
within a transaction, so if an error occurs, the transaction will be rolled back.

[EntityDuplicator](/reference/typescript-api/configuration/entity-duplicator#entityduplicator)

---

# OrderCalculator


## OrderCalculator​


[​](#ordercalculator)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-calculator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/order-calculator/order-calculator.ts#L35)This helper is used when making changes to an Order, to apply all applicable price adjustments to that Order,
including:

- Promotions
- Taxes
- Shipping

```
class OrderCalculator {    constructor(configService: ConfigService, zoneService: ZoneService, taxRateService: TaxRateService, shippingMethodService: ShippingMethodService, shippingCalculator: ShippingCalculator, requestContextCache: RequestContextCacheService)    applyPriceAdjustments(ctx: RequestContext, order: Order, promotions: Promotion[], updatedOrderLines: OrderLine[] = [], options?: { recalculateShipping?: boolean }) => Promise<Order>;    calculateOrderTotals(order: Order) => ;}
```

### constructor​


[​](#constructor)[ZoneService](/reference/typescript-api/services/zone-service#zoneservice)[TaxRateService](/reference/typescript-api/services/tax-rate-service#taxrateservice)[ShippingMethodService](/reference/typescript-api/services/shipping-method-service#shippingmethodservice)[ShippingCalculator](/reference/typescript-api/shipping/shipping-calculator#shippingcalculator)[RequestContextCacheService](/reference/typescript-api/cache/request-context-cache-service#requestcontextcacheservice)
### applyPriceAdjustments​


[​](#applypriceadjustments)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Promotion](/reference/typescript-api/entities/promotion#promotion)[OrderLine](/reference/typescript-api/entities/order-line#orderline)[Order](/reference/typescript-api/entities/order#order)Applies taxes and promotions to an Order. Mutates the order object.
Returns an array of any OrderItems which had new adjustments
applied, either tax or promotions.

### calculateOrderTotals​


[​](#calculateordertotals)[Order](/reference/typescript-api/entities/order#order)Sets the totals properties on an Order by summing each OrderLine, and taking
into account any Surcharges and ShippingLines. Does not save the Order, so
the entity must be persisted to the DB after calling this method.

Note that this method does not evaluate any taxes or promotions. It assumes
that has already been done and is solely responsible for summing the
totals.


---

# OrderModifier


## OrderModifier​


[​](#ordermodifier)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-modifier.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/order-modifier/order-modifier.ts#L84)This helper is responsible for modifying the contents of an Order.

Note:
There is not a clear separation of concerns between the OrderService and this, since
the OrderService also contains some method which modify the Order (e.g. removeItemFromOrder).
So this helper was mainly extracted to isolate the huge modifyOrder method since the
OrderService was just growing too large. Future refactoring could improve the organization
of these Order-related methods into a more clearly-delineated set of classes.

```
class OrderModifier {    constructor(connection: TransactionalConnection, configService: ConfigService, orderCalculator: OrderCalculator, paymentService: PaymentService, countryService: CountryService, stockMovementService: StockMovementService, productVariantService: ProductVariantService, customFieldRelationService: CustomFieldRelationService, promotionService: PromotionService, eventBus: EventBus, shippingCalculator: ShippingCalculator, historyService: HistoryService, translator: TranslatorService)    constrainQuantityToSaleable(ctx: RequestContext, variant: ProductVariant, quantity: number, existingOrderLineQuantity:  = 0, quantityInOtherOrderLines:  = 0) => ;    getExistingOrderLine(ctx: RequestContext, order: Order, productVariantId: ID, customFields?: { [key: string]: any }) => Promise<OrderLine | undefined>;    getOrCreateOrderLine(ctx: RequestContext, order: Order, productVariantId: ID, customFields?: { [key: string]: any }) => ;    updateOrderLineQuantity(ctx: RequestContext, orderLine: OrderLine, quantity: number, order: Order) => Promise<OrderLine>;    cancelOrderByOrderLines(ctx: RequestContext, input: CancelOrderInput, lineInputs: OrderLineInput[]) => ;    modifyOrder(ctx: RequestContext, input: ModifyOrderInput, order: Order) => Promise<JustErrorResults<ModifyOrderResult> | { order: Order; modification: OrderModification }>;    setShippingMethods(ctx: RequestContext, order: Order, shippingMethodIds: ID[]) => ;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[OrderCalculator](/reference/typescript-api/service-helpers/order-calculator#ordercalculator)[PaymentService](/reference/typescript-api/services/payment-service#paymentservice)[CountryService](/reference/typescript-api/services/country-service#countryservice)[StockMovementService](/reference/typescript-api/services/stock-movement-service#stockmovementservice)[ProductVariantService](/reference/typescript-api/services/product-variant-service#productvariantservice)[PromotionService](/reference/typescript-api/services/promotion-service#promotionservice)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[ShippingCalculator](/reference/typescript-api/shipping/shipping-calculator#shippingcalculator)[HistoryService](/reference/typescript-api/services/history-service#historyservice)[TranslatorService](/reference/typescript-api/service-helpers/translator-service#translatorservice)
### constrainQuantityToSaleable​


[​](#constrainquantitytosaleable)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)Ensure that the ProductVariant has sufficient saleable stock to add the given
quantity to an Order.

- existingOrderLineQuantity is used when adding an item to the order, since if an OrderLine
already exists then we will be adding the new quantity to the existing quantity.
- quantityInOtherOrderLines is used when we have more than 1 OrderLine containing the same
ProductVariant. This occurs when there are custom fields defined on the OrderLine and the lines
have differing values for one or more custom fields. In this case, we need to take all of these
OrderLines into account when constraining the quantity. See https://github.com/vendure-ecommerce/vendure/issues/2702
for more on this.

[https://github.com/vendure-ecommerce/vendure/issues/2702](https://github.com/vendure-ecommerce/vendure/issues/2702)
### getExistingOrderLine​


[​](#getexistingorderline)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[ID](/reference/typescript-api/common/id#id)[OrderLine](/reference/typescript-api/entities/order-line#orderline)Given a ProductVariant ID and optional custom fields, this method will return an existing OrderLine that
matches, or undefined if no match is found.

### getOrCreateOrderLine​


[​](#getorcreateorderline)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[ID](/reference/typescript-api/common/id#id)Returns the OrderLine containing the given ProductVariant, taking into account any custom field values. If no existing
OrderLine is found, a new OrderLine will be created.

[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### updateOrderLineQuantity​


[​](#updateorderlinequantity)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[OrderLine](/reference/typescript-api/entities/order-line#orderline)[Order](/reference/typescript-api/entities/order#order)[OrderLine](/reference/typescript-api/entities/order-line#orderline)Updates the quantity of an OrderLine, taking into account the available saleable stock level.
Returns the actual quantity that the OrderLine was updated to (which may be less than the
quantity argument if insufficient stock was available.

### cancelOrderByOrderLines​


[​](#cancelorderbyorderlines)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### modifyOrder​


[​](#modifyorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Order](/reference/typescript-api/entities/order#order)[OrderModification](/reference/typescript-api/entities/order-modification#ordermodification)
### setShippingMethods​


[​](#setshippingmethods)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[ID](/reference/typescript-api/common/id#id)


---

# ProductPriceApplicator


## ProductPriceApplicator​


[​](#productpriceapplicator)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-price-applicator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/product-price-applicator/product-price-applicator.ts#L41)This helper is used to apply the correct price to a ProductVariant based on the current context
including active Channel, any current Order, etc. If you use the TransactionalConnection to
directly query ProductVariants, you will find that the price and priceWithTax properties will
always be 0 until you use the applyChannelPriceAndTax() method:

[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)Example

```
export class MyCustomService {  constructor(private connection: TransactionalConnection,              private productPriceApplicator: ProductPriceApplicator) {}  getVariant(ctx: RequestContext, id: ID) {    const productVariant = await this.connection      .getRepository(ctx, ProductVariant)      .findOne(id, { relations: ['taxCategory'] });    await this.productPriceApplicator      .applyChannelPriceAndTax(productVariant, ctx);    return productVariant;  }}
```

```
class ProductPriceApplicator {    constructor(configService: ConfigService, taxRateService: TaxRateService, zoneService: ZoneService, requestCache: RequestContextCacheService)    applyChannelPriceAndTax(variant: ProductVariant, ctx: RequestContext, order?: Order, throwIfNoPriceFound:  = false) => Promise<ProductVariant>;}
```

### constructor​


[​](#constructor)[TaxRateService](/reference/typescript-api/services/tax-rate-service#taxrateservice)[ZoneService](/reference/typescript-api/services/zone-service#zoneservice)[RequestContextCacheService](/reference/typescript-api/cache/request-context-cache-service#requestcontextcacheservice)
### applyChannelPriceAndTax​


[​](#applychannelpriceandtax)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)Populates the price field with the price for the specified channel. Make sure that
the ProductVariant being passed in has its taxCategory relation joined.

If the throwIfNoPriceFound option is set to true, then an error will be thrown if no
price is found for the given Channel.


---

# SlugValidator


## SlugValidator​


[​](#slugvalidator)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[slug-validator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/slug-validator/slug-validator.ts#L44)Used to validate slugs to ensure they are URL-safe and unique. Designed to be used with translatable
entities such as Product and Collection.

[Product](/reference/typescript-api/entities/product#product)[Collection](/reference/typescript-api/entities/collection#collection)
```
class SlugValidator {    constructor(connection: TransactionalConnection)    validateSlugs(ctx: RequestContext, input: T, translationEntity: Type<E>) => Promise<T>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)
### validateSlugs​


[​](#validateslugs)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
## InputWithSlug​


[​](#inputwithslug)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[slug-validator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/slug-validator/slug-validator.ts#L16)
```
type InputWithSlug = {    id?: ID | null;    translations?: Array<{        id?: ID | null;        languageCode: LanguageCode;        slug?: string | null;    }> | null;}
```

### id​


[​](#id)[ID](/reference/typescript-api/common/id#id)
### translations​


[​](#translations)[ID](/reference/typescript-api/common/id#id)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)
## TranslationEntity​


[​](#translationentity)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[slug-validator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/slug-validator/slug-validator.ts#L29)
```
type TranslationEntity = VendureEntity & {    id: ID;    languageCode: LanguageCode;    slug: string;    base: any;}
```


---

# TranslatableSaver


## TranslatableSaver​


[​](#translatablesaver)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[translatable-saver.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/translatable-saver/translatable-saver.ts#L55)A helper which contains methods for creating and updating entities which implement the Translatable interface.

[Translatable](/reference/typescript-api/entities/interfaces#translatable)Example

```
export class MyService {  constructor(private translatableSaver: TranslatableSaver) {}  async create(ctx: RequestContext, input: CreateFacetInput): Promise<Translated<Facet>> {    const facet = await this.translatableSaver.create({      ctx,      input,      entityType: Facet,      translationType: FacetTranslation,      beforeSave: async f => {          f.code = await this.ensureUniqueCode(ctx, f.code);      },    });    return facet;  }  // ...}
```

```
class TranslatableSaver {    constructor(connection: TransactionalConnection)    create(options: CreateTranslatableOptions<T>) => Promise<T>;    update(options: UpdateTranslatableOptions<T>) => Promise<T>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)
### create​


[​](#create)Create a translatable entity, including creating any translation entities according
to the translations array.

### update​


[​](#update)Update a translatable entity. Performs a diff of the translations array in order to
perform the correct operation on the translations.


---

# TranslatorService


## TranslatorService​


[​](#translatorservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[translator.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/translator/translator.service.ts#L42)The TranslatorService is used to translate entities into the current language.

Example

```
import { Injectable } from '@nestjs/common';import { ID, Product, RequestContext, TransactionalConnection, TranslatorService } from '@vendure/core';@Injectable()export class ProductService {    constructor(private connection: TransactionalConnection,                private translator: TranslatorService){}    async findOne(ctx: RequestContext, productId: ID): Promise<Product | undefined> {        const product = await this.connection.findOneInChannel(ctx, Product, productId, ctx.channelId, {            relations: {                 facetValues: {                     facet: true,                 }            }        });        if (!product) {            return;        }        return this.translator.translate(product, ctx, ['facetValues', ['facetValues', 'facet']]);    }}
```

```
class TranslatorService {    constructor(configService: ConfigService)    translate(translatable: T, ctx: RequestContext, translatableRelations: DeepTranslatableRelations<T> = []) => ;}
```

### constructor​


[​](#constructor)
### translate​


[​](#translate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)


---

# AdministratorService


## AdministratorService​


[​](#administratorservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[administrator.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/administrator.service.ts#L41)Contains methods relating to Administrator entities.

[Administrator](/reference/typescript-api/entities/administrator#administrator)
```
class AdministratorService {    constructor(connection: TransactionalConnection, configService: ConfigService, listQueryBuilder: ListQueryBuilder, passwordCipher: PasswordCipher, userService: UserService, roleService: RoleService, customFieldRelationService: CustomFieldRelationService, eventBus: EventBus, requestContextService: RequestContextService)    findAll(ctx: RequestContext, options?: ListQueryOptions<Administrator>, relations?: RelationPaths<Administrator>) => Promise<PaginatedList<Administrator>>;    findOne(ctx: RequestContext, administratorId: ID, relations?: RelationPaths<Administrator>) => Promise<Administrator | undefined>;    findOneByUserId(ctx: RequestContext, userId: ID, relations?: RelationPaths<Administrator>) => Promise<Administrator | undefined>;    create(ctx: RequestContext, input: CreateAdministratorInput) => Promise<Administrator>;    update(ctx: RequestContext, input: UpdateAdministratorInput) => Promise<Administrator>;    assignRole(ctx: RequestContext, administratorId: ID, roleId: ID) => Promise<Administrator>;    softDelete(ctx: RequestContext, id: ID) => ;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[UserService](/reference/typescript-api/services/user-service#userservice)[RoleService](/reference/typescript-api/services/role-service#roleservice)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[RequestContextService](/reference/typescript-api/request/request-context-service#requestcontextservice)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Administrator](/reference/typescript-api/entities/administrator#administrator)[Administrator](/reference/typescript-api/entities/administrator#administrator)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Administrator](/reference/typescript-api/entities/administrator#administrator)Get a paginated list of Administrators.

### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Administrator](/reference/typescript-api/entities/administrator#administrator)[Administrator](/reference/typescript-api/entities/administrator#administrator)Get an Administrator by id.

### findOneByUserId​


[​](#findonebyuserid)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Administrator](/reference/typescript-api/entities/administrator#administrator)[Administrator](/reference/typescript-api/entities/administrator#administrator)Get an Administrator based on the User id.

### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Administrator](/reference/typescript-api/entities/administrator#administrator)Create a new Administrator.

### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Administrator](/reference/typescript-api/entities/administrator#administrator)Update an existing Administrator.

### assignRole​


[​](#assignrole)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)[Administrator](/reference/typescript-api/entities/administrator#administrator)Assigns a Role to the Administrator's User entity.

### softDelete​


[​](#softdelete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)Soft deletes an Administrator (sets the deletedAt field).


---

# AssetService


## AssetService​


[​](#assetservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[asset.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/asset.service.ts#L91)Contains methods relating to Asset entities.

[Asset](/reference/typescript-api/entities/asset#asset)
```
class AssetService {    constructor(connection: TransactionalConnection, configService: ConfigService, listQueryBuilder: ListQueryBuilder, eventBus: EventBus, tagService: TagService, channelService: ChannelService, roleService: RoleService, customFieldRelationService: CustomFieldRelationService)    findOne(ctx: RequestContext, id: ID, relations?: RelationPaths<Asset>) => Promise<Asset | undefined>;    findAll(ctx: RequestContext, options?: AssetListOptions, relations?: RelationPaths<Asset>) => Promise<PaginatedList<Asset>>;    getFeaturedAsset(ctx: RequestContext, entity: T) => Promise<Asset | undefined>;    getEntityAssets(ctx: RequestContext, entity: T) => Promise<Asset[] | undefined>;    updateFeaturedAsset(ctx: RequestContext, entity: T, input: EntityAssetInput) => Promise<T>;    updateEntityAssets(ctx: RequestContext, entity: T, input: EntityAssetInput) => Promise<T>;    create(ctx: RequestContext, input: CreateAssetInput) => Promise<CreateAssetResult>;    update(ctx: RequestContext, input: UpdateAssetInput) => Promise<Asset>;    delete(ctx: RequestContext, ids: ID[], force: boolean = false, deleteFromAllChannels: boolean = false) => Promise<DeletionResponse>;    assignToChannel(ctx: RequestContext, input: AssignAssetsToChannelInput) => Promise<Asset[]>;    createFromFileStream(stream: ReadStream, ctx?: RequestContext) => Promise<CreateAssetResult>;    createFromFileStream(stream: Readable, filePath: string, ctx?: RequestContext) => Promise<CreateAssetResult>;    createFromFileStream(stream: ReadStream | Readable, maybeFilePathOrCtx?: string | RequestContext, maybeCtx?: RequestContext) => Promise<CreateAssetResult>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[TagService](/reference/typescript-api/services/tag-service#tagservice)[ChannelService](/reference/typescript-api/services/channel-service#channelservice)[RoleService](/reference/typescript-api/services/role-service#roleservice)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Asset](/reference/typescript-api/entities/asset#asset)[Asset](/reference/typescript-api/entities/asset#asset)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Asset](/reference/typescript-api/entities/asset#asset)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Asset](/reference/typescript-api/entities/asset#asset)
### getFeaturedAsset​


[​](#getfeaturedasset)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Asset](/reference/typescript-api/entities/asset#asset)
### getEntityAssets​


[​](#getentityassets)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Asset](/reference/typescript-api/entities/asset#asset)Returns the Assets of an entity which has a well-ordered list of Assets, such as Product,
ProductVariant or Collection.

### updateFeaturedAsset​


[​](#updatefeaturedasset)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[EntityAssetInput](/reference/typescript-api/services/asset-service#entityassetinput)
### updateEntityAssets​


[​](#updateentityassets)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[EntityAssetInput](/reference/typescript-api/services/asset-service#entityassetinput)Updates the assets / featuredAsset of an entity, ensuring that only valid assetIds are used.

### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Create an Asset based on a file uploaded via the GraphQL API. The file should be uploaded
using the GraphQL multipart request specification,
e.g. using the apollo-upload-client npm package.

[GraphQL multipart request specification](https://github.com/jaydenseric/graphql-multipart-request-spec)[apollo-upload-client](https://github.com/jaydenseric/apollo-upload-client)See the Uploading Files docs for an example of usage.

[Uploading Files docs](/guides/developer-guide/uploading-files)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Asset](/reference/typescript-api/entities/asset#asset)Updates the name, focalPoint, tags & custom fields of an Asset.

### delete​


[​](#delete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)Deletes an Asset after performing checks to ensure that the Asset is not currently in use
by a Product, ProductVariant or Collection.

### assignToChannel​


[​](#assigntochannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Asset](/reference/typescript-api/entities/asset#asset)
### createFromFileStream​


[​](#createfromfilestream)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Create an Asset from a file stream, for example to create an Asset during data import.

### createFromFileStream​


[​](#createfromfilestream-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### createFromFileStream​


[​](#createfromfilestream-2)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
## EntityWithAssets​


[​](#entitywithassets)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[asset.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/asset.service.ts#L67)Certain entities (Product, ProductVariant, Collection) use this interface
to model a featured asset and then a list of assets with a defined order.

```
interface EntityWithAssets extends VendureEntity {    featuredAsset: Asset | null;    assets: OrderableAsset[];}
```

- Extends: VendureEntity

[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)
### featuredAsset​


[​](#featuredasset)[Asset](/reference/typescript-api/entities/asset#asset)
### assets​


[​](#assets)[OrderableAsset](/reference/typescript-api/entities/orderable-asset#orderableasset)
## EntityAssetInput​


[​](#entityassetinput)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[asset.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/asset.service.ts#L79)Used when updating entities which implement EntityWithAssets.

[EntityWithAssets](/reference/typescript-api/services/asset-service#entitywithassets)
```
interface EntityAssetInput {    assetIds?: ID[] | null;    featuredAssetId?: ID | null;}
```

### assetIds​


[​](#assetids)[ID](/reference/typescript-api/common/id#id)
### featuredAssetId​


[​](#featuredassetid)[ID](/reference/typescript-api/common/id#id)


---

# AuthService


## AuthService​


[​](#authservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[auth.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/auth.service.ts#L37)Contains methods relating to Session, AuthenticatedSession & AnonymousSession entities.

[Session](/reference/typescript-api/entities/session#session)[AuthenticatedSession](/reference/typescript-api/entities/authenticated-session#authenticatedsession)[AnonymousSession](/reference/typescript-api/entities/anonymous-session#anonymoussession)
```
class AuthService {    constructor(connection: TransactionalConnection, configService: ConfigService, sessionService: SessionService, eventBus: EventBus)    authenticate(ctx: RequestContext, apiType: ApiType, authenticationMethod: string, authenticationData: any) => Promise<AuthenticatedSession | InvalidCredentialsError | NotVerifiedError>;    createAuthenticatedSessionForUser(ctx: RequestContext, user: User, authenticationStrategyName: string) => Promise<AuthenticatedSession | NotVerifiedError>;    verifyUserPassword(ctx: RequestContext, userId: ID, password: string) => Promise<boolean | InvalidCredentialsError | ShopInvalidCredentialsError>;    destroyAuthenticatedSession(ctx: RequestContext, sessionToken: string) => Promise<void>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[SessionService](/reference/typescript-api/services/session-service#sessionservice)[EventBus](/reference/typescript-api/events/event-bus#eventbus)
### authenticate​


[​](#authenticate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ApiType](/reference/typescript-api/request/api-type#apitype)[AuthenticatedSession](/reference/typescript-api/entities/authenticated-session#authenticatedsession)Authenticates a user's credentials and if okay, creates a new AuthenticatedSession.

[AuthenticatedSession](/reference/typescript-api/entities/authenticated-session#authenticatedsession)
### createAuthenticatedSessionForUser​


[​](#createauthenticatedsessionforuser)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)[AuthenticatedSession](/reference/typescript-api/entities/authenticated-session#authenticatedsession)
### verifyUserPassword​


[​](#verifyuserpassword)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)Verify the provided password against the one we have for the given user. Requires
the NativeAuthenticationStrategy to be configured.

[NativeAuthenticationStrategy](/reference/typescript-api/auth/native-authentication-strategy#nativeauthenticationstrategy)
### destroyAuthenticatedSession​


[​](#destroyauthenticatedsession)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Deletes all sessions for the user associated with the given session token.

---

# ChannelService


## ChannelService​


[​](#channelservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[channel.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/channel.service.ts#L54)Contains methods relating to Channel entities.

[Channel](/reference/typescript-api/entities/channel#channel)
```
class ChannelService {    constructor(connection: TransactionalConnection, configService: ConfigService, globalSettingsService: GlobalSettingsService, customFieldRelationService: CustomFieldRelationService, eventBus: EventBus, listQueryBuilder: ListQueryBuilder)    assignToCurrentChannel(entity: T, ctx: RequestContext) => Promise<T>;    assignToChannels(ctx: RequestContext, entityType: Type<T>, entityId: ID, channelIds: ID[]) => Promise<T>;    removeFromChannels(ctx: RequestContext, entityType: Type<T>, entityId: ID, channelIds: ID[]) => Promise<T | undefined>;    getChannelFromToken(token: string) => Promise<Channel>;    getChannelFromToken(ctx: RequestContext, token: string) => Promise<Channel>;    getChannelFromToken(ctxOrToken: RequestContext | string, token?: string) => Promise<Channel>;    getDefaultChannel(ctx?: RequestContext) => Promise<Channel>;    findAll(ctx: RequestContext, options?: ListQueryOptions<Channel>, relations?: RelationPaths<Channel>) => Promise<PaginatedList<Channel>>;    findOne(ctx: RequestContext, id: ID) => Promise<Channel | undefined>;    create(ctx: RequestContext, input: CreateChannelInput) => Promise<ErrorResultUnion<CreateChannelResult, Channel>>;    update(ctx: RequestContext, input: UpdateChannelInput) => Promise<ErrorResultUnion<UpdateChannelResult, Channel>>;    delete(ctx: RequestContext, id: ID) => Promise<DeletionResponse>;    isChannelAware(entity: VendureEntity) => entity is VendureEntity & ChannelAware;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[GlobalSettingsService](/reference/typescript-api/services/global-settings-service#globalsettingsservice)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)
### assignToCurrentChannel​


[​](#assigntocurrentchannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Assigns a ChannelAware entity to the default Channel as well as any channel
specified in the RequestContext. This method will not save the entity to the database, but
assigns the channels property of the entity.

### assignToChannels​


[​](#assigntochannels)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)Assigns the entity to the given Channels and saves all changes to the database.

### removeFromChannels​


[​](#removefromchannels)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)Removes the entity from the given Channels and saves.

### getChannelFromToken​


[​](#getchannelfromtoken)[Channel](/reference/typescript-api/entities/channel#channel)Given a channel token, returns the corresponding Channel if it exists, else will throw
a ChannelNotFoundError.

[ChannelNotFoundError](/reference/typescript-api/errors/error-types#channelnotfounderror)
### getChannelFromToken​


[​](#getchannelfromtoken-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Channel](/reference/typescript-api/entities/channel#channel)
### getChannelFromToken​


[​](#getchannelfromtoken-2)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Channel](/reference/typescript-api/entities/channel#channel)
### getDefaultChannel​


[​](#getdefaultchannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Channel](/reference/typescript-api/entities/channel#channel)Returns the default Channel.

### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Channel](/reference/typescript-api/entities/channel#channel)[Channel](/reference/typescript-api/entities/channel#channel)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Channel](/reference/typescript-api/entities/channel#channel)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Channel](/reference/typescript-api/entities/channel#channel)
### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Channel](/reference/typescript-api/entities/channel#channel)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Channel](/reference/typescript-api/entities/channel#channel)
### delete​


[​](#delete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### isChannelAware​


[​](#ischannelaware)[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)[ChannelAware](/reference/typescript-api/entities/interfaces#channelaware)Type guard method which returns true if the given entity is an
instance of a class which implements the ChannelAware interface.

[ChannelAware](/reference/typescript-api/entities/interfaces#channelaware)


---

# CollectionService


## CollectionService​


[​](#collectionservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[collection.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/collection.service.ts#L77)Contains methods relating to Collection entities.

[Collection](/reference/typescript-api/entities/collection#collection)
```
class CollectionService implements OnModuleInit {    constructor(connection: TransactionalConnection, channelService: ChannelService, assetService: AssetService, listQueryBuilder: ListQueryBuilder, translatableSaver: TranslatableSaver, eventBus: EventBus, jobQueueService: JobQueueService, configService: ConfigService, slugValidator: SlugValidator, configArgService: ConfigArgService, customFieldRelationService: CustomFieldRelationService, translator: TranslatorService, roleService: RoleService, requestContextService: RequestContextService)    findAll(ctx: RequestContext, options?: ListQueryOptions<Collection> & { topLevelOnly?: boolean }, relations?: RelationPaths<Collection>) => Promise<PaginatedList<Translated<Collection>>>;    findOne(ctx: RequestContext, collectionId: ID, relations?: RelationPaths<Collection>) => Promise<Translated<Collection> | undefined>;    findByIds(ctx: RequestContext, ids: ID[], relations?: RelationPaths<Collection>) => Promise<Array<Translated<Collection>>>;    findOneBySlug(ctx: RequestContext, slug: string, relations?: RelationPaths<Collection>) => Promise<Translated<Collection> | undefined>;    getAvailableFilters(ctx: RequestContext) => ConfigurableOperationDefinition[];    getParent(ctx: RequestContext, collectionId: ID) => Promise<Collection | undefined>;    getChildren(ctx: RequestContext, collectionId: ID) => Promise<Collection[]>;    getBreadcrumbs(ctx: RequestContext, collection: Collection) => Promise<Array<{ name: string; id: ID; slug: string }>>;    getCollectionsByProductId(ctx: RequestContext, productId: ID, publicOnly: boolean) => Promise<Array<Translated<Collection>>>;    getDescendants(ctx: RequestContext, rootId: ID, maxDepth: number = Number.MAX_SAFE_INTEGER) => Promise<Array<Translated<Collection>>>;    getAncestors(collectionId: ID) => Promise<Collection[]>;    getAncestors(collectionId: ID, ctx: RequestContext) => Promise<Array<Translated<Collection>>>;    getAncestors(collectionId: ID, ctx?: RequestContext) => Promise<Array<Translated<Collection> | Collection>>;    previewCollectionVariants(ctx: RequestContext, input: PreviewCollectionVariantsInput, options?: ListQueryOptions<ProductVariant>, relations?: RelationPaths<Collection>) => Promise<PaginatedList<ProductVariant>>;    create(ctx: RequestContext, input: CreateCollectionInput) => Promise<Translated<Collection>>;    update(ctx: RequestContext, input: UpdateCollectionInput) => Promise<Translated<Collection>>;    delete(ctx: RequestContext, id: ID) => Promise<DeletionResponse>;    move(ctx: RequestContext, input: MoveCollectionInput) => Promise<Translated<Collection>>;    setApplyAllFiltersOnProductUpdates(applyAllFiltersOnProductUpdates: boolean) => ;    triggerApplyFiltersJob(ctx: RequestContext, options?: { collectionIds?: ID[]; applyToChangedVariantsOnly?: boolean }) => ;    getCollectionProductVariantIds(collection: Collection, ctx?: RequestContext) => Promise<ID[]>;    assignCollectionsToChannel(ctx: RequestContext, input: AssignCollectionsToChannelInput) => Promise<Array<Translated<Collection>>>;    removeCollectionsFromChannel(ctx: RequestContext, input: RemoveCollectionsFromChannelInput) => Promise<Array<Translated<Collection>>>;}
```

- Implements: OnModuleInit

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[ChannelService](/reference/typescript-api/services/channel-service#channelservice)[AssetService](/reference/typescript-api/services/asset-service#assetservice)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[TranslatableSaver](/reference/typescript-api/service-helpers/translatable-saver#translatablesaver)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[JobQueueService](/reference/typescript-api/job-queue/job-queue-service#jobqueueservice)[SlugValidator](/reference/typescript-api/service-helpers/slug-validator#slugvalidator)[TranslatorService](/reference/typescript-api/service-helpers/translator-service#translatorservice)[RoleService](/reference/typescript-api/services/role-service#roleservice)[RequestContextService](/reference/typescript-api/request/request-context-service#requestcontextservice)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Collection](/reference/typescript-api/entities/collection#collection)[Collection](/reference/typescript-api/entities/collection#collection)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Collection](/reference/typescript-api/entities/collection#collection)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Collection](/reference/typescript-api/entities/collection#collection)[Collection](/reference/typescript-api/entities/collection#collection)
### findByIds​


[​](#findbyids)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Collection](/reference/typescript-api/entities/collection#collection)[Collection](/reference/typescript-api/entities/collection#collection)
### findOneBySlug​


[​](#findonebyslug)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Collection](/reference/typescript-api/entities/collection#collection)[Collection](/reference/typescript-api/entities/collection#collection)
### getAvailableFilters​


[​](#getavailablefilters)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Returns all configured CollectionFilters, as specified by the CatalogOptions.

[CatalogOptions](/reference/typescript-api/products-stock/catalog-options#catalogoptions)
### getParent​


[​](#getparent)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Collection](/reference/typescript-api/entities/collection#collection)
### getChildren​


[​](#getchildren)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Collection](/reference/typescript-api/entities/collection#collection)Returns all child Collections of the Collection with the given id.

### getBreadcrumbs​


[​](#getbreadcrumbs)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Collection](/reference/typescript-api/entities/collection#collection)[ID](/reference/typescript-api/common/id#id)Returns an array of name/id pairs representing all ancestor Collections up
to the Root Collection.

### getCollectionsByProductId​


[​](#getcollectionsbyproductid)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Collection](/reference/typescript-api/entities/collection#collection)Returns all Collections which are associated with the given Product ID.

### getDescendants​


[​](#getdescendants)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Collection](/reference/typescript-api/entities/collection#collection)Returns the descendants of a Collection as a flat array. The depth of the traversal can be limited
with the maxDepth argument. So to get only the immediate children, set maxDepth = 1.

### getAncestors​


[​](#getancestors)[ID](/reference/typescript-api/common/id#id)[Collection](/reference/typescript-api/entities/collection#collection)Gets the ancestors of a given collection. Note that since ProductCategories are implemented as an adjacency list, this method
will produce more queries the deeper the collection is in the tree.

### getAncestors​


[​](#getancestors-1)[ID](/reference/typescript-api/common/id#id)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Collection](/reference/typescript-api/entities/collection#collection)
### getAncestors​


[​](#getancestors-2)[ID](/reference/typescript-api/common/id#id)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Collection](/reference/typescript-api/entities/collection#collection)[Collection](/reference/typescript-api/entities/collection#collection)
### previewCollectionVariants​


[​](#previewcollectionvariants)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[Collection](/reference/typescript-api/entities/collection#collection)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Collection](/reference/typescript-api/entities/collection#collection)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Collection](/reference/typescript-api/entities/collection#collection)
### delete​


[​](#delete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### move​


[​](#move)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Collection](/reference/typescript-api/entities/collection#collection)Moves a Collection by specifying the parent Collection ID, and an index representing the order amongst
its siblings.

### setApplyAllFiltersOnProductUpdates​


[​](#setapplyallfiltersonproductupdates)By default, whenever product data is updated (as determined by subscribing to the
ProductEvent and ProductVariantEvent events), the CollectionFilters are re-applied
to all Collections.

[ProductEvent](/reference/typescript-api/events/event-types#productevent)[ProductVariantEvent](/reference/typescript-api/events/event-types#productvariantevent)In certain scenarios, such as when a large number of products are updated at once due to
bulk data import, this can be inefficient. In such cases, you can disable this behaviour
for the duration of the import process by calling this method with false, and then
re-enable it by calling with true.

Afterward, you can call the triggerApplyFiltersJob method to manually re-apply the filters.

### triggerApplyFiltersJob​


[​](#triggerapplyfiltersjob)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)Triggers the creation of an apply-collection-filters job which will cause the contents
of the specified collections to be re-evaluated against their filters.

If no collectionIds option is passed, then all collections will be re-evaluated.

### getCollectionProductVariantIds​


[​](#getcollectionproductvariantids)[Collection](/reference/typescript-api/entities/collection#collection)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### assignCollectionsToChannel​


[​](#assigncollectionstochannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Collection](/reference/typescript-api/entities/collection#collection)Assigns Collections to the specified Channel

### removeCollectionsFromChannel​


[​](#removecollectionsfromchannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Collection](/reference/typescript-api/entities/collection#collection)Remove Collections from the specified Channel


---


# CountryService


## CountryService​


[​](#countryservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[country.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/country.service.ts#L33)Contains methods relating to Country entities.

[Country](/reference/typescript-api/entities/country#country)
```
class CountryService {    constructor(connection: TransactionalConnection, listQueryBuilder: ListQueryBuilder, translatableSaver: TranslatableSaver, eventBus: EventBus, translator: TranslatorService)    findAll(ctx: RequestContext, options?: ListQueryOptions<Country>, relations: RelationPaths<Country> = []) => Promise<PaginatedList<Translated<Country>>>;    findOne(ctx: RequestContext, countryId: ID, relations: RelationPaths<Country> = []) => Promise<Translated<Country> | undefined>;    findAllAvailable(ctx: RequestContext) => Promise<Array<Translated<Country>>>;    findOneByCode(ctx: RequestContext, countryCode: string) => Promise<Translated<Country>>;    create(ctx: RequestContext, input: CreateCountryInput) => Promise<Translated<Country>>;    update(ctx: RequestContext, input: UpdateCountryInput) => Promise<Translated<Country>>;    delete(ctx: RequestContext, id: ID) => Promise<DeletionResponse>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[TranslatableSaver](/reference/typescript-api/service-helpers/translatable-saver#translatablesaver)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[TranslatorService](/reference/typescript-api/service-helpers/translator-service#translatorservice)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Country](/reference/typescript-api/entities/country#country)[Country](/reference/typescript-api/entities/country#country)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Country](/reference/typescript-api/entities/country#country)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Country](/reference/typescript-api/entities/country#country)[Country](/reference/typescript-api/entities/country#country)
### findAllAvailable​


[​](#findallavailable)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Country](/reference/typescript-api/entities/country#country)Returns an array of enabled Countries, intended for use in a public-facing (ie. Shop) API.

### findOneByCode​


[​](#findonebycode)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Country](/reference/typescript-api/entities/country#country)Returns a Country based on its ISO country code.

### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Country](/reference/typescript-api/entities/country#country)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Country](/reference/typescript-api/entities/country#country)
### delete​


[​](#delete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)


---

# CustomerGroupService


## CustomerGroupService​


[​](#customergroupservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[customer-group.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/customer-group.service.ts#L38)Contains methods relating to CustomerGroup entities.

[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)
```
class CustomerGroupService {    constructor(connection: TransactionalConnection, listQueryBuilder: ListQueryBuilder, historyService: HistoryService, eventBus: EventBus, customFieldRelationService: CustomFieldRelationService)    findAll(ctx: RequestContext, options?: CustomerGroupListOptions, relations: RelationPaths<CustomerGroup> = []) => Promise<PaginatedList<CustomerGroup>>;    findOne(ctx: RequestContext, customerGroupId: ID, relations: RelationPaths<CustomerGroup> = []) => Promise<CustomerGroup | undefined>;    getGroupCustomers(ctx: RequestContext, customerGroupId: ID, options?: CustomerListOptions) => Promise<PaginatedList<Customer>>;    create(ctx: RequestContext, input: CreateCustomerGroupInput) => Promise<CustomerGroup>;    update(ctx: RequestContext, input: UpdateCustomerGroupInput) => Promise<CustomerGroup>;    delete(ctx: RequestContext, id: ID) => Promise<DeletionResponse>;    addCustomersToGroup(ctx: RequestContext, input: MutationAddCustomersToGroupArgs) => Promise<CustomerGroup>;    removeCustomersFromGroup(ctx: RequestContext, input: MutationRemoveCustomersFromGroupArgs) => Promise<CustomerGroup>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[HistoryService](/reference/typescript-api/services/history-service#historyservice)[EventBus](/reference/typescript-api/events/event-bus#eventbus)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)
### getGroupCustomers​


[​](#getgroupcustomers)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Customer](/reference/typescript-api/entities/customer#customer)Returns a PaginatedList of all the Customers in the group.

[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)
### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)
### delete​


[​](#delete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### addCustomersToGroup​


[​](#addcustomerstogroup)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)
### removeCustomersFromGroup​


[​](#removecustomersfromgroup)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)


---


# CustomerService


## CustomerService​


[​](#customerservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[customer.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/customer.service.ts#L80)Contains methods relating to Customer entities.

[Customer](/reference/typescript-api/entities/customer#customer)
```
class CustomerService {    constructor(connection: TransactionalConnection, configService: ConfigService, userService: UserService, countryService: CountryService, listQueryBuilder: ListQueryBuilder, eventBus: EventBus, historyService: HistoryService, channelService: ChannelService, customFieldRelationService: CustomFieldRelationService, translator: TranslatorService)    findAll(ctx: RequestContext, options: ListQueryOptions<Customer> | undefined, relations: RelationPaths<Customer> = []) => Promise<PaginatedList<Customer>>;    findOne(ctx: RequestContext, id: ID, relations: RelationPaths<Customer> = []) => Promise<Customer | undefined>;    findOneByUserId(ctx: RequestContext, userId: ID, filterOnChannel:  = true) => Promise<Customer | undefined>;    findAddressesByCustomerId(ctx: RequestContext, customerId: ID) => Promise<Address[]>;    getCustomerGroups(ctx: RequestContext, customerId: ID) => Promise<CustomerGroup[]>;    create(ctx: RequestContext, input: CreateCustomerInput, password?: string) => Promise<ErrorResultUnion<CreateCustomerResult, Customer>>;    update(ctx: RequestContext, input: UpdateCustomerShopInput & { id: ID }) => Promise<Customer>;    update(ctx: RequestContext, input: UpdateCustomerInput) => Promise<ErrorResultUnion<UpdateCustomerResult, Customer>>;    update(ctx: RequestContext, input: UpdateCustomerInput | (UpdateCustomerShopInput & { id: ID })) => Promise<ErrorResultUnion<UpdateCustomerResult, Customer>>;    registerCustomerAccount(ctx: RequestContext, input: RegisterCustomerInput) => Promise<RegisterCustomerAccountResult | EmailAddressConflictError | PasswordValidationError>;    refreshVerificationToken(ctx: RequestContext, emailAddress: string) => Promise<void>;    verifyCustomerEmailAddress(ctx: RequestContext, verificationToken: string, password?: string) => Promise<ErrorResultUnion<VerifyCustomerAccountResult, Customer>>;    requestPasswordReset(ctx: RequestContext, emailAddress: string) => Promise<void>;    resetPassword(ctx: RequestContext, passwordResetToken: string, password: string) => Promise<        User | PasswordResetTokenExpiredError | PasswordResetTokenInvalidError | PasswordValidationError    >;    requestUpdateEmailAddress(ctx: RequestContext, userId: ID, newEmailAddress: string) => Promise<boolean | EmailAddressConflictError>;    updateEmailAddress(ctx: RequestContext, token: string) => Promise<boolean | IdentifierChangeTokenInvalidError | IdentifierChangeTokenExpiredError>;    createOrUpdate(ctx: RequestContext, input: Partial<CreateCustomerInput> & { emailAddress: string }, errorOnExistingUser: boolean = false) => Promise<Customer | EmailAddressConflictError>;    createAddress(ctx: RequestContext, customerId: ID, input: CreateAddressInput) => Promise<Address>;    updateAddress(ctx: RequestContext, input: UpdateAddressInput) => Promise<Address>;    deleteAddress(ctx: RequestContext, id: ID) => Promise<boolean>;    softDelete(ctx: RequestContext, customerId: ID) => Promise<DeletionResponse>;    createAddressesForNewCustomer(ctx: RequestContext, order: Order) => ;    addNoteToCustomer(ctx: RequestContext, input: AddNoteToCustomerInput) => Promise<Customer>;    updateCustomerNote(ctx: RequestContext, input: UpdateCustomerNoteInput) => Promise<HistoryEntry>;    deleteCustomerNote(ctx: RequestContext, id: ID) => Promise<DeletionResponse>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[UserService](/reference/typescript-api/services/user-service#userservice)[CountryService](/reference/typescript-api/services/country-service#countryservice)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[HistoryService](/reference/typescript-api/services/history-service#historyservice)[ChannelService](/reference/typescript-api/services/channel-service#channelservice)[TranslatorService](/reference/typescript-api/service-helpers/translator-service#translatorservice)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Customer](/reference/typescript-api/entities/customer#customer)[Customer](/reference/typescript-api/entities/customer#customer)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Customer](/reference/typescript-api/entities/customer#customer)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Customer](/reference/typescript-api/entities/customer#customer)[Customer](/reference/typescript-api/entities/customer#customer)
### findOneByUserId​


[​](#findonebyuserid)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Customer](/reference/typescript-api/entities/customer#customer)Returns the Customer entity associated with the given userId, if one exists.
Setting filterOnChannel to true will limit the results to Customers which are assigned
to the current active Channel only.

### findAddressesByCustomerId​


[​](#findaddressesbycustomerid)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Address](/reference/typescript-api/entities/address#address)Returns all Address entities associated with the specified Customer.

[Address](/reference/typescript-api/entities/address#address)
### getCustomerGroups​


[​](#getcustomergroups)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)Returns a list of all CustomerGroup entities.

[CustomerGroup](/reference/typescript-api/entities/customer-group#customergroup)
### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Customer](/reference/typescript-api/entities/customer#customer)Creates a new Customer, including creation of a new User with the special customer Role.

If the password argument is specified, the Customer will be immediately verified. If not,
then an AccountRegistrationEvent is published, so that the customer can have their
email address verified and set their password in a later step using the verifyCustomerEmailAddress()
method.

[AccountRegistrationEvent](/reference/typescript-api/events/event-types#accountregistrationevent)This method is intended to be used in admin-created Customer flows.

### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Customer](/reference/typescript-api/entities/customer#customer)
### update​


[​](#update-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Customer](/reference/typescript-api/entities/customer#customer)
### update​


[​](#update-2)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Customer](/reference/typescript-api/entities/customer#customer)
### registerCustomerAccount​


[​](#registercustomeraccount)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Registers a new Customer account with the NativeAuthenticationStrategy and starts
the email verification flow (unless AuthOptions requireVerification is set to false)
by publishing an AccountRegistrationEvent.

[NativeAuthenticationStrategy](/reference/typescript-api/auth/native-authentication-strategy#nativeauthenticationstrategy)[AuthOptions](/reference/typescript-api/auth/auth-options#authoptions)[AccountRegistrationEvent](/reference/typescript-api/events/event-types#accountregistrationevent)This method is intended to be used in storefront Customer-creation flows.

### refreshVerificationToken​


[​](#refreshverificationtoken)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Refreshes a stale email address verification token by generating a new one and
publishing a AccountRegistrationEvent.

[AccountRegistrationEvent](/reference/typescript-api/events/event-types#accountregistrationevent)
### verifyCustomerEmailAddress​


[​](#verifycustomeremailaddress)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Customer](/reference/typescript-api/entities/customer#customer)Given a valid verification token which has been published in an AccountRegistrationEvent, this
method is used to set the Customer as verified as part of the account registration flow.

[AccountRegistrationEvent](/reference/typescript-api/events/event-types#accountregistrationevent)
### requestPasswordReset​


[​](#requestpasswordreset)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Publishes a new PasswordResetEvent for the given email address. This event creates
a token which can be used in the resetPassword() method.

[PasswordResetEvent](/reference/typescript-api/events/event-types#passwordresetevent)
### resetPassword​


[​](#resetpassword)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)Given a valid password reset token created by a call to the requestPasswordReset() method,
this method will change the Customer's password to that given as the password argument.

### requestUpdateEmailAddress​


[​](#requestupdateemailaddress)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)Publishes a IdentifierChangeRequestEvent for the given User. This event contains a token
which is then used in the updateEmailAddress() method to change the email address of the User &
Customer.

[IdentifierChangeRequestEvent](/reference/typescript-api/events/event-types#identifierchangerequestevent)
### updateEmailAddress​


[​](#updateemailaddress)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Given a valid email update token published in a IdentifierChangeRequestEvent, this method
will update the Customer & User email address.

[IdentifierChangeRequestEvent](/reference/typescript-api/events/event-types#identifierchangerequestevent)
### createOrUpdate​


[​](#createorupdate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Customer](/reference/typescript-api/entities/customer#customer)For guest checkouts, we assume that a matching email address is the same customer.

### createAddress​


[​](#createaddress)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Address](/reference/typescript-api/entities/address#address)Creates a new Address for the given Customer.

[Address](/reference/typescript-api/entities/address#address)
### updateAddress​


[​](#updateaddress)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Address](/reference/typescript-api/entities/address#address)
### deleteAddress​


[​](#deleteaddress)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### softDelete​


[​](#softdelete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### createAddressesForNewCustomer​


[​](#createaddressesfornewcustomer)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)If the Customer associated with the given Order does not yet have any Addresses,
this method will create new Address(es) based on the Order's shipping & billing
addresses.

### addNoteToCustomer​


[​](#addnotetocustomer)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Customer](/reference/typescript-api/entities/customer#customer)
### updateCustomerNote​


[​](#updatecustomernote)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[HistoryEntry](/reference/typescript-api/entities/history-entry#historyentry)
### deleteCustomerNote​


[​](#deletecustomernote)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)


---

# EntitySlugService


## EntitySlugService​


[​](#entityslugservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[entity-slug.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/entity-slug.service.ts#L41)A service that handles slug generation for entities, ensuring uniqueness
and handling conflicts by appending numbers.

```
class EntitySlugService {    constructor(slugService: SlugService, connection: TransactionalConnection)    generateSlugFromInput(ctx: RequestContext, params: GenerateSlugFromInputParams) => Promise<string>;}
```

### constructor​


[​](#constructor)[SlugService](/reference/typescript-api/services/slug-service#slugservice)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)
### generateSlugFromInput​


[​](#generateslugfrominput)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Generates a slug from input value for an entity, ensuring uniqueness.
Automatically detects if the field exists on the base entity or its translation entity.


---

# FacetService


## FacetService​


[​](#facetservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[facet.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/facet.service.ts#L45)Contains methods relating to Facet entities.

[Facet](/reference/typescript-api/entities/facet#facet)
```
class FacetService {    constructor(connection: TransactionalConnection, facetValueService: FacetValueService, translatableSaver: TranslatableSaver, listQueryBuilder: ListQueryBuilder, configService: ConfigService, channelService: ChannelService, customFieldRelationService: CustomFieldRelationService, eventBus: EventBus, translator: TranslatorService, roleService: RoleService)    findAll(ctx: RequestContext, options?: ListQueryOptions<Facet>, relations?: RelationPaths<Facet>) => Promise<PaginatedList<Translated<Facet>>>;    findOne(ctx: RequestContext, facetId: ID, relations?: RelationPaths<Facet>) => Promise<Translated<Facet> | undefined>;    findByCode(facetCode: string, lang: LanguageCode) => Promise<Translated<Facet> | undefined>;    findByCode(ctx: RequestContext, facetCode: string, lang: LanguageCode) => Promise<Translated<Facet> | undefined>;    findByCode(ctxOrFacetCode: RequestContext | string, facetCodeOrLang: string | LanguageCode, lang?: LanguageCode) => Promise<Translated<Facet> | undefined>;    findByFacetValueId(ctx: RequestContext, id: ID) => Promise<Translated<Facet> | undefined>;    create(ctx: RequestContext, input: CreateFacetInput) => Promise<Translated<Facet>>;    update(ctx: RequestContext, input: UpdateFacetInput) => Promise<Translated<Facet>>;    delete(ctx: RequestContext, id: ID, force: boolean = false) => Promise<DeletionResponse>;    assignFacetsToChannel(ctx: RequestContext, input: AssignFacetsToChannelInput) => Promise<Array<Translated<Facet>>>;    removeFacetsFromChannel(ctx: RequestContext, input: RemoveFacetsFromChannelInput) => Promise<Array<ErrorResultUnion<RemoveFacetFromChannelResult, Facet>>>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[FacetValueService](/reference/typescript-api/services/facet-value-service#facetvalueservice)[TranslatableSaver](/reference/typescript-api/service-helpers/translatable-saver#translatablesaver)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[ChannelService](/reference/typescript-api/services/channel-service#channelservice)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[TranslatorService](/reference/typescript-api/service-helpers/translator-service#translatorservice)[RoleService](/reference/typescript-api/services/role-service#roleservice)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Facet](/reference/typescript-api/entities/facet#facet)[Facet](/reference/typescript-api/entities/facet#facet)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Facet](/reference/typescript-api/entities/facet#facet)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Facet](/reference/typescript-api/entities/facet#facet)[Facet](/reference/typescript-api/entities/facet#facet)
### findByCode​


[​](#findbycode)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)[Facet](/reference/typescript-api/entities/facet#facet)
### findByCode​


[​](#findbycode-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)[Facet](/reference/typescript-api/entities/facet#facet)
### findByCode​


[​](#findbycode-2)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)[Facet](/reference/typescript-api/entities/facet#facet)
### findByFacetValueId​


[​](#findbyfacetvalueid)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Facet](/reference/typescript-api/entities/facet#facet)Returns the Facet which contains the given FacetValue id.

### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Facet](/reference/typescript-api/entities/facet#facet)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Facet](/reference/typescript-api/entities/facet#facet)
### delete​


[​](#delete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### assignFacetsToChannel​


[​](#assignfacetstochannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Facet](/reference/typescript-api/entities/facet#facet)Assigns Facets to the specified Channel

### removeFacetsFromChannel​


[​](#removefacetsfromchannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Facet](/reference/typescript-api/entities/facet#facet)Remove Facets from the specified Channel


---

# FacetValueService


## FacetValueService​


[​](#facetvalueservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[facet-value.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/facet-value.service.ts#L40)Contains methods relating to FacetValue entities.

[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
```
class FacetValueService {    constructor(connection: TransactionalConnection, translatableSaver: TranslatableSaver, configService: ConfigService, customFieldRelationService: CustomFieldRelationService, channelService: ChannelService, eventBus: EventBus, translator: TranslatorService, listQueryBuilder: ListQueryBuilder)    findAll(lang: LanguageCode) => Promise<Array<Translated<FacetValue>>>;    findAll(ctx: RequestContext, lang: LanguageCode) => Promise<Array<Translated<FacetValue>>>;    findAll(ctxOrLang: RequestContext | LanguageCode, lang?: LanguageCode) => Promise<Array<Translated<FacetValue>>>;    findAllList(ctx: RequestContext, options?: ListQueryOptions<FacetValue>, relations?: RelationPaths<FacetValue>) => Promise<PaginatedList<Translated<FacetValue>>>;    findOne(ctx: RequestContext, id: ID) => Promise<Translated<FacetValue> | undefined>;    findByIds(ctx: RequestContext, ids: ID[]) => Promise<Array<Translated<FacetValue>>>;    findByFacetId(ctx: RequestContext, id: ID) => Promise<Array<Translated<FacetValue>>>;    findByFacetIdList(ctx: RequestContext, id: ID, options?: ListQueryOptions<FacetValue>, relations?: RelationPaths<FacetValue>) => Promise<PaginatedList<Translated<FacetValue>>>;    create(ctx: RequestContext, facet: Facet, input: CreateFacetValueInput | CreateFacetValueWithFacetInput) => Promise<Translated<FacetValue>>;    update(ctx: RequestContext, input: UpdateFacetValueInput) => Promise<Translated<FacetValue>>;    delete(ctx: RequestContext, id: ID, force: boolean = false) => Promise<DeletionResponse>;    checkFacetValueUsage(ctx: RequestContext, facetValueIds: ID[], channelId?: ID) => Promise<{ productCount: number; variantCount: number }>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[TranslatableSaver](/reference/typescript-api/service-helpers/translatable-saver#translatablesaver)[ChannelService](/reference/typescript-api/services/channel-service#channelservice)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[TranslatorService](/reference/typescript-api/service-helpers/translator-service#translatorservice)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)
### findAll​


[​](#findall)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
### findAll​


[​](#findall-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
### findAll​


[​](#findall-2)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)[LanguageCode](/reference/typescript-api/common/language-code#languagecode)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
### findAllList​


[​](#findalllist)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)Returns a PaginatedList of FacetValues.

TODO: in v2 this should replace the findAll() method.
A separate method was created just to avoid a breaking change in v1.9.

### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
### findByIds​


[​](#findbyids)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
### findByFacetId​


[​](#findbyfacetid)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)Returns all FacetValues belonging to the Facet with the given id.

### findByFacetIdList​


[​](#findbyfacetidlist)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)Returns all FacetValues belonging to the Facet with the given id.

### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Facet](/reference/typescript-api/entities/facet#facet)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
### delete​


[​](#delete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### checkFacetValueUsage​


[​](#checkfacetvalueusage)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)Checks for usage of the given FacetValues in any Products or Variants, and returns the counts.


---

# FulfillmentService


## FulfillmentService​


[​](#fulfillmentservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[fulfillment.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/fulfillment.service.ts#L34)Contains methods relating to Fulfillment entities.

[Fulfillment](/reference/typescript-api/entities/fulfillment#fulfillment)
```
class FulfillmentService {    constructor(connection: TransactionalConnection, fulfillmentStateMachine: FulfillmentStateMachine, eventBus: EventBus, configService: ConfigService, customFieldRelationService: CustomFieldRelationService)    create(ctx: RequestContext, orders: Order[], lines: OrderLineInput[], handler: ConfigurableOperationInput) => Promise<Fulfillment | InvalidFulfillmentHandlerError | CreateFulfillmentError>;    getFulfillmentLines(ctx: RequestContext, id: ID) => Promise<FulfillmentLine[]>;    getFulfillmentsLinesForOrderLine(ctx: RequestContext, orderLineId: ID, relations: RelationPaths<FulfillmentLine> = []) => Promise<FulfillmentLine[]>;    transitionToState(ctx: RequestContext, fulfillmentId: ID, state: FulfillmentState) => Promise<        | {              fulfillment: Fulfillment;              orders: Order[];              fromState: FulfillmentState;              toState: FulfillmentState;          }        | FulfillmentStateTransitionError    >;    getNextStates(fulfillment: Fulfillment) => readonly FulfillmentState[];}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[EventBus](/reference/typescript-api/events/event-bus#eventbus)
### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Fulfillment](/reference/typescript-api/entities/fulfillment#fulfillment)Creates a new Fulfillment for the given Orders and OrderItems, using the specified
FulfillmentHandler.

[FulfillmentHandler](/reference/typescript-api/fulfillment/fulfillment-handler#fulfillmenthandler)
### getFulfillmentLines​


[​](#getfulfillmentlines)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[FulfillmentLine](/reference/typescript-api/entities/order-line-reference#fulfillmentline)
### getFulfillmentsLinesForOrderLine​


[​](#getfulfillmentslinesfororderline)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[FulfillmentLine](/reference/typescript-api/entities/order-line-reference#fulfillmentline)[FulfillmentLine](/reference/typescript-api/entities/order-line-reference#fulfillmentline)
### transitionToState​


[​](#transitiontostate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[FulfillmentState](/reference/typescript-api/fulfillment/fulfillment-state#fulfillmentstate)[Fulfillment](/reference/typescript-api/entities/fulfillment#fulfillment)[Order](/reference/typescript-api/entities/order#order)[FulfillmentState](/reference/typescript-api/fulfillment/fulfillment-state#fulfillmentstate)[FulfillmentState](/reference/typescript-api/fulfillment/fulfillment-state#fulfillmentstate)Transitions the specified Fulfillment to a new state and upon successful transition
publishes a FulfillmentStateTransitionEvent.

[FulfillmentStateTransitionEvent](/reference/typescript-api/events/event-types#fulfillmentstatetransitionevent)
### getNextStates​


[​](#getnextstates)[Fulfillment](/reference/typescript-api/entities/fulfillment#fulfillment)[FulfillmentState](/reference/typescript-api/fulfillment/fulfillment-state#fulfillmentstate)Returns an array of the next valid states for the Fulfillment.


---

# GlobalSettingsService


## GlobalSettingsService​


[​](#globalsettingsservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[global-settings.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/global-settings.service.ts#L23)Contains methods relating to the GlobalSettings entity.

[GlobalSettings](/reference/typescript-api/entities/global-settings#globalsettings)
```
class GlobalSettingsService {    constructor(connection: TransactionalConnection, configService: ConfigService, customFieldRelationService: CustomFieldRelationService, eventBus: EventBus, requestCache: RequestContextCacheService)    getSettings(ctx: RequestContext) => Promise<GlobalSettings>;    updateSettings(ctx: RequestContext, input: UpdateGlobalSettingsInput) => Promise<GlobalSettings>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[RequestContextCacheService](/reference/typescript-api/cache/request-context-cache-service#requestcontextcacheservice)
### getSettings​


[​](#getsettings)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[GlobalSettings](/reference/typescript-api/entities/global-settings#globalsettings)Returns the GlobalSettings entity.

### updateSettings​


[​](#updatesettings)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[GlobalSettings](/reference/typescript-api/entities/global-settings#globalsettings)

---

# HistoryService


## HistoryService​


[​](#historyservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[history.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/history.service.ts#L248)Contains methods relating to HistoryEntry entities. Histories are timelines of actions
related to a particular Customer or Order, recording significant events such as creation, state changes,
notes, etc.

[HistoryEntry](/reference/typescript-api/entities/history-entry#historyentry)
## Custom History Entry Types​


[​](#custom-history-entry-types)Since Vendure v1.9.0, it is possible to define custom HistoryEntry types.

Let's take an example where we have some Customers who are businesses. We want to verify their
tax ID in order to allow them wholesale rates. As part of this verification, we'd like to add
an entry into the Customer's history with data about the tax ID verification.

First of all we'd extend the GraphQL HistoryEntryType enum for our new type as part of a plugin

Example

```
import { PluginCommonModule, VendurePlugin } from '@vendure/core';import { VerificationService } from './verification.service';@VendurePlugin({  imports: [PluginCommonModule],  adminApiExtensions: {    schema: gql`      extend enum HistoryEntryType {        CUSTOMER_TAX_ID_VERIFICATION      }    `,  },  providers: [VerificationService],})export class TaxIDVerificationPlugin {}
```

Next we need to create a TypeScript type definition file where we extend the CustomerHistoryEntryData interface. This is done
via TypeScript's declaration merging
and ambient modules features.

[declaration merging](https://www.typescriptlang.org/docs/handbook/declaration-merging.html#merging-interfaces)[ambient modules](https://www.typescriptlang.org/docs/handbook/modules.html#ambient-modules)Example

```
// types.tsimport { CustomerHistoryEntryData } from '@vendure/core';export const CUSTOMER_TAX_ID_VERIFICATION = 'CUSTOMER_TAX_ID_VERIFICATION';declare module '@vendure/core' {  interface CustomerHistoryEntryData {    [CUSTOMER_TAX_ID_VERIFICATION]: {      taxId: string;      valid: boolean;      name?: string;      address?: string;    };  }}
```

Note: it works exactly the same way if we wanted to add a custom type for Order history, except in that case we'd extend the
OrderHistoryEntryData interface instead.

Now that we have our types set up, we can use the HistoryService to add a new HistoryEntry in a type-safe manner:

Example

```
// verification.service.tsimport { Injectable } from '@nestjs/common';import { RequestContext } from '@vendure/core';import { CUSTOMER_TAX_ID_VERIFICATION } from './types';@Injectable()export class VerificationService {  constructor(private historyService: HistoryService) {}  async verifyTaxId(ctx: RequestContext, customerId: ID, taxId: string) {    const result = await someTaxIdCheckingService(taxId);    await this.historyService.createHistoryEntryForCustomer({      customerId,      ctx,      type: CUSTOMER_TAX_ID_VERIFICATION,      data: {        taxId,        valid: result.isValid,        name: result.companyName,        address: result.registeredAddress,      },    });  }}
```

It is also possible to define a UI component to display custom history entry types. See the
Custom History Timeline Components guide.

[Custom History Timeline Components guide](/guides/extending-the-admin-ui/custom-timeline-components/)
```
class HistoryService {    constructor(connection: TransactionalConnection, administratorService: AdministratorService, listQueryBuilder: ListQueryBuilder, eventBus: EventBus)    getHistoryForOrder(ctx: RequestContext, orderId: ID, publicOnly: boolean, options?: HistoryEntryListOptions) => Promise<PaginatedList<OrderHistoryEntry>>;    createHistoryEntryForOrder(args: CreateOrderHistoryEntryArgs<T>, isPublic:  = true) => Promise<OrderHistoryEntry>;    getHistoryForCustomer(ctx: RequestContext, customerId: ID, publicOnly: boolean, options?: HistoryEntryListOptions) => Promise<PaginatedList<CustomerHistoryEntry>>;    createHistoryEntryForCustomer(args: CreateCustomerHistoryEntryArgs<T>, isPublic:  = false) => Promise<CustomerHistoryEntry>;    updateOrderHistoryEntry(ctx: RequestContext, args: UpdateOrderHistoryEntryArgs<T>) => ;    deleteOrderHistoryEntry(ctx: RequestContext, id: ID) => Promise<void>;    updateCustomerHistoryEntry(ctx: RequestContext, args: UpdateCustomerHistoryEntryArgs<T>) => ;    deleteCustomerHistoryEntry(ctx: RequestContext, id: ID) => Promise<void>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[AdministratorService](/reference/typescript-api/services/administrator-service#administratorservice)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[EventBus](/reference/typescript-api/events/event-bus#eventbus)
### getHistoryForOrder​


[​](#gethistoryfororder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[OrderHistoryEntry](/reference/typescript-api/entities/order-history-entry#orderhistoryentry)
### createHistoryEntryForOrder​


[​](#createhistoryentryfororder)[OrderHistoryEntry](/reference/typescript-api/entities/order-history-entry#orderhistoryentry)
### getHistoryForCustomer​


[​](#gethistoryforcustomer)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[CustomerHistoryEntry](/reference/typescript-api/entities/customer-history-entry#customerhistoryentry)
### createHistoryEntryForCustomer​


[​](#createhistoryentryforcustomer)[CustomerHistoryEntry](/reference/typescript-api/entities/customer-history-entry#customerhistoryentry)
### updateOrderHistoryEntry​


[​](#updateorderhistoryentry)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### deleteOrderHistoryEntry​


[​](#deleteorderhistoryentry)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### updateCustomerHistoryEntry​


[​](#updatecustomerhistoryentry)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### deleteCustomerHistoryEntry​


[​](#deletecustomerhistoryentry)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)


---

# InitializerService


## InitializerService​


[​](#initializerservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[initializer.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/initializer.service.ts#L26)Only used internally to run the various service init methods in the correct
sequence on bootstrap.

```
class InitializerService {    constructor(connection: TransactionalConnection, zoneService: ZoneService, channelService: ChannelService, roleService: RoleService, administratorService: AdministratorService, shippingMethodService: ShippingMethodService, globalSettingsService: GlobalSettingsService, taxRateService: TaxRateService, sellerService: SellerService, eventBus: EventBus, stockLocationService: StockLocationService)    onModuleInit() => ;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[ZoneService](/reference/typescript-api/services/zone-service#zoneservice)[ChannelService](/reference/typescript-api/services/channel-service#channelservice)[RoleService](/reference/typescript-api/services/role-service#roleservice)[AdministratorService](/reference/typescript-api/services/administrator-service#administratorservice)[ShippingMethodService](/reference/typescript-api/services/shipping-method-service#shippingmethodservice)[GlobalSettingsService](/reference/typescript-api/services/global-settings-service#globalsettingsservice)[TaxRateService](/reference/typescript-api/services/tax-rate-service#taxrateservice)[SellerService](/reference/typescript-api/services/seller-service#sellerservice)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[StockLocationService](/reference/typescript-api/services/stock-location-service#stocklocationservice)
### onModuleInit​


[​](#onmoduleinit)


---

# OrderService


## OrderService​


[​](#orderservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/order.service.ts#L141)Contains methods relating to Order entities.

[Order](/reference/typescript-api/entities/order#order)
```
class OrderService {    constructor(connection: TransactionalConnection, configService: ConfigService, productVariantService: ProductVariantService, customerService: CustomerService, countryService: CountryService, orderCalculator: OrderCalculator, shippingCalculator: ShippingCalculator, orderStateMachine: OrderStateMachine, orderMerger: OrderMerger, paymentService: PaymentService, paymentMethodService: PaymentMethodService, fulfillmentService: FulfillmentService, listQueryBuilder: ListQueryBuilder, refundStateMachine: RefundStateMachine, historyService: HistoryService, promotionService: PromotionService, eventBus: EventBus, channelService: ChannelService, orderModifier: OrderModifier, customFieldRelationService: CustomFieldRelationService, requestCache: RequestContextCacheService, translator: TranslatorService, stockLevelService: StockLevelService)    getOrderProcessStates() => OrderProcessState[];    findAll(ctx: RequestContext, options?: OrderListOptions, relations?: RelationPaths<Order>) => Promise<PaginatedList<Order>>;    findOne(ctx: RequestContext, orderId: ID, relations?: RelationPaths<Order>) => Promise<Order | undefined>;    findOneByCode(ctx: RequestContext, orderCode: string, relations?: RelationPaths<Order>) => Promise<Order | undefined>;    findOneByOrderLineId(ctx: RequestContext, orderLineId: ID, relations?: RelationPaths<Order>) => Promise<Order | undefined>;    findByCustomerId(ctx: RequestContext, customerId: ID, options?: ListQueryOptions<Order>, relations?: RelationPaths<Order>) => Promise<PaginatedList<Order>>;    getOrderPayments(ctx: RequestContext, orderId: ID) => Promise<Payment[]>;    getOrderModifications(ctx: RequestContext, orderId: ID) => Promise<OrderModification[]>;    getPaymentRefunds(ctx: RequestContext, paymentId: ID) => Promise<Refund[]>;    getSellerOrders(ctx: RequestContext, order: Order) => Promise<Order[]>;    getAggregateOrder(ctx: RequestContext, order: Order) => Promise<Order | undefined>;    getOrderChannels(ctx: RequestContext, order: Order) => Promise<Channel[]>;    getActiveOrderForUser(ctx: RequestContext, userId: ID) => Promise<Order | undefined>;    create(ctx: RequestContext, userId?: ID) => Promise<Order>;    createDraft(ctx: RequestContext) => ;    updateCustomFields(ctx: RequestContext, orderId: ID, customFields: any) => ;    updateOrderCustomer(ctx: RequestContext, { customerId, orderId, note }: SetOrderCustomerInput) => ;    addItemToOrder(ctx: RequestContext, orderId: ID, productVariantId: ID, quantity: number, customFields?: { [key: string]: any }, relations?: RelationPaths<Order>) => Promise<ErrorResultUnion<UpdateOrderItemsResult, Order>>;    addItemsToOrder(ctx: RequestContext, orderId: ID, items: Array<{            productVariantId: ID;            quantity: number;            customFields?: { [key: string]: any };        }>, relations?: RelationPaths<Order>) => Promise<{ order: Order; errorResults: Array<JustErrorResults<UpdateOrderItemsResult>> }>;    adjustOrderLine(ctx: RequestContext, orderId: ID, orderLineId: ID, quantity: number, customFields?: { [key: string]: any }, relations?: RelationPaths<Order>) => Promise<ErrorResultUnion<UpdateOrderItemsResult, Order>>;    adjustOrderLines(ctx: RequestContext, orderId: ID, lines: Array<{ orderLineId: ID; quantity: number; customFields?: { [key: string]: any } }>, relations?: RelationPaths<Order>) => Promise<{ order: Order; errorResults: Array<JustErrorResults<UpdateOrderItemsResult>> }>;    removeItemFromOrder(ctx: RequestContext, orderId: ID, orderLineId: ID) => Promise<ErrorResultUnion<RemoveOrderItemsResult, Order>>;    removeItemsFromOrder(ctx: RequestContext, orderId: ID, orderLineIds: ID[]) => Promise<ErrorResultUnion<RemoveOrderItemsResult, Order>>;    removeAllItemsFromOrder(ctx: RequestContext, orderId: ID) => Promise<ErrorResultUnion<RemoveOrderItemsResult, Order>>;    addSurchargeToOrder(ctx: RequestContext, orderId: ID, surchargeInput: Partial<Omit<Surcharge, 'id' | 'createdAt' | 'updatedAt' | 'order'>>) => Promise<Order>;    removeSurchargeFromOrder(ctx: RequestContext, orderId: ID, surchargeId: ID) => Promise<Order>;    applyCouponCode(ctx: RequestContext, orderId: ID, couponCode: string) => Promise<ErrorResultUnion<ApplyCouponCodeResult, Order>>;    removeCouponCode(ctx: RequestContext, orderId: ID, couponCode: string) => ;    getOrderPromotions(ctx: RequestContext, orderId: ID) => Promise<Promotion[]>;    getNextOrderStates(order: Order) => readonly OrderState[];    setShippingAddress(ctx: RequestContext, orderId: ID, input: CreateAddressInput) => Promise<Order>;    setBillingAddress(ctx: RequestContext, orderId: ID, input: CreateAddressInput) => Promise<Order>;    unsetShippingAddress(ctx: RequestContext, orderId: ID) => Promise<Order>;    unsetBillingAddress(ctx: RequestContext, orderId: ID) => Promise<Order>;    getEligibleShippingMethods(ctx: RequestContext, orderId: ID) => Promise<ShippingMethodQuote[]>;    getEligiblePaymentMethods(ctx: RequestContext, orderId: ID) => Promise<PaymentMethodQuote[]>;    setShippingMethod(ctx: RequestContext, orderId: ID, shippingMethodIds: ID[]) => Promise<ErrorResultUnion<SetOrderShippingMethodResult, Order>>;    transitionToState(ctx: RequestContext, orderId: ID, state: OrderState) => Promise<Order | OrderStateTransitionError>;    transitionFulfillmentToState(ctx: RequestContext, fulfillmentId: ID, state: FulfillmentState) => Promise<Fulfillment | FulfillmentStateTransitionError>;    transitionRefundToState(ctx: RequestContext, refundId: ID, state: RefundState, transactionId?: string) => Promise<Refund | RefundStateTransitionError>;    modifyOrder(ctx: RequestContext, input: ModifyOrderInput) => Promise<ErrorResultUnion<ModifyOrderResult, Order>>;    transitionPaymentToState(ctx: RequestContext, paymentId: ID, state: PaymentState) => Promise<ErrorResultUnion<TransitionPaymentToStateResult, Payment>>;    addPaymentToOrder(ctx: RequestContext, orderId: ID, input: PaymentInput) => Promise<ErrorResultUnion<AddPaymentToOrderResult, Order>>;    addManualPaymentToOrder(ctx: RequestContext, input: ManualPaymentInput) => Promise<ErrorResultUnion<AddManualPaymentToOrderResult, Order>>;    settlePayment(ctx: RequestContext, paymentId: ID) => Promise<ErrorResultUnion<SettlePaymentResult, Payment>>;    cancelPayment(ctx: RequestContext, paymentId: ID) => Promise<ErrorResultUnion<CancelPaymentResult, Payment>>;    createFulfillment(ctx: RequestContext, input: FulfillOrderInput) => Promise<ErrorResultUnion<AddFulfillmentToOrderResult, Fulfillment>>;    getOrderFulfillments(ctx: RequestContext, order: Order) => Promise<Fulfillment[]>;    getOrderSurcharges(ctx: RequestContext, orderId: ID) => Promise<Surcharge[]>;    cancelOrder(ctx: RequestContext, input: CancelOrderInput) => Promise<ErrorResultUnion<CancelOrderResult, Order>>;    refundOrder(ctx: RequestContext, input: RefundOrderInput) => Promise<ErrorResultUnion<RefundOrderResult, Refund>>;    settleRefund(ctx: RequestContext, input: SettleRefundInput) => Promise<Refund>;    addCustomerToOrder(ctx: RequestContext, orderIdOrOrder: ID | Order, customer: Customer) => Promise<Order>;    addNoteToOrder(ctx: RequestContext, input: AddNoteToOrderInput) => Promise<Order>;    updateOrderNote(ctx: RequestContext, input: UpdateOrderNoteInput) => Promise<HistoryEntry>;    deleteOrderNote(ctx: RequestContext, id: ID) => Promise<DeletionResponse>;    deleteOrder(ctx: RequestContext, orderOrId: ID | Order) => ;    mergeOrders(ctx: RequestContext, user: User, guestOrder?: Order, existingOrder?: Order) => Promise<Order | undefined>;    applyPriceAdjustments(ctx: RequestContext, order: Order, updatedOrderLines?: OrderLine[], relations?: RelationPaths<Order>) => Promise<Order>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[ProductVariantService](/reference/typescript-api/services/product-variant-service#productvariantservice)[CustomerService](/reference/typescript-api/services/customer-service#customerservice)[CountryService](/reference/typescript-api/services/country-service#countryservice)[OrderCalculator](/reference/typescript-api/service-helpers/order-calculator#ordercalculator)[ShippingCalculator](/reference/typescript-api/shipping/shipping-calculator#shippingcalculator)[PaymentService](/reference/typescript-api/services/payment-service#paymentservice)[PaymentMethodService](/reference/typescript-api/services/payment-method-service#paymentmethodservice)[FulfillmentService](/reference/typescript-api/services/fulfillment-service#fulfillmentservice)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[HistoryService](/reference/typescript-api/services/history-service#historyservice)[PromotionService](/reference/typescript-api/services/promotion-service#promotionservice)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[ChannelService](/reference/typescript-api/services/channel-service#channelservice)[OrderModifier](/reference/typescript-api/service-helpers/order-modifier#ordermodifier)[RequestContextCacheService](/reference/typescript-api/cache/request-context-cache-service#requestcontextcacheservice)[TranslatorService](/reference/typescript-api/service-helpers/translator-service#translatorservice)[StockLevelService](/reference/typescript-api/services/stock-level-service#stocklevelservice)
### getOrderProcessStates​


[​](#getorderprocessstates)Returns an array of all the configured states and transitions of the order process. This is
based on the default order process plus all configured OrderProcess objects
defined in the OrderOptions process array.

[OrderProcess](/reference/typescript-api/orders/order-process#orderprocess)[OrderOptions](/reference/typescript-api/orders/order-options#orderoptions)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Order](/reference/typescript-api/entities/order#order)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Order](/reference/typescript-api/entities/order#order)[Order](/reference/typescript-api/entities/order#order)
### findOneByCode​


[​](#findonebycode)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Order](/reference/typescript-api/entities/order#order)
### findOneByOrderLineId​


[​](#findonebyorderlineid)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Order](/reference/typescript-api/entities/order#order)[Order](/reference/typescript-api/entities/order#order)
### findByCustomerId​


[​](#findbycustomerid)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Order](/reference/typescript-api/entities/order#order)[Order](/reference/typescript-api/entities/order#order)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Order](/reference/typescript-api/entities/order#order)
### getOrderPayments​


[​](#getorderpayments)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Payment](/reference/typescript-api/entities/payment#payment)Returns all Payment entities associated with the Order.

[Payment](/reference/typescript-api/entities/payment#payment)
### getOrderModifications​


[​](#getordermodifications)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[OrderModification](/reference/typescript-api/entities/order-modification#ordermodification)Returns an array of any OrderModification entities associated with the Order.

[OrderModification](/reference/typescript-api/entities/order-modification#ordermodification)
### getPaymentRefunds​


[​](#getpaymentrefunds)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Refund](/reference/typescript-api/entities/refund#refund)Returns any Refunds associated with a Payment.

[Refund](/reference/typescript-api/entities/refund#refund)[Payment](/reference/typescript-api/entities/payment#payment)
### getSellerOrders​


[​](#getsellerorders)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Order](/reference/typescript-api/entities/order#order)
### getAggregateOrder​


[​](#getaggregateorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Order](/reference/typescript-api/entities/order#order)
### getOrderChannels​


[​](#getorderchannels)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Channel](/reference/typescript-api/entities/channel#channel)
### getActiveOrderForUser​


[​](#getactiveorderforuser)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Order](/reference/typescript-api/entities/order#order)Returns any Order associated with the specified User's Customer account
that is still in the active state.

### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Order](/reference/typescript-api/entities/order#order)Creates a new, empty Order. If a userId is passed, the Order will get associated with that
User's Customer account.

### createDraft​


[​](#createdraft)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### updateCustomFields​


[​](#updatecustomfields)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)Updates the custom fields of an Order.

### updateOrderCustomer​


[​](#updateordercustomer)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Updates the Customer which is assigned to a given Order. The target Customer must be assigned to the same
Channels as the Order, otherwise an error will be thrown.

### addItemToOrder​


[​](#additemtoorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)[Order](/reference/typescript-api/entities/order#order)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Order](/reference/typescript-api/entities/order#order)Adds an item to the Order, either creating a new OrderLine or
incrementing an existing one.

If you need to add multiple items to an Order, use addItemsToOrder() instead.

### addItemsToOrder​


[​](#additemstoorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)[Order](/reference/typescript-api/entities/order#order)[Order](/reference/typescript-api/entities/order#order)Adds multiple items to an Order. This method is more efficient than calling addItemToOrder
multiple times, as it only needs to fetch the entire Order once, and only performs
price adjustments once at the end.

Since this method can return multiple error results, it is recommended to check the errorResults
array to determine if any errors occurred.

### adjustOrderLine​


[​](#adjustorderline)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)[Order](/reference/typescript-api/entities/order#order)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Order](/reference/typescript-api/entities/order#order)Adjusts the quantity and/or custom field values of an existing OrderLine.

If you need to adjust multiple OrderLines, use adjustOrderLines() instead.

### adjustOrderLines​


[​](#adjustorderlines)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)[Order](/reference/typescript-api/entities/order#order)[Order](/reference/typescript-api/entities/order#order)Adjusts the quantity and/or custom field values of existing OrderLines.
This method is more efficient than calling adjustOrderLine multiple times, as it only needs to fetch
the entire Order once, and only performs price adjustments once at the end.
Since this method can return multiple error results, it is recommended to check the errorResults
array to determine if any errors occurred.

### removeItemFromOrder​


[​](#removeitemfromorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Order](/reference/typescript-api/entities/order#order)Removes the specified OrderLine from the Order.

If you need to remove multiple OrderLines, use removeItemsFromOrder() instead.

### removeItemsFromOrder​


[​](#removeitemsfromorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Order](/reference/typescript-api/entities/order#order)Removes the specified OrderLines from the Order.
This method is more efficient than calling removeItemFromOrder multiple times, as it only needs to fetch
the entire Order once, and only performs price adjustments once at the end.

### removeAllItemsFromOrder​


[​](#removeallitemsfromorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Order](/reference/typescript-api/entities/order#order)Removes all OrderLines from the Order.

### addSurchargeToOrder​


[​](#addsurchargetoorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Surcharge](/reference/typescript-api/entities/surcharge#surcharge)[Order](/reference/typescript-api/entities/order#order)Adds a Surcharge to the Order.

[Surcharge](/reference/typescript-api/entities/surcharge#surcharge)
### removeSurchargeFromOrder​


[​](#removesurchargefromorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)[Order](/reference/typescript-api/entities/order#order)Removes a Surcharge from the Order.

[Surcharge](/reference/typescript-api/entities/surcharge#surcharge)
### applyCouponCode​


[​](#applycouponcode)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Order](/reference/typescript-api/entities/order#order)Applies a coupon code to the Order, which should be a valid coupon code as specified in the configuration
of an active Promotion.

[Promotion](/reference/typescript-api/entities/promotion#promotion)
### removeCouponCode​


[​](#removecouponcode)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)Removes a coupon code from the Order.

### getOrderPromotions​


[​](#getorderpromotions)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Promotion](/reference/typescript-api/entities/promotion#promotion)Returns all Promotions associated with an Order.

[Promotion](/reference/typescript-api/entities/promotion#promotion)
### getNextOrderStates​


[​](#getnextorderstates)[Order](/reference/typescript-api/entities/order#order)[OrderState](/reference/typescript-api/orders/order-process#orderstate)Returns the next possible states that the Order may transition to.

### setShippingAddress​


[​](#setshippingaddress)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Order](/reference/typescript-api/entities/order#order)Sets the shipping address for the Order.

### setBillingAddress​


[​](#setbillingaddress)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Order](/reference/typescript-api/entities/order#order)Sets the billing address for the Order.

### unsetShippingAddress​


[​](#unsetshippingaddress)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Order](/reference/typescript-api/entities/order#order)Unsets the shipping address for the Order.

### unsetBillingAddress​


[​](#unsetbillingaddress)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Order](/reference/typescript-api/entities/order#order)Unsets the billing address for the Order.

### getEligibleShippingMethods​


[​](#geteligibleshippingmethods)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)Returns an array of quotes stating which ShippingMethods may be applied to this Order.
This is determined by the configured ShippingEligibilityChecker of each ShippingMethod.

[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)[ShippingEligibilityChecker](/reference/typescript-api/shipping/shipping-eligibility-checker#shippingeligibilitychecker)The quote also includes a price for each method, as determined by the configured
ShippingCalculator of each eligible ShippingMethod.

[ShippingCalculator](/reference/typescript-api/shipping/shipping-calculator#shippingcalculator)
### getEligiblePaymentMethods​


[​](#geteligiblepaymentmethods)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)Returns an array of quotes stating which PaymentMethods may be used on this Order.

[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)
### setShippingMethod​


[​](#setshippingmethod)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Order](/reference/typescript-api/entities/order#order)Sets the ShippingMethod to be used on this Order.

### transitionToState​


[​](#transitiontostate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[OrderState](/reference/typescript-api/orders/order-process#orderstate)[Order](/reference/typescript-api/entities/order#order)Transitions the Order to the given state.

### transitionFulfillmentToState​


[​](#transitionfulfillmenttostate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[FulfillmentState](/reference/typescript-api/fulfillment/fulfillment-state#fulfillmentstate)[Fulfillment](/reference/typescript-api/entities/fulfillment#fulfillment)Transitions a Fulfillment to the given state and then transitions the Order state based on
whether all Fulfillments of the Order are shipped or delivered.

### transitionRefundToState​


[​](#transitionrefundtostate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[RefundState](/reference/typescript-api/payment/refund-state#refundstate)[Refund](/reference/typescript-api/entities/refund#refund)Transitions a Refund to the given state

### modifyOrder​


[​](#modifyorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Order](/reference/typescript-api/entities/order#order)Allows the Order to be modified, which allows several aspects of the Order to be changed:

- Changes to OrderLine quantities
- New OrderLines being added
- Arbitrary Surcharges being added
- Shipping or billing address changes

[Surcharge](/reference/typescript-api/entities/surcharge#surcharge)Setting the dryRun input property to true will apply all changes, including updating the price of the
Order, except history entry and additional payment actions.

Using dryRun option, you must wrap function call in transaction manually.

### transitionPaymentToState​


[​](#transitionpaymenttostate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Payment](/reference/typescript-api/entities/payment#payment)Transitions the given Payment to a new state.

[Payment](/reference/typescript-api/entities/payment#payment)
### addPaymentToOrder​


[​](#addpaymenttoorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Order](/reference/typescript-api/entities/order#order)Adds a new Payment to the Order. If the Order totalWithTax is covered by Payments, then the Order
state will get automatically transitioned to the PaymentSettled or PaymentAuthorized state.

### addManualPaymentToOrder​


[​](#addmanualpaymenttoorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Order](/reference/typescript-api/entities/order#order)This method is used after modifying an existing completed order using the modifyOrder() method. If the modifications
cause the order total to increase (such as when adding a new OrderLine), then there will be an outstanding charge to
pay.

This method allows you to add a new Payment and assumes the actual processing has been done manually, e.g. in the
dashboard of your payment provider.

### settlePayment​


[​](#settlepayment)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[SettlePaymentResult](/reference/typescript-api/payment/payment-method-types#settlepaymentresult)[Payment](/reference/typescript-api/entities/payment#payment)Settles a payment by invoking the PaymentMethodHandler's settlePayment() method. Automatically
transitions the Order state if all Payments are settled.

[PaymentMethodHandler](/reference/typescript-api/payment/payment-method-handler#paymentmethodhandler)
### cancelPayment​


[​](#cancelpayment)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[CancelPaymentResult](/reference/typescript-api/payment/payment-method-types#cancelpaymentresult)[Payment](/reference/typescript-api/entities/payment#payment)Cancels a payment by invoking the PaymentMethodHandler's cancelPayment() method (if defined), and transitions the Payment to
the Cancelled state.

[PaymentMethodHandler](/reference/typescript-api/payment/payment-method-handler#paymentmethodhandler)
### createFulfillment​


[​](#createfulfillment)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Fulfillment](/reference/typescript-api/entities/fulfillment#fulfillment)Creates a new Fulfillment associated with the given Order and OrderItems.

### getOrderFulfillments​


[​](#getorderfulfillments)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Fulfillment](/reference/typescript-api/entities/fulfillment#fulfillment)Returns an array of all Fulfillments associated with the Order.

### getOrderSurcharges​


[​](#getordersurcharges)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Surcharge](/reference/typescript-api/entities/surcharge#surcharge)Returns an array of all Surcharges associated with the Order.

### cancelOrder​


[​](#cancelorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Order](/reference/typescript-api/entities/order#order)Cancels an Order by transitioning it to the Cancelled state. If stock is being tracked for the ProductVariants
in the Order, then new StockMovements will be created to correct the stock levels.

[StockMovement](/reference/typescript-api/entities/stock-movement#stockmovement)
### refundOrder​


[​](#refundorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Refund](/reference/typescript-api/entities/refund#refund)Creates a Refund against the order and in doing so invokes the createRefund() method of the
PaymentMethodHandler.

[Refund](/reference/typescript-api/entities/refund#refund)[PaymentMethodHandler](/reference/typescript-api/payment/payment-method-handler#paymentmethodhandler)
### settleRefund​


[​](#settlerefund)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Refund](/reference/typescript-api/entities/refund#refund)Settles a Refund by transitioning it to the Settled state.

### addCustomerToOrder​


[​](#addcustomertoorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Order](/reference/typescript-api/entities/order#order)[Customer](/reference/typescript-api/entities/customer#customer)[Order](/reference/typescript-api/entities/order#order)Associates a Customer with the Order.

### addNoteToOrder​


[​](#addnotetoorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)Creates a new "ORDER_NOTE" type OrderHistoryEntry in the Order's history timeline.

[OrderHistoryEntry](/reference/typescript-api/entities/order-history-entry#orderhistoryentry)
### updateOrderNote​


[​](#updateordernote)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[HistoryEntry](/reference/typescript-api/entities/history-entry#historyentry)
### deleteOrderNote​


[​](#deleteordernote)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### deleteOrder​


[​](#deleteorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Order](/reference/typescript-api/entities/order#order)Deletes an Order, ensuring that any Sessions that reference this Order are dereferenced before deletion.

### mergeOrders​


[​](#mergeorders)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)[Order](/reference/typescript-api/entities/order#order)[Order](/reference/typescript-api/entities/order#order)[Order](/reference/typescript-api/entities/order#order)When a guest user with an anonymous Order signs in and has an existing Order associated with that Customer,
we need to reconcile the contents of the two orders.

The logic used to do the merging is specified in the OrderOptions mergeStrategy config setting.

[OrderOptions](/reference/typescript-api/orders/order-options#orderoptions)
### applyPriceAdjustments​


[​](#applypriceadjustments)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[OrderLine](/reference/typescript-api/entities/order-line#orderline)[Order](/reference/typescript-api/entities/order#order)[Order](/reference/typescript-api/entities/order#order)Applies promotions, taxes and shipping to the Order. If the updatedOrderLines argument is passed in,
then all of those OrderLines will have their prices re-calculated using the configured OrderItemPriceCalculationStrategy.

[OrderItemPriceCalculationStrategy](/reference/typescript-api/orders/order-item-price-calculation-strategy#orderitempricecalculationstrategy)


---

# OrderTestingService


## OrderTestingService​


[​](#ordertestingservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[order-testing.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/order-testing.service.ts#L35)This service is responsible for creating temporary mock Orders against which tests can be run, such as
testing a ShippingMethod or Promotion.

```
class OrderTestingService {    constructor(connection: TransactionalConnection, orderCalculator: OrderCalculator, shippingCalculator: ShippingCalculator, configArgService: ConfigArgService, configService: ConfigService, productPriceApplicator: ProductPriceApplicator, translator: TranslatorService)    testShippingMethod(ctx: RequestContext, input: TestShippingMethodInput) => Promise<TestShippingMethodResult>;    testEligibleShippingMethods(ctx: RequestContext, input: TestEligibleShippingMethodsInput) => Promise<ShippingMethodQuote[]>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[OrderCalculator](/reference/typescript-api/service-helpers/order-calculator#ordercalculator)[ShippingCalculator](/reference/typescript-api/shipping/shipping-calculator#shippingcalculator)[ProductPriceApplicator](/reference/typescript-api/service-helpers/product-price-applicator#productpriceapplicator)[TranslatorService](/reference/typescript-api/service-helpers/translator-service#translatorservice)
### testShippingMethod​


[​](#testshippingmethod)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Runs a given ShippingMethod configuration against a mock Order to test for eligibility and resulting
price.

### testEligibleShippingMethods​


[​](#testeligibleshippingmethods)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Tests all available ShippingMethods against a mock Order and return those which are eligible. This
is intended to simulate a call to the eligibleShippingMethods query of the Shop API.


---

# PaymentMethodService


## PaymentMethodService​


[​](#paymentmethodservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment-method.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/payment-method.service.ts#L47)Contains methods relating to PaymentMethod entities.

[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)
```
class PaymentMethodService {    constructor(connection: TransactionalConnection, configService: ConfigService, roleService: RoleService, listQueryBuilder: ListQueryBuilder, eventBus: EventBus, configArgService: ConfigArgService, channelService: ChannelService, customFieldRelationService: CustomFieldRelationService, translatableSaver: TranslatableSaver, translator: TranslatorService)    findAll(ctx: RequestContext, options?: ListQueryOptions<PaymentMethod>, relations: RelationPaths<PaymentMethod> = []) => Promise<PaginatedList<PaymentMethod>>;    findOne(ctx: RequestContext, paymentMethodId: ID, relations: RelationPaths<PaymentMethod> = []) => Promise<PaymentMethod | undefined>;    create(ctx: RequestContext, input: CreatePaymentMethodInput) => Promise<PaymentMethod>;    update(ctx: RequestContext, input: UpdatePaymentMethodInput) => Promise<PaymentMethod>;    delete(ctx: RequestContext, paymentMethodId: ID, force: boolean = false) => Promise<DeletionResponse>;    assignPaymentMethodsToChannel(ctx: RequestContext, input: AssignPaymentMethodsToChannelInput) => Promise<Array<Translated<PaymentMethod>>>;    removePaymentMethodsFromChannel(ctx: RequestContext, input: RemovePaymentMethodsFromChannelInput) => Promise<Array<Translated<PaymentMethod>>>;    getPaymentMethodEligibilityCheckers(ctx: RequestContext) => ConfigurableOperationDefinition[];    getPaymentMethodHandlers(ctx: RequestContext) => ConfigurableOperationDefinition[];    getEligiblePaymentMethods(ctx: RequestContext, order: Order) => Promise<PaymentMethodQuote[]>;    getMethodAndOperations(ctx: RequestContext, method: string) => Promise<{        paymentMethod: PaymentMethod;        handler: PaymentMethodHandler;        checker: PaymentMethodEligibilityChecker | null;    }>;    getActivePaymentMethods(ctx: RequestContext) => Promise<PaymentMethod[]>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[RoleService](/reference/typescript-api/services/role-service#roleservice)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[ChannelService](/reference/typescript-api/services/channel-service#channelservice)[TranslatableSaver](/reference/typescript-api/service-helpers/translatable-saver#translatablesaver)[TranslatorService](/reference/typescript-api/service-helpers/translator-service#translatorservice)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)
### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)
### delete​


[​](#delete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### assignPaymentMethodsToChannel​


[​](#assignpaymentmethodstochannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)
### removePaymentMethodsFromChannel​


[​](#removepaymentmethodsfromchannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)
### getPaymentMethodEligibilityCheckers​


[​](#getpaymentmethodeligibilitycheckers)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### getPaymentMethodHandlers​


[​](#getpaymentmethodhandlers)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### getEligiblePaymentMethods​


[​](#geteligiblepaymentmethods)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)
### getMethodAndOperations​


[​](#getmethodandoperations)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)[PaymentMethodHandler](/reference/typescript-api/payment/payment-method-handler#paymentmethodhandler)[PaymentMethodEligibilityChecker](/reference/typescript-api/payment/payment-method-eligibility-checker#paymentmethodeligibilitychecker)
### getActivePaymentMethods​


[​](#getactivepaymentmethods)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[PaymentMethod](/reference/typescript-api/entities/payment-method#paymentmethod)


---

# PaymentService


## PaymentService​


[​](#paymentservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[payment.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/payment.service.ts#L43)Contains methods relating to Payment entities.

[Payment](/reference/typescript-api/entities/payment#payment)
```
class PaymentService {    constructor(connection: TransactionalConnection, paymentStateMachine: PaymentStateMachine, refundStateMachine: RefundStateMachine, paymentMethodService: PaymentMethodService, eventBus: EventBus)    create(ctx: RequestContext, input: DeepPartial<Payment>) => Promise<Payment>;    findOneOrThrow(ctx: RequestContext, id: ID, relations: string[] = ['order']) => Promise<Payment>;    transitionToState(ctx: RequestContext, paymentId: ID, state: PaymentState) => Promise<Payment | PaymentStateTransitionError>;    getNextStates(payment: Payment) => readonly PaymentState[];    createPayment(ctx: RequestContext, order: Order, amount: number, method: string, metadata: any) => Promise<Payment | IneligiblePaymentMethodError>;    settlePayment(ctx: RequestContext, paymentId: ID) => Promise<PaymentStateTransitionError | Payment>;    cancelPayment(ctx: RequestContext, paymentId: ID) => Promise<PaymentStateTransitionError | Payment>;    createManualPayment(ctx: RequestContext, order: Order, amount: number, input: ManualPaymentInput) => ;    createRefund(ctx: RequestContext, input: RefundOrderInput, order: Order, selectedPayment: Payment) => Promise<Refund | RefundStateTransitionError | RefundAmountError>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[PaymentMethodService](/reference/typescript-api/services/payment-method-service#paymentmethodservice)[EventBus](/reference/typescript-api/events/event-bus#eventbus)
### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Payment](/reference/typescript-api/entities/payment#payment)[Payment](/reference/typescript-api/entities/payment#payment)
### findOneOrThrow​


[​](#findoneorthrow)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Payment](/reference/typescript-api/entities/payment#payment)
### transitionToState​


[​](#transitiontostate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)[Payment](/reference/typescript-api/entities/payment#payment)Transitions a Payment to the given state.

When updating a Payment in the context of an Order, it is
preferable to use the OrderService transitionPaymentToState() method, which will also handle
updating the Order state too.

[OrderService](/reference/typescript-api/services/order-service#orderservice)
### getNextStates​


[​](#getnextstates)[Payment](/reference/typescript-api/entities/payment#payment)[PaymentState](/reference/typescript-api/payment/payment-state#paymentstate)
### createPayment​


[​](#createpayment)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Payment](/reference/typescript-api/entities/payment#payment)Creates a new Payment.

When creating a Payment in the context of an Order, it is
preferable to use the OrderService addPaymentToOrder() method, which will also handle
updating the Order state too.

[OrderService](/reference/typescript-api/services/order-service#orderservice)
### settlePayment​


[​](#settlepayment)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Payment](/reference/typescript-api/entities/payment#payment)Settles a Payment.

When settling a Payment in the context of an Order, it is
preferable to use the OrderService settlePayment() method, which will also handle
updating the Order state too.

[OrderService](/reference/typescript-api/services/order-service#orderservice)
### cancelPayment​


[​](#cancelpayment)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Payment](/reference/typescript-api/entities/payment#payment)
### createManualPayment​


[​](#createmanualpayment)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)Creates a Payment from the manual payment mutation in the Admin API

When creating a manual Payment in the context of an Order, it is
preferable to use the OrderService addManualPaymentToOrder() method, which will also handle
updating the Order state too.

[OrderService](/reference/typescript-api/services/order-service#orderservice)
### createRefund​


[​](#createrefund)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Payment](/reference/typescript-api/entities/payment#payment)[Refund](/reference/typescript-api/entities/refund#refund)Creates a Refund against the specified Payment. If the amount to be refunded exceeds the value of the
specified Payment (in the case of multiple payments on a single Order), then the remaining outstanding
refund amount will be refunded against the next available Payment from the Order.

When creating a Refund in the context of an Order, it is
preferable to use the OrderService refundOrder() method, which performs additional
validation.

[OrderService](/reference/typescript-api/services/order-service#orderservice)


---

# ProductOptionGroupService


## ProductOptionGroupService​


[​](#productoptiongroupservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-option-group.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/product-option-group.service.ts#L35)Contains methods relating to ProductOptionGroup entities.

[ProductOptionGroup](/reference/typescript-api/entities/product-option-group#productoptiongroup)
```
class ProductOptionGroupService {    constructor(connection: TransactionalConnection, translatableSaver: TranslatableSaver, customFieldRelationService: CustomFieldRelationService, productOptionService: ProductOptionService, eventBus: EventBus, translator: TranslatorService)    findAll(ctx: RequestContext, filterTerm?: string, relations?: RelationPaths<ProductOptionGroup>) => Promise<Array<Translated<ProductOptionGroup>>>;    findOne(ctx: RequestContext, id: ID, relations?: RelationPaths<ProductOptionGroup>, findOneOptions?: { includeSoftDeleted: boolean }) => Promise<Translated<ProductOptionGroup> | undefined>;    getOptionGroupsByProductId(ctx: RequestContext, id: ID) => Promise<Array<Translated<ProductOptionGroup>>>;    create(ctx: RequestContext, input: Omit<CreateProductOptionGroupInput, 'options'>) => Promise<Translated<ProductOptionGroup>>;    update(ctx: RequestContext, input: UpdateProductOptionGroupInput) => Promise<Translated<ProductOptionGroup>>;    deleteGroupAndOptionsFromProduct(ctx: RequestContext, id: ID, productId: ID) => ;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[TranslatableSaver](/reference/typescript-api/service-helpers/translatable-saver#translatablesaver)[ProductOptionService](/reference/typescript-api/services/product-option-service#productoptionservice)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[TranslatorService](/reference/typescript-api/service-helpers/translator-service#translatorservice)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductOptionGroup](/reference/typescript-api/entities/product-option-group#productoptiongroup)[ProductOptionGroup](/reference/typescript-api/entities/product-option-group#productoptiongroup)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ProductOptionGroup](/reference/typescript-api/entities/product-option-group#productoptiongroup)[ProductOptionGroup](/reference/typescript-api/entities/product-option-group#productoptiongroup)
### getOptionGroupsByProductId​


[​](#getoptiongroupsbyproductid)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ProductOptionGroup](/reference/typescript-api/entities/product-option-group#productoptiongroup)
### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductOptionGroup](/reference/typescript-api/entities/product-option-group#productoptiongroup)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductOptionGroup](/reference/typescript-api/entities/product-option-group#productoptiongroup)
### deleteGroupAndOptionsFromProduct​


[​](#deletegroupandoptionsfromproduct)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)Deletes the ProductOptionGroup and any associated ProductOptions. If the ProductOptionGroup
is still referenced by a soft-deleted Product, then a soft-delete will be used to preserve
referential integrity. Otherwise a hard-delete will be performed.


---

# ProductOptionService


## ProductOptionService​


[​](#productoptionservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-option.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/product-option.service.ts#L37)Contains methods relating to ProductOption entities.

[ProductOption](/reference/typescript-api/entities/product-option#productoption)
```
class ProductOptionService {    constructor(connection: TransactionalConnection, translatableSaver: TranslatableSaver, customFieldRelationService: CustomFieldRelationService, eventBus: EventBus, translator: TranslatorService, listQueryBuilder: ListQueryBuilder)    findAll(ctx: RequestContext, options?: ListQueryOptions<ProductOption>, groupId?: ID, relations?: RelationPaths<ProductOption>) => Promise<PaginatedList<Translated<ProductOption>>>;    findOne(ctx: RequestContext, id: ID, relations?: RelationPaths<ProductOption>) => Promise<Translated<ProductOption> | undefined>;    create(ctx: RequestContext, group: ProductOptionGroup | ID, input: CreateGroupOptionInput | CreateProductOptionInput) => Promise<Translated<ProductOption>>;    update(ctx: RequestContext, input: UpdateProductOptionInput) => Promise<Translated<ProductOption>>;    delete(ctx: RequestContext, id: ID) => Promise<DeletionResponse>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[TranslatableSaver](/reference/typescript-api/service-helpers/translatable-saver#translatablesaver)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[TranslatorService](/reference/typescript-api/service-helpers/translator-service#translatorservice)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductOption](/reference/typescript-api/entities/product-option#productoption)[ID](/reference/typescript-api/common/id#id)[ProductOption](/reference/typescript-api/entities/product-option#productoption)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[ProductOption](/reference/typescript-api/entities/product-option#productoption)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ProductOption](/reference/typescript-api/entities/product-option#productoption)[ProductOption](/reference/typescript-api/entities/product-option#productoption)
### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductOptionGroup](/reference/typescript-api/entities/product-option-group#productoptiongroup)[ID](/reference/typescript-api/common/id#id)[ProductOption](/reference/typescript-api/entities/product-option#productoption)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductOption](/reference/typescript-api/entities/product-option#productoption)
### delete​


[​](#delete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)Deletes a ProductOption.

- If the ProductOption is used by any ProductVariants, the deletion will fail.
- If the ProductOption is used only by soft-deleted ProductVariants, the option will itself
be soft-deleted.
- If the ProductOption is not used by any ProductVariant at all, it will be hard-deleted.

---

# ProductService


## ProductService​


[​](#productservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/product.service.ts#L54)Contains methods relating to Product entities.

[Product](/reference/typescript-api/entities/product#product)
```
class ProductService {    constructor(connection: TransactionalConnection, channelService: ChannelService, assetService: AssetService, productVariantService: ProductVariantService, facetValueService: FacetValueService, listQueryBuilder: ListQueryBuilder, translatableSaver: TranslatableSaver, eventBus: EventBus, slugValidator: SlugValidator, customFieldRelationService: CustomFieldRelationService, translator: TranslatorService, productOptionGroupService: ProductOptionGroupService)    findAll(ctx: RequestContext, options?: ListQueryOptions<Product>, relations?: RelationPaths<Product>) => Promise<PaginatedList<Translated<Product>>>;    findOne(ctx: RequestContext, productId: ID, relations?: RelationPaths<Product>) => Promise<Translated<Product> | undefined>;    findByIds(ctx: RequestContext, productIds: ID[], relations?: RelationPaths<Product>) => Promise<Array<Translated<Product>>>;    getProductChannels(ctx: RequestContext, productId: ID) => Promise<Channel[]>;    getFacetValuesForProduct(ctx: RequestContext, productId: ID) => Promise<Array<Translated<FacetValue>>>;    findOneBySlug(ctx: RequestContext, slug: string, relations?: RelationPaths<Product>) => Promise<Translated<Product> | undefined>;    create(ctx: RequestContext, input: CreateProductInput) => Promise<Translated<Product>>;    update(ctx: RequestContext, input: UpdateProductInput) => Promise<Translated<Product>>;    softDelete(ctx: RequestContext, productId: ID) => Promise<DeletionResponse>;    assignProductsToChannel(ctx: RequestContext, input: AssignProductsToChannelInput) => Promise<Array<Translated<Product>>>;    removeProductsFromChannel(ctx: RequestContext, input: RemoveProductsFromChannelInput) => Promise<Array<Translated<Product>>>;    addOptionGroupToProduct(ctx: RequestContext, productId: ID, optionGroupId: ID) => Promise<Translated<Product>>;    removeOptionGroupFromProduct(ctx: RequestContext, productId: ID, optionGroupId: ID, force?: boolean) => Promise<ErrorResultUnion<RemoveOptionGroupFromProductResult, Translated<Product>>>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[ChannelService](/reference/typescript-api/services/channel-service#channelservice)[AssetService](/reference/typescript-api/services/asset-service#assetservice)[ProductVariantService](/reference/typescript-api/services/product-variant-service#productvariantservice)[FacetValueService](/reference/typescript-api/services/facet-value-service#facetvalueservice)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[TranslatableSaver](/reference/typescript-api/service-helpers/translatable-saver#translatablesaver)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[SlugValidator](/reference/typescript-api/service-helpers/slug-validator#slugvalidator)[TranslatorService](/reference/typescript-api/service-helpers/translator-service#translatorservice)[ProductOptionGroupService](/reference/typescript-api/services/product-option-group-service#productoptiongroupservice)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Product](/reference/typescript-api/entities/product#product)[Product](/reference/typescript-api/entities/product#product)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Product](/reference/typescript-api/entities/product#product)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Product](/reference/typescript-api/entities/product#product)[Product](/reference/typescript-api/entities/product#product)
### findByIds​


[​](#findbyids)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Product](/reference/typescript-api/entities/product#product)[Product](/reference/typescript-api/entities/product#product)
### getProductChannels​


[​](#getproductchannels)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Channel](/reference/typescript-api/entities/channel#channel)Returns all Channels to which the Product is assigned.

### getFacetValuesForProduct​


[​](#getfacetvaluesforproduct)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
### findOneBySlug​


[​](#findonebyslug)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Product](/reference/typescript-api/entities/product#product)[Product](/reference/typescript-api/entities/product#product)
### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Product](/reference/typescript-api/entities/product#product)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Product](/reference/typescript-api/entities/product#product)
### softDelete​


[​](#softdelete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### assignProductsToChannel​


[​](#assignproductstochannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Product](/reference/typescript-api/entities/product#product)Assigns a Product to the specified Channel, and optionally uses a priceFactor to set the ProductVariantPrices
on the new Channel.

Internally, this method will also call ProductVariantService assignProductVariantsToChannel() for
each of the Product's variants, and will assign the Product's Assets to the Channel too.

[ProductVariantService](/reference/typescript-api/services/product-variant-service#productvariantservice)
### removeProductsFromChannel​


[​](#removeproductsfromchannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Product](/reference/typescript-api/entities/product#product)
### addOptionGroupToProduct​


[​](#addoptiongrouptoproduct)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)[Product](/reference/typescript-api/entities/product#product)
### removeOptionGroupFromProduct​


[​](#removeoptiongroupfromproduct)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Product](/reference/typescript-api/entities/product#product)


---

# ProductVariantService


## ProductVariantService​


[​](#productvariantservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[product-variant.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/product-variant.service.ts#L70)Contains methods relating to ProductVariant entities.

[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
```
class ProductVariantService {    constructor(connection: TransactionalConnection, configService: ConfigService, taxCategoryService: TaxCategoryService, facetValueService: FacetValueService, assetService: AssetService, translatableSaver: TranslatableSaver, eventBus: EventBus, listQueryBuilder: ListQueryBuilder, globalSettingsService: GlobalSettingsService, stockMovementService: StockMovementService, stockLevelService: StockLevelService, channelService: ChannelService, roleService: RoleService, customFieldRelationService: CustomFieldRelationService, requestCache: RequestContextCacheService, productPriceApplicator: ProductPriceApplicator, translator: TranslatorService)    findAll(ctx: RequestContext, options?: ListQueryOptions<ProductVariant>) => Promise<PaginatedList<Translated<ProductVariant>>>;    findOne(ctx: RequestContext, productVariantId: ID, relations?: RelationPaths<ProductVariant>) => Promise<Translated<ProductVariant> | undefined>;    findByIds(ctx: RequestContext, ids: ID[]) => Promise<Array<Translated<ProductVariant>>>;    getVariantsByProductId(ctx: RequestContext, productId: ID, options: ListQueryOptions<ProductVariant> = {}, relations?: RelationPaths<ProductVariant>) => Promise<PaginatedList<Translated<ProductVariant>>>;    getVariantsByCollectionId(ctx: RequestContext, collectionId: ID, options: ListQueryOptions<ProductVariant>, relations: RelationPaths<ProductVariant> = []) => Promise<PaginatedList<Translated<ProductVariant>>>;    getProductVariantChannels(ctx: RequestContext, productVariantId: ID) => Promise<Channel[]>;    getProductVariantPrices(ctx: RequestContext, productVariantId: ID) => Promise<ProductVariantPrice[]>;    getVariantByOrderLineId(ctx: RequestContext, orderLineId: ID) => Promise<Translated<ProductVariant>>;    getOptionsForVariant(ctx: RequestContext, variantId: ID) => Promise<Array<Translated<ProductOption>>>;    getFacetValuesForVariant(ctx: RequestContext, variantId: ID) => Promise<Array<Translated<FacetValue>>>;    getProductForVariant(ctx: RequestContext, variant: ProductVariant) => Promise<Translated<Product>>;    getSaleableStockLevel(ctx: RequestContext, variant: ProductVariant) => Promise<number>;    getDisplayStockLevel(ctx: RequestContext, variant: ProductVariant) => Promise<string>;    getFulfillableStockLevel(ctx: RequestContext, variant: ProductVariant) => Promise<number>;    create(ctx: RequestContext, input: CreateProductVariantInput[]) => Promise<Array<Translated<ProductVariant>>>;    update(ctx: RequestContext, input: UpdateProductVariantInput[]) => Promise<Array<Translated<ProductVariant>>>;    createOrUpdateProductVariantPrice(ctx: RequestContext, productVariantId: ID, price: number, channelId: ID, currencyCode?: CurrencyCode, customFields?: CustomFieldsObject) => Promise<ProductVariantPrice>;    deleteProductVariantPrice(ctx: RequestContext, variantId: ID, channelId: ID, currencyCode: CurrencyCode) => ;    softDelete(ctx: RequestContext, id: ID | ID[]) => Promise<DeletionResponse>;    hydratePriceFields(ctx: RequestContext, variant: ProductVariant, priceField: F) => Promise<ProductVariant[F]>;    applyChannelPriceAndTax(variant: ProductVariant, ctx: RequestContext, order?: Order, throwIfNoPriceFound:  = false) => Promise<ProductVariant>;    assignProductVariantsToChannel(ctx: RequestContext, input: AssignProductVariantsToChannelInput) => Promise<Array<Translated<ProductVariant>>>;    removeProductVariantsFromChannel(ctx: RequestContext, input: RemoveProductVariantsFromChannelInput) => Promise<Array<Translated<ProductVariant>>>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[TaxCategoryService](/reference/typescript-api/services/tax-category-service#taxcategoryservice)[FacetValueService](/reference/typescript-api/services/facet-value-service#facetvalueservice)[AssetService](/reference/typescript-api/services/asset-service#assetservice)[TranslatableSaver](/reference/typescript-api/service-helpers/translatable-saver#translatablesaver)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[GlobalSettingsService](/reference/typescript-api/services/global-settings-service#globalsettingsservice)[StockMovementService](/reference/typescript-api/services/stock-movement-service#stockmovementservice)[StockLevelService](/reference/typescript-api/services/stock-level-service#stocklevelservice)[ChannelService](/reference/typescript-api/services/channel-service#channelservice)[RoleService](/reference/typescript-api/services/role-service#roleservice)[RequestContextCacheService](/reference/typescript-api/cache/request-context-cache-service#requestcontextcacheservice)[ProductPriceApplicator](/reference/typescript-api/service-helpers/product-price-applicator#productpriceapplicator)[TranslatorService](/reference/typescript-api/service-helpers/translator-service#translatorservice)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### findByIds​


[​](#findbyids)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### getVariantsByProductId​


[​](#getvariantsbyproductid)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### getVariantsByCollectionId​


[​](#getvariantsbycollectionid)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)Returns a PaginatedList of all ProductVariants associated with the given Collection.

[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)
### getProductVariantChannels​


[​](#getproductvariantchannels)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Channel](/reference/typescript-api/entities/channel#channel)Returns all Channels to which the ProductVariant is assigned.

### getProductVariantPrices​


[​](#getproductvariantprices)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)
### getVariantByOrderLineId​


[​](#getvariantbyorderlineid)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)Returns the ProductVariant associated with the given OrderLine.

[OrderLine](/reference/typescript-api/entities/order-line#orderline)
### getOptionsForVariant​


[​](#getoptionsforvariant)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ProductOption](/reference/typescript-api/entities/product-option#productoption)Returns the ProductOptions for the given ProductVariant.

[ProductOption](/reference/typescript-api/entities/product-option#productoption)
### getFacetValuesForVariant​


[​](#getfacetvaluesforvariant)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[FacetValue](/reference/typescript-api/entities/facet-value#facetvalue)
### getProductForVariant​


[​](#getproductforvariant)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[Product](/reference/typescript-api/entities/product#product)Returns the Product associated with the ProductVariant. Whereas the ProductService.findOne()
method performs a large multi-table join with all the typical data needed for a "product detail"
page, this method returns only the Product itself.

### getSaleableStockLevel​


[​](#getsaleablestocklevel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)Returns the number of saleable units of the ProductVariant, i.e. how many are available
for purchase by Customers. This is determined by the ProductVariant's stockOnHand value,
as well as the local and global outOfStockThreshold settings.

### getDisplayStockLevel​


[​](#getdisplaystocklevel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)Returns the stockLevel to display to the customer, as specified by the configured
StockDisplayStrategy.

[StockDisplayStrategy](/reference/typescript-api/products-stock/stock-display-strategy#stockdisplaystrategy)
### getFulfillableStockLevel​


[​](#getfulfillablestocklevel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)Returns the number of fulfillable units of the ProductVariant, equivalent to stockOnHand
for those variants which are tracking inventory.

### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)
### createOrUpdateProductVariantPrice​


[​](#createorupdateproductvariantprice)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)[CurrencyCode](/reference/typescript-api/common/currency-code#currencycode)[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)Creates a ProductVariantPrice for the given ProductVariant/Channel combination.
If the currencyCode is not specified, the default currency of the Channel will be used.

[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)
### deleteProductVariantPrice​


[​](#deleteproductvariantprice)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)[CurrencyCode](/reference/typescript-api/common/currency-code#currencycode)
### softDelete​


[​](#softdelete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)
### hydratePriceFields​


[​](#hydratepricefields)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)This method is intended to be used by the ProductVariant GraphQL entity resolver to resolve the
price-related fields which need to be populated at run-time using the applyChannelPriceAndTax
method.

Is optimized to make as few DB calls as possible using caching based on the open request.

### applyChannelPriceAndTax​


[​](#applychannelpriceandtax)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)Populates the price field with the price for the specified channel.

### assignProductVariantsToChannel​


[​](#assignproductvariantstochannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)Assigns the specified ProductVariants to the specified Channel. In doing so, it will create a new
ProductVariantPrice and also assign the associated Product and any Assets to the Channel too.

[ProductVariantPrice](/reference/typescript-api/entities/product-variant-price#productvariantprice)
### removeProductVariantsFromChannel​


[​](#removeproductvariantsfromchannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)



---

# PromotionService


## PromotionService​


[​](#promotionservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[promotion.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/promotion.service.ts#L57)Contains methods relating to Promotion entities.

[Promotion](/reference/typescript-api/entities/promotion#promotion)
```
class PromotionService {    availableConditions: PromotionCondition[] = [];    availableActions: PromotionAction[] = [];    constructor(connection: TransactionalConnection, configService: ConfigService, channelService: ChannelService, listQueryBuilder: ListQueryBuilder, configArgService: ConfigArgService, customFieldRelationService: CustomFieldRelationService, eventBus: EventBus, translatableSaver: TranslatableSaver, translator: TranslatorService)    findAll(ctx: RequestContext, options?: ListQueryOptions<Promotion>, relations: RelationPaths<Promotion> = []) => Promise<PaginatedList<Promotion>>;    findOne(ctx: RequestContext, adjustmentSourceId: ID, relations: RelationPaths<Promotion> = []) => Promise<Promotion | undefined>;    getPromotionConditions(ctx: RequestContext) => ConfigurableOperationDefinition[];    getPromotionActions(ctx: RequestContext) => ConfigurableOperationDefinition[];    createPromotion(ctx: RequestContext, input: CreatePromotionInput) => Promise<ErrorResultUnion<CreatePromotionResult, Promotion>>;    updatePromotion(ctx: RequestContext, input: UpdatePromotionInput) => Promise<ErrorResultUnion<UpdatePromotionResult, Promotion>>;    softDeletePromotion(ctx: RequestContext, promotionId: ID) => Promise<DeletionResponse>;    assignPromotionsToChannel(ctx: RequestContext, input: AssignPromotionsToChannelInput) => Promise<Promotion[]>;    removePromotionsFromChannel(ctx: RequestContext, input: RemovePromotionsFromChannelInput) => ;    validateCouponCode(ctx: RequestContext, couponCode: string, customerId?: ID) => Promise<JustErrorResults<ApplyCouponCodeResult> | Promotion>;    getActivePromotionsInChannel(ctx: RequestContext) => ;    getActivePromotionsOnOrder(ctx: RequestContext, orderId: ID) => Promise<Promotion[]>;    runPromotionSideEffects(ctx: RequestContext, order: Order, promotionsPre: Promotion[]) => ;    addPromotionsToOrder(ctx: RequestContext, order: Order) => Promise<Order>;}
```

### availableConditions​


[​](#availableconditions)[PromotionCondition](/reference/typescript-api/promotions/promotion-condition#promotioncondition)
### availableActions​


[​](#availableactions)[PromotionAction](/reference/typescript-api/promotions/promotion-action#promotionaction)
### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[ChannelService](/reference/typescript-api/services/channel-service#channelservice)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[TranslatableSaver](/reference/typescript-api/service-helpers/translatable-saver#translatablesaver)[TranslatorService](/reference/typescript-api/service-helpers/translator-service#translatorservice)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Promotion](/reference/typescript-api/entities/promotion#promotion)[Promotion](/reference/typescript-api/entities/promotion#promotion)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Promotion](/reference/typescript-api/entities/promotion#promotion)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Promotion](/reference/typescript-api/entities/promotion#promotion)[Promotion](/reference/typescript-api/entities/promotion#promotion)
### getPromotionConditions​


[​](#getpromotionconditions)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### getPromotionActions​


[​](#getpromotionactions)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### createPromotion​


[​](#createpromotion)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Promotion](/reference/typescript-api/entities/promotion#promotion)
### updatePromotion​


[​](#updatepromotion)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[Promotion](/reference/typescript-api/entities/promotion#promotion)
### softDeletePromotion​


[​](#softdeletepromotion)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### assignPromotionsToChannel​


[​](#assignpromotionstochannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Promotion](/reference/typescript-api/entities/promotion#promotion)
### removePromotionsFromChannel​


[​](#removepromotionsfromchannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### validateCouponCode​


[​](#validatecouponcode)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Promotion](/reference/typescript-api/entities/promotion#promotion)Checks the validity of a coupon code, by checking that it is associated with an existing,
enabled and non-expired Promotion. Additionally, if there is a usage limit on the coupon code,
this method will enforce that limit against the specified Customer.

### getActivePromotionsInChannel​


[​](#getactivepromotionsinchannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### getActivePromotionsOnOrder​


[​](#getactivepromotionsonorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Promotion](/reference/typescript-api/entities/promotion#promotion)
### runPromotionSideEffects​


[​](#runpromotionsideeffects)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Promotion](/reference/typescript-api/entities/promotion#promotion)
### addPromotionsToOrder​


[​](#addpromotionstoorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Order](/reference/typescript-api/entities/order#order)Used internally to associate a Promotion with an Order, once an Order has been placed.


---

# ProvinceService


## ProvinceService​


[​](#provinceservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[province.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/province.service.ts#L32)Contains methods relating to Province entities.

[Province](/reference/typescript-api/entities/province#province)
```
class ProvinceService {    constructor(connection: TransactionalConnection, listQueryBuilder: ListQueryBuilder, translatableSaver: TranslatableSaver, eventBus: EventBus, translator: TranslatorService)    findAll(ctx: RequestContext, options?: ListQueryOptions<Province>, relations: RelationPaths<Province> = []) => Promise<PaginatedList<Translated<Province>>>;    findOne(ctx: RequestContext, provinceId: ID, relations: RelationPaths<Province> = []) => Promise<Translated<Province> | undefined>;    create(ctx: RequestContext, input: CreateProvinceInput) => Promise<Translated<Province>>;    update(ctx: RequestContext, input: UpdateProvinceInput) => Promise<Translated<Province>>;    delete(ctx: RequestContext, id: ID) => Promise<DeletionResponse>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[TranslatableSaver](/reference/typescript-api/service-helpers/translatable-saver#translatablesaver)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[TranslatorService](/reference/typescript-api/service-helpers/translator-service#translatorservice)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Province](/reference/typescript-api/entities/province#province)[Province](/reference/typescript-api/entities/province#province)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Province](/reference/typescript-api/entities/province#province)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Province](/reference/typescript-api/entities/province#province)[Province](/reference/typescript-api/entities/province#province)
### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Province](/reference/typescript-api/entities/province#province)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Province](/reference/typescript-api/entities/province#province)
### delete​


[​](#delete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)


---

# RoleService


## RoleService​


[​](#roleservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[role.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/role.service.ts#L55)Contains methods relating to Role entities.

[Role](/reference/typescript-api/entities/role#role)
```
class RoleService {    constructor(connection: TransactionalConnection, channelService: ChannelService, listQueryBuilder: ListQueryBuilder, configService: ConfigService, eventBus: EventBus, requestContextCache: RequestContextCacheService, cacheService: CacheService)    initRoles() => ;    findAll(ctx: RequestContext, options?: ListQueryOptions<Role>, relations?: RelationPaths<Role>) => Promise<PaginatedList<Role>>;    findOne(ctx: RequestContext, roleId: ID, relations?: RelationPaths<Role>) => Promise<Role | undefined>;    getChannelsForRole(ctx: RequestContext, roleId: ID) => Promise<Channel[]>;    getSuperAdminRole(ctx?: RequestContext) => Promise<Role>;    getCustomerRole(ctx?: RequestContext) => Promise<Role>;    getAllPermissions() => string[];    userHasPermissionOnChannel(ctx: RequestContext, channelId: ID, permission: Permission) => Promise<boolean>;    userHasAnyPermissionsOnChannel(ctx: RequestContext, channelId: ID, permissions: Permission[]) => Promise<boolean>;    userHasAllPermissionsOnChannel(ctx: RequestContext, channelId: ID, permissions: Permission[]) => Promise<boolean>;    create(ctx: RequestContext, input: CreateRoleInput) => Promise<Role>;    update(ctx: RequestContext, input: UpdateRoleInput) => Promise<Role>;    delete(ctx: RequestContext, id: ID) => Promise<DeletionResponse>;    assignRoleToChannel(ctx: RequestContext, roleId: ID, channelId: ID) => ;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[ChannelService](/reference/typescript-api/services/channel-service#channelservice)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[RequestContextCacheService](/reference/typescript-api/cache/request-context-cache-service#requestcontextcacheservice)[CacheService](/reference/typescript-api/cache/cache-service#cacheservice)
### initRoles​


[​](#initroles)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Role](/reference/typescript-api/entities/role#role)[Role](/reference/typescript-api/entities/role#role)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Role](/reference/typescript-api/entities/role#role)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Role](/reference/typescript-api/entities/role#role)[Role](/reference/typescript-api/entities/role#role)
### getChannelsForRole​


[​](#getchannelsforrole)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Channel](/reference/typescript-api/entities/channel#channel)
### getSuperAdminRole​


[​](#getsuperadminrole)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Role](/reference/typescript-api/entities/role#role)Returns the special SuperAdmin Role, which always exists in Vendure.

### getCustomerRole​


[​](#getcustomerrole)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Role](/reference/typescript-api/entities/role#role)Returns the special Customer Role, which always exists in Vendure.

### getAllPermissions​


[​](#getallpermissions)Returns all the valid Permission values

### userHasPermissionOnChannel​


[​](#userhaspermissiononchannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Permission](/reference/typescript-api/common/permission#permission)Returns true if the User has the specified permission on that Channel

### userHasAnyPermissionsOnChannel​


[​](#userhasanypermissionsonchannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Permission](/reference/typescript-api/common/permission#permission)Returns true if the User has any of the specified permissions on that Channel

### userHasAllPermissionsOnChannel​


[​](#userhasallpermissionsonchannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Permission](/reference/typescript-api/common/permission#permission)Returns true if the User has all the specified permissions on that Channel

### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Role](/reference/typescript-api/entities/role#role)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Role](/reference/typescript-api/entities/role#role)
### delete​


[​](#delete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### assignRoleToChannel​


[​](#assignroletochannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)


---

# SearchService


## SearchService​


[​](#searchservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[search.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/search.service.ts#L15)This service allows a concrete search service to override its behaviour
by passing itself to the adopt() method.

```
class SearchService {    adopt(override: Pick<SearchService, 'reindex'>) => ;    reindex(ctx: RequestContext) => Promise<Job>;}
```

### adopt​


[​](#adopt)[SearchService](/reference/typescript-api/services/search-service#searchservice)Adopt a concrete search service implementation to pass through the
calls to.

### reindex​


[​](#reindex)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Job](/reference/typescript-api/job-queue/job#job)


---

# SellerService


## SellerService​


[​](#sellerservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[seller.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/seller.service.ts#L26)Contains methods relating to Seller entities.

[Seller](/reference/typescript-api/entities/seller#seller)
```
class SellerService {    constructor(connection: TransactionalConnection, listQueryBuilder: ListQueryBuilder, eventBus: EventBus, customFieldRelationService: CustomFieldRelationService)    initSellers() => ;    findAll(ctx: RequestContext, options?: ListQueryOptions<Seller>) => Promise<PaginatedList<Seller>>;    findOne(ctx: RequestContext, sellerId: ID) => Promise<Seller | undefined>;    create(ctx: RequestContext, input: CreateSellerInput) => ;    update(ctx: RequestContext, input: UpdateSellerInput) => ;    delete(ctx: RequestContext, id: ID) => Promise<DeletionResponse>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[EventBus](/reference/typescript-api/events/event-bus#eventbus)
### initSellers​


[​](#initsellers)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Seller](/reference/typescript-api/entities/seller#seller)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Seller](/reference/typescript-api/entities/seller#seller)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Seller](/reference/typescript-api/entities/seller#seller)
### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### delete​


[​](#delete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)


---

# SessionService


## SessionService​


[​](#sessionservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[session.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/session.service.ts#L33)Contains methods relating to Session entities.

[Session](/reference/typescript-api/entities/session#session)
```
class SessionService implements EntitySubscriberInterface, OnApplicationBootstrap {    constructor(connection: TransactionalConnection, configService: ConfigService, orderService: OrderService, jobQueueService: JobQueueService, requestContextService: RequestContextService)    onApplicationBootstrap() => ;    createNewAuthenticatedSession(ctx: RequestContext, user: User, authenticationStrategyName: string) => Promise<AuthenticatedSession>;    createAnonymousSession() => Promise<CachedSession>;    getSessionFromToken(sessionToken: string) => Promise<CachedSession | undefined>;    serializeSession(session: AuthenticatedSession | AnonymousSession) => CachedSession;    setActiveOrder(ctx: RequestContext, serializedSession: CachedSession, order: Order) => Promise<CachedSession>;    unsetActiveOrder(ctx: RequestContext, serializedSession: CachedSession) => Promise<CachedSession>;    setActiveChannel(serializedSession: CachedSession, channel: Channel) => Promise<CachedSession>;    deleteSessionsByUser(ctx: RequestContext, user: User) => Promise<void>;    deleteSessionsByActiveOrderId(ctx: RequestContext, activeOrderId: ID) => Promise<void>;    triggerCleanSessionsJob(batchSize: number) => ;    cleanExpiredSessions(ctx: RequestContext, batchSize: number) => ;}
```

- Implements: EntitySubscriberInterface, OnApplicationBootstrap

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[OrderService](/reference/typescript-api/services/order-service#orderservice)[JobQueueService](/reference/typescript-api/job-queue/job-queue-service#jobqueueservice)[RequestContextService](/reference/typescript-api/request/request-context-service#requestcontextservice)
### onApplicationBootstrap​


[​](#onapplicationbootstrap)
### createNewAuthenticatedSession​


[​](#createnewauthenticatedsession)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)[AuthenticatedSession](/reference/typescript-api/entities/authenticated-session#authenticatedsession)Creates a new AuthenticatedSession. To be used after successful authentication.

[AuthenticatedSession](/reference/typescript-api/entities/authenticated-session#authenticatedsession)
### createAnonymousSession​


[​](#createanonymoussession)[CachedSession](/reference/typescript-api/auth/session-cache-strategy#cachedsession)Create an AnonymousSession and caches it using the configured SessionCacheStrategy,
and returns the cached session object.

[AnonymousSession](/reference/typescript-api/entities/anonymous-session#anonymoussession)[SessionCacheStrategy](/reference/typescript-api/auth/session-cache-strategy#sessioncachestrategy)
### getSessionFromToken​


[​](#getsessionfromtoken)[CachedSession](/reference/typescript-api/auth/session-cache-strategy#cachedsession)Returns the cached session object matching the given session token.

### serializeSession​


[​](#serializesession)[AuthenticatedSession](/reference/typescript-api/entities/authenticated-session#authenticatedsession)[AnonymousSession](/reference/typescript-api/entities/anonymous-session#anonymoussession)[CachedSession](/reference/typescript-api/auth/session-cache-strategy#cachedsession)Serializes a Session instance into a simplified plain object suitable for caching.

[Session](/reference/typescript-api/entities/session#session)
### setActiveOrder​


[​](#setactiveorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[CachedSession](/reference/typescript-api/auth/session-cache-strategy#cachedsession)[Order](/reference/typescript-api/entities/order#order)[CachedSession](/reference/typescript-api/auth/session-cache-strategy#cachedsession)Sets the activeOrder on the given cached session object and updates the cache.

### unsetActiveOrder​


[​](#unsetactiveorder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[CachedSession](/reference/typescript-api/auth/session-cache-strategy#cachedsession)[CachedSession](/reference/typescript-api/auth/session-cache-strategy#cachedsession)Clears the activeOrder on the given cached session object and updates the cache.

### setActiveChannel​


[​](#setactivechannel)[CachedSession](/reference/typescript-api/auth/session-cache-strategy#cachedsession)[Channel](/reference/typescript-api/entities/channel#channel)[CachedSession](/reference/typescript-api/auth/session-cache-strategy#cachedsession)Sets the activeChannel on the given cached session object and updates the cache.

### deleteSessionsByUser​


[​](#deletesessionsbyuser)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)Deletes all existing sessions for the given user.

### deleteSessionsByActiveOrderId​


[​](#deletesessionsbyactiveorderid)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)Deletes all existing sessions with the given activeOrder.

### triggerCleanSessionsJob​


[​](#triggercleansessionsjob)Triggers the clean sessions job.

### cleanExpiredSessions​


[​](#cleanexpiredsessions)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Cleans expired sessions from the database & the session cache.


---

# SettingsStoreService


## SettingsStoreService​


[​](#settingsstoreservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[settings-store.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/settings-store/settings-store.service.ts#L50)The SettingsStoreService provides a flexible settings storage system with support for
scoping, permissions, and validation. It allows plugins and the core system to
store and retrieve configuration data with fine-grained control over access and isolation.

## Usage​


[​](#usage)Values are automatically scoped according to their field configuration:

Example

```
// In a serviceconst userTheme = await this.settingsStoreService.get('dashboard.theme', ctx);await this.settingsStoreService.set('dashboard.theme', 'dark', ctx);// Get multiple valuesconst settings = await this.settingsStoreService.getMany([  'dashboard.theme',  'dashboard.tableFilters'], ctx);
```

```
class SettingsStoreService implements OnModuleInit {    constructor(connection: TransactionalConnection, moduleRef: ModuleRef, configService: ConfigService)    onModuleInit() => ;    register(registration: SettingsStoreRegistration) => void;    get(ctx: RequestContext, key: string) => Promise<T | undefined>;    get(key: string, ctx: RequestContext) => Promise<T | undefined>;    get(keyOrCtx: string | RequestContext, ctxOrKey: RequestContext | string) => Promise<T | undefined>;    getMany(ctx: RequestContext, keys: string[]) => Promise<Record<string, JsonCompatible<any>>>;    getMany(keys: string[], ctx: RequestContext) => Promise<Record<string, JsonCompatible<any>>>;    getMany(keysOrCtx: string[] | RequestContext, ctxOrKeys: RequestContext | string[]) => Promise<Record<string, JsonCompatible<any>>>;    set(ctx: RequestContext, key: string, value: T) => Promise<SetSettingsStoreValueResult>;    set(key: string, value: T, ctx: RequestContext) => Promise<SetSettingsStoreValueResult>;    set(keyOrCtx: string | RequestContext, keyOrValue: string | T, ctxOrValue: RequestContext | T) => Promise<SetSettingsStoreValueResult>;    setMany(ctx: RequestContext, values: Record<string, JsonCompatible<any>>) => Promise<SetSettingsStoreValueResult[]>;    setMany(values: Record<string, JsonCompatible<any>>, ctx: RequestContext) => Promise<SetSettingsStoreValueResult[]>;    setMany(valuesOrCtx: Record<string, JsonCompatible<any>> | RequestContext, ctxOrValues: RequestContext | Record<string, JsonCompatible<any>>) => Promise<SetSettingsStoreValueResult[]>;    getFieldDefinition(key: string) => SettingsStoreFieldConfig | undefined;    validateValue(key: string, value: any, ctx: RequestContext) => Promise<string | void>;    findOrphanedEntries(options: CleanupOrphanedSettingsStoreEntriesOptions = {}) => Promise<OrphanedSettingsStoreEntry[]>;    cleanupOrphanedEntries(options: CleanupOrphanedSettingsStoreEntriesOptions = {}) => Promise<CleanupOrphanedSettingsStoreEntriesResult>;    hasPermission(ctx: RequestContext, key: string) => boolean;    hasReadPermission(ctx: RequestContext, key: string) => boolean;    hasWritePermission(ctx: RequestContext, key: string) => boolean;    isReadonly(key: string) => boolean;}
```

- Implements: OnModuleInit

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)
### onModuleInit​


[​](#onmoduleinit)
### register​


[​](#register)[SettingsStoreRegistration](/reference/typescript-api/settings-store/settings-store-registration#settingsstoreregistration)Register settings store fields. This is typically called during application
bootstrap when processing the VendureConfig.

### get​


[​](#get)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Get a value for the specified key. The value is automatically scoped
according to the field's scope configuration.

### get​


[​](#get-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### get​


[​](#get-2)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### getMany​


[​](#getmany)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[JsonCompatible](/reference/typescript-api/common/json-compatible#jsoncompatible)Get multiple values efficiently. Each key is scoped according to
its individual field configuration.

### getMany​


[​](#getmany-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[JsonCompatible](/reference/typescript-api/common/json-compatible#jsoncompatible)
### getMany​


[​](#getmany-2)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[JsonCompatible](/reference/typescript-api/common/json-compatible#jsoncompatible)
### set​


[​](#set)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[SetSettingsStoreValueResult](/reference/typescript-api/settings-store/set-settings-store-value-result#setsettingsstorevalueresult)Set a value for the specified key with structured result feedback.
This version returns detailed information about the success or failure
of the operation instead of throwing errors.

### set​


[​](#set-1)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[SetSettingsStoreValueResult](/reference/typescript-api/settings-store/set-settings-store-value-result#setsettingsstorevalueresult)
### set​


[​](#set-2)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[SetSettingsStoreValueResult](/reference/typescript-api/settings-store/set-settings-store-value-result#setsettingsstorevalueresult)
### setMany​


[​](#setmany)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[JsonCompatible](/reference/typescript-api/common/json-compatible#jsoncompatible)[SetSettingsStoreValueResult](/reference/typescript-api/settings-store/set-settings-store-value-result#setsettingsstorevalueresult)Set multiple values with structured result feedback for each operation.
This method will not throw errors but will return
detailed results for each key-value pair.

### setMany​


[​](#setmany-1)[JsonCompatible](/reference/typescript-api/common/json-compatible#jsoncompatible)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[SetSettingsStoreValueResult](/reference/typescript-api/settings-store/set-settings-store-value-result#setsettingsstorevalueresult)
### setMany​


[​](#setmany-2)[JsonCompatible](/reference/typescript-api/common/json-compatible#jsoncompatible)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[JsonCompatible](/reference/typescript-api/common/json-compatible#jsoncompatible)[SetSettingsStoreValueResult](/reference/typescript-api/settings-store/set-settings-store-value-result#setsettingsstorevalueresult)
### getFieldDefinition​


[​](#getfielddefinition)[SettingsStoreFieldConfig](/reference/typescript-api/settings-store/settings-store-field-config#settingsstorefieldconfig)Get the field configuration for a key.

### validateValue​


[​](#validatevalue)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Validate a value against its field definition.

### findOrphanedEntries​


[​](#findorphanedentries)[CleanupOrphanedSettingsStoreEntriesOptions](/reference/typescript-api/settings-store/cleanup-orphaned-settings-store-entries-options#cleanuporphanedsettingsstoreentriesoptions)[OrphanedSettingsStoreEntry](/reference/typescript-api/settings-store/orphaned-settings-store-entry#orphanedsettingsstoreentry)Find orphaned settings store entries that no longer have corresponding field definitions.

### cleanupOrphanedEntries​


[​](#cleanuporphanedentries)[CleanupOrphanedSettingsStoreEntriesOptions](/reference/typescript-api/settings-store/cleanup-orphaned-settings-store-entries-options#cleanuporphanedsettingsstoreentriesoptions)[CleanupOrphanedSettingsStoreEntriesResult](/reference/typescript-api/settings-store/cleanup-orphaned-settings-store-entries-result#cleanuporphanedsettingsstoreentriesresult)Clean up orphaned settings store entries from the database.

### hasPermission​


[​](#haspermission)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Check if the current user has permission to access a field.
This is not called internally in the get and set methods, so should
be used by any methods which are exposing these methods via the GraphQL
APIs.

### hasReadPermission​


[​](#hasreadpermission)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Check if the current user has permission to read a field.

### hasWritePermission​


[​](#haswritepermission)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Check if the current user has permission to write a field.

### isReadonly​


[​](#isreadonly)Returns true if the settings field has the readonly: true configuration.


---

# ShippingMethodService


## ShippingMethodService​


[​](#shippingmethodservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[shipping-method.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/shipping-method.service.ts#L45)Contains methods relating to ShippingMethod entities.

[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)
```
class ShippingMethodService {    constructor(connection: TransactionalConnection, configService: ConfigService, roleService: RoleService, listQueryBuilder: ListQueryBuilder, channelService: ChannelService, configArgService: ConfigArgService, translatableSaver: TranslatableSaver, customFieldRelationService: CustomFieldRelationService, eventBus: EventBus, translator: TranslatorService)    findAll(ctx: RequestContext, options?: ListQueryOptions<ShippingMethod>, relations: RelationPaths<ShippingMethod> = []) => Promise<PaginatedList<Translated<ShippingMethod>>>;    findOne(ctx: RequestContext, shippingMethodId: ID, includeDeleted:  = false, relations: RelationPaths<ShippingMethod> = []) => Promise<Translated<ShippingMethod> | undefined>;    create(ctx: RequestContext, input: CreateShippingMethodInput) => Promise<Translated<ShippingMethod>>;    update(ctx: RequestContext, input: UpdateShippingMethodInput) => Promise<Translated<ShippingMethod>>;    softDelete(ctx: RequestContext, id: ID) => Promise<DeletionResponse>;    assignShippingMethodsToChannel(ctx: RequestContext, input: AssignShippingMethodsToChannelInput) => Promise<Array<Translated<ShippingMethod>>>;    removeShippingMethodsFromChannel(ctx: RequestContext, input: RemoveShippingMethodsFromChannelInput) => Promise<Array<Translated<ShippingMethod>>>;    getShippingEligibilityCheckers(ctx: RequestContext) => ConfigurableOperationDefinition[];    getShippingCalculators(ctx: RequestContext) => ConfigurableOperationDefinition[];    getFulfillmentHandlers(ctx: RequestContext) => ConfigurableOperationDefinition[];    getActiveShippingMethods(ctx: RequestContext) => Promise<ShippingMethod[]>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[RoleService](/reference/typescript-api/services/role-service#roleservice)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[ChannelService](/reference/typescript-api/services/channel-service#channelservice)[TranslatableSaver](/reference/typescript-api/service-helpers/translatable-saver#translatablesaver)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[TranslatorService](/reference/typescript-api/service-helpers/translator-service#translatorservice)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)
### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)
### softDelete​


[​](#softdelete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### assignShippingMethodsToChannel​


[​](#assignshippingmethodstochannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)
### removeShippingMethodsFromChannel​


[​](#removeshippingmethodsfromchannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)
### getShippingEligibilityCheckers​


[​](#getshippingeligibilitycheckers)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### getShippingCalculators​


[​](#getshippingcalculators)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### getFulfillmentHandlers​


[​](#getfulfillmenthandlers)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### getActiveShippingMethods​


[​](#getactiveshippingmethods)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)


---


# SlugService


## SlugService​


[​](#slugservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[slug.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/helpers/slug.service.ts#L13)A service that handles slug generation using the configured SlugStrategy.

```
class SlugService {    constructor(configService: ConfigService)    generate(ctx: RequestContext, params: SlugGenerateParams) => Promise<string>;}
```

### constructor​


[​](#constructor)
### generate​


[​](#generate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Generates a slug from the input string using the configured SlugStrategy.


---

# StockLevelService


## StockLevelService​


[​](#stocklevelservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[stock-level.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/stock-level.service.ts#L23)The StockLevelService is responsible for managing the stock levels of ProductVariants.
Whenever you need to adjust the stockOnHand or stockAllocated for a ProductVariant,
you should use this service.

```
class StockLevelService {    constructor(connection: TransactionalConnection, stockLocationService: StockLocationService, configService: ConfigService)    getStockLevel(ctx: RequestContext, productVariantId: ID, stockLocationId: ID) => Promise<StockLevel>;    getStockLevelsForVariant(ctx: RequestContext, productVariantId: ID) => Promise<StockLevel[]>;    getAvailableStock(ctx: RequestContext, productVariantId: ID) => Promise<AvailableStock>;    updateStockOnHandForLocation(ctx: RequestContext, productVariantId: ID, stockLocationId: ID, change: number) => ;    updateStockAllocatedForLocation(ctx: RequestContext, productVariantId: ID, stockLocationId: ID, change: number) => ;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[StockLocationService](/reference/typescript-api/services/stock-location-service#stocklocationservice)
### getStockLevel​


[​](#getstocklevel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)[StockLevel](/reference/typescript-api/entities/stock-level#stocklevel)Returns the StockLevel for the given ProductVariant and StockLocation.

[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)
### getStockLevelsForVariant​


[​](#getstocklevelsforvariant)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[StockLevel](/reference/typescript-api/entities/stock-level#stocklevel)
### getAvailableStock​


[​](#getavailablestock)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[AvailableStock](/reference/typescript-api/products-stock/stock-location-strategy#availablestock)Returns the available stock (on hand and allocated) for the given ProductVariant. This is determined
by the configured StockLocationStrategy.

[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[StockLocationStrategy](/reference/typescript-api/products-stock/stock-location-strategy#stocklocationstrategy)
### updateStockOnHandForLocation​


[​](#updatestockonhandforlocation)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)Updates the stockOnHand for the given ProductVariant and StockLocation.

[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)
### updateStockAllocatedForLocation​


[​](#updatestockallocatedforlocation)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[ID](/reference/typescript-api/common/id#id)Updates the stockAllocated for the given ProductVariant and StockLocation.

[ProductVariant](/reference/typescript-api/entities/product-variant#productvariant)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)


---

# StockLocationService


## StockLocationService​


[​](#stocklocationservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[stock-location.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/stock-location.service.ts#L41)Contains methods relating to StockLocation entities.

[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)
```
class StockLocationService {    constructor(requestContextService: RequestContextService, connection: TransactionalConnection, channelService: ChannelService, roleService: RoleService, listQueryBuilder: ListQueryBuilder, configService: ConfigService, requestContextCache: RequestContextCacheService, customFieldRelationService: CustomFieldRelationService, eventBus: EventBus)    initStockLocations() => ;    findOne(ctx: RequestContext, stockLocationId: ID) => Promise<StockLocation | undefined>;    findAll(ctx: RequestContext, options?: ListQueryOptions<StockLocation>, relations?: RelationPaths<StockLocation>) => Promise<PaginatedList<StockLocation>>;    create(ctx: RequestContext, input: CreateStockLocationInput) => Promise<StockLocation>;    update(ctx: RequestContext, input: UpdateStockLocationInput) => Promise<StockLocation>;    delete(ctx: RequestContext, input: DeleteStockLocationInput) => Promise<DeletionResponse>;    assignStockLocationsToChannel(ctx: RequestContext, input: AssignStockLocationsToChannelInput) => Promise<StockLocation[]>;    removeStockLocationsFromChannel(ctx: RequestContext, input: RemoveStockLocationsFromChannelInput) => Promise<StockLocation[]>;    defaultStockLocation(ctx: RequestContext) => ;    getAllocationLocations(ctx: RequestContext, orderLine: OrderLine, quantity: number) => ;    getReleaseLocations(ctx: RequestContext, orderLine: OrderLine, quantity: number) => ;    getSaleLocations(ctx: RequestContext, orderLine: OrderLine, quantity: number) => ;    getCancellationLocations(ctx: RequestContext, orderLine: OrderLine, quantity: number) => ;}
```

### constructor​


[​](#constructor)[RequestContextService](/reference/typescript-api/request/request-context-service#requestcontextservice)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[ChannelService](/reference/typescript-api/services/channel-service#channelservice)[RoleService](/reference/typescript-api/services/role-service#roleservice)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[RequestContextCacheService](/reference/typescript-api/cache/request-context-cache-service#requestcontextcacheservice)[EventBus](/reference/typescript-api/events/event-bus#eventbus)
### initStockLocations​


[​](#initstocklocations)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)
### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)
### delete​


[​](#delete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Deletes a StockLocation. If transferToLocationId is specified in the input, all stock levels
from the deleted location will be transferred to the target location. The last StockLocation
cannot be deleted.

### assignStockLocationsToChannel​


[​](#assignstocklocationstochannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)Assigns multiple StockLocations to the specified Channel. Requires the UpdateStockLocation
permission on the target channel.

### removeStockLocationsFromChannel​


[​](#removestocklocationsfromchannel)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[StockLocation](/reference/typescript-api/entities/stock-location#stocklocation)Removes multiple StockLocations from the specified Channel. Requires the DeleteStockLocation
permission on the target channel. StockLocations cannot be removed from the default channel.

### defaultStockLocation​


[​](#defaultstocklocation)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### getAllocationLocations​


[​](#getallocationlocations)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[OrderLine](/reference/typescript-api/entities/order-line#orderline)Returns the locations and quantities to use for allocating stock when an OrderLine is created.
This uses the configured StockLocationStrategy.

[StockLocationStrategy](/reference/typescript-api/products-stock/stock-location-strategy#stocklocationstrategy)
### getReleaseLocations​


[​](#getreleaselocations)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[OrderLine](/reference/typescript-api/entities/order-line#orderline)Returns the locations and quantities to use for releasing allocated stock when an OrderLine is cancelled
or modified. This uses the configured StockLocationStrategy.

[StockLocationStrategy](/reference/typescript-api/products-stock/stock-location-strategy#stocklocationstrategy)
### getSaleLocations​


[​](#getsalelocations)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[OrderLine](/reference/typescript-api/entities/order-line#orderline)Returns the locations and quantities to use for creating sales when an Order is fulfilled.
This uses the configured StockLocationStrategy.

[StockLocationStrategy](/reference/typescript-api/products-stock/stock-location-strategy#stocklocationstrategy)
### getCancellationLocations​


[​](#getcancellationlocations)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[OrderLine](/reference/typescript-api/entities/order-line#orderline)Returns the locations and quantities to use for cancelling sales when an OrderLine is cancelled
after fulfillment. This uses the configured StockLocationStrategy.

[StockLocationStrategy](/reference/typescript-api/products-stock/stock-location-strategy#stocklocationstrategy)


---

# StockMovementService


## StockMovementService​


[​](#stockmovementservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[stock-movement.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/stock-movement.service.ts#L41)Contains methods relating to StockMovement entities.

[StockMovement](/reference/typescript-api/entities/stock-movement#stockmovement)
```
class StockMovementService {    shippingEligibilityCheckers: ShippingEligibilityChecker[];    shippingCalculators: ShippingCalculator[];    constructor(connection: TransactionalConnection, listQueryBuilder: ListQueryBuilder, globalSettingsService: GlobalSettingsService, stockLevelService: StockLevelService, eventBus: EventBus, stockLocationService: StockLocationService)    getStockMovementsByProductVariantId(ctx: RequestContext, productVariantId: ID, options?: StockMovementListOptions) => Promise<PaginatedList<StockMovement>>;    adjustProductVariantStock(ctx: RequestContext, productVariantId: ID, stockOnHandNumberOrInput: number | StockLevelInput[]) => Promise<StockAdjustment[]>;    createAllocationsForOrder(ctx: RequestContext, order: Order) => Promise<Allocation[]>;    createAllocationsForOrderLines(ctx: RequestContext, lines: OrderLineInput[]) => Promise<Allocation[]>;    createSalesForOrder(ctx: RequestContext, lines: OrderLineInput[]) => Promise<Sale[]>;    createCancellationsForOrderLines(ctx: RequestContext, lineInputs: OrderLineInput[]) => Promise<Cancellation[]>;    createReleasesForOrderLines(ctx: RequestContext, lineInputs: OrderLineInput[]) => Promise<Release[]>;}
```

### shippingEligibilityCheckers​


[​](#shippingeligibilitycheckers)[ShippingEligibilityChecker](/reference/typescript-api/shipping/shipping-eligibility-checker#shippingeligibilitychecker)
### shippingCalculators​


[​](#shippingcalculators)[ShippingCalculator](/reference/typescript-api/shipping/shipping-calculator#shippingcalculator)
### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)[GlobalSettingsService](/reference/typescript-api/services/global-settings-service#globalsettingsservice)[StockLevelService](/reference/typescript-api/services/stock-level-service#stocklevelservice)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[StockLocationService](/reference/typescript-api/services/stock-location-service#stocklocationservice)
### getStockMovementsByProductVariantId​


[​](#getstockmovementsbyproductvariantid)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[StockMovement](/reference/typescript-api/entities/stock-movement#stockmovement)Returns a PaginatedList of all StockMovements associated with the specified ProductVariant.

[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)
### adjustProductVariantStock​


[​](#adjustproductvariantstock)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[StockAdjustment](/reference/typescript-api/entities/stock-movement#stockadjustment)Adjusts the stock level of the ProductVariant, creating a new StockAdjustment entity
in the process.

[StockAdjustment](/reference/typescript-api/entities/stock-movement#stockadjustment)
### createAllocationsForOrder​


[​](#createallocationsfororder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Order](/reference/typescript-api/entities/order#order)[Allocation](/reference/typescript-api/entities/stock-movement#allocation)Creates a new Allocation for each OrderLine in the Order. For ProductVariants
which are configured to track stock levels, the ProductVariant.stockAllocated value is
increased, indicating that this quantity of stock is allocated and cannot be sold.

[Allocation](/reference/typescript-api/entities/stock-movement#allocation)
### createAllocationsForOrderLines​


[​](#createallocationsfororderlines)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Allocation](/reference/typescript-api/entities/stock-movement#allocation)Creates a new Allocation for each of the given OrderLines. For ProductVariants
which are configured to track stock levels, the ProductVariant.stockAllocated value is
increased, indicating that this quantity of stock is allocated and cannot be sold.

[Allocation](/reference/typescript-api/entities/stock-movement#allocation)
### createSalesForOrder​


[​](#createsalesfororder)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Sale](/reference/typescript-api/entities/stock-movement#sale)Creates Sales for each OrderLine in the Order. For ProductVariants
which are configured to track stock levels, the ProductVariant.stockAllocated value is
reduced and the stockOnHand value is also reduced by the OrderLine quantity, indicating
that the stock is no longer allocated, but is actually sold and no longer available.

[Sale](/reference/typescript-api/entities/stock-movement#sale)
### createCancellationsForOrderLines​


[​](#createcancellationsfororderlines)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Cancellation](/reference/typescript-api/entities/stock-movement#cancellation)Creates a Cancellation for each of the specified OrderItems. For ProductVariants
which are configured to track stock levels, the ProductVariant.stockOnHand value is
increased for each Cancellation, allowing that stock to be sold again.

[Cancellation](/reference/typescript-api/entities/stock-movement#cancellation)
### createReleasesForOrderLines​


[​](#createreleasesfororderlines)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Release](/reference/typescript-api/entities/stock-movement#release)Creates a Release for each of the specified OrderItems. For ProductVariants
which are configured to track stock levels, the ProductVariant.stockAllocated value is
reduced, indicating that this stock is once again available to buy.

[Release](/reference/typescript-api/entities/stock-movement#release)


---

# TagService


## TagService​


[​](#tagservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[tag.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/tag.service.ts#L25)Contains methods relating to Tag entities.

[Tag](/reference/typescript-api/entities/tag#tag)
```
class TagService {    constructor(connection: TransactionalConnection, listQueryBuilder: ListQueryBuilder)    findAll(ctx: RequestContext, options?: ListQueryOptions<Tag>) => Promise<PaginatedList<Tag>>;    findOne(ctx: RequestContext, tagId: ID) => Promise<Tag | undefined>;    create(ctx: RequestContext, input: CreateTagInput) => ;    update(ctx: RequestContext, input: UpdateTagInput) => ;    delete(ctx: RequestContext, id: ID) => Promise<DeletionResponse>;    valuesToTags(ctx: RequestContext, values: string[]) => Promise<Tag[]>;    getTagsForEntity(ctx: RequestContext, entity: Type<VendureEntity & Taggable>, id: ID) => Promise<Tag[]>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Tag](/reference/typescript-api/entities/tag#tag)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Tag](/reference/typescript-api/entities/tag#tag)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Tag](/reference/typescript-api/entities/tag#tag)
### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### delete​


[​](#delete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### valuesToTags​


[​](#valuestotags)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Tag](/reference/typescript-api/entities/tag#tag)
### getTagsForEntity​


[​](#gettagsforentity)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[VendureEntity](/reference/typescript-api/entities/vendure-entity#vendureentity)[Taggable](/reference/typescript-api/entities/interfaces#taggable)[ID](/reference/typescript-api/common/id#id)[Tag](/reference/typescript-api/entities/tag#tag)


---


# TaxCategoryService


## TaxCategoryService​


[​](#taxcategoryservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[tax-category.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/tax-category.service.ts#L29)Contains methods relating to TaxCategory entities.

[TaxCategory](/reference/typescript-api/entities/tax-category#taxcategory)
```
class TaxCategoryService {    constructor(connection: TransactionalConnection, eventBus: EventBus, listQueryBuilder: ListQueryBuilder)    findAll(ctx: RequestContext, options?: ListQueryOptions<TaxCategory>) => Promise<PaginatedList<TaxCategory>>;    findOne(ctx: RequestContext, taxCategoryId: ID) => Promise<TaxCategory | undefined>;    create(ctx: RequestContext, input: CreateTaxCategoryInput) => Promise<TaxCategory>;    update(ctx: RequestContext, input: UpdateTaxCategoryInput) => Promise<TaxCategory>;    delete(ctx: RequestContext, id: ID) => Promise<DeletionResponse>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[TaxCategory](/reference/typescript-api/entities/tax-category#taxcategory)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[TaxCategory](/reference/typescript-api/entities/tax-category#taxcategory)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[TaxCategory](/reference/typescript-api/entities/tax-category#taxcategory)
### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[TaxCategory](/reference/typescript-api/entities/tax-category#taxcategory)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[TaxCategory](/reference/typescript-api/entities/tax-category#taxcategory)
### delete​


[​](#delete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)


---

# TaxRateService


## TaxRateService​


[​](#taxrateservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[tax-rate.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/tax-rate.service.ts#L37)Contains methods relating to TaxRate entities.

[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)
```
class TaxRateService {    constructor(connection: TransactionalConnection, eventBus: EventBus, listQueryBuilder: ListQueryBuilder, configService: ConfigService, customFieldRelationService: CustomFieldRelationService)    findAll(ctx: RequestContext, options?: ListQueryOptions<TaxRate>, relations?: RelationPaths<TaxRate>) => Promise<PaginatedList<TaxRate>>;    findOne(ctx: RequestContext, taxRateId: ID, relations?: RelationPaths<TaxRate>) => Promise<TaxRate | undefined>;    create(ctx: RequestContext, input: CreateTaxRateInput) => Promise<TaxRate>;    update(ctx: RequestContext, input: UpdateTaxRateInput) => Promise<TaxRate>;    delete(ctx: RequestContext, id: ID) => Promise<DeletionResponse>;    getApplicableTaxRate(ctx: RequestContext, zone: Zone | ID, taxCategory: TaxCategory | ID) => Promise<TaxRate>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)
### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)
### delete​


[​](#delete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### getApplicableTaxRate​


[​](#getapplicabletaxrate)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Zone](/reference/typescript-api/entities/zone#zone)[ID](/reference/typescript-api/common/id#id)[TaxCategory](/reference/typescript-api/entities/tax-category#taxcategory)[ID](/reference/typescript-api/common/id#id)[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)Returns the applicable TaxRate based on the specified Zone and TaxCategory. Used when calculating Order
prices.


---

# UserService


## UserService​


[​](#userservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[user.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/user.service.ts#L38)Contains methods relating to User entities.

[User](/reference/typescript-api/entities/user#user)
```
class UserService {    constructor(connection: TransactionalConnection, configService: ConfigService, roleService: RoleService, passwordCipher: PasswordCipher, verificationTokenGenerator: VerificationTokenGenerator, moduleRef: ModuleRef)    getUserById(ctx: RequestContext, userId: ID) => Promise<User | undefined>;    getUserByEmailAddress(ctx: RequestContext, emailAddress: string, userType?: 'administrator' | 'customer') => Promise<User | undefined>;    createCustomerUser(ctx: RequestContext, identifier: string, password?: string) => Promise<User | PasswordValidationError>;    addNativeAuthenticationMethod(ctx: RequestContext, user: User, identifier: string, password?: string) => Promise<User | PasswordValidationError>;    createAdminUser(ctx: RequestContext, identifier: string, password: string) => Promise<User>;    softDelete(ctx: RequestContext, userId: ID) => ;    setVerificationToken(ctx: RequestContext, user: User) => Promise<User>;    verifyUserByToken(ctx: RequestContext, verificationToken: string, password?: string) => Promise<ErrorResultUnion<VerifyCustomerAccountResult, User>>;    setPasswordResetToken(ctx: RequestContext, emailAddress: string) => Promise<User | undefined>;    resetPasswordByToken(ctx: RequestContext, passwordResetToken: string, password: string) => Promise<        User | PasswordResetTokenExpiredError | PasswordResetTokenInvalidError | PasswordValidationError    >;    changeUserAndNativeIdentifier(ctx: RequestContext, userId: ID, newIdentifier: string) => ;    setIdentifierChangeToken(ctx: RequestContext, user: User) => Promise<User>;    changeIdentifierByToken(ctx: RequestContext, token: string) => Promise<        | { user: User; oldIdentifier: string }        | IdentifierChangeTokenInvalidError        | IdentifierChangeTokenExpiredError    >;    updatePassword(ctx: RequestContext, userId: ID, currentPassword: string, newPassword: string) => Promise<boolean | InvalidCredentialsError | PasswordValidationError>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[RoleService](/reference/typescript-api/services/role-service#roleservice)
### getUserById​


[​](#getuserbyid)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[User](/reference/typescript-api/entities/user#user)
### getUserByEmailAddress​


[​](#getuserbyemailaddress)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)
### createCustomerUser​


[​](#createcustomeruser)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)Creates a new User with the special customer Role and using the NativeAuthenticationStrategy.

[NativeAuthenticationStrategy](/reference/typescript-api/auth/native-authentication-strategy#nativeauthenticationstrategy)
### addNativeAuthenticationMethod​


[​](#addnativeauthenticationmethod)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)[User](/reference/typescript-api/entities/user#user)Adds a new NativeAuthenticationMethod to the User. If the AuthOptions requireVerification
is set to true (as is the default), the User will be marked as unverified until the email verification
flow is completed.

[NativeAuthenticationMethod](/reference/typescript-api/entities/authentication-method#nativeauthenticationmethod)[AuthOptions](/reference/typescript-api/auth/auth-options#authoptions)
### createAdminUser​


[​](#createadminuser)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)Creates a new verified User using the NativeAuthenticationStrategy.

[NativeAuthenticationStrategy](/reference/typescript-api/auth/native-authentication-strategy#nativeauthenticationstrategy)
### softDelete​


[​](#softdelete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### setVerificationToken​


[​](#setverificationtoken)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)[User](/reference/typescript-api/entities/user#user)Sets the NativeAuthenticationMethod verificationToken as part of the User email verification
flow.

[NativeAuthenticationMethod](/reference/typescript-api/entities/authentication-method#nativeauthenticationmethod)
### verifyUserByToken​


[​](#verifyuserbytoken)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ErrorResultUnion](/reference/typescript-api/errors/error-result-union#errorresultunion)[User](/reference/typescript-api/entities/user#user)Verifies a verificationToken by looking for a User which has previously had it set using the
setVerificationToken() method, and checks that the token is valid and has not expired.

If valid, the User will be set to verified: true.

### setPasswordResetToken​


[​](#setpasswordresettoken)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)Sets the NativeAuthenticationMethod passwordResetToken as part of the User password reset
flow.

[NativeAuthenticationMethod](/reference/typescript-api/entities/authentication-method#nativeauthenticationmethod)
### resetPasswordByToken​


[​](#resetpasswordbytoken)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)Verifies a passwordResetToken by looking for a User which has previously had it set using the
setPasswordResetToken() method, and checks that the token is valid and has not expired.

If valid, the User's credentials will be updated with the new password.

### changeUserAndNativeIdentifier​


[​](#changeuserandnativeidentifier)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)Changes the User identifier without an email verification step, so this should be only used when
an Administrator is setting a new email address.

### setIdentifierChangeToken​


[​](#setidentifierchangetoken)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)[User](/reference/typescript-api/entities/user#user)Sets the NativeAuthenticationMethod identifierChangeToken as part of the User email address change
flow.

[NativeAuthenticationMethod](/reference/typescript-api/entities/authentication-method#nativeauthenticationmethod)
### changeIdentifierByToken​


[​](#changeidentifierbytoken)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[User](/reference/typescript-api/entities/user#user)Changes the User identifier as part of the storefront flow used by Customers to set a
new email address, with the token previously set using the setIdentifierChangeToken() method.

### updatePassword​


[​](#updatepassword)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)Updates the password for a User with the NativeAuthenticationMethod.

[NativeAuthenticationMethod](/reference/typescript-api/entities/authentication-method#nativeauthenticationmethod)


---

# ZoneService


## ZoneService​


[​](#zoneservice)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[zone.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/service/services/zone.service.ts#L38)Contains methods relating to Zone entities.

[Zone](/reference/typescript-api/entities/zone#zone)
```
class ZoneService {    constructor(connection: TransactionalConnection, configService: ConfigService, eventBus: EventBus, translator: TranslatorService, listQueryBuilder: ListQueryBuilder, customFieldRelationService: CustomFieldRelationService)    findAll(ctx: RequestContext, options?: ListQueryOptions<Zone>) => Promise<PaginatedList<Zone>>;    findOne(ctx: RequestContext, zoneId: ID) => Promise<Zone | undefined>;    getAllWithMembers(ctx: RequestContext) => Promise<Zone[]>;    create(ctx: RequestContext, input: CreateZoneInput) => Promise<Zone>;    update(ctx: RequestContext, input: UpdateZoneInput) => Promise<Zone>;    delete(ctx: RequestContext, id: ID) => Promise<DeletionResponse>;    addMembersToZone(ctx: RequestContext, { memberIds, zoneId }: MutationAddMembersToZoneArgs) => Promise<Zone>;    removeMembersFromZone(ctx: RequestContext, { memberIds, zoneId }: MutationRemoveMembersFromZoneArgs) => Promise<Zone>;}
```

### constructor​


[​](#constructor)[TransactionalConnection](/reference/typescript-api/data-access/transactional-connection#transactionalconnection)[EventBus](/reference/typescript-api/events/event-bus#eventbus)[TranslatorService](/reference/typescript-api/service-helpers/translator-service#translatorservice)[ListQueryBuilder](/reference/typescript-api/data-access/list-query-builder#listquerybuilder)
### findAll​


[​](#findall)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Zone](/reference/typescript-api/entities/zone#zone)[PaginatedList](/reference/typescript-api/common/paginated-list#paginatedlist)[Zone](/reference/typescript-api/entities/zone#zone)
### findOne​


[​](#findone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)[Zone](/reference/typescript-api/entities/zone#zone)
### getAllWithMembers​


[​](#getallwithmembers)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Zone](/reference/typescript-api/entities/zone#zone)
### create​


[​](#create)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Zone](/reference/typescript-api/entities/zone#zone)
### update​


[​](#update)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Zone](/reference/typescript-api/entities/zone#zone)
### delete​


[​](#delete)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ID](/reference/typescript-api/common/id#id)
### addMembersToZone​


[​](#addmemberstozone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Zone](/reference/typescript-api/entities/zone#zone)
### removeMembersFromZone​


[​](#removemembersfromzone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Zone](/reference/typescript-api/entities/zone#zone)


---

# SettingsStore


## cleanOrphanedSettingsStoreTask​


[​](#cleanorphanedsettingsstoretask)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[clean-orphaned-settings-store-task.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/settings-store/clean-orphaned-settings-store-task.ts#L39)A ScheduledTask that cleans up orphaned settings store entries from the database.
Orphaned entries are entries that no longer have corresponding field definitions
in the settings store configuration.

[ScheduledTask](/reference/typescript-api/scheduled-tasks/scheduled-task#scheduledtask)This task can be configured with options for dry-run mode, age thresholds,
and batch processing settings. Users can override or disable this task entirely
using the existing ScheduledTask APIs.

Example

```
// Override the default task with custom optionsconst customCleanupTask = new ScheduledTask({  id: 'clean-orphaned-settings-store',  description: 'Custom orphaned settings store cleanup',  schedule: cron => cron.every(7).days(),  async execute({ injector }) {    const settingsStoreService = injector.get(SettingsStoreService);    return settingsStoreService.cleanupOrphanedEntries({      olderThan: '30d',      maxDeleteCount: 500,      batchSize: 50,    });  },});
```


---

# CleanupOrphanedSettingsStoreEntriesOptions


## CleanupOrphanedSettingsStoreEntriesOptions​


[​](#cleanuporphanedsettingsstoreentriesoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[settings-store-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/settings-store/settings-store-types.ts#L270)Options for cleaning up orphaned settings store entries.

```
interface CleanupOrphanedSettingsStoreEntriesOptions {    dryRun?: boolean;    olderThan?: string;    maxDeleteCount?: number;    batchSize?: number;}
```

### dryRun​


[​](#dryrun)If true, perform a dry run without actually deleting entries.

### olderThan​


[​](#olderthan)Only delete entries older than this duration.
Examples: '30d', '7d', '1h', '30m'

### maxDeleteCount​


[​](#maxdeletecount)Maximum number of entries to delete in a single operation.

### batchSize​


[​](#batchsize)Batch size for deletion operations.

---

# CleanupOrphanedSettingsStoreEntriesResult


## CleanupOrphanedSettingsStoreEntriesResult​


[​](#cleanuporphanedsettingsstoreentriesresult)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[settings-store-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/settings-store/settings-store-types.ts#L308)Result of a cleanup operation for orphaned settings store entries.

```
interface CleanupOrphanedSettingsStoreEntriesResult {    deletedCount: number;    dryRun: boolean;    deletedEntries: OrphanedSettingsStoreEntry[];}
```

### deletedCount​


[​](#deletedcount)Number of entries that were (or would be) deleted.

### dryRun​


[​](#dryrun)Whether this was a dry run.

### deletedEntries​


[​](#deletedentries)[OrphanedSettingsStoreEntry](/reference/typescript-api/settings-store/orphaned-settings-store-entry#orphanedsettingsstoreentry)Sample of deleted entries (for logging/audit purposes).


---

# OrphanedSettingsStoreEntry


## OrphanedSettingsStoreEntry​


[​](#orphanedsettingsstoreentry)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[settings-store-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/settings-store/settings-store-types.ts#L237)Represents an orphaned settings store entry that no longer has a corresponding
field definition in the configuration.

```
interface OrphanedSettingsStoreEntry {    key: string;    scope: string;    updatedAt: Date;    valuePreview: string;}
```

### key​


[​](#key)The orphaned key.

### scope​


[​](#scope)The scope of the orphaned entry.

### updatedAt​


[​](#updatedat)When the entry was last updated.

### valuePreview​


[​](#valuepreview)Preview of the stored value (truncated for large values).


---

# SetSettingsStoreValueResult


## SetSettingsStoreValueResult​


[​](#setsettingsstorevalueresult)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[settings-store-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/settings-store/settings-store-types.ts#L209)Result type for settings store set operations, providing detailed feedback
about the success or failure of each operation.

```
interface SetSettingsStoreValueResult {    key: string;    result: boolean;    error?: string;}
```

### key​


[​](#key)The key that was attempted to be set.

### result​


[​](#result)Whether the set operation was successful.

### error​


[​](#error)Error message if the operation failed, null if successful.


---

# SettingsStoreFieldConfig


## SettingsStoreFieldConfig​


[​](#settingsstorefieldconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[settings-store-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/settings-store/settings-store-types.ts#L41)Configuration for a settings store field, defining how it should be stored,
scoped, validated, and accessed.

```
interface SettingsStoreFieldConfig {    name: string;    scope?: SettingsStoreScopeFunction;    readonly?: boolean;    requiresPermission?:        | Array<Permission | string>        | Permission        | string        | {              read?: Array<Permission | string> | Permission | string;              write?: Array<Permission | string> | Permission | string;          };    validate?: (        value: any,        injector: Injector,        ctx: RequestContext,    ) => string | LocalizedString[] | void | Promise<string | LocalizedString[] | void>;}
```

### name​


[​](#name)The name of the field. This will be combined with the namespace
to create the full key (e.g., 'dashboard.theme').

### scope​


[​](#scope)[SettingsStoreScopeFunction](/reference/typescript-api/settings-store/settings-store-scope-function#settingsstorescopefunction)Function that determines how this field should be scoped.
Defaults to global scoping (no isolation).

### readonly​


[​](#readonly)Whether this field is readonly via the GraphQL API.
Readonly fields can still be modified programmatically via a service.

### requiresPermission​


[​](#requirespermission)[Permission](/reference/typescript-api/common/permission#permission)[Permission](/reference/typescript-api/common/permission#permission)[Permission](/reference/typescript-api/common/permission#permission)[Permission](/reference/typescript-api/common/permission#permission)[Permission](/reference/typescript-api/common/permission#permission)[Permission](/reference/typescript-api/common/permission#permission)Permissions required to access this field. If not specified,
basic authentication is required for admin API access.

Can be either:

- A single permission or array of permissions (applies to both read and write)
- An object with read and write properties for granular control

Example

```
// Single permission for both read and writerequiresPermission: Permission.UpdateSettings// Separate read and write permissionsrequiresPermission: {  read: Permission.ReadSettings,  write: Permission.UpdateSettings}// Using custom RwPermissionDefinitionrequiresPermission: {  read: dashboardSavedViews.Read,  write: dashboardSavedViews.Write}
```

### validate​


[​](#validate)[Injector](/reference/typescript-api/common/injector#injector)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)Custom validation function for field values.


---

# SettingsStoreRegistration


## SettingsStoreRegistration​


[​](#settingsstoreregistration)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[settings-store-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/settings-store/settings-store-types.ts#L119)Configuration for registering a namespace of settings store fields.

```
interface SettingsStoreRegistration {    namespace: string;    fields: SettingsStoreFieldConfig[];}
```

### namespace​


[​](#namespace)The namespace for these fields (e.g., 'dashboard', 'payment').
Field names will be prefixed with this namespace.

### fields​


[​](#fields)[SettingsStoreFieldConfig](/reference/typescript-api/settings-store/settings-store-field-config#settingsstorefieldconfig)Array of field configurations for this namespace.


---

# SettingsStoreScopeFunction


## SettingsStoreScopeFunction​


[​](#settingsstorescopefunction)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[settings-store-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/settings-store/settings-store-types.ts#L27)A function that determines how a settings store entry should be scoped.
Returns a string that will be used as the scope key for storage isolation.

Example

```
// User-specific scopingconst userScope: SettingsStoreScopeFunction = ({ ctx }) => ctx.activeUserId || '';// Channel-specific scopingconst channelScope: SettingsStoreScopeFunction = ({ ctx }) => ctx.channelId || '';// User and channel scopingconst userAndChannelScope: SettingsStoreScopeFunction = ({ ctx }) =>  `${ctx.activeUserId || ''}:${ctx.channelId || ''}`;
```

```
type SettingsStoreScopeFunction = (params: {    key: string;    value?: any;    ctx: RequestContext;}) => string
```


---

# SettingsStoreScopes


## SettingsStoreScopes​


[​](#settingsstorescopes)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[settings-store-types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/settings-store/settings-store-types.ts#L174)Pre-built scope functions for common scoping patterns.

Example

```
const config: VendureConfig = {  settingsStoreFields: {    dashboard: [      {        name: 'theme',        scope: SettingsStoreScopes.user, // User-specific      },      {        name: 'currency',        scope: SettingsStoreScopes.channel, // Channel-specific      },      {        name: 'tableFilters',        scope: SettingsStoreScopes.userAndChannel, // User-specific per channel      }    ]  }};
```


---

# CheckShippingEligibilityCheckerFn


## CheckShippingEligibilityCheckerFn​


[​](#checkshippingeligibilitycheckerfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[shipping-eligibility-checker.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/shipping-method/shipping-eligibility-checker.ts#L138)A function which implements logic to determine whether a given Order is eligible for
a particular shipping method. Once a ShippingMethod has been assigned to an Order, this
function will be called on every change to the Order (e.g. updating quantities, adding/removing
items etc).

[Order](/reference/typescript-api/entities/order#order)If the code running in this function is expensive, then consider also defining
a ShouldRunCheckFn to avoid unnecessary calls.

[ShouldRunCheckFn](/reference/typescript-api/shipping/should-run-check-fn#shouldruncheckfn)
```
type CheckShippingEligibilityCheckerFn<T extends ConfigArgs> = (    ctx: RequestContext,    order: Order,    args: ConfigArgValues<T>,    method: ShippingMethod,) => boolean | Promise<boolean>
```


---

# DefaultShippingLineAssignmentStrategy


## DefaultShippingLineAssignmentStrategy​


[​](#defaultshippinglineassignmentstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-shipping-line-assignment-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/shipping-method/default-shipping-line-assignment-strategy.ts#L16)This is the default ShippingLineAssignmentStrategy which simply assigns all OrderLines to the
ShippingLine, and is suitable for the most common scenario of a single shipping method per Order.

[ShippingLineAssignmentStrategy](/reference/typescript-api/shipping/shipping-line-assignment-strategy#shippinglineassignmentstrategy)
```
class DefaultShippingLineAssignmentStrategy implements ShippingLineAssignmentStrategy {    assignShippingLineToOrderLines(ctx: RequestContext, shippingLine: ShippingLine, order: Order) => OrderLine[] | Promise<OrderLine[]>;}
```

- Implements: ShippingLineAssignmentStrategy

[ShippingLineAssignmentStrategy](/reference/typescript-api/shipping/shipping-line-assignment-strategy#shippinglineassignmentstrategy)
### assignShippingLineToOrderLines​


[​](#assignshippinglinetoorderlines)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ShippingLine](/reference/typescript-api/entities/shipping-line#shippingline)[Order](/reference/typescript-api/entities/order#order)[OrderLine](/reference/typescript-api/entities/order-line#orderline)[OrderLine](/reference/typescript-api/entities/order-line#orderline)


---

# ShippingCalculator


## ShippingCalculator​


[​](#shippingcalculator)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[shipping-calculator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/shipping-method/shipping-calculator.ts#L48)The ShippingCalculator is used by a ShippingMethod to calculate the price of shipping on a given Order.

[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)[Order](/reference/typescript-api/entities/order#order)Example

```
const flatRateCalculator = new ShippingCalculator({  code: 'flat-rate-calculator',  description: [{ languageCode: LanguageCode.en, value: 'Default Flat-Rate Shipping Calculator' }],  args: {    rate: {      type: 'int',      ui: { component: 'currency-form-input' },    },    taxRate: {      type: 'int',      ui: { component: 'number-form-input', suffix: '%' },    },  },  calculate: (ctx, order, args) => {    return {      price: args.rate,      taxRate: args.taxRate,      priceIncludesTax: ctx.channel.pricesIncludeTax,    };  },});
```

```
class ShippingCalculator<T extends ConfigArgs = ConfigArgs> extends ConfigurableOperationDef<T> {    constructor(config: ShippingCalculatorConfig<T>)}
```

- Extends: ConfigurableOperationDef<T>

[ConfigurableOperationDef](/reference/typescript-api/configurable-operation-def/#configurableoperationdef)
### constructor​


[​](#constructor)
## ShippingCalculationResult​


[​](#shippingcalculationresult)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[shipping-calculator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/shipping-method/shipping-calculator.ts#L79)The return value of the CalculateShippingFn.

[CalculateShippingFn](/reference/typescript-api/shipping/shipping-calculator#calculateshippingfn)
```
interface ShippingCalculationResult {    price: number;    priceIncludesTax: boolean;    taxRate: number;    metadata?: Record<string, any>;}
```

### price​


[​](#price)The shipping price without any taxes.

### priceIncludesTax​


[​](#priceincludestax)Whether or not the given price already includes taxes.

### taxRate​


[​](#taxrate)The tax rate applied to the shipping price.

### metadata​


[​](#metadata)Arbitrary metadata may be returned from the calculation function. This can be used
e.g. to return data on estimated delivery times or any other data which may be
needed in the storefront application when listing eligible shipping methods.

## CalculateShippingFn​


[​](#calculateshippingfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[shipping-calculator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/shipping-method/shipping-calculator.ts#L119)A function which implements the specific shipping calculation logic. It takes an Order and
an arguments object and should return the shipping price as an integer in cents.

[Order](/reference/typescript-api/entities/order#order)Should return a ShippingCalculationResult object.

[ShippingCalculationResult](/reference/typescript-api/shipping/shipping-calculator#shippingcalculationresult)
```
type CalculateShippingFn<T extends ConfigArgs> = (    ctx: RequestContext,    order: Order,    args: ConfigArgValues<T>,    method: ShippingMethod,) => CalculateShippingFnResult
```


---

# ShippingEligibilityCheckerConfig


## ShippingEligibilityCheckerConfig​


[​](#shippingeligibilitycheckerconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[shipping-eligibility-checker.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/shipping-method/shipping-eligibility-checker.ts#L23)Configuration passed into the constructor of a ShippingEligibilityChecker to
configure its behavior.

[ShippingEligibilityChecker](/reference/typescript-api/shipping/shipping-eligibility-checker#shippingeligibilitychecker)
```
interface ShippingEligibilityCheckerConfig<T extends ConfigArgs> extends ConfigurableOperationDefOptions<T> {    check: CheckShippingEligibilityCheckerFn<T>;    shouldRunCheck?: ShouldRunCheckFn<T>;}
```

- Extends: ConfigurableOperationDefOptions<T>

[ConfigurableOperationDefOptions](/reference/typescript-api/configurable-operation-def/configurable-operation-def-options#configurableoperationdefoptions)
### check​


[​](#check)[CheckShippingEligibilityCheckerFn](/reference/typescript-api/shipping/check-shipping-eligibility-checker-fn#checkshippingeligibilitycheckerfn)
### shouldRunCheck​


[​](#shouldruncheck)[ShouldRunCheckFn](/reference/typescript-api/shipping/should-run-check-fn#shouldruncheckfn)


---


# ShippingEligibilityChecker


## ShippingEligibilityChecker​


[​](#shippingeligibilitychecker)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[shipping-eligibility-checker.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/shipping-method/shipping-eligibility-checker.ts#L50)The ShippingEligibilityChecker class is used to check whether an order qualifies for a
given ShippingMethod.

[ShippingMethod](/reference/typescript-api/entities/shipping-method#shippingmethod)Example

```
const minOrderTotalEligibilityChecker = new ShippingEligibilityChecker({    code: 'min-order-total-eligibility-checker',    description: [{ languageCode: LanguageCode.en, value: 'Checks that the order total is above some minimum value' }],    args: {        orderMinimum: { type: 'int', ui: { component: 'currency-form-input' } },    },    check: (ctx, order, args) => {        return order.totalWithTax >= args.orderMinimum;    },});
```

```
class ShippingEligibilityChecker<T extends ConfigArgs = ConfigArgs> extends ConfigurableOperationDef<T> {    constructor(config: ShippingEligibilityCheckerConfig<T>)    init(injector: Injector) => ;    toJSON() => ;}
```

- Extends: ConfigurableOperationDef<T>

[ConfigurableOperationDef](/reference/typescript-api/configurable-operation-def/#configurableoperationdef)
### constructor​


[​](#constructor)[ShippingEligibilityCheckerConfig](/reference/typescript-api/shipping/shipping-eligibility-checker-config#shippingeligibilitycheckerconfig)
### init​


[​](#init)[Injector](/reference/typescript-api/common/injector#injector)
### toJSON​


[​](#tojson)


---

# ShippingLineAssignmentStrategy


## ShippingLineAssignmentStrategy​


[​](#shippinglineassignmentstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[shipping-line-assignment-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/shipping-method/shipping-line-assignment-strategy.ts#L52)This strategy is used to assign a given ShippingLine to one or more OrderLines of the Order.
This allows you to set multiple shipping methods for a single order, each assigned a different subset of
OrderLines.

[ShippingLine](/reference/typescript-api/entities/shipping-line#shippingline)[OrderLine](/reference/typescript-api/entities/order-line#orderline)The DefaultShippingLineAssignmentStrategy simply assigns all OrderLines, so is suitable for the
most common scenario of a single shipping method per Order.

[DefaultShippingLineAssignmentStrategy](/reference/typescript-api/shipping/default-shipping-line-assignment-strategy#defaultshippinglineassignmentstrategy)This is configured via the shippingOptions.shippingLineAssignmentStrategy property of
your VendureConfig.

Here's an example of a custom ShippingLineAssignmentStrategy which assigns digital products to a
different ShippingLine to physical products:

```
import {    Order,    OrderLine,    RequestContext,    ShippingLine,    ShippingLineAssignmentStrategy,} from '@vendure/core';export class DigitalShippingLineAssignmentStrategy implements ShippingLineAssignmentStrategy {    assignShippingLineToOrderLines(        ctx: RequestContext,        shippingLine: ShippingLine,        order: Order,    ): OrderLine[] | Promise<OrderLine[]> {        if (shippingLine.shippingMethod.customFields.isDigital) {            return order.lines.filter(l => l.productVariant.customFields.isDigital);        } else {            return order.lines.filter(l => !l.productVariant.customFields.isDigital);        }    }}
```

```
interface ShippingLineAssignmentStrategy extends InjectableStrategy {    assignShippingLineToOrderLines(        ctx: RequestContext,        shippingLine: ShippingLine,        order: Order,    ): OrderLine[] | Promise<OrderLine[]>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### assignShippingLineToOrderLines​


[​](#assignshippinglinetoorderlines)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[ShippingLine](/reference/typescript-api/entities/shipping-line#shippingline)[Order](/reference/typescript-api/entities/order#order)[OrderLine](/reference/typescript-api/entities/order-line#orderline)[OrderLine](/reference/typescript-api/entities/order-line#orderline)


---

# ShippingOptions


## ShippingOptions​


[​](#shippingoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts#L800)
```
interface ShippingOptions {    shippingEligibilityCheckers?: Array<ShippingEligibilityChecker<any>>;    shippingCalculators?: Array<ShippingCalculator<any>>;    shippingLineAssignmentStrategy?: ShippingLineAssignmentStrategy;    customFulfillmentProcess?: Array<FulfillmentProcess<any>>;    process?: Array<FulfillmentProcess<any>>;    fulfillmentHandlers?: Array<FulfillmentHandler<any>>;}
```

### shippingEligibilityCheckers​


[​](#shippingeligibilitycheckers)[ShippingEligibilityChecker](/reference/typescript-api/shipping/shipping-eligibility-checker#shippingeligibilitychecker)An array of available ShippingEligibilityCheckers for use in configuring ShippingMethods

### shippingCalculators​


[​](#shippingcalculators)[ShippingCalculator](/reference/typescript-api/shipping/shipping-calculator#shippingcalculator)An array of available ShippingCalculators for use in configuring ShippingMethods

### shippingLineAssignmentStrategy​


[​](#shippinglineassignmentstrategy)[ShippingLineAssignmentStrategy](/reference/typescript-api/shipping/shipping-line-assignment-strategy#shippinglineassignmentstrategy)This strategy is used to assign a given ShippingLine to one or more OrderLines of the Order.
This allows you to set multiple shipping methods for a single order, each assigned a different subset of
OrderLines.

[ShippingLine](/reference/typescript-api/entities/shipping-line#shippingline)[OrderLine](/reference/typescript-api/entities/order-line#orderline)
### customFulfillmentProcess​


[​](#customfulfillmentprocess)[FulfillmentProcess](/reference/typescript-api/fulfillment/fulfillment-process#fulfillmentprocess)Allows the definition of custom states and transition logic for the fulfillment process state machine.
Takes an array of objects implementing the FulfillmentProcess interface.

[FulfillmentProcess](/reference/typescript-api/fulfillment/fulfillment-process#fulfillmentprocess)
### process​


[​](#process)[FulfillmentProcess](/reference/typescript-api/fulfillment/fulfillment-process#fulfillmentprocess)[defaultFulfillmentProcess](/reference/typescript-api/fulfillment/fulfillment-process#defaultfulfillmentprocess)Allows the definition of custom states and transition logic for the fulfillment process state machine.
Takes an array of objects implementing the FulfillmentProcess interface.

[FulfillmentProcess](/reference/typescript-api/fulfillment/fulfillment-process#fulfillmentprocess)
### fulfillmentHandlers​


[​](#fulfillmenthandlers)[FulfillmentHandler](/reference/typescript-api/fulfillment/fulfillment-handler#fulfillmenthandler)An array of available FulfillmentHandlers.


---

# ShouldRunCheckFn


## ShouldRunCheckFn​


[​](#shouldruncheckfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[shipping-eligibility-checker.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/shipping-method/shipping-eligibility-checker.ts#L173)An optional method which is used to decide whether to run the check() function.
Returns a JSON-compatible object which is cached and compared between calls.
If the value is the same, then the check() function is not called.

Use of this function is an optimization technique which can be useful when
the check() function is expensive and should be kept to an absolute minimum.

Example

```
const optimizedChecker = new ShippingEligibilityChecker({  code: 'example',  description: [],  args: {},  check: async (ctx, order) => {    // some slow, expensive function here  },  shouldRunCheck: (ctx, order) => {    // Will only run the `check()` function any time    // the shippingAddress object has changed.    return order.shippingAddress;  },});
```

```
type ShouldRunCheckFn<T extends ConfigArgs> = (    ctx: RequestContext,    order: Order,    args: ConfigArgValues<T>,    method: ShippingMethod,) => Json | Promise<Json>
```


---

# FSM


## FSM​


[​](#fsm)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[finite-state-machine.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/finite-state-machine/finite-state-machine.ts#L12)A simple type-safe finite state machine. This is used internally to control the Order process, ensuring that
the state of Orders, Payments, Fulfillments and Refunds follows a well-defined behaviour.

```
class FSM<T extends string, Data = any> {    constructor(config: StateMachineConfig<T, Data>, initialState: T)    initialState: T    currentState: T    transitionTo(state: T, data: Data) => Promise<{ finalize: () => Promise<any> }>;    jumpTo(state: T) => ;    getNextStates() => readonly T[];    canTransitionTo(state: T) => boolean;}
```

### constructor​


[​](#constructor)[StateMachineConfig](/reference/typescript-api/state-machine/state-machine-config#statemachineconfig)
### initialState​


[​](#initialstate)
### currentState​


[​](#currentstate)
### transitionTo​


[​](#transitionto)
### jumpTo​


[​](#jumpto)
### getNextStates​


[​](#getnextstates)
### canTransitionTo​


[​](#cantransitionto)

---

# StateMachineConfig


## StateMachineConfig​


[​](#statemachineconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/finite-state-machine/types.ts#L89)The config object used to instantiate a new FSM instance.

[FSM](/reference/typescript-api/state-machine/fsm#fsm)
```
interface StateMachineConfig<T extends string, Data = undefined> {    readonly transitions: Transitions<T>;    onTransitionStart?: OnTransitionStartFn<T, Data>;    onTransitionEnd?: OnTransitionEndFn<T, Data>;    onError?: OnTransitionErrorFn<T>;}
```

### transitions​


[​](#transitions)[Transitions](/reference/typescript-api/state-machine/transitions#transitions)Defines the available states of the state machine as well as the permitted
transitions from one state to another.

### onTransitionStart​


[​](#ontransitionstart)[OnTransitionStartFn](/reference/typescript-api/state-machine/state-machine-config#ontransitionstartfn)Called before a transition takes place. If the function resolves to false or a string, then the transition
will be cancelled. In the case of a string, the string (error message) will be forwarded to the onError handler.

If this function returns a value resolving to true or void (no return value), then the transition
will be permitted.

### onTransitionEnd​


[​](#ontransitionend)[OnTransitionEndFn](/reference/typescript-api/state-machine/state-machine-config#ontransitionendfn)Called after a transition has taken place.

### onError​


[​](#onerror)[OnTransitionErrorFn](/reference/typescript-api/state-machine/state-machine-config#ontransitionerrorfn)Called when a transition is prevented and the onTransitionStart handler has returned an
error message.

## OnTransitionStartFn​


[​](#ontransitionstartfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/finite-state-machine/types.ts#L48)Called before a transition takes place. If the function resolves to false or a string, then the transition
will be cancelled. In the case of a string, the string (error message) will be forwarded to the onError handler.

If this function returns a value resolving to true or void (no return value), then the transition
will be permitted.

```
type OnTransitionStartFn<T extends string, Data> = (    fromState: T,    toState: T,    data: Data,) => boolean | string | void | Promise<boolean | string | void> | Observable<boolean | string | void>
```

## OnTransitionErrorFn​


[​](#ontransitionerrorfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/finite-state-machine/types.ts#L62)Called when a transition is prevented and the onTransitionStart handler has returned an
error message.

```
type OnTransitionErrorFn<T extends string> = (    fromState: T,    toState: T,    message?: string,) => void | Promise<void> | Observable<void>
```

## OnTransitionEndFn​


[​](#ontransitionendfn)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/finite-state-machine/types.ts#L75)Called after a transition has taken place.

```
type OnTransitionEndFn<T extends string, Data> = (    fromState: T,    toState: T,    data: Data,) => void | Promise<void> | Observable<void>
```


---

# Transitions


## Transitions​


[​](#transitions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/finite-state-machine/types.ts#L30)A type which is used to define valid states and transitions for a state machine based
on FSM.

[FSM](/reference/typescript-api/state-machine/fsm#fsm)Example

```
type LightColor = 'Green' | 'Amber' | 'Red';const trafficLightTransitions: Transitions<LightColor> = {  Green: {    to: ['Amber'],  },  Amber: {    to: ['Red'],  },  Red: {    to: ['Green'],  },};
```

The mergeStrategy property defines how to handle the merging of states when one set of
transitions is being merged with another (as in the case of defining a OrderProcess)

[OrderProcess](/reference/typescript-api/orders/order-process#orderprocess)
```
type Transitions<State extends string, Target extends string = State> = {    [S in State]: {        to: Readonly<Target[]>;        mergeStrategy?: 'merge' | 'replace';    };}
```


---

# AddressBasedTaxZoneStrategy


## AddressBasedTaxZoneStrategy​


[​](#addressbasedtaxzonestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[address-based-tax-zone-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/tax/address-based-tax-zone-strategy.ts#L40)Address based TaxZoneStrategy which tries to find the applicable Zone based on the
country of the shipping address of the Order.
This is useful for shops that do cross-border B2C orders and use the One-Stop-Shop (OSS) VAT scheme.

[TaxZoneStrategy](/reference/typescript-api/tax/tax-zone-strategy#taxzonestrategy)[Zone](/reference/typescript-api/entities/zone#zone)Returns the default Channel's default tax zone if no applicable zone is found.

[Channel](/reference/typescript-api/entities/channel#channel)This is configured via taxOptions.taxZoneStrategy = new AddressBasedTaxZoneStrategy() in
your VendureConfig.

Example

```
import { VendureConfig, AddressBasedTaxZoneStrategy } from '@vendure/core';export const config: VendureConfig = {  // other options...  taxOptions: {    taxZoneStrategy: new AddressBasedTaxZoneStrategy(),  },};
```

```
class AddressBasedTaxZoneStrategy implements TaxZoneStrategy {    determineTaxZone(ctx: RequestContext, zones: Zone[], channel: Channel, order?: Order) => Zone;}
```

- Implements: TaxZoneStrategy

[TaxZoneStrategy](/reference/typescript-api/tax/tax-zone-strategy#taxzonestrategy)
### determineTaxZone​


[​](#determinetaxzone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Zone](/reference/typescript-api/entities/zone#zone)[Channel](/reference/typescript-api/entities/channel#channel)[Order](/reference/typescript-api/entities/order#order)[Zone](/reference/typescript-api/entities/zone#zone)


---

# DefaultTaxLineCalculationStrategy


## DefaultTaxLineCalculationStrategy​


[​](#defaulttaxlinecalculationstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-tax-line-calculation-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/tax/default-tax-line-calculation-strategy.ts#L12)The default TaxLineCalculationStrategy which applies a single TaxLine to the OrderLine
based on the applicable TaxRate.

[TaxLineCalculationStrategy](/reference/typescript-api/tax/tax-line-calculation-strategy#taxlinecalculationstrategy)[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)
```
class DefaultTaxLineCalculationStrategy implements TaxLineCalculationStrategy {    calculate(args: CalculateTaxLinesArgs) => TaxLine[];}
```

- Implements: TaxLineCalculationStrategy

[TaxLineCalculationStrategy](/reference/typescript-api/tax/tax-line-calculation-strategy#taxlinecalculationstrategy)
### calculate​


[​](#calculate)[CalculateTaxLinesArgs](/reference/typescript-api/tax/tax-line-calculation-strategy#calculatetaxlinesargs)


---

# DefaultTaxZoneStrategy


## DefaultTaxZoneStrategy​


[​](#defaulttaxzonestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[default-tax-zone-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/tax/default-tax-zone-strategy.ts#L15)A default method of determining Zone for tax calculations. The strategy simply returns the default
tax zone of the Channel. In many cases you actually want to base the tax zone
on the shipping or billing address of the Order, in which case you would use the
AddressBasedTaxZoneStrategy.

[AddressBasedTaxZoneStrategy](/reference/typescript-api/tax/address-based-tax-zone-strategy#addressbasedtaxzonestrategy)
```
class DefaultTaxZoneStrategy implements TaxZoneStrategy {    determineTaxZone(ctx: RequestContext, zones: Zone[], channel: Channel, order?: Order) => Zone;}
```

- Implements: TaxZoneStrategy

[TaxZoneStrategy](/reference/typescript-api/tax/tax-zone-strategy#taxzonestrategy)
### determineTaxZone​


[​](#determinetaxzone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Zone](/reference/typescript-api/entities/zone#zone)[Channel](/reference/typescript-api/entities/channel#channel)[Order](/reference/typescript-api/entities/order#order)[Zone](/reference/typescript-api/entities/zone#zone)


---

# TaxLineCalculationStrategy


## TaxLineCalculationStrategy​


[​](#taxlinecalculationstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[tax-line-calculation-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/tax/tax-line-calculation-strategy.ts#L29)This strategy defines how the TaxLines on OrderItems are calculated. By default,
the DefaultTaxLineCalculationStrategy is used, which directly applies
a single TaxLine based on the applicable TaxRate.

[DefaultTaxLineCalculationStrategy](/reference/typescript-api/tax/default-tax-line-calculation-strategy#defaulttaxlinecalculationstrategy)[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)However, custom strategies may use any suitable method for calculating TaxLines.
For example, a third-party tax API or a lookup of a custom tax table may be used.

This is configured via the taxOptions.taxLineCalculationStrategy property of
your VendureConfig.

```
interface TaxLineCalculationStrategy extends InjectableStrategy {    calculate(args: CalculateTaxLinesArgs): TaxLine[] | Promise<TaxLine[]>;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### calculate​


[​](#calculate)[CalculateTaxLinesArgs](/reference/typescript-api/tax/tax-line-calculation-strategy#calculatetaxlinesargs)This method is called when calculating the Order prices. Since it will be called
whenever an Order is modified in some way (adding/removing items, applying promotions,
setting ShippingMethod etc), care should be taken so that calling the function does
not adversely impact overall performance. For example, by using caching and only
calling external APIs when absolutely necessary.

## CalculateTaxLinesArgs​


[​](#calculatetaxlinesargs)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[tax-line-calculation-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/tax/tax-line-calculation-strategy.ts#L47)
```
interface CalculateTaxLinesArgs {    ctx: RequestContext;    order: Order;    orderLine: OrderLine;    applicableTaxRate: TaxRate;}
```

### ctx​


[​](#ctx)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
### order​


[​](#order)[Order](/reference/typescript-api/entities/order#order)
### orderLine​


[​](#orderline)[OrderLine](/reference/typescript-api/entities/order-line#orderline)
### applicableTaxRate​


[​](#applicabletaxrate)[TaxRate](/reference/typescript-api/entities/tax-rate#taxrate)


---

# TaxOptions


## TaxOptions​


[​](#taxoptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/vendure-config.ts#L913)
```
interface TaxOptions {    taxZoneStrategy?: TaxZoneStrategy;    taxLineCalculationStrategy?: TaxLineCalculationStrategy;}
```

### taxZoneStrategy​


[​](#taxzonestrategy)[TaxZoneStrategy](/reference/typescript-api/tax/tax-zone-strategy#taxzonestrategy)[DefaultTaxZoneStrategy](/reference/typescript-api/tax/default-tax-zone-strategy#defaulttaxzonestrategy)Defines the strategy used to determine the applicable Zone used in tax calculations.

### taxLineCalculationStrategy​


[​](#taxlinecalculationstrategy)[TaxLineCalculationStrategy](/reference/typescript-api/tax/tax-line-calculation-strategy#taxlinecalculationstrategy)[DefaultTaxLineCalculationStrategy](/reference/typescript-api/tax/default-tax-line-calculation-strategy#defaulttaxlinecalculationstrategy)Defines the strategy used to calculate the TaxLines added to OrderItems.


---

# TaxZoneStrategy


## TaxZoneStrategy​


[​](#taxzonestrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[tax-zone-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/tax/tax-zone-strategy.ts#L28)Defines how the active Zone is determined for the purposes of calculating taxes.

[Zone](/reference/typescript-api/entities/zone#zone)This strategy is used in 2 scenarios:

- To determine the applicable Zone when calculating the taxRate to apply when displaying ProductVariants. In this case the
order argument will be undefined, as the request is not related to a specific Order.
- To determine the applicable Zone when calculating the taxRate on the contents of a specific Order. In this case the
order argument will be defined, and can be used in the logic. For example, the shipping address can be taken into account.

Note that this method is called very often in a typical user session, so any work it performs should be designed with as little
performance impact as possible.

This is configured via the taxOptions.taxZoneStrategy property of
your VendureConfig.

```
interface TaxZoneStrategy extends InjectableStrategy {    determineTaxZone(        ctx: RequestContext,        zones: Zone[],        channel: Channel,        order?: Order,    ): Zone | Promise<Zone> | undefined;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### determineTaxZone​


[​](#determinetaxzone)[RequestContext](/reference/typescript-api/request/request-context#requestcontext)[Zone](/reference/typescript-api/entities/zone#zone)[Channel](/reference/typescript-api/entities/channel#channel)[Order](/reference/typescript-api/entities/order#order)[Zone](/reference/typescript-api/entities/zone#zone)[Zone](/reference/typescript-api/entities/zone#zone)


---

# Instrument


## Instrument​


[​](#instrument)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[instrument-decorator.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/common/instrument-decorator.ts#L47)This decorator is used to apply instrumentation to a class. It is intended to be used in conjunction
with an InstrumentationStrategy which defines how the instrumentation should be applied.

[InstrumentationStrategy](/reference/typescript-api/telemetry/instrumentation-strategy#instrumentationstrategy)In order for the instrumentation to be applied, the VENDURE_ENABLE_INSTRUMENTATION environment
variable (exported from the @vendure/core package as ENABLE_INSTRUMENTATION_ENV_VAR) must be set to true.
This is done to avoid the overhead of instrumentation in environments where it is not needed.

You should not decorate GraphQL resolvers & REST controllers with this decorator. Those will
already be instrumented, and adding the @Instrument() decorator will potentially
interfere with other NestJS decorators on your resolver methods.

For more information on how instrumentation is used, see docs on the TelemetryPlugin.

Example

```
import { Instrument } from '@vendure/core';import { Injectable } from '@nestjs/common';@Injectable()@Instrument()export class MyService {  // Calls to this method will be instrumented  myMethod() {    // ...  }}
```

```
function Instrument(): ClassDecorator
```


---

# InstrumentationStrategy


## InstrumentationStrategy​


[​](#instrumentationstrategy)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[instrumentation-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/system/instrumentation-strategy.ts#L51)This interface is used to define a strategy for instrumenting methods of
classes which are decorated with the Instrument decorator.

[Instrument](/reference/typescript-api/telemetry/instrument#instrument)
```
interface InstrumentationStrategy extends InjectableStrategy {    wrapMethod(args: WrappedMethodArgs): any;}
```

- Extends: InjectableStrategy

[InjectableStrategy](/reference/typescript-api/common/injectable-strategy#injectablestrategy)
### wrapMethod​


[​](#wrapmethod)[WrappedMethodArgs](/reference/typescript-api/telemetry/wrapped-method-args#wrappedmethodargs)When a method of an instrumented class is called, it will be wrapped (by means of
a Proxy) and this method will be called. The applyOriginalFunction function
will apply the original method and return the result.


---

# WrappedMethodArgs


## WrappedMethodArgs​


[​](#wrappedmethodargs)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[instrumentation-strategy.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/config/system/instrumentation-strategy.ts#L13)The arguments that are passed to the wrapMethod method of the
InstrumentationStrategy interface.

[InstrumentationStrategy](/reference/typescript-api/telemetry/instrumentation-strategy#instrumentationstrategy)
```
interface WrappedMethodArgs {    instance: any;    target: Type<any>;    methodName: string;    args: any[];    applyOriginalFunction: () => any | Promise<any>;}
```

### instance​


[​](#instance)The instance of the class which is being instrumented.

### target​


[​](#target)The class which is being instrumented.

### methodName​


[​](#methodname)The name of the method which is being instrumented.

### args​


[​](#args)The arguments which are passed to the method.

### applyOriginalFunction​


[​](#applyoriginalfunction)A function which applies the original method and returns the result.
This is used to call the original method after the instrumentation has
been applied.


---

# CreateErrorResultGuard


## createErrorResultGuard​


[​](#createerrorresultguard)[@vendure/testing](https://www.npmjs.com/package/@vendure/testing)[error-result-guard.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/testing/src/error-result-guard.ts#L18)Convenience method for creating an ErrorResultGuard. Takes a predicate function which
tests whether the input is considered successful (true) or an error result (false).

[ErrorResultGuard](/reference/typescript-api/testing/error-result-guard#errorresultguard)Note that the resulting variable must still be type annotated in order for the TypeScript
type inference to work as expected:

Example

```
const orderResultGuard: ErrorResultGuard<AddItemToOrderResult>  = createErrorResultGuard(order => !!order.lines);
```

```
function createErrorResultGuard<T>(testFn: (input: T) => boolean): ErrorResultGuard<T>
```

Parameters

### testFn​


[​](#testfn)


---

# CreateTestEnvironment


## createTestEnvironment​


[​](#createtestenvironment)[@vendure/testing](https://www.npmjs.com/package/@vendure/testing)[create-test-environment.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/testing/src/create-test-environment.ts#L60)Configures a TestServer and a SimpleGraphQLClient for each of the GraphQL APIs
for use in end-to-end tests. Returns a TestEnvironment object.

[TestServer](/reference/typescript-api/testing/test-server#testserver)[SimpleGraphQLClient](/reference/typescript-api/testing/simple-graph-qlclient#simplegraphqlclient)[TestEnvironment](/reference/typescript-api/testing/test-environment#testenvironment)Example

```
import { createTestEnvironment, testConfig } from '@vendure/testing';describe('some feature to test', () => {  const { server, adminClient, shopClient } = createTestEnvironment(testConfig);  beforeAll(async () => {    await server.init({        // ... server options    });    await adminClient.asSuperAdmin();  });  afterAll(async () => {      await server.destroy();  });  // ... end-to-end tests here});
```

```
function createTestEnvironment(config: Required<VendureConfig>): TestEnvironment
```

Parameters

### config​


[​](#config)[VendureConfig](/reference/typescript-api/configuration/vendure-config#vendureconfig)


---

# ErrorResultGuard


## ErrorResultGuard​


[​](#errorresultguard)[@vendure/testing](https://www.npmjs.com/package/@vendure/testing)[error-result-guard.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/testing/src/error-result-guard.ts#L50)A utility class which is used to assert the success of an operation
which returns a union type of SuccessType | ErrorResponse [ | ErrorResponse ].
The methods of this class are used to:

- assert that the result is a success or error case
- narrow the type so that TypeScript can correctly infer the properties of the result.

Example

```
const orderResultGuard: ErrorResultGuard<AddItemToOrderResult>  = createErrorResultGuard(order => !!order.lines);it('errors when quantity is negative', async () => {   const { addItemToOrder } = await shopClient.query<AddItemToOrder.Query, AddItemToOrder.Mutation>(ADD_ITEM_TO_ORDER, {     productVariantId: 42, quantity: -1,   });   // The test will fail   orderResultGuard.assertErrorResult(addItemToOrder);   // the type of `addItemToOrder` has now been   // narrowed to only include the ErrorResult types.   expect(addItemToOrder.errorCode).toBe(ErrorCode.NegativeQuantityError);}
```

```
class ErrorResultGuard<T> {    constructor(testFn: (input: T) => boolean)    isSuccess(input: T | any) => input is T;    assertSuccess(input: T | R) => asserts input is T;    assertErrorResult(input: T | R) => asserts input is R;}
```

### constructor​


[​](#constructor)
### isSuccess​


[​](#issuccess)A type guard which returns true if the input passes the testFn predicate.

### assertSuccess​


[​](#assertsuccess)Asserts (using the testing library's fail() function) that the input is
successful, i.e. it passes the testFn.

### assertErrorResult​


[​](#asserterrorresult)Asserts (using the testing library's fail() function) that the input is
not successful, i.e. it does not pass the testFn.


---

# GetSuperadminContext


## getSuperadminContext​


[​](#getsuperadmincontext)[@vendure/testing](https://www.npmjs.com/package/@vendure/testing)[get-superadmin-context.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/testing/src/utils/get-superadmin-context.ts#L11)Creates a RequestContext configured for the default Channel with the activeUser set
as the superadmin user. Useful for populating data.

[RequestContext](/reference/typescript-api/request/request-context#requestcontext)
```
function getSuperadminContext(app: INestApplicationContext): Promise<RequestContext>
```

Parameters

### app​


[​](#app)


---

# RegisterInitializer


## registerInitializer​


[​](#registerinitializer)[@vendure/testing](https://www.npmjs.com/package/@vendure/testing)[initializers.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/testing/src/initializers/initializers.ts#L16)Registers a TestDbInitializer for the given database type. Should be called before invoking
createTestEnvironment.

[TestDbInitializer](/reference/typescript-api/testing/test-db-initializer#testdbinitializer)[createTestEnvironment](/reference/typescript-api/testing/create-test-environment#createtestenvironment)
```
function registerInitializer(type: DataSourceOptions['type'], initializer: TestDbInitializer<any>): void
```

Parameters

### type​


[​](#type)
### initializer​


[​](#initializer)[TestDbInitializer](/reference/typescript-api/testing/test-db-initializer#testdbinitializer)


---

# SimpleGraphQLClient


## SimpleGraphQLClient​


[​](#simplegraphqlclient)[@vendure/testing](https://www.npmjs.com/package/@vendure/testing)[simple-graphql-client.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/testing/src/simple-graphql-client.ts#L40)A minimalistic GraphQL client for populating and querying test data.

```
class SimpleGraphQLClient {    constructor(vendureConfig: Required<VendureConfig>, apiUrl: string = '')    setAuthToken(token: string) => ;    setChannelToken(token: string | null) => ;    getAuthToken() => string;    query(query: DocumentNode | TypedDocumentNode<T, V>, variables?: V, queryParams?: QueryParams) => Promise<T>;    fetch(url: string, options: RequestInit = {}) => Promise<Response>;    queryStatus(query: DocumentNode, variables?: V) => Promise<number>;    asUserWithCredentials(username: string, password: string) => ;    asSuperAdmin() => ;    asAnonymousUser() => ;    fileUploadMutation(options: {        mutation: DocumentNode;        filePaths: string[];        mapVariables: (filePaths: string[]) => any;    }) => Promise<any>;}
```

### constructor​


[​](#constructor)[VendureConfig](/reference/typescript-api/configuration/vendure-config#vendureconfig)
### setAuthToken​


[​](#setauthtoken)Sets the authToken to be used in each GraphQL request.

### setChannelToken​


[​](#setchanneltoken)Sets the authToken to be used in each GraphQL request.

### getAuthToken​


[​](#getauthtoken)Returns the authToken currently being used.

### query​


[​](#query)Performs both query and mutation operations.

### fetch​


[​](#fetch)Performs a raw HTTP request to the given URL, but also includes the authToken & channelToken
headers if they have been set. Useful for testing non-GraphQL endpoints, e.g. for plugins
which make use of REST controllers.

### queryStatus​


[​](#querystatus)Performs a query or mutation and returns the resulting status code.

### asUserWithCredentials​


[​](#asuserwithcredentials)Attempts to log in with the specified credentials.

### asSuperAdmin​


[​](#assuperadmin)Logs in as the SuperAdmin user.

### asAnonymousUser​


[​](#asanonymoususer)Logs out so that the client is then treated as an anonymous user.

### fileUploadMutation​


[​](#fileuploadmutation)Perform a file upload mutation.

Upload spec: https://github.com/jaydenseric/graphql-multipart-request-spec

[https://github.com/jaydenseric/graphql-multipart-request-spec](https://github.com/jaydenseric/graphql-multipart-request-spec)Discussion of issue: https://github.com/jaydenseric/apollo-upload-client/issues/32

[https://github.com/jaydenseric/apollo-upload-client/issues/32](https://github.com/jaydenseric/apollo-upload-client/issues/32)Example

```
// Testing a custom mutation:const result = await client.fileUploadMutation({  mutation: gql`    mutation AddSellerImages($input: AddSellerImagesInput!) {      addSellerImages(input: $input) {        id        name      }    }  `,  filePaths: ['./images/profile-picture.jpg', './images/logo.png'],  mapVariables: () => ({    name: "George's Pans",    profilePicture: null,  // corresponds to filePaths[0]    branding: {      logo: null  // corresponds to filePaths[1]    }  })});
```


---

# TestConfig


## testConfig​


[​](#testconfig)[@vendure/testing](https://www.npmjs.com/package/@vendure/testing)[test-config.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/testing/src/config/test-config.ts#L42)A VendureConfig object used for e2e tests. This configuration uses sqljs as the database
and configures some special settings which are optimized for e2e tests:

[VendureConfig](/reference/typescript-api/configuration/vendure-config#vendureconfig)- entityIdStrategy: new TestingEntityIdStrategy() This ID strategy uses auto-increment IDs but encodes all IDs
to be prepended with the string 'T_', so ID 1 becomes 'T_1'.
- logger: new NoopLogger() Do no output logs by default
- assetStorageStrategy: new TestingAssetStorageStrategy() This strategy does not actually persist any binary data to disk.
- assetPreviewStrategy: new TestingAssetPreviewStrategy() This strategy is a no-op.

## Logging​


[​](#logging)By default, the testConfig does not output any log messages. This is most desirable to keep a clean CI output.
However, for debugging purposes, it can make it hard to figure out why tests fail.

You can enable default logging behaviour with the environment variable LOG:

```
LOG=true yarn e2e
```


---

# TestDbInitializer


## TestDbInitializer​


[​](#testdbinitializer)[@vendure/testing](https://www.npmjs.com/package/@vendure/testing)[test-db-initializer.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/testing/src/initializers/test-db-initializer.ts#L23)Defines how the e2e TestService sets up a particular DB to run a single test suite.
The @vendure/testing package ships with initializers for sql.js, MySQL & Postgres.

Custom initializers can be created by implementing this interface and registering
it with the registerInitializer function:

[registerInitializer](/reference/typescript-api/testing/register-initializer#registerinitializer)Example

```
export class CockroachDbInitializer implements TestDbInitializer<CockroachConnectionOptions> {    // database-specific implementation goes here}registerInitializer('cockroachdb', new CockroachDbInitializer());
```

```
interface TestDbInitializer<T extends BaseConnectionOptions> {    init(testFileName: string, connectionOptions: T): Promise<T>;    populate(populateFn: () => Promise<void>): Promise<void>;    destroy(): void | Promise<void>;}
```

### init​


[​](#init)Responsible for creating a database for the current test suite.
Typically, this method will:

- use the testFileName parameter to derive a database name
- create the database
- mutate the connetionOptions object to point to that new database

### populate​


[​](#populate)Execute the populateFn to populate your database.

### destroy​


[​](#destroy)Clean up any resources used during the init() phase (i.e. close open DB connections)


---

# TestEnvironment


## TestEnvironment​


[​](#testenvironment)[@vendure/testing](https://www.npmjs.com/package/@vendure/testing)[create-test-environment.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/testing/src/create-test-environment.ts#L13)The return value of createTestEnvironment, containing the test server
and clients for the Shop API and Admin API.

[createTestEnvironment](/reference/typescript-api/testing/create-test-environment#createtestenvironment)
```
interface TestEnvironment {    server: TestServer;    adminClient: SimpleGraphQLClient;    shopClient: SimpleGraphQLClient;}
```

### server​


[​](#server)[TestServer](/reference/typescript-api/testing/test-server#testserver)A Vendure server instance against which GraphQL requests can be made.

### adminClient​


[​](#adminclient)[SimpleGraphQLClient](/reference/typescript-api/testing/simple-graph-qlclient#simplegraphqlclient)A GraphQL client configured for the Admin API.

### shopClient​


[​](#shopclient)[SimpleGraphQLClient](/reference/typescript-api/testing/simple-graph-qlclient#simplegraphqlclient)A GraphQL client configured for the Shop API.


---

# TestServerOptions


## TestServerOptions​


[​](#testserveroptions)[@vendure/testing](https://www.npmjs.com/package/@vendure/testing)[types.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/testing/src/types.ts#L14)Configuration options used to initialize an instance of the TestServer.

[TestServer](/reference/typescript-api/testing/test-server#testserver)
```
interface TestServerOptions {    productsCsvPath?: string;    initialData: InitialData;    customerCount?: number;    logging?: boolean;}
```

### productsCsvPath​


[​](#productscsvpath)The path to an optional CSV file containing product data to import.

### initialData​


[​](#initialdata)[InitialData](/reference/typescript-api/import-export/initial-data#initialdata)An object containing non-product data which is used to populate the database.

### customerCount​


[​](#customercount)The number of fake Customers to populate into the database.

### logging​


[​](#logging)Set this to true to log some information about the database population process.

---

# TestServer


## TestServer​


[​](#testserver)[@vendure/testing](https://www.npmjs.com/package/@vendure/testing)[test-server.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/testing/src/test-server.ts#L17)A real Vendure server against which the e2e tests should be run.

```
class TestServer {    public app: INestApplication;    constructor(vendureConfig: Required<VendureConfig>)    init(options: TestServerOptions) => Promise<void>;    bootstrap() => ;    destroy() => ;}
```

### app​


[​](#app)
### constructor​


[​](#constructor)[VendureConfig](/reference/typescript-api/configuration/vendure-config#vendureconfig)
### init​


[​](#init)[TestServerOptions](/reference/typescript-api/testing/test-server-options#testserveroptions)Bootstraps an instance of Vendure server and populates the database according to the options
passed in. Should be called in the beforeAll function.

The populated data is saved into an .sqlite file for each test file. On subsequent runs, this file
is loaded so that the populate step can be skipped, which speeds up the tests significantly.

### bootstrap​


[​](#bootstrap)Bootstraps a Vendure server instance. Generally the .init() method should be used, as that will also
populate the test data. However, the bootstrap() method is sometimes useful in tests which need to
start and stop a Vendure instance multiple times without re-populating data.

### destroy​


[​](#destroy)Destroy the Vendure server instance and clean up all resources.
Should be called after all tests have run, e.g. in an afterAll function.


---

# TestingLogger


## TestingLogger​


[​](#testinglogger)[@vendure/testing](https://www.npmjs.com/package/@vendure/testing)[testing-logger.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/testing/src/testing-logger.ts#L55)The TestingLogger can be used in unit tests or e2e tests to make assertions on whether the various
Logger methods have been called, and which arguments.

Here's some examples of how to use it in e2e tests and unit tests. In both cases we are using
the Jest testing framework, but the TestingLogger should work with other similar frameworks
(e.g. replacing jest.fn() with jasmine.createSpy()).

Example

```
// e2e test exampleimport { createTestEnvironment, TestingLogger } from '@vendure/testing';const testingLogger = new TestingLogger(() => jest.fn());const { server, adminClient, shopClient } = createTestEnvironment({  ...testConfig,  logger: testingLogger,});// e2e testing setup omittedit('should log an error', async () => {  // The `errorSpy` property exposes the Jest mock function  testingLogger.errorSpy.mockClear();  await doSomethingThatErrors();  expect(testingLogger.errorSpy).toHaveBeenCalled();});
```

Example

```
// unit test exampleimport { Test } from '@nestjs/testing';import { Logger } from '@vendure/core';import { TestingLogger } from '@vendure/testing';beforeEach(async () => {  const moduleRef = await Test.createTestingModule({    // Nest testing setup omitted  }).compile();  Logger.useLogger(testingLogger);  moduleRef.useLogger(new Logger());}
```

```
class TestingLogger<Spy extends (...args: any[]) => any> implements VendureLogger {    constructor(createSpyFn: () => Spy)    debugSpy: Spy;    errorSpy: Spy;    infoSpy: Spy;    verboseSpy: Spy;    warnSpy: Spy;    debug(message: string, context?: string) => void;    error(message: string, context?: string, trace?: string) => void;    info(message: string, context?: string) => void;    verbose(message: string, context?: string) => void;    warn(message: string, context?: string) => void;}
```

- Implements: VendureLogger

[VendureLogger](/reference/typescript-api/logger/vendure-logger#vendurelogger)
### constructor​


[​](#constructor)
### debugSpy​


[​](#debugspy)
### errorSpy​


[​](#errorspy)
### infoSpy​


[​](#infospy)
### verboseSpy​


[​](#verbosespy)
### warnSpy​


[​](#warnspy)
### debug​


[​](#debug)
### error​


[​](#error)
### info​


[​](#info)
### verbose​


[​](#verbose)
### warn​


[​](#warn)


---


# BootstrapWorker


## bootstrapWorker​


[​](#bootstrapworker)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[bootstrap.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/bootstrap.ts#L225)Bootstraps a Vendure worker. Resolves to a VendureWorker object containing a reference to the underlying
NestJs standalone application as well as convenience
methods for starting the job queue and health check server.

[VendureWorker](/reference/typescript-api/worker/vendure-worker#vendureworker)[standalone application](https://docs.nestjs.com/standalone-applications)Read more about the Vendure Worker.

[Vendure Worker](/guides/developer-guide/worker-job-queue/)Example

```
import { bootstrapWorker } from '@vendure/core';import { config } from './vendure-config';bootstrapWorker(config)  .then(worker => worker.startJobQueue())  .then(worker => worker.startHealthCheckServer({ port: 3020 }))  .catch(err => {    console.log(err);    process.exit(1);  });
```

```
function bootstrapWorker(userConfig: Partial<VendureConfig>, options?: BootstrapWorkerOptions): Promise<VendureWorker>
```

Parameters

### userConfig​


[​](#userconfig)[VendureConfig](/reference/typescript-api/configuration/vendure-config#vendureconfig)
### options​


[​](#options)[BootstrapWorkerOptions](/reference/typescript-api/worker/bootstrap-worker#bootstrapworkeroptions)
## BootstrapWorkerOptions​


[​](#bootstrapworkeroptions)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[bootstrap.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/bootstrap.ts#L83)Additional options that can be used to configure the bootstrap process of the
Vendure worker.

```
interface BootstrapWorkerOptions {    nestApplicationContextOptions?: NestApplicationContextOptions;    ignoreCompatibilityErrorsForPlugins?: Array<DynamicModule | Type<any>>;}
```

### nestApplicationContextOptions​


[​](#nestapplicationcontextoptions)These options get passed directly to the NestFactory.createApplicationContext method.

### ignoreCompatibilityErrorsForPlugins​


[​](#ignorecompatibilityerrorsforplugins)See the ignoreCompatibilityErrorsForPlugins option in BootstrapOptions.

[BootstrapOptions](/reference/typescript-api/common/bootstrap#bootstrapoptions)


---

# VendureWorker


## VendureWorker​


[​](#vendureworker)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[vendure-worker.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/worker/vendure-worker.ts#L13)This object is created by calling the bootstrapWorker function.

[bootstrapWorker](/reference/typescript-api/worker/bootstrap-worker#bootstrapworker)
```
class VendureWorker {    public app: INestApplicationContext;    constructor(app: INestApplicationContext)    startJobQueue() => Promise<VendureWorker>;    startHealthCheckServer(healthCheckConfig: WorkerHealthCheckConfig) => Promise<VendureWorker>;}
```

### app​


[​](#app)A reference to the INestApplicationContext object, which represents
the NestJS standalone application instance.

[standalone application](https://docs.nestjs.com/standalone-applications)
### constructor​


[​](#constructor)
### startJobQueue​


[​](#startjobqueue)[VendureWorker](/reference/typescript-api/worker/vendure-worker#vendureworker)Starts the job queues running so that the worker can handle background jobs.

### startHealthCheckServer​


[​](#starthealthcheckserver)[WorkerHealthCheckConfig](/reference/typescript-api/worker/worker-health-check-config#workerhealthcheckconfig)[VendureWorker](/reference/typescript-api/worker/vendure-worker#vendureworker)Starts a simple http server which can be used as a health check on the worker instance.
This endpoint can be used by container orchestration services such as Kubernetes to
verify whether the worker is running.


---

# WorkerHealthCheckConfig


## WorkerHealthCheckConfig​


[​](#workerhealthcheckconfig)[@vendure/core](https://www.npmjs.com/package/@vendure/core)[worker-health.service.ts](https://github.com/vendure-ecommerce/vendure/blob/master/packages/core/src/worker/worker-health.service.ts#L14)Specifies the configuration for the Worker's HTTP health check endpoint.

```
interface WorkerHealthCheckConfig {    port: number;    hostname?: string;    route?: string;}
```

### port​


[​](#port)The port on which the worker will listen

### hostname​


[​](#hostname)The hostname

### route​


[​](#route)The route at which the health check is available.


---

